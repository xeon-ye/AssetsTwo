function styler(){return"cursor:pointer;"}function changeTabs(c,a,b){if(a==1){$("#divDept").css("height",document.body.clientHeight-95);$("#saveButton").linkbutton("disable");if(!dgMapDept){dgMapDept=$("#dgMapDept").datagrid({queryParams:{id:b},onClickCell:onClickCellDept})}}else{if(a==2){$("#divRole").css("height",document.body.clientHeight-95);$("#saveButton").linkbutton("disable");if(!dgMapUserRole){$.ajax({url:"platform/cc/sysuser/getRoleCode.json",data:{},type:"POST",dataType:"json",success:function(d){if(d.roleType){roleType=d.roleType}if(d.validFlag){roleValFlag=d.validFlag}}});dgMapUserRole=$("#dgMapUserRole").datagrid({queryParams:{userId:b},onClickCell:onClickCellRole})}}else{$("#saveButton").linkbutton("enable")}}}function closeForm(){if(parent!=null){parent.flushData();parent.$closeEditIfram()}}function saveForm(){if($("#formEditBaseInfo").form("validate")==false){return}$("#saveButton").linkbutton("disable");var b=$("#formEditBaseInfo").serializeArray();var a=convertToJson(b);b=JSON.stringify(a);$.ajax({url:"platform/cc/sysuser/toSaveUser/2",data:{datas:JSON.stringify(serializeObject($("#formEditBaseInfo")))},type:"post",dataType:"json",success:function(c){if(c.flag=="success"){showMessager("保存成功!");if(parent!=null){parent.flushData();parent.$closeEditIfram()}}else{showMessager("保存失败!"+c.error)}$("#saveButton").linkbutton("enable")}})}$.extend($.fn.datagrid.methods,{editCell:function(b,a){return b.each(function(){var c=$(this).datagrid("getColumnFields",true).concat($(this).datagrid("getColumnFields"));var d=c.length;for(;d--;){var e=$(this).datagrid("getColumnOption",c[d]);e.editor1=e.editor;if(c[d]!=a.field&&c[d]!="deptId"&&c[d]!="positionId"){e.editor=null}}$(this).datagrid("beginEdit",a.index);d=c.length;for(;d--;){var e=$(this).datagrid("getColumnOption",c[d]);e.editor=e.editor1}})}});function addMapDept(){endEditing();dgMapDept.datagrid("insertRow",{index:0,row:{id:"",deptId:"",deptName:"",positionId:"",positionName:"",validFlag:0,isChiefDept:0,isManager:0}})}function saveMapDept(g){var e=dgMapDept.datagrid("getRows"),a=e.length,c=a,f,b={};for(;a--;){f=e[a];if(!f.deptName){$.messager.show({title:"提示",msg:"第"+(a+1)+"条数据中,部门名称不能为空!"});return false}if(!f.positionName){$.messager.show({title:"提示",msg:"第"+(a+1)+"条数据中,岗位名称不能为空!"});return false}if(b[f.deptId]){$.messager.show({title:"提示",msg:"第"+(a+1)+"条数据中,部门名称已经存在!"});return false}b[f.deptId]=2}var d=JSON.stringify(e);if(e.length>0){$.ajax({url:"platform/cc/sysuser/saveMapDept",data:{datas:d,userId:g},type:"post",dataType:"json",success:function(h){if(h.flag=="success"){reloadMapDept(g);if(h.deptId){$("#deptId").val(h.deptId);$("#deptIdAlias").val(h.deptName);$("#positonId").val(h.positonId);$("#positionName").val(h.positionName);if(h.isManager=="1"){$("input[name='isManager'][value=1]").attr("checked",true)}else{$("input[name='isManager'][value=0]").attr("checked",true)}}showMessager("保存成功！")}else{if(h.error){$.messager.alert("提示",h.error,"warning")}else{showMessager("保存失败，用户不存在!")}}}})}else{showMessager("没有要提交的数据！")}}function deleteMapDept(b){var d=dgMapDept.datagrid("getChecked");var c=[];var a=d.length;if(d.length>0){$.messager.confirm("请确认","您确定要删除当前所选的数据？",function(e){if(e){for(;a--;){c.push(d[a].id)}$.ajax({url:"platform/cc/sysuser/deleteMapDept",data:{ids:c.join(",")},type:"post",dataType:"json",success:function(f){if(f.flag=="success"){reloadMapDept(b);showMessager("删除成功!")}}})}})}else{$.messager.alert("提示","请选择要删除的记录！","warning")}}function reloadMapDept(a){dgMapDept.datagrid("uncheckAll").datagrid("unselectAll").datagrid("clearSelections");dgMapDept.datagrid("reload",{id:a})}function endEditing(){if(editIndex==undefined){return true}dgMapDept.datagrid("endEdit",editIndex);editIndex=undefined;return true}function callBackDept(b){dgMapDept.datagrid("beginEdit",b);var a=dgMapDept.datagrid("getEditor",{index:b,field:"validFlag"});$(a.target).val(1);dgMapDept.datagrid("endEdit",b)}function changeMgr(b,d,c){endEditing();var e=dgMapDept.datagrid("getRows")[b];var c=(parseInt(e.isManager)+1)&1;dgMapDept.datagrid("beginEdit",b);var a=dgMapDept.datagrid("getEditor",{index:b,field:"isManager"});$(a.target).val(c);dgMapDept.datagrid("endEdit",b)}function changeIsChiefDept(b,g,f){endEditing();var e=dgMapDept.datagrid("getRows");var c=e.length;var d=(parseInt(f)+1)&1;for(;c--;){if(e[c].isChiefDept==1){dgMapDept.datagrid("beginEdit",c);var a=dgMapDept.datagrid("getEditor",{index:c,field:g});$(a.target).val(0);dgMapDept.datagrid("endEdit",c);break}}dgMapDept.datagrid("beginEdit",b);var a=dgMapDept.datagrid("getEditor",{index:b,field:"isChiefDept"});$(a.target).val(d);dgMapDept.datagrid("endEdit",b)}function editDeptPos(a,d,b){if(endEditing()){var c=$("#dgMapDept").datagrid("getRows")[a];if(d==="deptName"){comSelect=new GridCommonSelector("dept","dgMapDept",a,"deptId",{targetId:"deptId"},function(g,e){var f={deptId:e.deptId,deptName:e.deptName,validFlag:e.deptId?1:0,orgIdentity:e.orgIdentity};if(c.orgIdentity&&c.orgIdentity!==e.orgIdentity){f.positionId="";f.positionName=""}$("#dgMapDept").datagrid("updateRow",{index:a,row:f})},500,400,null,1,null,null,"2");comSelect.init(c)}else{if(!c.deptId){alert("请首先选择部门!");return}comSelect=new GridCommonSelector("position","dgMapDept",a,"deptId",{targetId:"positionId"},function(f,e){$("#dgMapDept").datagrid("updateRow",{index:a,row:{positionId:e.positionId,positionName:e.positionName}})},JSON.stringify({orgIdentity:c.orgIdentity}),400,400,1,null,null,"-2");comSelect.init(c)}}}function onClickCellDept(a,c,b){switch(c){case"isManager":changeMgr(a,c,b);return false;case"validFlag":return false;case"isChiefDept":changeIsChiefDept(a,c,b);break;default:editDeptPos(a,c,b)}}function formateManeger(c,d,b){var a=d.isManager==0?"":'checked="true"';return'<input type="checkbox" '+a+"/>"}function formateChiefDept(c,d,b){var a=d.isChiefDept==0?"":'checked="true"';return'<input type="checkbox"'+a+"/>"}function formateValidFlag(b,c,a){return b==1?"有效":"无效"}function formateRoleType(c,d,b){var a=roleType.length;for(;a--;){if(roleType[a].lookupCode==c){return roleType[a].lookupName}}}function formateRoleFlag(c,d,b){var a=roleValFlag.length;for(;a--;){if(roleValFlag[a].lookupCode==c){return roleValFlag[a].lookupName}}}function addMapRole(){endRoleEditing();dgMapUserRole.datagrid("insertRow",{index:0,row:{id:+new Date(),roleId:"",roleName:"",roleName:"",validFlag:""}})}function saveMapUserRole(a){var d=dgMapUserRole.datagrid("getChanges");var b=[];var c=d.length;if(c>0){$.ajax({url:"platform/cc/sysuser/saveMapRole",data:{datas:JSON.stringify(d),userId:a},type:"post",dataType:"json",success:function(e){if(e.flag=="success"){reloadMapRole(a);showMessager("保存成功！")}else{if(e.error){$.messager.alert("提示","保存失败,"+e.error,"warning")}else{showMessager("保存失败，用户不存在！")}}}})}else{showMessager("没有要提交的数据！")}}function callBackRole(b,c){dgMapUserRole.datagrid("beginEdit",b);var a=dgMapUserRole.datagrid("getEditor",{index:b,field:"roleName"});$(a.target).combobox("setValue",c[0].roleName);dgMapUserRole.datagrid("endEdit",b);dgMapUserRole.datagrid("beginEdit",b);a=dgMapUserRole.datagrid("getEditor",{index:b,field:"roleType"});$(a.target).val(c[0].roleType);a=dgMapUserRole.datagrid("getEditor",{index:b,field:"sysRoleId"});$(a.target).val(c[0].id);a=dgMapUserRole.datagrid("getEditor",{index:b,field:"validFlag"});$(a.target).val(c[0].validFlag);dgMapUserRole.datagrid("endEdit",b);$("#datagrid-row-r1-2-"+b).find(".datagrid-cell-c1-roleName").text(c[0].roleName)}function reloadMapRole(a){dgMapUserRole.datagrid("uncheckAll").datagrid("unselectAll").datagrid("clearSelections");dgMapUserRole.datagrid("reload",{userId:a})}function deleteMapUserRole(a){var e=dgMapUserRole.datagrid("getChecked");var d=dgMapUserRole.datagrid("getRows").length;var c=e.length;if(c==d){$.messager.alert("提示","至少保留一条用户角色信息","warning");return false}var b=[];if(c>0){$.messager.confirm("请确认","您确定要删除当前所选的数据？",function(f){if(f){for(;c--;){b.push(e[c].sysRoleId)}$.ajax({url:"platform/cc/sysuser/deleteMapRole",data:{ids:b.join(","),userId:a},type:"post",dataType:"json",success:function(g){if(g.flag=="success"){reloadMapRole(a);showMessager("删除成功!")}else{showMessager("保存失败,"+g.error)}}})}})}else{$.messager.alert("提示","请选择要删除的记录！","warning")}}function endRoleEditing(){if(editIndexRole==undefined){return true}dgMapUserRole.datagrid("endEdit",editIndexRole);editIndexRole=undefined;return true}function onClickCellRole(a,b){if(b=="roleType"||b=="validFlag"){return false}if(endRoleEditing()){dgMapUserRole.datagrid("selectRow",a).datagrid("editCell",{index:a,field:b});editIndexRole=a}};