function clickComponentCell(c,b,a){switch(b){case"READGRANTED":if(a==null||typeof(a)=="undefined"||a.length==0){setComponentAuth("S","1","1",c)}else{if(a=="1"){setComponentAuth("S","0","",c)}else{if(a=="0"){setComponentAuth("S","del","",c)}}}break;case"WRITEGRANTED":if(a==null||typeof(a)=="undefined"||a.length==0){setComponentAuth("S","1","1",c)}else{if(a=="1"){setComponentAuth("S","","0",c)}else{if(a=="0"){setComponentAuth("S","","del",c)}}}break}}function findComponentResources(c,d){var a=$("#componentsDataGrid");var b=a.datagrid("options").queryParams;if(c==null||typeof(c)=="undefined"){c="1"}b.urlId=c;b.targetType=TARGET_TYPE;b.targetId=TARGET_ID;b.queryKeyWord=d;b.appId=_APPID;a.datagrid("options").queryParams=b;a.datagrid("load");$(".searchbox-text:eq(2)").val("")}function initComponentSearch(){$("#searchKeyWord").searchbox({width:200,searcher:function(b){var a=$("#tg").treegrid("getSelected");var c=a==null?null:a.ID;findComponentResources(c,b)},prompt:"请输入组件名称或标识！"})}function comReadAuthFormat(b,a,c){if("1"==b){return"<img src='static/images/platform/sysmenuaccesscontrol/ok.png' title='允许访问' alt='允许访问' >"}if("0"==b){return"<img src='static/images/platform/sysmenuaccesscontrol/no.gif' title='禁止访问' alt='禁止访问' >"}return"<img src='static/images/platform/sysmenuaccesscontrol/untitled.png' title='未设置权限' alt='未设置权限' >"}function comWriteAuthFormat(b,a,c){if("1"==b){return"<img src='static/images/platform/sysmenuaccesscontrol/ok.png' title='允许编辑' alt='允许编辑' >"}if("0"==b){return"<img src='static/images/platform/sysmenuaccesscontrol/no.gif' title='禁止编辑' alt='禁止编辑' >"}return"<img src='static/images/platform/sysmenuaccesscontrol/untitled.png' title='未设置权限' alt='未设置权限' >"}function setComponentAuth(g,k,f,i){var j="";var a="";var h=$("#componentsDataGrid");if(g=="S"){var l=h.datagrid("getRows");var c=l[i];var b=c.ACCESSCONTROLID;var e=c.ID;c=null;if(b!=null&&b.length>0){j=b}else{a=e}}else{var l=h.datagrid("getChecked");if(l==null||l.length==0){$.messager.alert("提示","请勾选若干组件后再进行此操作！","info");return}if(l!=null&&l.length>0){$.each(l,function(m,n){var o=n.ACCESSCONTROLID;if(o!=null&&o.length>0){if(j.length==0){j=n.ACCESSCONTROLID}else{j+=","+n.ACCESSCONTROLID}}else{if(a.length==0){a=n.ID}else{a+=","+n.ID}}})}}var d="";if(j!=null&&j.length>0){d+="accessControlIds="+j}if(a!=null&&a.length>0){d+="&resourceIds="+a}if(k!=null&&k.length>0){d+="&readStatus="+k}if(f!=null&&f.length>0){d+="&writeStatus="+f}if(TARGET_TYPE!=null&&TARGET_TYPE.length>0){d+="&targetType="+TARGET_TYPE}if(TARGET_ID!=null&&TARGET_ID.length>0){d+="&targetId="+TARGET_ID}if(_APPID!=null&&_APPID.length>0){d+="&appId="+_APPID}$.ajax({url:"platform/cc/componentmanager/updateComponentResourceAuth.json",type:"POST",dataType:"json",data:d,success:function(){var m=$("#tg").treegrid("getSelected");var n=m==null?null:m.ID;findComponentResources(n,"");h.datagrid("uncheckAll").datagrid("unselectAll").datagrid("clearSelections");$.messager.show({title:"提示",msg:"页面组件授权成功。",timeout:2000,showType:"slide"})},error:function(m,o,n){alert(m.status);alert(o);alert(m.readyState)}})}function refreshAuthority(){$.messager.confirm("加载资源权限信息","确认要重新加载资源权限信息吗？",function(a){if(a){$.ajax({url:"platform/cc/componentmanager/refreshComponentAuthority/"+_APPID+".json",type:"POST",dataType:"json",success:function(b){if(b.flag=="success"){$.messager.show({title:"提示",msg:"刷新菜单授权缓存成功。",timeout:2000,showType:"slide"})}else{$.messager.show({title:"提示",msg:b.e,timeout:2000,showType:"slide"})}},error:function(b,d,c){}})}})}function refreshComponent(){var a=$("#tg").treegrid("getSelected");var b=a==null?null:a.ID;if(!b){$.messager.alert("提示","请选择一个菜单！","info");return}$.ajax({url:"platform/cc/componentmanager/refreshComponent4Page.json?resourceId="+b+"&appId="+_APPID,type:"POST",dataType:"json",data:b,success:function(c){if(c.flag=="success"){findComponentResources(b,"");$.messager.show({title:"提示",msg:"重载页面组件成功。",timeout:2000,showType:"slide"})}else{if(c.flag=="failure"){if(c.error){$.messager.show({title:"提示",msg:c.error,timeout:2000,showType:"slide"})}}}},error:function(c,e,d){}})}function deleteComponentResources(){var a=$("#componentsDataGrid").datagrid("getChecked");var b="";if(a!=null&&a.length>0){$.each(a,function(c,d){if(b.length==0){b=d.ID}else{b+=","+d.ID}})}if(b!=null&&b.length>0){$.messager.confirm("删除组件","确认要删除选择的组件及相关的权限吗？",function(c){if(c){$.ajax({url:"platform/cc/componentmanager/deleteComponentResources.json",type:"POST",dataType:"json",data:"deleteIds="+b,success:function(e){if(e.flag=="success"){var d=$("#tg").treegrid("getSelected");var f=d==null?null:d.ID;$("#componentsDataGrid").datagrid("uncheckAll").datagrid("unselectAll").datagrid("clearSelections");findComponentResources(f,"");$.messager.show({title:"提示",msg:"组件删除成功。",timeout:2000,showType:"slide"})}else{if(e.flag=="failure"){if(e.error){$.messager.show({title:"提示",msg:e.error,timeout:2000,showType:"slide"})}}}}})}})}else{$.messager.alert("提示","请选择需要删除的组件！","info");return}};