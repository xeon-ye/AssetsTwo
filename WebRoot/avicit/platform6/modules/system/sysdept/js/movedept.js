$(document).bind("contextmenu",function(){return false});var MoveDept=(function(e){var g,d,f,h,a=function(j,i){d=j;f=i;g=e("#tree").tree({url:"platform/sysdept/move/deptTree/list",onBeforeLoad:function(k,l){if(!k){l.id=j;l.root=1;l.level=2;l.type=0;return}l.root=2;l.level=1;l.type=k.attributes.type},onLoadSuccess:function(l,m){var k=g.tree("find",f);if(k){g.tree("remove",k.target)}},onSelect:function(k){h=k},formatter:function(k){if(k.attributes.v){return'<a style="color:#fff;font-weight:normal;background:#3399ff;padding:0 4px;">'+k.text+"</a>"}return k.text},});e("#search").searchbox({width:200,searcher:function(k){if(k==null||k==""){g.tree("reload");return}e.ajax({type:"post",url:"platform/sysdept/move/deptTree/search/list",dataType:"json",data:{s:k,c:f,i:d},error:function(l){throw new Error("操作失败，服务请求状态："+l.status+" "+l.statusText+" 请检查服务是否可用！")},success:function(l){if(l.flag==0){alert(l.msg);return}if(l.data){g.tree("loadData",l.data)}else{g.tree("loadData",{})}}})},prompt:"请输入部门名称！"})},c=function(){if(parent.$tree.tree("getParent",parent.currTreeNode.target).id===h.id){b();return true}var i=parent.$tree.tree("find",h.id);e.ajax({url:"platform/sysdept/move/deptTree/save",data:{src:f,des:h.id,type:h.attributes.type},type:"post",dataType:"json",success:function(l){if(!l.flag){var k;if(i){k=parent.$tree.tree("pop",parent.currTreeNode.target);if(i.state==="open"){parent.$tree.tree("append",{parent:i.target,data:[k]});parent.$tree.tree("select",k.target);parent.deptTreeOnClickRow(k)}else{parent.$tree.tree("select",i.target);parent.deptTreeOnClickRow(i)}}else{var j=parent.$tree.tree("getParent",parent.currTreeNode.target);parent.$tree.tree("pop",parent.currTreeNode.target);parent.$tree.tree("select",j.target);parent.deptTreeOnClickRow(j)}b()}else{alert(l.msg)}}})},b=function(){if(parent){parent.closeMove()}};return{init:function(j,i){a(j,i);return this},saveMove:function(){if(!h){alert("请选择一个组织或者部门!");return false}c()},closeForm:function(){b();return false}}}(jQuery));