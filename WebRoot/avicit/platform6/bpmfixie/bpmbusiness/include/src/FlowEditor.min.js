/**
 * 业务操作父类
 *//**
 * 数据模板
 *//**
 * 按钮基类
 *//**
 * 流程增发
 *//**
 * 关注工作
 *//**
 * 流程结束
 *//**
 * 流程跳转
 *//**
 * 流程意见修改
 *//**
 * 流程恢复
 *//**
 * 流程暂停
 *//**
 * 流程退回，包括退回上一步和退回拟稿人
 *//**
 * 保存
 *//**
 * 自定义选人
 *//**
 * 提交，多个提交合成一个
 *//**
 * 流程转办
 *//**
 * 催办下节点
 *//**
 * 补发
 *//**
 * 增加读者
 *//**
 * 流程转发
 *//**
 * 拿回
 *//**
 * 节点内拿回
 */
function DefaultForm(){}DefaultForm.prototype.flowEditor=null;DefaultForm.prototype.isAutoSave=!0;DefaultForm.prototype.id=null;DefaultForm.prototype.setId=function(a){this.id=a};DefaultForm.prototype.initFormData=function(){};DefaultForm.prototype.start=function(a,b){};DefaultForm.prototype.save=function(a){};DefaultForm.prototype.afterCreateButtons=function(){};DefaultForm.prototype.afterControlFormInput=function(){};DefaultForm.prototype.filterSecretLevel=function(a){return a};DefaultForm.prototype.validSecretLevel=function(a){return!0};DefaultForm.prototype.setAttachMagic=function(a){};DefaultForm.prototype.setAttachCanAddOrDel=function(a,b,c){};DefaultForm.prototype.setAttachRequired=function(a,b,c){};DefaultForm.prototype.setAttachSecretLevelModify=function(a,b,c){};DefaultForm.prototype.controlSelfElement=function(a,b,c){};DefaultForm.prototype.controlSelfElementForAccess=function(a,b,c){};DefaultForm.prototype.controlSelfElementForRequired=function(a,b,c){};DefaultForm.prototype.controlSubTableButtonForAccess=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForAccess=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForOperability=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForRequired=function(a,b,c){};DefaultForm.prototype.reGetidea=function(a,b){return a};DefaultForm.prototype.afterInit=function(){};DefaultForm.prototype.beforeSubmit=function(a){return!0};DefaultForm.prototype.afterSubmit=function(a){};DefaultForm.prototype.beforeRetreat=function(a){return!0};DefaultForm.prototype.afterRetreat=function(a){};DefaultForm.prototype.beforeWithdraw=function(a){return!0};DefaultForm.prototype.afterWithdraw=function(a){};DefaultForm.prototype.beforeSupplement=function(a){return!0};DefaultForm.prototype.afterSupplement=function(a){};DefaultForm.prototype.beforeAdduser=function(a){return!0};DefaultForm.prototype.afterAdduser=function(a){};DefaultForm.prototype.beforeSupersede=function(a){return!0};DefaultForm.prototype.afterSupersede=function(a){};DefaultForm.prototype.beforeTransmit=function(a){return!0};DefaultForm.prototype.afterTransmit=function(a){};DefaultForm.prototype.beforeTaskreader=function(a){return!0};DefaultForm.prototype.afterTaskreader=function(a){};DefaultForm.prototype.beforeWithdrawassignee=function(a){return!0};DefaultForm.prototype.afterWithdrawassignee=function(a){};DefaultForm.prototype.beforeGlobalend=function(a){return!0};DefaultForm.prototype.afterGlobalend=function(a){};DefaultForm.prototype.beforeGlobaljump=function(a){return!0};DefaultForm.prototype.afterGlobaljump=function(a){};DefaultForm.prototype.beforeGlobalresume=function(a){return!0};DefaultForm.prototype.afterGlobalresume=function(a){};DefaultForm.prototype.beforeGlobalsuspend=function(a){return!0};DefaultForm.prototype.afterGlobalsuspend=function(a){};DefaultForm.prototype.beforeStepuserdefined=function(a){return!0};DefaultForm.prototype.afterStepuserdefined=function(a){};DefaultForm.prototype.beforePresstodo=function(a){return!0};DefaultForm.prototype.afterPresstodo=function(a){};DefaultForm.prototype.getLeadButCodeList=function(){var a=[];a.push("dosubmit");a.push("dosubmit_mesh");a.push("dostart");a.push("dotransmitsubmit");return a};function FlowModel(a,b,c,d,e){this.defineId=a;this.deploymentId=b;this.entryId=_fileupload_entryId=c;this.executionId=d;this.taskId=e}FlowModel.prototype.defineId=null;FlowModel.prototype.setDefineId=function(a){this.defineId=a};FlowModel.prototype.deploymentId=null;FlowModel.prototype.setDeploymentId=function(a){this.deploymentId=a};FlowModel.prototype.entryId=null;FlowModel.prototype.setEntryId=function(a){this.entryId=_fileupload_entryId=a};FlowModel.prototype.executionId=null;FlowModel.prototype.setExecutionId=function(a){this.executionId=a};FlowModel.prototype.taskId=null;FlowModel.prototype.setTaskId=function(a){this.taskId=a};FlowModel.prototype.activityname=null;FlowModel.prototype.setActivityname=function(a){this.activityname=_fileupload_taskName=a};FlowModel.prototype.activitylabel=null;FlowModel.prototype.setActivitylabel=function(a){this.activitylabel=a};FlowModel.prototype.userIdentityKey=null;FlowModel.prototype.setUserIdentityKey=function(a){this.userIdentityKey=a};FlowModel.prototype.userIdentity=null;FlowModel.prototype.setUserIdentity=function(a){this.userIdentity=a};FlowModel.prototype.ideasBySelf=null;FlowModel.prototype.setIdeasBySelf=function(a){this.ideasBySelf=a};var _fileupload_entryId="",_fileupload_taskName="",swfobject=function(){function a(){"complete"==C.readyState&&(C.parentNode.removeChild(C),b())}function b(){if(!E){if(h.ie&&h.win){var a=n.createElement("span");try{var b=n.getElementsByTagName("body")[0].appendChild(a);b.parentNode.removeChild(b)}catch(w){return}}E=!0;F&&(clearInterval(F),F=null);a=G.length;for(b=0;b<a;b++)G[b]()}}function c(a){E?a():G[G.length]=a}function d(a){if("undefined"!=typeof r.addEventListener)r.addEventListener("load",a,!1);else if("undefined"!=typeof n.addEventListener)n.addEventListener("load",a,!1);else if("undefined"!=typeof r.attachEvent)H(r,"onload",a);else if("function"==typeof r.onload){var b=r.onload;r.onload=function(){b();a()}}else r.onload=a}function e(){for(var a=v.length,b=0;b<a;b++){var c=v[b].id;if(0<h.pv[0]){var e=t(c);if(e)if(v[b].width=e.getAttribute("width")?e.getAttribute("width"):"0",v[b].height=e.getAttribute("height")?e.getAttribute("height"):"0",D(v[b].swfVersion)){if(h.webkit&&312>h.webkit){var d=e.getElementsByTagName("object")[0];if(d){var g=n.createElement("embed"),l=d.attributes;if(l)for(var p=l.length,m=0;m<p;m++)"DATA"==l[m].nodeName?g.setAttribute("src",l[m].nodeValue):g.setAttribute(l[m].nodeName,l[m].nodeValue);if(d=d.childNodes)for(l=d.length,p=0;p<l;p++)1==d[p].nodeType&&"PARAM"==d[p].nodeName&&g.setAttribute(d[p].getAttribute("name"),d[p].getAttribute("value"));e.parentNode.replaceChild(g,e)}}y(c,!0)}else v[b].expressInstall&&!z&&D("6.0.65")&&(h.win||h.mac)?f(v[b]):k(e)}else y(c,!0)}}function f(a){z=!0;var b=t(a.id);if(b){if(a.altContentId){var c=t(a.altContentId);c&&(A=c,I=a.altContentId)}else A=g(b);!/%$/.test(a.width)&&310>parseInt(a.width,10)&&(a.width="310");!/%$/.test(a.height)&&137>parseInt(a.height,10)&&(a.height="137");n.title=n.title.slice(0,47)+" - Flash Player Installation";var c="MMredirectURL\x3d"+r.location+"\x26MMplayerType\x3d"+(h.ie&&h.win?"ActiveX":"PlugIn")+"\x26MMdoctitle\x3d"+n.title,e=a.id;if(h.ie&&h.win&&4!=b.readyState){var f=n.createElement("div"),e=e+"SWFObjectNew";f.setAttribute("id",e);b.parentNode.insertBefore(f,b);b.style.display="none";H(r,"onload",function(){b.parentNode.removeChild(b)})}l({data:a.expressInstall,id:"SWFObjectExprInst",width:a.width,height:a.height},{flashvars:c},e)}}function k(a){if(h.ie&&h.win&&4!=a.readyState){var b=n.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(g(a),b);a.style.display="none";H(r,"onload",function(){a.parentNode.removeChild(a)})}else a.parentNode.replaceChild(g(a),a)}function g(a){var b=n.createElement("div");if(h.win&&h.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName("object")[0])if(a=a.childNodes)for(var c=a.length,e=0;e<c;e++)1==a[e].nodeType&&"PARAM"==a[e].nodeName||8==a[e].nodeType||b.appendChild(a[e].cloneNode(!0));return b}function l(a,b,c){var e,f=t(c);if(f)if("undefined"==typeof a.id&&(a.id=c),h.ie&&h.win){var d="",k;for(k in a)a[k]!=Object.prototype[k]&&("data"==k.toLowerCase()?b.movie=a[k]:"styleclass"==k.toLowerCase()?d+=' class\x3d"'+a[k]+'"':"classid"!=k.toLowerCase()&&(d+=" "+k+'\x3d"'+a[k]+'"'));k="";for(var g in b)b[g]!=Object.prototype[g]&&(k+='\x3cparam name\x3d"'+g+'" value\x3d"'+b[g]+'" /\x3e');f.outerHTML='\x3cobject classid\x3d"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+d+"\x3e"+k+"\x3c/object\x3e";J[J.length]=a.id;e=t(a.id)}else if(h.webkit&&312>h.webkit){d=n.createElement("embed");d.setAttribute("type","application/x-shockwave-flash");for(var q in a)a[q]!=Object.prototype[q]&&("data"==q.toLowerCase()?d.setAttribute("src",a[q]):"styleclass"==q.toLowerCase()?d.setAttribute("class",a[q]):"classid"!=q.toLowerCase()&&d.setAttribute(q,a[q]));for(var u in b)b[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&d.setAttribute(u,b[u]);f.parentNode.replaceChild(d,f);e=d}else{g=n.createElement("object");g.setAttribute("type","application/x-shockwave-flash");for(var l in a)a[l]!=Object.prototype[l]&&("styleclass"==l.toLowerCase()?g.setAttribute("class",a[l]):"classid"!=l.toLowerCase()&&g.setAttribute(l,a[l]));for(d in b)b[d]!=Object.prototype[d]&&"movie"!=d.toLowerCase()&&(a=g,k=d,q=b[d],u=n.createElement("param"),u.setAttribute("name",k),u.setAttribute("value",q),a.appendChild(u));f.parentNode.replaceChild(g,f);e=g}return e}function p(a){var b=t(a);!b||"OBJECT"!=b.nodeName&&"EMBED"!=b.nodeName||(h.ie&&h.win?4==b.readyState?m(a):r.attachEvent("onload",function(){m(a)}):b.parentNode.removeChild(b))}function m(a){if(a=t(a)){for(var b in a)"function"==typeof a[b]&&(a[b]=null);a.parentNode.removeChild(a)}}function t(a){var b=null;try{b=n.getElementById(a)}catch(w){}return b}function H(a,b,c){a.attachEvent(b,c);B[B.length]=[a,b,c]}function D(a){var b=h.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function K(a,b){if(!h.ie||!h.mac){var c=n.getElementsByTagName("head")[0],e=n.createElement("style");e.setAttribute("type","text/css");e.setAttribute("media","screen");h.ie&&h.win||"undefined"==typeof n.createTextNode||e.appendChild(n.createTextNode(a+" {"+b+"}"));c.appendChild(e);h.ie&&h.win&&"undefined"!=typeof n.styleSheets&&0<n.styleSheets.length&&(c=n.styleSheets[n.styleSheets.length-1],"object"==typeof c.addRule&&c.addRule(a,b))}}function y(a,b){var c=b?"visible":"hidden";E&&t(a)?t(a).style.visibility=c:K("#"+a,"visibility:"+c)}function L(a){return null!=/[\\\"<>\.;]/.exec(a)?encodeURIComponent(a):a}var r=window,n=document,x=navigator,G=[],v=[],J=[],B=[],C,F=null,A=null,I=null,E=!1,z=!1,h=function(){var a="undefined"!=typeof n.getElementById&&"undefined"!=typeof n.getElementsByTagName&&"undefined"!=typeof n.createElement,b=[0,0,0],c=null;if("undefined"!=typeof x.plugins&&"object"==typeof x.plugins["Shockwave Flash"])!(c=x.plugins["Shockwave Flash"].description)||"undefined"!=typeof x.mimeTypes&&x.mimeTypes["application/x-shockwave-flash"]&&!x.mimeTypes["application/x-shockwave-flash"].enabledPlugin||(c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),b[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),b[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),b[2]=/r/.test(c)?parseInt(c.replace(/^.*r(.*)$/,"$1"),10):0);else if("undefined"!=typeof r.ActiveXObject){var e=null,f=!1;try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(M){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),b=[6,0,21],e.AllowScriptAccess="always"}catch(N){6==b[0]&&(f=!0)}if(!f)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(N){}}if(!f&&e)try{if(c=e.GetVariable("$version"))c=c.split(" ")[1].split(","),b=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}catch(M){}}var f=x.userAgent.toLowerCase(),d=x.platform.toLowerCase(),c=/webkit/.test(f)?parseFloat(f.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,e=d?/win/.test(d):/win/.test(f),f=d?/mac/.test(d):/mac/.test(f);return{w3cdom:a,pv:b,webkit:c,ie:!1,win:e,mac:f}}();(function(){if(h.w3cdom){c(e);if(h.ie&&h.win)try{n.write("\x3cscript id\x3d__ie_ondomload defer\x3dtrue src\x3d//:\x3e\x3c/script\x3e"),(C=t("__ie_ondomload"))&&H(C,"onreadystatechange",a)}catch(q){}h.webkit&&"undefined"!=typeof n.readyState&&(F=setInterval(function(){/loaded|complete/.test(n.readyState)&&b()},10));"undefined"!=typeof n.addEventListener&&n.addEventListener("DOMContentLoaded",b,null);d(b)}})();(function(){h.ie&&h.win&&window.attachEvent("onunload",function(){for(var a=B.length,b=0;b<a;b++)B[b][0].detachEvent(B[b][1],B[b][2]);a=J.length;for(b=0;b<a;b++)p(J[b]);for(var c in h)h[c]=null;h=null;for(var e in swfobject)swfobject[e]=null;swfobject=null})})();return{registerObject:function(a,b,c){if(h.w3cdom&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c?c:!1;v[v.length]=e;y(a,!1)}},getObjectById:function(a){var b=null;if(h.w3cdom&&(a=t(a))){var c=a.getElementsByTagName("object")[0];!c||c&&"undefined"!=typeof a.SetVariable?b=a:"undefined"!=typeof c.SetVariable&&(b=c)}return b},embedSWF:function(a,b,e,d,k,g,p,m,n){if(h.w3cdom&&a&&b&&e&&d&&k)if(e+="",d+="",D(k)){y(b,!1);var q={};if(n&&"object"===typeof n)for(var u in n)n[u]!=Object.prototype[u]&&(q[u]=n[u]);q.data=a;q.width=e;q.height=d;var r={};if(m&&"object"===typeof m)for(var t in m)m[t]!=Object.prototype[t]&&(r[t]=m[t]);if(p&&"object"===typeof p)for(var w in p)p[w]!=Object.prototype[w]&&(r.flashvars="undefined"!=typeof r.flashvars?r.flashvars+("\x26"+w+"\x3d"+p[w]):w+"\x3d"+p[w]);c(function(){l(q,r,b);q.id==b&&y(b,!0)})}else g&&!z&&D("6.0.65")&&(h.win||h.mac)&&(z=!0,y(b,!1),c(function(){var a={};a.id=a.altContentId=b;a.width=e;a.height=d;a.expressInstall=g;f(a)}))},getFlashPlayerVersion:function(){return{major:h.pv[0],minor:h.pv[1],release:h.pv[2]}},hasFlashPlayerVersion:D,createSWF:function(a,b,c){if(h.w3cdom)return l(a,b,c)},removeSWF:function(a){h.w3cdom&&p(a)},createCSS:function(a,b){h.w3cdom&&K(a,b)},addDomLoadEvent:c,addLoadEvent:d,getQueryParamValue:function(a){var b=n.location.search||n.location.hash;if(null==a)return L(b);if(b)for(var b=b.substring(1).split("\x26"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("\x3d"))==a)return L(b[c].substring(b[c].indexOf("\x3d")+1));return""},expressInstallCallback:function(){if(z&&A){var a=t("SWFObjectExprInst");a&&(a.parentNode.replaceChild(A,a),I&&(y(I,!0),h.ie&&h.win&&(A.style.display="block")),I=A=null,z=!1)}}}}();function FlowUploader(a){this.flowEditor=a}FlowUploader.prototype.flowEditor=null;FlowUploader.prototype.uploader=null;FlowUploader.prototype.filesdiv="bpm_files_div";FlowUploader.prototype.filesaddId="bpm_files_add";FlowUploader.prototype.filesUploadId="bpm_files_upload";FlowUploader.prototype.hasFlash=!1;FlowUploader.prototype.hasFlashWarning=!1;FlowUploader.prototype.saveType="DataBase";FlowUploader.prototype.secretLevelList=[];FlowUploader.prototype.init=function(){var a=this;$.ajax({type:"POST",data:{entryId:this.flowEditor.flowModel.entryId},url:"platform/bpm/business/getSecretLevelList",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.secretLevelList=b.result}});if(this.hasFlash=swfobject.hasFlashPlayerVersion("9.0.28"))_flowUploader_uploader=this.uploader=WebUploader.create({swf:"static/h5/webuploader-0.1.5/dist/Uploader.swf",server:"platform/bpm/business/upload.json",pick:"#"+this.filesaddId,resize:!1,fileSingleSizeLimit:10485760}),this.uploader.on("ready",function(){}),this.uploader.on("beforeFileQueued",function(b){if(flowUtils.notNull(a.flowEditor.flowModel.entryId))return!0;flowUtils.warning("\u8bf7\u4fdd\u5b58\u8868\u5355\u540e\u518d\u6dfb\u52a0\u6587\u6863");return!1}),this.uploader.on("fileQueued",function(b){a.addFile(b)}),this.uploader.on("uploadBeforeSend",function(b,c){var d=$("#"+b.file.id).find('select[name\x3d"secretLevel"]');c.secretLevel=d.val();c.entryId=a.flowEditor.flowModel.entryId;c.saveType=a.saveType}),this.uploader.on("uploadProgress",function(a,c){$("#"+a.id).children().last().html("\u6b63\u5728\u4e0a\u4f20")}),this.uploader.on("uploadSuccess",function(b,c){if(flowUtils.notNull(c.error))flowUtils.error(c.error);else{var d=$("#"+b.id);d.children().last().html("\u4e0a\u4f20\u6210\u529f");a.uploader.removeFile(b);setTimeout(function(){var b=a.getTr(c.bpmFiles);d.replaceWith(b)},500)}}),this.uploader.on("uploadError",function(a,c){flowUtils.error("\u4e0a\u4f20\u5931\u8d25\u4e86")}),this.uploader.on("error",function(a,c){"F_EXCEED_SIZE"==a?flowUtils.warning("\u8d85\u8fc7\u9644\u4ef6\u5927\u5c0f\u9650\u5236"):"Q_TYPE_DENIED"==a?flowUtils.warning("\u4e0d\u80fd\u4e0a\u4f20\u7a7a\u6587\u4ef6"):flowUtils.warning("\u9644\u4ef6\u4e0d\u80fd\u4e0a\u4f20")}),this.uploader.on("uploadComplete",function(a){}),$("#"+this.filesUploadId).on("click",function(){var b=[],c=$("#"+a.filesdiv).find('select[name\x3d"secretLevel"]');$.each(c,function(a,c){b.push(c.value)});a.flowEditor.defaultForm.validSecretLevel(b)&&a.uploader.upload()})};FlowUploader.prototype.refresh=function(){var a=this;this.flowEditor.isStart||"6"!=this.flowEditor.flowModel.userIdentityKey?($("#"+this.filesaddId).hide(),$("#"+this.filesUploadId).hide()):this.hasFlash?($("#"+this.filesaddId).show(),$("#"+this.filesUploadId).show()):($("#"+this.filesaddId).hide(),$("#"+this.filesUploadId).hide(),this.hasFlashWarning||(flowUtils.warning("\u6ca1\u6709\u5b89\u88c5flash\u63d2\u4ef6\uff0c\u5c06\u65e0\u6cd5\u4f7f\u7528\u6d41\u7a0b\u6587\u6863\u53ca\u9644\u4ef6\u7684\u4e0a\u4f20\u529f\u80fd\uff01"),this.hasFlashWarning=!0));$.ajax({type:"POST",data:{entryId:this.flowEditor.flowModel.entryId,defineId:this.flowEditor.flowModel.defineId,activityName:this.flowEditor.flowModel.activityname},url:"platform/bpm/business/getBpmFiles",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):($("#"+a.filesdiv).empty(),$.each(b.result,function(b,d){var c=a.getTr(d);$("#"+a.filesdiv).append(c)}))}})};FlowUploader.prototype.addFile=function(a){var b=$("\x3ctr\x3e\x3c/tr\x3e");b.attr("id",a.id);b.append(this.getTd(a.name));b.append(this.getTdSecretLevel());b.append(this.getTd(""));b.append(this.getTd(""));b.append(this.getOperateTd(!0,a.name,a.id));b.append(this.getTd("\u7b49\u5f85\u4e0a\u4f20"));$("#"+this.filesdiv).append(b)};FlowUploader.prototype.getTr=function(a){var b=$("\x3ctr\x3e\x3c/tr\x3e");b.attr("id",a.id);b.append(this.getTd(a.attachName));b.append(this.getTd(a.secretLevelString));b.append(this.getTd(a.createdByString));b.append(this.getTd(a.creationDateString));b.append(this.getOperateTd(!1,a.attachName,a.id,a.processDefineid));b.append(this.getTd("\u5df2\u4e0a\u4f20"));return b};FlowUploader.prototype.getOperateTd=function(a,b,c,d){b=$("\x3ctd\x3e\x3c/td\x3e");var e=$("\x3ca href\x3d'javascript:void(0);'\x3e\u4e0b\u8f7d\x3c/a\x3e"),f=$("\x3ca href\x3d'javascript:void(0);'\x3e\u5220\u9664\x3c/a\x3e");a?(f.on("click",function(){_flowUploader_removeFile(!0,c)}),b.append(f)):flowUtils.notNull(d)||"6"!=this.flowEditor.flowModel.userIdentityKey?(e.on("click",function(){_flowUploader_downloadFile(c)}),b.append(e)):(e.on("click",function(){_flowUploader_downloadFile(c)}),b.append(e),b.append("\x26nbsp;\x26nbsp;"),f.on("click",function(){_flowUploader_removeFile(!1,c)}),b.append(f));return b};FlowUploader.prototype.getTdSecretLevel=function(){var a=this.flowEditor.defaultForm.filterSecretLevel(flowUtils.clone(this.secretLevelList)),b=$("\x3ctd\x3e\x3c/td\x3e"),c=$("\x3cselect\x3e\x3c/select\x3e");c.attr("name","secretLevel");$.each(a,function(a,b){var e=$("\x3coption\x3e\x3c/option\x3e");e.attr("value",b.lookupCode);e.html(b.lookupName);c.append(e)});b.append(c);return b};FlowUploader.prototype.getTd=function(a){var b=$("\x3ctd\x3e\x3c/td\x3e");b.html(a);return b};var _flowUploader_uploader=null;function _flowUploader_removeFile(a,b){a?(_flowUploader_uploader.removeFile(_flowUploader_uploader.getFile(b)),$("#"+b).remove()):flowUtils.confirm("\u786e\u5b9a\u5220\u9664\uff1f",function(){avicAjax.ajax({type:"POST",data:{id:b},url:"platform/bpm/business/deleteBpmFiles",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):$("#"+b).remove()}})})}function _flowUploader_downloadFile(a){(new FlowDownLoad4URL("iframe","form",null,"platform/bpm/business/doDownload?id\x3d"+a)).downLoad()}function BpmButton(a,b,c,d){this.flowEditor=a;this.defaultForm=b;this.data=c;flowUtils.notNull(this.data)&&(this.enable=!0);this.domeId="";this.isEvent=d}BpmButton.prototype.enable=!1;BpmButton.prototype.isEnable=function(){return this.enable};BpmButton.prototype.execute=function(){flowUtils.success("\u8be5\u65b9\u6cd5\u5f00\u53d1\u4e2d")};BpmButton.prototype.getHtml=function(){if(!this.isEvent)if(this.isEnable()){var a=this;$("#"+this.domeId).html(this.data.lable);$("#"+this.domeId).off("click");$("#"+this.domeId).on("click",function(){a.execute()});$("#"+this.domeId).show();$("#"+this.domeId).parent().show();$("#"+this.domeId).parent().prev().show();$("#bpm_buttons_more").show()}else $("#"+this.domeId).hide(),$("#"+this.domeId).off("click")};BpmButton.prototype.getIdeaText=function(){return this.isEvent?"":this.flowEditor.flowIdea.getIdea(this.ideaElementIdBySelf)};BpmButton.prototype.focusIdeaText=function(){this.flowEditor.flowIdea.focusIdeaText(this.ideaElementIdBySelf)};BpmButton.prototype.hasIdeaElementBySelf=function(){return this.isEvent?!1:this.flowEditor.flowIdea.hasIdeaElementBySelf(this.ideaElementIdBySelf)};BpmButton.prototype.submit=function(a,b){flowUtils.warning("\u672a\u5b9e\u73b0\u7684\u65b9\u6cd5")};BpmButton.prototype.validIdeasBySelf=function(a,b){var c=this;if(null!=this.flowEditor.flowModel.ideasBySelf&&0<this.flowEditor.flowModel.ideasBySelf.length){for(var d="\x3cform class\x3d'container-fluid'\x3e\n",e=!1,f=0;f<this.flowEditor.flowModel.ideasBySelf.length;f++){var k=this.flowEditor.flowModel.ideasBySelf[f];if("0"==k.outcome||k.outcome==a)e=!0,d+="  \x3cdiv class\x3d\"form-group\"\x3e\n    \x3clabel\x3e\x3cinput type\x3d'radio' name\x3d'ideas_radio'/\x3e "+k.content+"\x3c/label\x3e\n  \x3c/div\x3e\n"}e?layer.open({type:1,title:"\u5f3a\u5236\u8868\u6001",area:["300px","400px"],content:d+"\x3c/form\x3e",btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(a,e){var f=$("input[name\x3d'ideas_radio']:checked");0==f.length?flowUtils.warning("\u8bf7\u5148\u8868\u6001"):(c.ideas_text=f.parent().text().trim(),b(),layer.close(a))}}):b()}else b()};BpmButton.prototype.getConditions=function(a){return{isBranch:function(){return null!=a.nextTask&&1<a.nextTask.length?!0:!1},isUserSelectTypeAuto:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.userSelectType?"auto"==a.nextTask[b].currentActivityAttr.userSelectType?!0:!1:!1},isWorkHandUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isWorkHandUser?"no"==a.nextTask[b].currentActivityAttr.isWorkHandUser?!1:!0:!0},getDealType:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.dealType?a.nextTask[b].currentActivityAttr.dealType:"2"},getSingle:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.single?a.nextTask[b].currentActivityAttr.single:"no"},isMustUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isMustUser?"no"==a.nextTask[b].currentActivityAttr.isMustUser?!1:!0:!0},isSecret:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isSecret?"yes"==a.nextTask[b].currentActivityAttr.isMustUser?!0:!1:!1},getIdeaType:function(){return a.currentActivityAttr.ideaType?a.currentActivityAttr.ideaType:""},isIdeaCompelManner:function(){return a.currentActivityAttr.ideaCompelManner?"yes"==a.currentActivityAttr.ideaCompelManner?!0:!1:!1},isNeedIdea:function(){return a.currentActivityAttr.isNeedIdea?"no"==a.currentActivityAttr.isNeedIdea?!1:!0:!0},isSelectUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isSelectUser?"no"==a.nextTask[b].currentActivityAttr.isSelectUser?!1:!0:!0},isAutoGetUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isAutoGetUser?"no"==a.nextTask[b].currentActivityAttr.isAutoGetUser?!1:!0:!1},getNextActivityType:function(){return a.activityType},isUflow:function(){return"2"==a.isUflow}}};function BpmAdduser(a,b,c,d){BpmButton.call(this,a,b,c.doadduser,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_adduser";this.getHtml()}BpmAdduser.prototype=new BpmButton;BpmAdduser.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeAdduser(this.data)){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.data.procinstDbid,executionId:a.data.executionId,taskId:a.data.taskId,outcome:a.data.name,targetActivityName:a.data.targetActivityName,type:"doadduser"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):(new BpmActor(a.data,b.taskUserSelect,a)).open()}})}};BpmAdduser.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dosupplementassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),opType:"doadduser"},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u52a0\u7b7e\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterAdduser(a)}catch(f){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmFocus(a,b,c,d){BpmButton.call(this,a,b,c.dofocus,d);this.domeId="bpm_focus";this.getHtml()}BpmFocus.prototype=new BpmButton;BpmFocus.prototype.execute=function(){avicAjax.ajax({url:"platform/bpm/business/setFocusedTask",data:{processInstanceId:this.flowEditor.flowModel.entryId,dbid:this.flowEditor.flowModel.taskId},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):0==a.mes?flowUtils.success("\u8be5\u4efb\u52a1\u6b64\u524d\u5df2\u88ab\u5173\u6ce8"):flowUtils.success("\u5df2\u6210\u529f\u5173\u6ce8\u8be5\u4efb\u52a1")}})};BpmFocus.prototype.getHtml=function(){if(this.isEnable()){var a=this;$("#"+this.domeId).off("click");$("#"+this.domeId).on("click",function(){a.execute()});$("#"+this.domeId).show()}else $("#"+this.domeId).hide(),$("#"+this.domeId).off("click")};function BpmGlobalend(a,b,c,d){BpmButton.call(this,a,b,c.doglobalend,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_globalend";this.getHtml()}BpmGlobalend.prototype=new BpmButton;BpmGlobalend.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeGlobalend(this.data)){var a=this;flowUtils.confirm("\u6d41\u7a0b\u4e00\u65e6\u7ed3\u675f\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u60a8\u786e\u5b9a\u7ed3\u675f\u8be5\u6d41\u7a0b\u5417\uff1f",function(){avicAjax.ajax({url:"platform/bpm/business/doend",data:{executionId:a.data.executionId,message:a.getIdeaText()},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterGlobalend(a.data)}catch(c){}}}})})}};function BpmGlobaljump(a,b,c,d){BpmButton.call(this,a,b,c.doglobaljump,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_globaljump";this.getHtml()}BpmGlobaljump.prototype=new BpmButton;BpmGlobaljump.prototype.execute=function(){this.flowEditor.defaultForm.beforeGlobaljump(this.data)&&(this.jumpTaskDialog=layer.open({type:2,title:"\u8df3\u8f6c\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.data.procinstDbid+"\x26type\x3ddoglobaljump"}),this.isEvent&&layer.full(this.jumpTaskDialog),window.bpmGlobaljump=this)};BpmGlobaljump.prototype.callback=function(a,b){layer.close(this.jumpTaskDialog);var c=flowUtils.clone(this.data);flowUtils.notNull(a)&&(c.executionId=a);c.targetActivityName=b;var d=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:c.procinstDbid,executionId:c.executionId,taskId:c.taskId,outcome:c.name,targetActivityName:c.targetActivityName,type:"doglobaljump"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(new BpmActor(c,a.taskUserSelect,d)).open()}})};BpmGlobaljump.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dojump",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{c.isEvent?(flowUtils.success("\u8df3\u8f6c\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u8df3\u8f6c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterGlobaljump(a)}catch(f){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmGlobalidea(a,b,c,d){BpmButton.call(this,a,b,c.doglobalidea,d);this.domeId="bpm_globalidea";this.getHtml();this.lastIndex=-1}BpmGlobalidea.prototype=new BpmButton;BpmGlobalidea.prototype.execute=function(){var a=this;layer.open({type:1,title:"\u4fee\u6539\u610f\u89c1",area:["800px","450px"],content:"\x3ctable id\x3d'ideaTable'\x3e\x3c/table\x3e",btn:["\u786e\u5b9a","\u5173\u95ed"],success:function(b,c){$("#ideaTable").datagrid({url:"platform/bpm/business/doGettracksByPage?entryId\x3d"+a.data.procinstDbid,method:"POST",idField:"dbid",columns:[[{field:"dbid",hidden:!0},{title:"\u8282\u70b9",field:"currentActiveLabel",align:"center",width:100},{title:"\u5904\u7406\u4eba",field:"assigneeName",align:"center",width:80},{title:"\u63a5\u6536\u65f6\u95f4",field:"iTime",align:"center",width:110},{title:"\u5904\u7406\u65f6\u95f4",field:"eTime",align:"center",width:110},{title:"\u64cd\u4f5c\u7c7b\u578b",field:"opType",align:"center",width:80},{title:"\u5904\u7406\u610f\u89c1",field:"message",editor:"text",width:200}]],rownumbers:!0,striped:!0,fitColumns:!0,onClickCell:function(b,c,f){"message"==c&&(a.lastIndex!=b&&($("#ideaTable").datagrid("endEdit",a.lastIndex),$("#ideaTable").datagrid("beginEdit",b)),a.lastIndex=b)}})},yes:function(b,c){$("#ideaTable").datagrid("endEdit",a.lastIndex);var d=$("#ideaTable").datagrid("getChanges");avicAjax.ajax({url:"platform/bpm/business/saveGettracks",data:{data:JSON.stringify(d),processInstanceId:a.data.procinstDbid},type:"post",dataType:"json",success:function(c){flowUtils.notNull(c.error)?flowUtils.error(c.error):(flowUtils.success("\u4fee\u6539\u6210\u529f"),layer.close(b),a.flowEditor.refreshTracks())}})}})};function BpmGlobalresume(a,b,c,d){BpmButton.call(this,a,b,c.doglobalresume,d);this.domeId="bpm_globalresume";this.getHtml()}BpmGlobalresume.prototype=new BpmButton;BpmGlobalresume.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeGlobalresume(this.data)){var a=this;flowUtils.confirm("\u60a8\u786e\u5b9a\u6062\u590d\u8be5\u6d41\u7a0b\u5417\uff1f",function(){avicAjax.ajax({url:"platform/bpm/business/doresume",data:{processInstanceId:a.data.procinstDbid},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");try{a.flowEditor.defaultForm.afterGlobalresume(a.data)}catch(c){}a.flowEditor.createButtons();flowUtils.refreshBack()}}})})}};function BpmGlobalsuspend(a,b,c,d){BpmButton.call(this,a,b,c.doglobalsuspend,d);this.domeId="bpm_globalsuspend";this.getHtml()}BpmGlobalsuspend.prototype=new BpmButton;BpmGlobalsuspend.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeGlobalsuspend(this.data)){var a=this;flowUtils.confirm("\u60a8\u786e\u5b9a\u6682\u505c\u8be5\u6d41\u7a0b\u5417\uff1f",function(){avicAjax.ajax({url:"platform/bpm/business/dosuspend",data:{processInstanceId:a.data.procinstDbid},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f!");try{a.flowEditor.defaultForm.afterGlobalsuspend(a.data)}catch(c){}a.flowEditor.createButtons();flowUtils.refreshBack()}}})})}};function BpmRetreat(a,b,c,d){BpmButton.call(this,a,b,null,d);this.doretreattodraft=c.doretreattodraft;this.doretreattoprev=c.doretreattoprev;this.doretreattowant=c.doretreattowant;this.doretreattoactivity=c.doretreattoactivity;if(flowUtils.notNull(this.doretreattodraft)||flowUtils.notNull(this.doretreattoprev)||flowUtils.notNull(this.doretreattowant)||flowUtils.notNull(this.doretreattoactivity))this.enable=!0,this.flowEditor.needIdeaText=!0;this.getHtml()}BpmRetreat.prototype=new BpmButton;BpmRetreat.prototype.executeTodraft=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattodraft)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeTodraftBack();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeTodraftBack()})}};BpmRetreat.prototype.executeTodraftBack=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.doretreattodraft.procinstDbid,executionId:a.doretreattodraft.executionId,taskId:a.doretreattodraft.taskId,outcome:a.doretreattodraft.name,targetActivityName:a.doretreattodraft.targetActivityName,type:"doretreattodraft"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.validJsonData(a.doretreattodraft,b.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u62df\u7a3f\u4eba\u5417\uff1f")}});this.submit=function(b,c){if(flowUtils.notNull(c)&&0!=c.length){var d=a.getIdeaText();flowUtils.notNull(this.ideas_text)&&(d=this.ideas_text+" "+d);avicAjax.ajax({url:"platform/bpm/business/dobacktofirst",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,userJson:JSON.stringify({users:c,idea:d,compelManner:"",outcome:b.name})},type:"POST",dataType:"JSON",success:function(c){if(flowUtils.notNull(c.error))flowUtils.error(c.error);else{a.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterRetreat(b)}catch(f){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeToprev=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattoprev)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeToprevBack();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeToprevBack()})}};BpmRetreat.prototype.executeToprevBack=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.doretreattoprev.procinstDbid,executionId:a.doretreattoprev.executionId,taskId:a.doretreattoprev.taskId,outcome:a.doretreattoprev.name,targetActivityName:a.doretreattoprev.targetActivityName,type:"doretreattoprev"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.validJsonData(a.doretreattoprev,b.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u4e0a\u4e00\u6b65\u5417\uff1f")}});this.submit=function(b,c){if(flowUtils.notNull(c)&&0!=c.length){var d=a.getIdeaText();flowUtils.notNull(this.ideas_text)&&(d=this.ideas_text+" "+d);avicAjax.ajax({url:"platform/bpm/business/dobacktoprev",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,userJson:JSON.stringify({users:c,idea:d,compelManner:"",outcome:b.name})},type:"POST",dataType:"JSON",success:function(c){if(flowUtils.notNull(c.error))flowUtils.error(c.error);else{a.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterRetreat(b)}catch(f){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeTowant=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattowant)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeTowantSelectTask();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeTowantSelectTask()})}};BpmRetreat.prototype.executeTowantSelectTask=function(){this.retreattowantDialog=layer.open({type:2,title:"\u4efb\u610f\u9000\u56de\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.doretreattowant.procinstDbid+"\x26type\x3ddoretreattowant"});this.isEvent&&layer.full(this.retreattowantDialog);window.bpmRetreatToWant=this};BpmRetreat.prototype.callback=function(a){layer.close(this.retreattowantDialog);var b=flowUtils.clone(this.doretreattowant);b.targetActivityName=a;var c=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,taskId:b.taskId,outcome:b.name,targetActivityName:b.targetActivityName,type:"doretreattowant"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):c.validJsonData(b,a.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u5417\uff1f")}});this.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var e=c.getIdeaText();flowUtils.notNull(this.ideas_text)&&(e=this.ideas_text+" "+e);avicAjax.ajax({url:"platform/bpm/business/dobacktowant",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:e,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{c.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterRetreat(a)}catch(g){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeToactivity=function(a){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattoactivity)){var b=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){b.executeToactivityBack(a);b.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){b.executeToactivityBack(a)})}};BpmRetreat.prototype.executeToactivityBack=function(a){var b=flowUtils.clone(this.doretreattoactivity);b.targetActivityName=a;var c=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,taskId:b.taskId,outcome:b.name,targetActivityName:b.targetActivityName,type:"doretreattoactivity"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):c.validJsonData(b,a.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u5417\uff1f")}});this.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var e=c.getIdeaText();flowUtils.notNull(this.ideas_text)&&(e=this.ideas_text+" "+e);avicAjax.ajax({url:"platform/bpm/business/dobacktoactivity",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:e,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{c.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterRetreat(a)}catch(g){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.validJsonData=function(a,b,c){var d=this;flowUtils.notNull(b)&&(this.conditions=this.getConditions(b),this.validIdeaMust()&&(this.conditions.isBranch()?(new BpmActor(a,b,this)).open():flowUtils.confirm(c,function(){var c=(new BpmActor(a,b,d)).getUsers();d.submit(a,c)})))};BpmRetreat.prototype.validIdeaMust=function(){if(this.isEvent)return!0;if(this.conditions.isNeedIdea()){var a=this.getIdeaText();if(!flowUtils.notNull(a))return flowUtils.warning("\u8bf7\u586b\u5199\u6d41\u7a0b\u610f\u89c1"),this.focusIdeaText(),!1}return!0};BpmRetreat.prototype.getHtml=function(){if(this.isEvent)return!0;if(this.isEnable()){var a=this,b=$('\x3cbutton class\x3d"listBtn grey btn btn-default dropdown-toggle" type\x3d"button" id\x3d"dropmenu_retreat" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u9000\u56de\x3c/span\x3e\x3ci\x3e\x3c/i\x3e\x3c/button\x3e'),c=$('\x3cul class\x3d"dropdown-menu" aria-labelledby\x3d"dropmenu_retreat"\x3e');if(null!=this.doretreattodraft){var d=$("\x3cli\x3e\x3c/li\x3e"),e=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattodraft.lable+"\x3c/a\x3e");e.on("click",function(){a.executeTodraft()});d.append(e);c.append(d)}null!=this.doretreattoprev&&(d=$("\x3cli\x3e\x3c/li\x3e"),e=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattoprev.lable+"\x3c/a\x3e"),e.on("click",function(){a.executeToprev()}),d.append(e),c.append(d));null!=this.doretreattowant&&(d=$("\x3cli\x3e\x3c/li\x3e"),e=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattowant.lable+"\x3c/a\x3e"),e.on("click",function(){a.executeTowant()}),d.append(e),c.append(d));if(null!=this.doretreattoactivity){var d=this.doretreattoactivity.targetName.split(","),f=this.doretreattoactivity.lable.split(",");$.each(d,function(b,e){var d=$("\x3cli\x3e\x3c/li\x3e"),k=$('\x3ca href\x3d"javascript:void(0);"\x3e\u9000\u56de\u5230\u3010'+f[b]+"\u3011\u8282\u70b9\x3c/a\x3e");k.on("click",function(){a.executeToactivity(e)});d.append(k);c.append(d)})}$("#bpm_buttons_default1").append(b);$("#bpm_buttons_default1").append(c)}};function BpmSave(a,b,c,d){BpmButton.call(this,a,b,null,d);this.data=c.doformsave;if(this.flowEditor.isStart||flowUtils.notNull(this.data))this.enable=!0;this.domeId="bpm_save";this.getHtml()}BpmSave.prototype=new BpmButton;BpmSave.prototype.disabled=!1;BpmSave.prototype.execute=function(){var a=this;this.disabled||(this.disabled=!0,setTimeout(function(){a.disabled=!1},2E3),this.flowEditor.isStart?this.defaultForm.start(this.flowEditor.flowModel.defineId,function(b){flowUtils.success("\u6682\u5b58\u6210\u529f");a.flowEditor.afterStart(b);a.flowEditor.createButtons();flowUtils.refreshBack()}):(a=this,this.defaultForm.save(function(){flowUtils.success("\u6682\u5b58\u6210\u529f");a.flowEditor.createButtons()})))};BpmSave.prototype.getHtml=function(){if(this.isEnable()){var a=this;$("#"+this.domeId).off("click");$("#"+this.domeId).on("click",function(){a.execute()});$("#"+this.domeId).show()}else $("#"+this.domeId).hide(),$("#"+this.domeId).off("click")};function BpmStepuserdefined(a,b,c,d){BpmButton.call(this,a,b,c.dostepuserdefined,d);this.domeId="bpm_stepuserdefined";this.getHtml()}BpmStepuserdefined.prototype=new BpmButton;BpmStepuserdefined.prototype.execute=function(){this.flowEditor.defaultForm.beforeStepuserdefined(this.data)&&(this.stepuserdefinedDialog=layer.open({type:2,title:"\u81ea\u5b9a\u4e49\u5ba1\u6279\u4eba",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.data.procinstDbid+"\x26type\x3ddostepuserdefined"}),this.isEvent&&layer.full(this.stepuserdefinedDialog),window.bpmStepuserdefined=this)};BpmStepuserdefined.prototype.callback=function(a){var b=flowUtils.clone(this.data);b.activityName=a;b.targetActivityName=a;(new BpmActor(b,null,this)).open()};BpmStepuserdefined.prototype.submit=function(a,b){flowUtils.notNull(b)&&0!=b.length?avicAjax.ajax({url:"platform/bpm/business/douserdefined",data:{procinstDbid:a.procinstDbid,userJson:JSON.stringify({users:b,idea:"",compelManner:"",outcome:a.name}),activityName:a.activityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");try{_self.flowEditor.defaultForm.afterStepuserdefined(a)}catch(d){}}}}):flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmSubmit(a,b,c,d){BpmButton.call(this,a,b,null,d);this.data=c.dosubmit;this.transmitData=c.dotransmitsubmit;if(this.flowEditor.isStart||flowUtils.notNull(this.data)||flowUtils.notNull(this.transmitData))this.enable=!0;flowUtils.notNull(c.dosubmit)&&flowUtils.notNull(c.dosubmit[0].attribute)&&flowUtils.notNull(c.dosubmit[0].attribute.ideaElementIdBySelf)&&(this.ideaElementIdBySelf=c.dosubmit[0].attribute.ideaElementIdBySelf);this.enable&&!this.hasIdeaElementBySelf()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_submit";this.getHtml();this.isAutoClickAfterStart=!1}BpmSubmit.prototype=new BpmButton;BpmSubmit.prototype.disabled=!1;BpmSubmit.prototype.execute=function(a){var b=this;this.disabled||(this.disabled=!0,setTimeout(function(){b.disabled=!1},2E3),this.flowEditor.isStart?this.defaultForm.start(this.flowEditor.flowModel.defineId,function(a){b.flowEditor.afterStart(a);b.flowEditor.createButtons(!0);flowUtils.refreshBack()}):this.flowEditor.defaultForm.beforeSubmit(a)&&(!this.isAutoClickAfterStart&&!this.isEvent&&this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){b.flowEditor.createButtons(!0,a.name)}):this.validIdeasBySelf("1",function(){b.executeBack(a)})))};BpmSubmit.prototype.executeBack=function(a){var b=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,taskId:a.taskId,outcome:a.name,targetActivityName:a.targetActivityName,type:"dosubmit"},type:"POST",dataType:"JSON",success:function(c){flowUtils.notNull(c.error)?flowUtils.error(c.error):b.validJsonData(a,c.taskUserSelect)}})};BpmSubmit.prototype.validJsonData=function(a,b){var c=this;if(flowUtils.notNull(b))if(this.conditions=this.getConditions(b),!this.isEvent&&this.conditions.isIdeaCompelManner()&&0==$(".bpm_compelManner_div input[name\x3d'bpm_compelManner']:checked").length)$(".bpm_compelManner_div").show(),flowUtils.warning("\u8bf7\u60a8\u8868\u6001");else if(this.validIdeaMust()){var d=this.conditions.getNextActivityType();if(d)if("end"==d)flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});else{if("sub-process"==d){if(!this.conditions.isMustUser()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});return}}else if("foreach"==d){if(!this.conditions.isMustUser()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});return}}else if("task"==d&&!this.conditions.isBranch()){if(!this.conditions.isSelectUser()&&this.conditions.isUserSelectTypeAuto()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){var e=(new BpmActor(a,b,c)).getUsers();c.submit(a,e)});return}if(!this.conditions.isSelectUser()){flowUtils.warning("\u914d\u7f6e\u9519\u8bef\uff1a\u914d\u7f6e\u4e0d\u663e\u793a\u9009\u4eba\u6846\uff0c\u4f46\u672a\u914d\u7f6e\u81ea\u52a8\u9009\u4eba");return}}(new BpmActor(a,b,this,this.conditions.isUflow())).open()}else b.nextTask||flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)})}};BpmSubmit.prototype.validIdeaMust=function(){if(!this.isEvent&&"must"==this.conditions.getIdeaType()){var a=this.getIdeaText();if(!flowUtils.notNull(a))return flowUtils.warning("\u8bf7\u586b\u5199\u6d41\u7a0b\u610f\u89c1"),this.focusIdeaText(),!1}return!0};BpmSubmit.prototype.submit=function(a,b,c,d){if(c||flowUtils.notNull(b)&&0!=b.length){c=this.isEvent?"\u540c\u610f":this.getIdeaText();c=this.flowEditor.defaultForm.reGetidea(c,b);var e="";this.conditions.isIdeaCompelManner()&&(e=this.isEvent?"yes":$(".bpm_compelManner_div input[name\x3d'bpm_compelManner']:checked").val());flowUtils.notNull(this.ideas_text)&&(c=this.ideas_text+" "+c);var f=this;avicAjax.ajax({url:"platform/bpm/business/dosubmit",data:{instanceId:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify({users:b,idea:c,compelManner:e,outcome:a.name}),outcome:a.name,formJson:null,uflowDealType:d,isUflow:this.conditions.isUflow()},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{f.isEvent?flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01",function(){flowUtils.refreshCurrentBack()},!0):flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){f.flowEditor.createButtons()},500)},!0);try{f.flowEditor.defaultForm.afterSubmit(a)}catch(g){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};BpmSubmit.prototype.getHtml=function(){if(this.isEnable()&&!this.isEvent){var a=this;if(null!=this.data&&1<this.data.length){var b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3ci\x3e\x3c/i\x3e\x3c/button\x3e');b.attr("id",this.domeId);var c=$('\x3cul class\x3d"dropdown-menu" aria-labelledby\x3d"'+this.domeId+'"\x3e');$.each(this.data,function(b,f){var e=$("\x3cli\x3e\x3c/li\x3e"),d=$('\x3ca href\x3d"javascript:void(0);"\x3e'+f.lable+"\x3c/a\x3e");d.attr("title",f.description);d.on("click",function(){a.execute(f)});e.append(d);c.append(e);flowUtils.notNull(f.attribute)&&"yes"==f.attribute.ideaCompelManner&&$(".bpm_compelManner_div").show()});$("#bpm_buttons_default2").append(b);$("#bpm_buttons_default2").append(c)}else if(null!=this.data){var d=this.data[0],b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e');b.attr("id",this.domeId);b.attr("title",d.description);b.on("click",function(){a.execute(d)});$("#bpm_buttons_default2").append(b);flowUtils.notNull(d.attribute)&&"yes"==d.attribute.ideaCompelManner&&$(".bpm_compelManner_div").show()}else null!=this.transmitData?(b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e'),b.attr("id",this.domeId),b.attr("title","\u586b\u5199\u610f\u89c1"),b.on("click",function(){a.executeTransmit()}),$("#bpm_buttons_default2").append(b)):(b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt" id\x3d"bpm_firsttasksubmitname"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e'),b.attr("id",this.domeId),b.on("click",function(){a.execute()}),$("#bpm_buttons_default2").append(b),flowUtils.notNull(this.flowEditor.ideaCompelManner)&&"yes"==this.flowEditor.ideaCompelManner&&$(".bpm_compelManner_div").show(),$.ajax({url:"platform/bpm/business/getFirstTaskSubmitName",data:{},type:"POST",dataType:"TEXT",success:function(a){flowUtils.notNull(a)&&$("#bpm_firsttasksubmitname").html(a)}}))}};BpmSubmit.prototype.executeTransmit=function(){var a=this;flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){a.submitTransmit()})};BpmSubmit.prototype.submitTransmit=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/dosubmitTransmit",data:{instanceId:this.transmitData.procinstDbid,message:this.getIdeaText(),taskId:this.transmitData.taskId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0)}})};BpmSubmit.prototype.clickBut=function(a){if(this.isEnable())if(flowUtils.notNull(a)){if(null!=this.data&&0<this.data.length)for(var b=0;b<this.data.length;b++)if(this.data[b].name==a){this.executeBack(this.data[b]);return}layer.msg("\u8def\u7531\u6761\u4ef6\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\uff0c\u8bf7\u91cd\u65b0\u8fdb\u884c\u63d0\u4ea4")}else if(null!=this.data&&1<this.data.length)layer.msg("\u6d41\u7a0b\u5df2\u521b\u5efa\uff0c\u8bf7\u9009\u62e9\u4e00\u4e2a\u5206\u652f\u8fdb\u884c\u63d0\u4ea4"),$("#"+this.domeId).parent().addClass("open");else if(null!=this.data){this.isAutoClickAfterStart=!0;try{$("#"+this.domeId).click()}catch(c){this.isAutoClickAfterStart=!1}this.isAutoClickAfterStart=!1}};BpmSubmit.prototype.quickExecute=function(){if(this.isEnable()&&this.isEvent){var a=this;if(null!=this.data&&1<this.data.length){var b="";$.each(this.data,function(a,d){b=0==a?b+('\x3cinput checked _val\x3d"'+a+'" type\x3d"radio" name\x3d"submitName" id\x3d"'+d.id+'"\x3e\x26nbsp;\x26nbsp;\x3clabel for\x3d"'+d.id+'"\x3e'+d.lable+"\x3c/label\x3e"):b+('\x3cbr/\x3e\x3cinput _val\x3d"'+a+'" type\x3d"radio" name\x3d"submitName" id\x3d"'+d.id+'"\x3e\x26nbsp;\x26nbsp;\x3clabel for\x3d"'+d.id+'"\x3e'+d.lable+"\x3c/label\x3e")});layer.open({title:"\u8bf7\u9009\u62e9\u529e\u7406\u4e8b\u9879",content:b,btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(b,d){var c=d.find("input[name\x3d'submitName']:checked");0==c.length?flowUtils.error("\u8bf7\u9009\u62e9\u529e\u7406\u4e8b\u9879"):(c=Number(c.attr("_val")),layer.close(b),a.execute(a.data[c]))}})}else null!=this.data&&this.execute(this.data[0])}else flowUtils.error("\u76ee\u524d\u6ca1\u6709\u529e\u7406\u6743\u9650")};function BpmSupersede(a,b,c,d){BpmButton.call(this,a,b,c.dosupersede,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_supersede";this.getHtml()}BpmSupersede.prototype=new BpmButton;BpmSupersede.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeSupersede(this.data)){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.data.procinstDbid,executionId:a.data.executionId,taskId:a.data.taskId,outcome:a.data.name,targetActivityName:a.data.targetActivityName,type:"dosupersede"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):(new BpmActor(a.data,b.taskUserSelect,a)).open()}})}};BpmSupersede.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dosupersede",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),selectUserId:null,formJson:null,activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterSupersede(a)}catch(f){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmPresstodo(a,b,c,d){BpmButton.call(this,a,b,c.dopresstodo,d);this.domeId="bpm_presstodo";this.getHtml()}BpmPresstodo.prototype=new BpmButton;BpmPresstodo.prototype.execute=function(){if(this.flowEditor.defaultForm.beforePresstodo(this.data)){var a=this;avicAjax.ajax({url:"platform/bpm/business/beforepresstodo",data:{executionId:a.data.executionId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.presstodo(b.result)}})}};BpmPresstodo.prototype.presstodo=function(a){var b=this,c="",c="true"==a.flg?"\u786e\u5b9a\u5bf9\u4e0b\u4e00\u8282\u70b9\u8fdb\u884c\u50ac\u529e\u5417\uff1f"+a.msg:"\u4e0b\u4e00\u8282\u70b9\u5728"+a.time+"\u88ab\u50ac\u529e\u8fc7\uff0c\u786e\u5b9a\u7ee7\u7eed\u8fdb\u884c\u50ac\u529e\u5417\uff1f"+a.msg;flowUtils.confirm(c,function(){avicAjax.ajax({url:"platform/bpm/business/dopresstodo",data:{executionId:b.data.executionId},type:"POST",dataType:"JSON",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error);else{flowUtils.success("\u50ac\u529e\u6210\u529f");try{b.flowEditor.defaultForm.afterPresstodo(b.data)}catch(e){}}}})})};function BpmSupplement(a,b,c,d){BpmButton.call(this,a,b,c.dosupplement,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_supplement"}BpmSupplement.prototype=new BpmButton;BpmSupplement.prototype.getHtmlForDefaultBar=function(){if(this.isEnable()){var a=this,b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e'+this.data.lable+"\x3c/span\x3e\x3c/button\x3e");b.on("click",function(){a.execute()});$("#bpm_buttons_default2").append(b)}};BpmSupplement.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeSupplement(this.data)){var a=this;avicAjax.ajax({type:"POST",data:{processInstanceId:a.data.procinstDbid},url:"platform/bpm/clientbpmdisplayaction/getcoordinate",dataType:"json",success:function(b){if(flowUtils.notNull(b,b.activity)){for(var c in b.activity){var d=b.activity[c],e=d.activityName,f=d.isCurrent,k=d.executionId;if(d.executionAlone&&"true"==f){a.callback(k,e);return}}a.supplementTaskDialog=layer.open({type:2,title:"\u8865\u53d1\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+a.data.procinstDbid+"\x26type\x3ddosupplement"});a.isEvent&&layer.full(a.supplementTaskDialog);window.bpmSupplement=a}}})}};BpmSupplement.prototype.callback=function(a,b){flowUtils.notNull(this.supplementTaskDialog)&&(layer.close(this.supplementTaskDialog),this.supplementTaskDialog=null);var c=flowUtils.clone(this.data);c.executionId=a;c.targetActivityName=b;var d=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:c.procinstDbid,executionId:c.executionId,taskId:c.taskId,outcome:c.name,targetActivityName:c.targetActivityName,type:"dosupplement"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(new BpmActor(c,a.taskUserSelect,d)).open()}})};BpmSupplement.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dosupplementassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),opType:"dosupplement"},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u8865\u53d1\u6210\u529f");try{c.flowEditor.defaultForm.afterSupplement(a)}catch(f){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmTaskreader(a,b,c,d){BpmButton.call(this,a,b,c.dotaskreader,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_taskreader";this.getHtml()}BpmTaskreader.prototype=new BpmButton;BpmTaskreader.prototype.execute=function(){this.flowEditor.defaultForm.beforeTaskreader(this.data)&&(new BpmActor(this.data,null,this)).open()};BpmTaskreader.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dotaskreader",data:{procinstDbid:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify(d)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterTaskreader(a)}catch(f){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmTransmit(a,b,c,d){BpmButton.call(this,a,b,c.dotransmit,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_transmit";this.getHtml()}BpmTransmit.prototype=new BpmButton;BpmTransmit.prototype.execute=function(){this.flowEditor.defaultForm.beforeTransmit(this.data)&&(new BpmActor(this.data,null,this)).open()};BpmTransmit.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dotransmit",data:{procinstDbid:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify(d)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterTransmit(a)}catch(f){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmWithdraw(a,b,c,d){BpmButton.call(this,a,b,c.dowithdraw,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_withdraw"}BpmWithdraw.prototype=new BpmButton;BpmWithdraw.prototype.getHtmlForDefaultBar=function(){if(this.isEnable()){var a=this,b=$('\x3cbutton class\x3d"listBtn grey btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e'+this.data.lable+"\x3c/span\x3e\x3c/button\x3e");b.on("click",function(){a.execute()});$("#bpm_buttons_default1").append(b)}};BpmWithdraw.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeWithdraw(this.data)){var a=this;avicAjax.ajax({type:"POST",data:{processInstanceId:a.data.procinstDbid},url:"platform/bpm/clientbpmdisplayaction/getcoordinate",dataType:"json",success:function(b){if(flowUtils.notNull(b,b.activity)){for(var c in b.activity){var d=b.activity[c],e=d.activityName,f=d.isCurrent,k=d.executionId;if(d.executionAlone&&"true"==f){a.callback(k,e);return}}a.withdrawTaskDialog=layer.open({type:2,title:"\u62ff\u56de\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+a.data.procinstDbid+"\x26type\x3ddowithdraw"});a.isEvent&&layer.full(a.withdrawTaskDialog);window.bpmWithdraw=a}}})}};BpmWithdraw.prototype.callback=function(a,b){var c=this;flowUtils.notNull(this.withdrawTaskDialog)&&(layer.close(this.withdrawTaskDialog),this.withdrawTaskDialog=null);var d=flowUtils.clone(this.data);d.targetActivityName=b;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:d.procinstDbid,executionId:d.executionId,taskId:d.taskId,outcome:d.name,targetActivityName:d.targetActivityName,type:"dowithdraw"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):flowUtils.confirm("\u786e\u5b9a\u62ff\u56de\u5417\uff1f",function(){var b=(new BpmActor(d,a.taskUserSelect,c)).getUsers();c.submit(d,b)})}})};BpmWithdraw.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dowithdrawcurract",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u62ff\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterWithdraw(a)}catch(f){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmWithdrawassignee(a,b,c,d){BpmButton.call(this,a,b,c.dowithdrawassignee,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_withdrawassignee";this.getHtml()}BpmWithdrawassignee.prototype=new BpmButton;BpmWithdrawassignee.prototype.execute=function(){this.flowEditor.defaultForm.beforeWithdrawassignee(this.data)&&(new BpmActor(this.data,null,this)).open()};BpmWithdrawassignee.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dowithdrawactassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{flowUtils.success("\u51cf\u7b7e\u6210\u529f");try{c.flowEditor.defaultForm.afterWithdrawassignee(a)}catch(f){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function initFlowPic(a){$("#graph").attr("src","platform/bpm/bpmPublishAction/getProcessImageTrackByDefid.gif?defid\x3d"+a)}function bpm_RefreshPic(a){flowUtils.notNull(a)&&$("#graph").attr("src","avicit/platform6/bpmfixie/bpmbusiness/include/ProcessTrackFixie.jsp?processInstanceId\x3d"+a)}function bpm_RefreshTracks(a){flowUtils.notNull(a)&&$.ajax({type:"POST",data:{entryId:a},url:"platform/bpm/business/doGettracks",dataType:"JSON",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error);else{$("#bpm_tracks_list").empty();$.each(a.result.tracklist,function(a,b){$.each(b,function(c,e){var f="bpm_tracks_"+a,d=$("\x3ctr\x3e\x3c/tr\x3e");d.addClass(f);d.hover(function(){$("."+f).addClass("hover")},function(){$("."+f).removeClass("hover")});var k=$("\x3ctd\x3e\x3c/td\x3e");k.html(e.currentActiveLabel);1<b.length&&(0==c?(k.attr("rowspan",2*b.length-1),k.addClass("merge")):(k=null,$("#bpm_tracks_list").append($("\x3ctr class\x3d'"+f+"'\x3e\x3c/tr\x3e"))));d.append(k);d.append(bpm_createTd(e.assigneeName,null));d.append(bpm_createTd(e.iTime,null));d.append(bpm_createTd(e.eTime,null));d.append(bpm_createTd(e.opType,null));d.append(bpm_createTd(e.useTime,null));d.append(bpm_createTd(e.targetuser,null));d.append(bpm_createTd(e.message,null));$("#bpm_tracks_list").append(d)})});var b={list:[]};$.each(a.result.timelist,function(a,c){var e={};e.title=c[0].dayName;e.list=[];$.each(c,function(a,b){var c={};c.l=b.timeName;c.r='\x3cspan style\x3d"color:#c426b3"\x3e'+b.operateUserName+'\x3c/span\x3e\u5728\x3cspan style\x3d"color:#2d52df"\x3e'+b.currentActiveLabel+'\x3c/span\x3e\u8282\u70b9\u8fdb\u884c\u4e86\x3cspan style\x3d"color:#49bd32"\x3e'+b.opType+"\x3c/span\x3e\u64cd\u4f5c";flowUtils.notNull(b.targetuser)&&(c.r+=',\u76ee\u6807\u63a5\u6536\u4eba\u662f\x3cspan style\x3d"color:#c426b3"\x3e'+b.targetuser+"\x3c/span\x3e");c.r+='\x3cbr/\x3e\u610f\u89c1\uff1a\x3cspan style\x3d"color:#2d52df"\x3e'+$.trim(b.message)+"\x3c/span\x3e";e.list.push(c)});b.list.push(e)});$(".time-line").timeliner({data:b})}}})}function bpm_createTd(a,b){var c=$("\x3ctd\x3e\x3c/td\x3e");c.html(a);flowUtils.notNull(b)&&c.css("border-top",b);return c}function BpmActor(a,b,c,d){this.data=a;this.submitObj=c;this.taskJsonData=b;this.isUflow=d}BpmActor.prototype.open=function(){var a=this,b=a.getActorHandTitle();flowUtils.notNull(b)||(b="\u4e0b\u4e00\u8282\u70b9");top.layer.open({skin:"bpm_selectUser_class",type:2,title:"\u9009\u62e9\u3010"+b+"\u3011\u5904\u7406\u4eba",area:["800px","450px"],content:"platform/bpmActor/bpmSelectUserAction2/main?procinstDbid\x3d"+this.data.procinstDbid+"\x26executionId\x3d"+this.data.executionId+"\x26taskId\x3d"+this.data.taskId+"\x26outcome\x3d"+this.data.name+"\x26targetActivityName\x3d"+this.data.targetActivityName+"\x26type\x3d"+this.data.event+"\x26doSubmitUrl\x3d\x26doSubmitCallEvent\x3d",btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(b,d){var c=d.find("iframe")[0].contentWindow.getSelectedUsers();if(null==c||0==c.length)top.layer.msg("\u8bf7\u9009\u62e9\u5904\u7406\u4eba");else{var f=a.getUflowDealType();if(a.checkIsBranch()){if(a.checkWorkHandUser()){var k=a.geBranchWorkHandSelectedUsers(c);actorWorkerHandlerOperation(k,a,!0,c,f);return}}else{if(a.checkWorkHandUser()){actorWorkerHandlerOperation(c,a,!1,null,f);return}c=[{selectedUsers:c,targetActivityName:null==a.data.targetActivityName?"":a.data.targetActivityName,outcome:null==a.data.name?"":a.data.name,workhandUsers:[]}]}top.layer.closeAll();a.submitObj.submit(a.data,c,!1,f)}},success:function(b,d){if(a.isUflow){var c=$(".bpm_selectUser_class");0==c.length&&(c=parent.$(".bpm_selectUser_class"));if(0==c.length)return;c.find(".layui-layer-btn").append("\x3cdiv class\x3d'pull-left'\x3e\x3cinput type\x3d'radio' name\x3d'dealtype' value\x3d'4' checked style\x3d'vertical-align:middle; margin-top:-2px; margin-bottom:1px;'/\x3e\u591a\u4eba\u5e76\u884c\x26nbsp;\x26nbsp\x3cinput type\x3d'radio' name\x3d'dealtype' value\x3d'3' style\x3d'vertical-align:middle; margin-top:-2px; margin-bottom:1px;'/\x3e\u591a\u4eba\u4efb\u610f\x3c/div\x3e")}if(flowUtils.notNull(a.data)&&"dostepuserdefined"==a.data.event){var f=b.find("iframe")[0].contentWindow;$.ajax({url:"platform/bpm/business/getBpmStepPerson",data:{entryId:a.data.procinstDbid,activityName:a.data.activityName},type:"POST",dataType:"JSON",success:function(a){if(flowUtils.notNull(a))for(var b=0;b<a.length;b++){var c=a[b];f.selectorData({id:c.id,name:c.name,attributes:{deptId:c.deptId,deptName:c.deptName}})}}})}}})};BpmActor.prototype.getUflowDealType=function(){if(this.isUflow){var a=$(".bpm_selectUser_class");0==a.length&&(a=parent.$(".bpm_selectUser_class"));return 0==a.length?"":a.find(".layui-layer-btn").find("input[name\x3d'dealtype']:checked").val()}return""};BpmActor.prototype.getUsers=function(){var a,b=this;$.ajax({url:"platform/bpmActor/bpmSelectUserAction2/getAutoSelectedUsersJSONData",async:!1,dataType:"JSON",data:{procinstDbid:this.data.procinstDbid,executionId:this.data.executionId,taskId:this.data.taskId,targetActivityName:this.data.targetActivityName,type:this.data.event,outcome:this.data.name},type:"GET",success:function(c){a="doretreattodraft"==b.data.event||"doretreattoprev"==b.data.event||"dowithdraw"==b.data.event?[{selectedUsers:c,targetActivityName:null==b.data.targetActivityName?"":b.data.targetActivityName,outcome:null==b.data.name?"":b.data.name,workhandUsers:[]}]:c}});return a};BpmActor.prototype.checkIsBranch=function(){try{return this.submitObj.conditions.isBranch()?!0:!1}catch(a){return!1}};BpmActor.prototype.getActorHandTitle=function(){try{if(this.checkIsBranch())return"\u5206\u652f";var a=this.taskJsonData.nextTask[0].currentActivityAttr.activityAlias;return null!=a?a:this.submitObj.data.lable}catch(b){return this.submitObj.data.lable}};BpmActor.prototype.checkWorkHandUser=function(){if(this.taskJsonData&&this.taskJsonData.nextTask)for(var a=0;a<this.taskJsonData.nextTask.length;a++){if("yes"==this.taskJsonData.nextTask[a].currentActivityAttr.isWorkHandUser)return!0}else return!1};BpmActor.prototype.geBranchWorkHandSelectedUsers=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].selectedUsers,e=0;e<d.length;e++)b.push(d[e]);return b};function actorWorkerHandlerOperation(a,b,c,d,e){$.ajax({type:"POST",url:"platform/bpmActor/bpmSelectUserAction2/getWorkHandUsers",async:!1,data:{userList:JSON.stringify(a),processKey:b.taskJsonData.processKey},dataType:"json",success:function(f){f&&0<f.length?(f="platform/bpmActor/bpmSelectUserAction2/getWorkHandSelectUser?userList\x3d"+encodeURI(encodeURI(JSON.stringify(f))),top.layer.open({skin:"bs-modal",title:"\u9009\u62e9\u6d41\u7a0b\u59d4\u6258\u5904\u7406\u4eba",content:f,area:["600px","400px"],type:2,shade:.3,btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(f,g){var k=g.find("iframe")[0].contentWindow.getWorkhandSelectedUsers();if(c){for(var p=0;p<d.length;p++)d[p].workhandUsers=k;top.layer.closeAll();b.submitObj.submit(b.data,d,!1,e)}else k=[{selectedUsers:a,targetActivityName:null==b.data.targetActivityName?"":b.data.targetActivityName,outcome:b.data.name,workhandUsers:k}],top.layer.closeAll(),b.submitObj.submit(b.data,k,!1,e)},init:function(a,b){}})):c?(top.layer.closeAll(),b.submitObj.submit(b.data,d,!1,e)):(f=[{selectedUsers:a,targetActivityName:null==b.data.targetActivityName?"":b.data.targetActivityName,outcome:b.data.name,workhandUsers:null}],top.layer.closeAll(),b.submitObj.submit(b.data,f,!1,e))},error:function(a){layer.alert(a,{icon:2})}})}flowUtils.include("avicit/platform6/bpmreform/bpmbusiness/include/src/FlowIdeaBase.js");flowUtils.include("avicit/platform6/bpmreform/bpmbusiness/include/src/FlowIdea.js");function FlowEditor(a,b){var c=_bpm_defineId,d=_bpm_deploymentId,e=_bpm_firstTaskName,f=_bpm_firstTaskAlias,k=_bpm_entryId,g=_bpm_executionId,l=_bpm_taskId,p=_bpm_formId,m=_bpm_ideaCompelManner;_flow_editor=this;this.simulation=_bpm_simulation;this.flowModel=new FlowModel(c,d,k,g,l);this.defaultForm=a;this.defaultForm.flowEditor=this;flowUtils.notNull(b)?this.flowIdea=b:this.flowIdea=new FlowIdea;this.flowIdea.flowEditor=this;this.ideaCompelManner=m;if(flowUtils.notNull(c))this.isStart=!0,this.flowModel.setActivityname(e),this.flowModel.setActivitylabel(f),this.flowModel.setUserIdentityKey("6"),this.flowModel.setUserIdentity("\u62df\u7a3f\u4eba");else if(flowUtils.notNull(k,g,l,p))this.defaultForm.setId(p),this.defaultForm.initFormData(),this.flowModel.defineId=this.getDefineIdByEntryId(k);else return this.hideButtons(),flowUtils.error("\u6d41\u7a0b\u53c2\u6570\u9519\u8bef\uff01\u65e0\u6cd5\u521d\u59cb\u5316\u6743\u9650\u6309\u94ae\uff01\u60a8\u53ef\u80fd\u662f\u901a\u8fc7\u975e\u6cd5\u7684\u9014\u5f84\u8fdb\u5165\u4e86\u5f53\u524d\u9875\u9762\uff0c\u4f8b\u5982\u91cd\u590d\u5237\u65b0\u9875\u9762\uff0c\u62f7\u8d1d\u94fe\u63a5\u5230\u6d4f\u89c8\u5668\u5730\u5740\u680f\u7b49\u64cd\u4f5c\u3002\u70b9\u51fb\u786e\u5b9a\u5173\u95ed\u8868\u5355",function(){flowUtils.closeWindowOnDialog()}),!1;c=flowUtils.getUrlQuery("title");flowUtils.notNull(c)&&(document.title=c);this.flowUploader=new FlowUploader(this);this.flowUploader.init();initFlowPic(this.flowModel.defineId);this.flowIdea.init();this.createButtons()}FlowEditor.prototype.defaultForm=null;FlowEditor.prototype.flowModel=null;FlowEditor.prototype.isStart=!1;FlowEditor.prototype.needRefreshPic=!1;FlowEditor.prototype.needIdeaText=!1;FlowEditor.prototype.simulation="0";FlowEditor.prototype.afterInit=!1;FlowEditor.prototype.hideButtons=function(){$(".bpmhide").hide();$("#bpm_buttons_default1").empty();$("#bpm_buttons_default2").empty()};FlowEditor.prototype.createButtons=function(a){var b=this;this.hideButtons();"1"==this.simulation?(this.bpmSubmit=new BpmSubmit(this,this.defaultForm,{}),this.bpmSave=new BpmSave(this,this.defaultForm,{}),this.bpmSubmit.execute=function(){flowUtils.success("\u6a21\u62df\u63d0\u4ea4")},this.bpmSave.execute=function(){flowUtils.success("\u6a21\u62df\u4fdd\u5b58")},$("#bpm_buttons_title").html("\u5f53\u524d\u8282\u70b9\uff1a"+this.flowModel.activitylabel),$("#bpm_buttons_desc").html("\u5f53\u524d\u8eab\u4efd\uff1a"+this.flowModel.userIdentity),this.hoverRemark(),this.controlFormInput(),this.refreshFiles(),this.needRefreshPic=!0,this.defaultForm.afterCreateButtons(),this.afterInit||(this.defaultForm.afterInit(),this.afterInit=!0),this.flowIdea.show()):this.isStart?(this.bpmSubmit=new BpmSubmit(this,this.defaultForm,{}),this.bpmSave=new BpmSave(this,this.defaultForm,{}),$("#bpm_buttons_title").html("\u5f53\u524d\u8282\u70b9\uff1a"+this.flowModel.activitylabel),$("#bpm_buttons_desc").html("\u5f53\u524d\u8eab\u4efd\uff1a"+this.flowModel.userIdentity),this.hoverRemark(),this.controlFormInput(),this.refreshFiles(),this.needRefreshPic=!0,this.defaultForm.afterCreateButtons(),this.afterInit||(this.defaultForm.afterInit(),this.afterInit=!0),this.flowIdea.show()):(1==_avicTabIndex?(this.refreshPic(),this.refreshTracks()):this.needRefreshPic=!0,avicAjax.ajax({type:"POST",data:{processInstanceId:b.flowModel.entryId,executionId:b.flowModel.executionId,taskId:b.flowModel.taskId},url:"platform/bpm/business/getoperateright",dataType:"JSON",success:function(c){flowUtils.notNull(c.error)?flowUtils.error(c.error):(b.drawButtons(c),"undefined"!=typeof word_oa_refresh&&flowUtils.notNull(word_oa_refresh)&&word_oa_refresh(b),a&&b.bpmSubmit.clickBut(),b.defaultForm.afterCreateButtons(),b.afterInit||(b.defaultForm.afterInit(),b.afterInit=!0))}}))};FlowEditor.prototype.drawButtons=function(a){var b=a.bpmContent;this.flowModel.setActivityname(b.processActivityName);this.flowModel.setActivitylabel(b.processActivityLabel);this.flowModel.setUserIdentityKey(b.userIdentityKey);this.flowModel.setUserIdentity(b.userIdentity);$("#bpm_buttons_title").html("\u5f53\u524d\u8282\u70b9\uff1a"+this.flowModel.activitylabel);$("#bpm_buttons_desc").html("\u5f53\u524d\u8eab\u4efd\uff1a"+this.flowModel.userIdentity);this.hoverRemark();this.refreshFiles();a=a.operateRight;if(null!=a){var c={};$.each(a,function(a,b){"dosubmit"==b.event?(null==c.dosubmit&&(c.dosubmit=[]),c.dosubmit.push(b)):eval("buttonData."+b.event+"\x3d button")});this.needIdeaText=!1;this.bpmSave=new BpmSave(this,this.defaultForm,c);this.bpmRetreat=new BpmRetreat(this,this.defaultForm,c);this.bpmSubmit=new BpmSubmit(this,this.defaultForm,c);this.bpmWithdraw=new BpmWithdraw(this,this.defaultForm,c);this.bpmSupplement=new BpmSupplement(this,this.defaultForm,c);this.bpmRetreat.enable||this.bpmSubmit.enable?(this.bpmWithdraw.getHtml(),this.bpmSupplement.getHtml()):(this.bpmWithdraw.getHtmlForDefaultBar(),this.bpmSupplement.getHtmlForDefaultBar());this.bpmAdduser=new BpmAdduser(this,this.defaultForm,c);this.bpmSupersede=new BpmSupersede(this,this.defaultForm,c);this.bpmTransmit=new BpmTransmit(this,this.defaultForm,c);this.bpmWithdrawassignee=new BpmWithdrawassignee(this,this.defaultForm,c);this.bpmFocus=new BpmFocus(this,this.defaultForm,c);this.bpmGlobalend=new BpmGlobalend(this,this.defaultForm,c);this.bpmGlobalidea=new BpmGlobalidea(this,this.defaultForm,c);this.bpmGlobaljump=new BpmGlobaljump(this,this.defaultForm,c);this.bpmGlobalresume=new BpmGlobalresume(this,this.defaultForm,c);this.bpmGlobalsuspend=new BpmGlobalsuspend(this,this.defaultForm,c);this.bpmStepuserdefined=new BpmStepuserdefined(this,this.defaultForm,c);this.bpmTaskreader=new BpmTaskreader(this,this.defaultForm,c);this.bpmPresstodo=new BpmPresstodo(this,this.defaultForm,c);this.needIdeaText?(this.flowIdea.readonly(!1),this.flowIdea.show()):(this.flowIdea.clear(),this.flowIdea.readonly(!0),this.flowIdea.hide());this.controlFormInput()}};FlowEditor.prototype.afterStart=function(a){this.isStart=!1;this.flowModel.setDefineId(a.defineId);this.flowModel.setEntryId(a.entryId);this.flowModel.setExecutionId(a.executionId);this.flowModel.setTaskId(a.taskId);this.defaultForm.setId(a.formId)};FlowEditor.prototype.refreshPic=function(){bpm_RefreshPic(this.flowModel.entryId)};FlowEditor.prototype.refreshTracks=function(){bpm_RefreshTracks(this.flowModel.entryId)};FlowEditor.prototype.refreshFiles=function(){this.flowUploader.refresh()};FlowEditor.prototype.getDefineIdByEntryId=function(a){var b=null;$.ajax({type:"POST",async:!1,data:{entryId:a},url:"platform/bpm/business/getDefineIdByEntryId",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):b=a.defineId}});return b};FlowEditor.prototype.controlFormInput=function(){var a=this;"7"==this.flowModel.userIdentityKey&&this.bpmSave.isEnable()||($(".panel-body").eq(0).find("select").attr("disabled","disabled"),$(".panel-body").eq(0).find(":checkbox").attr("disabled","disabled"),$(".panel-body").eq(0).find(":radio").attr("disabled","disabled"),$(".panel-body").eq(0).find(":text").attr("disabled","disabled"),$(".panel-body").eq(0).find("textarea").attr("disabled","disabled"),$(".panel-body").eq(0).find(".easyui-datebox").datebox({disabled:!0}),$(".panel-body").eq(0).find(".easyui-datetimebox").datetimebox({disabled:!0}),$(".panel-body").eq(0).find(".easyui-combobox").combobox({disabled:!0}),$(".panel-body").eq(0).find(".ext-input-right-icon").hide(),$(".bpm_self_class").each(function(b){b=$(this).attr("id");a.defaultForm.controlSelfElement(b,!1)}),$(".bpm_self_class").each(function(a){}),this.defaultForm.setAttachMagic(!1),avicAjax.ajax({type:"POST",data:{defineId:this.flowModel.defineId,activityname:this.flowModel.activityname},url:"platform/bpm/business/getFormSecuritys",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{if(a.bpmSave.isEnable()){$.each(b.result,function(b,c){var f="1"==c.operability;if(f)if("bpm_self_class"==c.elementType)a.defaultForm.controlSelfElement(c.tag,f,c);else if("pt6:JigsawCheckBox"==c.elementType||"pt6:JigsawRadio"==c.elementType||"checkbox"==c.elementType||"radio"==c.elementType)f=$('input[name\x3d"'+c.tag+'"]'),f.removeAttr("disabled");else if("textarea"==c.elementType)f=$("#"+c.tag),f.removeAttr("disabled");else if("eform_subtable_bpm_auth"==c.elementType){var d=c.tag.split("__"),f=d[1],d=d[0],e=$("#"+d).datagrid("getColumnFields"),l=!1,p=f+"Name";if(null!=e&&0<e.length)for(var m=0;m<e.length;m++)if(e[m]==p){l=!0;break}l?$("#"+d).datagridex("readonly",f+"Name",!1):$("#"+d).datagridex("readonly",f,!1)}else"eform_subtable_bpm_button_auth"!=c.elementType&&(f=$("#"+c.tag),f.hasClass("easyui-datebox")?f.datebox({disabled:!1}):f.hasClass("easyui-datetimebox")?f.datetimebox({disabled:!1}):f.hasClass("easyui-combobox")?f.combobox({disabled:!1}):(f.removeAttr("disabled"),f.parent().find(".ext-input-right-icon")&&f.parent().find(".ext-input-right-icon").show()));else if("eform_subtable_bpm_auth"==c.elementType){d=c.tag.split("__");f=d[1];d=d[0];e=$("#"+d).datagrid("getColumnFields");l=!1;p=f+"Name";if(null!=e&&0<e.length)for(m=0;m<e.length;m++)if(e[m]==p){l=!0;break}l?$("#"+d).datagridex("readonly",f+"Name"):$("#"+d).datagridex("readonly",f)}});var c=b.attachMagic||"true"==b.attachMagic;c&&a.defaultForm.setAttachMagic(c);$.each(b.attachmentAuths,function(b,c){var d="1"==c.operability,e="1"==c.required;a.defaultForm.setAttachCanAddOrDel(c.tag,d,c);a.defaultForm.setAttachRequired(c.tag,d&&e?!0:!1,c)});$.each(b.result,function(b,c){if("0"==c.required||"1"==c.required&&("0"==c.accessibility||"0"==c.operability))if("bpm_self_class"==c.elementType)a.defaultForm.controlSelfElementForRequired(c.tag,!1,c);else if("checkbox"==c.elementType||"radio"==c.elementType){var d=$('input[name\x3d"'+c.tag+'"]');(d=d.closest("td"))&&d.attr("data-isnull","true");var e=$('label[for\x3d"'+c.tag+'"]'),g=e.children("i[class\x3drequired]");if(g&&0<g.length)for(d=0;d<g.length;d++)g[d].remove()}else if("textarea"==c.elementType){if(d=$("#"+c.tag),d.validatebox({required:!1}),e=$('label[for\x3d"'+c.tag+'"]'),(g=e.children("i[class\x3drequired]"))&&0<g.length)for(d=0;d<g.length;d++)g[d].remove()}else if("eform_subtable_bpm_auth"==c.elementType){var e=c.tag.split("__"),d=e[1],e=e[0],g=$("#"+e).datagrid("getColumnFields"),l=!1,p=d+"Name";if(null!=g&&0<g.length)for(var m=0;m<g.length;m++)if(g[m]==p){l=!0;break}l?$("#"+e).datagridex("deleteValidate",d+"Name","required"):$("#"+e).datagridex("deleteValidate",d,"required")}else{if("eform_subtable_bpm_button_auth"!=c.elementType){d=$("#"+c.tag);d.hasClass("easyui-datebox")?(e=d.datebox("getValue"),d.datebox({required:!1}),d.datebox("setValue",e)):d.hasClass("easyui-datetimebox")?(e=d.datetimebox("getValue"),d.datetimebox({required:!1}),d.datetimebox("setValue",e)):d.hasClass("easyui-combobox")?(e=d.combobox("getValue"),d.combobox({required:!1,validType:null}),d.combobox("setValue",e)):d.validatebox({required:!1});e=$('label[for\x3d"'+c.tag+'"]');if((g=e.children("i[style\x3d'color:red']"))&&0<g.length)for(d=0;d<g.length;d++)g[d].remove();d=$('label[for\x3d"'+c.tag+'Name"]');if((e=d.children("i[style\x3d'color:red']"))&&0<e.length)for(d=0;d<e.length;d++)e[d].remove()}}else if("1"==c.required&&"1"==c.accessibility&&"1"==c.operability)if("bpm_self_class"==c.elementType)a.defaultForm.controlSelfElementForRequired(c.tag,"1"==c.required,c);else if("checkbox"==c.elementType||"radio"==c.elementType){if(d=$('input[name\x3d"'+c.tag+'"]'),(d=d.closest("td"))&&d.attr("data-isnull","false"),e=$('label[for\x3d"'+c.tag+'"]'),g=e.children("i[class\x3drequired]"),!g||1>g.length)g=$("\x3ci style\x3d'color:red'\x3e*\x3c/i\x3e"),e.prepend(g)}else if("textarea"==c.elementType){if(d=$("#"+c.tag),d.validatebox({required:!0}),e=$('label[for\x3d"'+c.tag+'"]'),g=e.children("i[class\x3drequired]"),!g||1>g.length)g=$("\x3ci style\x3d'color:red'\x3e*\x3c/i\x3e"),e.prepend(g)}else if("eform_subtable_bpm_auth"==c.elementType){e=c.tag.split("__");d=e[1];e=e[0];g=$("#"+e).datagrid("getColumnFields");l=!1;p=d+"Name";if(null!=g&&0<g.length)for(m=0;m<g.length;m++)if(g[m]==p){l=!0;break}l?$("#"+e).datagridex("addValidate",d+"Name","required"):$("#"+e).datagridex("addValidate",d,"required")}else if("eform_subtable_bpm_button_auth"!=c.elementType){d=$("#"+c.tag);d.hasClass("easyui-datebox")?(e=d.datebox("getValue"),d.datebox({required:!0}),d.datebox("setValue",e)):d.hasClass("easyui-datetimebox")?(e=d.datetimebox("getValue"),d.datetimebox({required:!0}),d.datetimebox("setValue",e)):d.hasClass("easyui-combobox")?(e=d.combobox("getValue"),d.combobox({required:!0,validType:"extendsIsNull"}),d.combobox("setValue",e)):d.validatebox({required:!0});e=$('label[for\x3d"'+c.tag+'"]');d=$('label[for\x3d"'+c.tag+'Name"]');g=e.children("i[style\x3d'color:red']");if(!g||1>g.length)g=$("\x3ci style\x3d'color:red'\x3e*\x3c/i\x3e"),e.prepend(g);e=d.children("i[style\x3d'color:red']");if(!e||1>e.length)g=$("\x3ci style\x3d'color:red'\x3e*\x3c/i\x3e"),d.prepend(g)}})}$.each(b.result,function(b,c){var d="1"==c.accessibility;if(d)if("eform_subtable_bpm_auth"==c.elementType){e=c.tag.split("__");d=e[1];e=e[0];g=$("#"+e).datagrid("getColumnFields");l=!1;p=d+"Name";if(null!=g&&0<g.length)for(m=0;m<g.length;m++)if(g[m]==p){l=!0;break}l?jQuery("#"+e).datagrid("showColumn",d+"Name"):jQuery("#"+e).datagrid("showColumn",d)}else"eform_subtable_bpm_button_auth"==c.elementType&&a.defaultForm.controlSubTableButtonForAccess(c.tag,d,c);else if("bpm_self_class"==c.elementType)a.defaultForm.controlSelfElementForAccess(c.tag,d,c);else if("checkbox"==c.elementType||"radio"==c.elementType)d=$('input[name\x3d"'+c.tag+'"]'),d.hide(),d=$('label[for\x3d"'+c.tag+'"]'),d.hide();else if("textarea"==c.elementType)d=$("#"+c.tag),d.hide(),d=$('label[for\x3d"'+c.tag+'"]'),d.hide();else if("eform_subtable_bpm_auth"==c.elementType){var e=c.tag.split("__"),d=e[1],e=e[0],g=$("#"+e).datagrid("getColumnFields"),l=!1,p=d+"Name";if(null!=g&&0<g.length)for(var m=0;m<g.length;m++)if(g[m]==p){l=!0;break}l?jQuery("#"+e).datagrid("hideColumn",d+"Name"):jQuery("#"+e).datagrid("hideColumn",d)}else"eform_subtable_bpm_button_auth"==c.elementType?a.defaultForm.controlSubTableButtonForAccess(c.tag,d,c):(d=$("#"+c.tag),d.hasClass("easyui-datebox")?d.datebox("destroy"):d.hasClass("easyui-numberbox")?d.numberbox("destroy"):d.hasClass("easyui-combobox")?d.combobox("destroy"):d.hasClass("easyui-datetimebox")?d.datetimebox("destroy"):d.hasClass("easyui-coding")?d.coding("destroy"):d.hasClass("groupCtrlSpan")?d.remove():d.parent()&&d.parent().hasClass("ext-selector-div")?d.parent().hide():d.hide(),d=$('label[for\x3d"'+c.tag+'"]'),e=$('label[for\x3d"'+c.tag+'Name"]'),d.hide(),e.hide())})}}}))};FlowEditor.prototype.hoverRemark=function(){"true"!=$("#bpm_buttons_remark").attr("isload")&&($("#bpm_buttons_remark").attr("isload","true"),$.ajax({type:"POST",data:{defineId:this.flowModel.defineId,activityname:this.flowModel.activityname},url:"platform/bpm/business/getTaskRemark",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(a=flowUtils.notNull(a.result)?""+a.result+"":"\u5f53\u524d\u8282\u70b9\u65e0\u63cf\u8ff0",$("#bpm_buttons_remark").attr("title",a))}}))};var _flow_editor=null,_avicTabIndex=0;function avicTabOnSwitch(a){_avicTabIndex=a;1==a&&"undefined"!=typeof _flow_editor.needRefreshPic&&_flow_editor.needRefreshPic&&(_flow_editor.needRefreshPic=!1,_flow_editor.refreshPic(),_flow_editor.refreshTracks())};