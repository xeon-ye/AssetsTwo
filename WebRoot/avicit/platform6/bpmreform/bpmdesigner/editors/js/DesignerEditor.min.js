/**
 * MyBase
 *//**
 * custom extends MyBase
 *//**
 * end extends MyBase
 *//**
 * exclusive extends MyBase
 *//**
 * foreach extends MyBase
 *//**
 * fork extends MyBase
 *//**
 * java extends MyBase
 *//**
 * jms extends MyBase
 *//**
 * join extends MyBase
 *//**
 * process extends MyBase
 *//**
 * sql extends MyBase
 *//**
 * start extends MyBase
 *//**
 * state extends MyBase
 *//**
 * sub-process extends MyBase
 *//**
 * swimlane extends MyBase
 *//**
 * task extends MyBase
 *//**
 * transition extends MyBase
 *//**
 * ws extends MyBase
 *//**
 * rules extends MyBase
 *//**
 * text extends MyBase
 *//**
 * rest extends MyBase
 *//**
 * 编辑器
 */
function MyBase(a,b,c){this.designerEditor=a;this.id=b;this.tagName=c;this.cell;this.forkJoinArr=[];this.defineId="undefined"!=typeof _type?2==_type?_pdId:_id:null;this.picIndex=1}MyBase.prototype.init=function(){};MyBase.prototype.initTracks=function(a,b){this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this)};MyBase.prototype.addForkJoin=function(a){this.forkJoinArr.push(a)};MyBase.prototype.hasForkJoin=function(){return 0<this.forkJoinArr.length?!0:!1};MyBase.prototype.initLoad=function(a,b){};MyBase.prototype.initBase=function(){var a=$("#"+this.tagName).clone(!0,!0);a.attr("id",this.id);a.addClass("temp");"process"==this.tagName?(a.appendTo(this.designerEditor.homeDiv),$("#"+this.id).show()):(a.appendTo(this.designerEditor.profileDiv),$("#"+this.id).hide())};MyBase.prototype.initJBXX=function(){$("#"+this.id).find("#xian_shi_ming_cheng").val($.trim(this.alias));$("#"+this.id).find("#luo_ji_biao_shi").val(this.name)};MyBase.prototype.rename=function(a){this.alias==this.name?(this.alias=this.name=a,$("#"+this.id).find("#luo_ji_biao_shi").val(this.name),$("#"+this.id).find("#xian_shi_ming_cheng").val($.trim(this.alias))):(this.name=a,$("#"+this.id).find("#luo_ji_biao_shi").val(this.name))};MyBase.prototype.getXmlDoc=function(){this.cell=this.getCell();var a;a=new mxCodec;this.designerEditor.editor.graph.setCellStyles("imageBorder","",[this.cell]);var b=a.encode(this.cell);"transition"==this.tagName?(a=flowUtils.createElement(this.tagName),a.setAttribute("_id",this.id),a.appendChild(b)):a=b;this.putAttr("alias",this.alias,a);this.putAttr("g",this.getG(),a);this.putAttr("name",this.name,a);this.getOtherAttr(a);return a};MyBase.prototype.getOtherAttr=function(a){};MyBase.prototype.showProp=function(){$(".prop_wrap").hide();$("#"+this.id).show();this.designerEditor.myCurCellId=this.id;setTimeout(function(){$("#propMainDiv").find(".nav-tabs").find("li").eq(1).trigger("click");$("#propMainDiv").find(".nav-tabs").find("a").eq(0).trigger("blur")},100);this.controlCandidate();this.afterShowProp()};MyBase.prototype.afterShowProp=function(){};MyBase.prototype.controlCandidate=function(){if("transition"==this.tagName&&0<$("#"+this.id).find("#draft-candidate-data-field").length){var a=this.getCell().target.id;if("task"==this.designerEditor.myCellMap.get(a).tagName&&(a=this.getCell().source.id,a=this.designerEditor.myCellMap.get(a),"custom"==a.tagName||"java"==a.tagName||"sql"==a.tagName||"state"==a.tagName||"ws"==a.tagName||"sub-process"==a.tagName)){$("#"+this.id).find("#draft-candidate-data-field").parents(".candidate").show();return}$("#"+this.id).find("#draft-candidate-data-field").parents(".candidate").hide().find("input,textarea").val("")}};MyBase.prototype.remove=function(){$("#"+this.id).remove()};MyBase.prototype.getCell=function(){return this.designerEditor.editor.graph.getModel().getCell(this.id)};MyBase.prototype.getG=function(){var a=this.cell.getGeometry(),b,c;b=this.cell.getParent();null!=b&&"1"!=b.id?(c=b.getGeometry(),b=Math.round(c.x)+Math.round(a.x),c=Math.round(c.y)+Math.round(a.y)):(b=Math.round(a.x),c=Math.round(a.y));b=b+","+(c+",")+(a.width+",");return b+=a.height};MyBase.prototype.getmxCellG=function(){var a=this.g.split(","),b={};b.x=a[0];b.y=a[1];b.width=a[2];b.height=a[3];return b};MyBase.prototype.labelChanged=function(a){this.alias=a;("1"!=_iconType||"start"!=this.tagName&&"end"!=this.tagName&&"decision"!=this.tagName&&"fork"!=this.tagName&&"join"!=this.tagName)&&this.designerEditor.editor.graph.labelChanged(this.getCell(),a)};MyBase.prototype.resolve=function(){return Number(this.name.replace(this.tagName,""))};MyBase.prototype.createMxCell=function(a){var b=this.getmxCellG(),c=flowUtils.createElement(this.tagName);c.setAttribute("id",this.id);"1"==_iconType?"start"!=this.tagName&&"end"!=this.tagName&&"decision"!=this.tagName&&"fork"!=this.tagName&&"join"!=this.tagName&&c.setAttribute("label",$.trim(this.alias)):c.setAttribute("label",$.trim(this.alias));if(this.designerEditor.useNewDesigner){if(flowUtils.notNull(a.firstElementChild)){if("start"==this.tagName||"end"==this.tagName||"decision"==this.tagName||"fork"==this.tagName||"join"==this.tagName)a.firstElementChild.firstElementChild.setAttribute("width","55"),a.firstElementChild.firstElementChild.setAttribute("height","50");c.appendChild(a.firstElementChild)}else{if("start"==this.tagName||"end"==this.tagName||"decision"==this.tagName||"fork"==this.tagName||"join"==this.tagName)a.firstChild.firstChild.setAttribute("width","55"),a.firstChild.firstChild.setAttribute("height","50");c.appendChild(a.firstChild)}return c}a=flowUtils.createElement("mxCell");var d=flowUtils.createElement("mxGeometry");a.setAttribute("style",this.style);a.setAttribute("vertex","1");a.setAttribute("parent","1");d.setAttribute("x",b.x);d.setAttribute("y",b.y);d.setAttribute("width",b.width);d.setAttribute("height",b.height);d.setAttribute("as","geometry");a.appendChild(d);c.appendChild(a);return c};MyBase.prototype.doubleClickCell=function(){};MyBase.prototype.putAttr=function(a,b,c){flowUtils.notNull(b)&&c.setAttribute(a,b)};MyBase.prototype.getAttr=function(a,b){return $.trim(a.getAttribute(b))};MyBase.prototype.addMeta=function(a,b,c){if(flowUtils.notNull(b)){var d=flowUtils.createElement("meta");d.setAttribute("name",a);d.appendChild(flowUtils.createTextNode(b));c.appendChild(d)}};MyBase.prototype.getMeta=function(a,b){return $.trim($(a).children("meta[name\x3d'"+b+"']").text())};MyBase.prototype.setXmlAttrByVal=function(a,b,c){this.putAttr(c,$("#"+this.id).find("#"+a).val(),b)};MyBase.prototype.setXmlMetaByVal=function(a,b,c){a=$("#"+this.id).find("#"+a).val();flowUtils.notNull(a)&&this.addMeta(c,"\x3c![CDATA["+a+"]]\x3e",b)};MyBase.prototype.setXmlAttrByCheck=function(a,b,c){this.putAttr(c,$("#"+this.id).find("input[name\x3d'"+a+"']:checked").val(),b)};MyBase.prototype.setXmlMetaByCheck=function(a,b,c){a=$("#"+this.id).find("input[name\x3d'"+a+"']").is(":checked")?"yes":"no";this.addMeta(c,a,b)};MyBase.prototype.setXmlAttrByProp=function(a,b,c,d){this.putAttr(c,$("#"+this.id).find("#"+a).attr(d),b)};MyBase.prototype.setXmlMetaByProp=function(a,b,c,d){this.addMeta(c,$("#"+this.id).find("#"+a).attr(d),b)};MyBase.prototype.setDomValByAttr=function(a,b,c){$("#"+this.id).find("#"+a).val(this.getAttr(b,c))};MyBase.prototype.setDomValByMeta=function(a,b,c){$("#"+this.id).find("#"+a).val(this.getMeta(b,c))};MyBase.prototype.setDomCheckByAttr=function(a,b,c,d){this.getAttr(b,c)==d&&($("#"+this.id).find("#"+a).attr("checked",!0),$("#"+this.id).find("#"+a).trigger("click"))};MyBase.prototype.setDomCheckByMeta=function(a,b,c,d){b=this.getMeta(b,c);$("#"+this.id).find("#"+a).prop("checked",void 0==b?"yes"==d?!0:!1:"yes"==b?!0:!1)};MyBase.prototype.setDomPropByAttr=function(a,b,c,d){b=this.getAttr(b,c);flowUtils.notNull(b)&&$("#"+this.id).find("#"+a).attr(d,b)};MyBase.prototype.setDomPropByMeta=function(a,b,c,d){b=this.getMeta(b,c);flowUtils.notNull(b)&&$("#"+this.id).find("#"+a).attr(d,b)};MyBase.prototype.createRemarkXml=function(a){var b=$("#"+this.id).find("#bei_zhu_xin_xi").val();void 0!=b&&0<b.length&&this.addMeta("remark","\x3c![CDATA["+b+"]]\x3e",a)};MyBase.prototype.createRemarkDom=function(a){this.setDomValByMeta("bei_zhu_xin_xi",a,"remark")};MyBase.prototype.createQXXml=function(a,b,c,d,e){b=$("#"+this.id).find("input[name\x3d'"+b+"']");if(b.prop("checked")){var f=b.parentsUntil("div[class^\x3d'div-auth-checkbox']").parent().siblings("div[class^\x3d'div-auth-box']"),g=f.find("input[name\x3d'operator-data-field']"),h=f.find("input[name\x3d'candidate-data-field']"),k=f.find("input[name\x3d'preprocess-data-field']"),l=f.find("input[name\x3d'postprocess-data-field']"),m=f.find("input[name\x3d'input_kua_jie_dian_tui_hui_activity']");b=flowUtils.createElement("magic");b.setAttribute("type",c);b.setAttribute("name",d);c=f.find("input[name\x3d'operator-alias']");flowUtils.notNull(c.val())&&(c=$.trim(c.val()),b.setAttribute("alias",c));c=f.find("input[name\x3d'operator-jScript']");flowUtils.notNull(c.val())&&(c=$.trim(c.val()),b.setAttribute("jScript",c));c=flowUtils.createElement("possess");d=flowUtils.createElement("scope");var f=flowUtils.createElement("pre-processing"),p=flowUtils.createElement("post-processing"),n=flowUtils.createElement("activity"),q=g.attr("actorsid");flowUtils.notNull(q)?(c.setAttribute("owner",q),this.createUserSelectXml(q,g.val(),e)):c.setAttribute("owner","");g=h.attr("actorsid");flowUtils.notNull(g)?(d.setAttribute("select",g),this.createUserSelectXml(g,h.val(),e)):d.setAttribute("select","");h=e="";flowUtils.notNull(k.val())&&(e=$.trim(k.val().split("\u3010")[0]),h=$.trim(k.val().split("\u3010")[1]).replace("\u3011",""));f.setAttribute("class",h);f.appendChild(flowUtils.createTextNode(e));k=e="";flowUtils.notNull(l.val())&&(e=$.trim(l.val().split("\u3010")[0]),k=$.trim(l.val().split("\u3010")[1]).replace("\u3011",""));p.setAttribute("class",k);p.appendChild(flowUtils.createTextNode(e));e=l="";if(flowUtils.notNull(m.val()))for(m=m.val().split(","),k=0;k<m.length;k++)0<k&&(l+=",",e+=","),l+=$.trim(m[k].split("\u3010")[0]),e+=$.trim(m[k].split("\u3010")[1]).replace("\u3011","");n.setAttribute("activityName",e);n.appendChild(flowUtils.createTextNode(l));b.appendChild(c);b.appendChild(d);b.appendChild(f);b.appendChild(p);b.appendChild(n);a.appendChild(b)}};MyBase.prototype.createQXDom=function(a,b,c){var d=this;$(a).children("magics").children("magic[type\x3d'"+c+"']").each(function(){var c=$("#"+d.id).find("input[name\x3d'"+b+"']"),f=c.parentsUntil("div[class^\x3d'div-auth-checkbox']").parent().siblings("div[class^\x3d'div-auth-box']"),g=$(this).find("possess").attr("owner"),h=$(this).find("scope").attr("select"),k=$(this).attr("alias");flowUtils.notNull(k)&&f.find("input[name\x3d'operator-alias']").val(k);k=$(this).attr("jScript");flowUtils.notNull(k)&&f.find("input[name\x3d'operator-jScript']").val(k);if(flowUtils.notNull(g)){var l=f.find("input[name\x3d'operator-data-field']"),k=f.find("input[name\x3d'operator-text-field']");l.attr("actorsId",g);g=d.getUserSelectObjFromXml(g,a);l.val(JSON.stringify(g));g=d.getUserSelectTextFieldValue(g);k.val(g);k.attr("title",g)}flowUtils.notNull(h)&&(l=f.find("input[name\x3d'candidate-data-field']"),k=f.find("input[name\x3d'candidate-text-field']"),l.attr("actorsId",h),g=d.getUserSelectObjFromXml(h,a),l.val(JSON.stringify(g)),g=d.getUserSelectTextFieldValue(g),k.val(g),k.attr("title",g));var m=$.trim($(this).find("pre-processing").attr("class")),k=$.trim($(this).find("post-processing").attr("class")),p=$.trim($(this).find("pre-processing").text()),l=$.trim($(this).find("post-processing").text()),g=$.trim($(this).find("activity").attr("activityName")),h=$.trim($(this).find("activity").text()),n=f.find("input[name\x3d'preprocess-data-field']");flowUtils.notNull(m)&&(m=p+"\u3010"+m+"\u3011",n.val(m),n.attr("title",m));n=f.find("input[name\x3d'postprocess-data-field']");flowUtils.notNull(k)&&(m=l+"\u3010"+k+"\u3011",n.val(m),n.attr("title",m));f=f.find("input[name\x3d'input_kua_jie_dian_tui_hui_activity']");if(flowUtils.notNull(g)){g=g.split(",");h=h.split(",");k="";for(l=0;l<g.length;l++)0<l&&(k+=","),k+=h[l]+"\u3010"+g[l]+"\u3011";f.val(k);f.attr("title",k)}c.trigger("click")})};MyBase.prototype.createWDQXDom=function(a){var b=this;$(a).children("docRights").children("docRight").each(function(){var a=$(this).attr("type");$("#"+b.id).find("input[name\x3d'"+a+"']").trigger("click");$(this).children("subDocRight").each(function(){var c=$(this).attr("type"),c=$("#"+b.id).find("."+a).find("#"+c);c.is("input[type\x3d'checkbox']")?c.trigger("click"):c.is(".wd_text")?(c.val($(this).attr("name")),c.attr("wd_text_ids",$(this).attr("value"))):c.is(".wd_actor")&&(c.attr("actorsId",$(this).attr("value")),c.val(actorFactory.getActorsTextById($(this).attr("value"))))})})};MyBase.prototype.createWDQXXml=function(a,b,c,d){var e=this;if($("#"+this.id).find("input[name\x3d'"+b+"']").prop("checked")){var f=flowUtils.createElement("docRight");f.setAttribute("type",b);f.setAttribute("name",c);$("#"+this.id).find("."+b).find("input[type\x3d'checkbox']:checked").each(function(){var a=flowUtils.createElement("subDocRight");a.setAttribute("type",$(this).attr("id"));a.setAttribute("name",$(this).next().text());a.setAttribute("value",$(this).attr("id"));f.appendChild(a)});$("#"+this.id).find("."+b).find(".wd_text").each(function(){if($.notNull($(this).val())){var a=flowUtils.createElement("subDocRight");a.setAttribute("type",$(this).attr("id"));a.setAttribute("name",$(this).val());a.setAttribute("value",$(this).attr("wd_text_ids"));f.appendChild(a)}});$("#"+this.id).find("."+b).find(".wd_actor").each(function(){if($.notNull($(this).val())){var a=flowUtils.createElement("subDocRight");a.setAttribute("type",$(this).attr("id"));a.setAttribute("name",$(this).parent().prev().text());a.setAttribute("value",$(this).attr("actorsId"));f.appendChild(a);e.createUserSelectXml(d,$(this).attr("actorsId"))}});a.appendChild(f)}};MyBase.prototype.setConditionXml=function(a,b,c){b=$("#"+this.id).find("#"+b+' tr[name!\x3d"title"]');if(0<b.length){var d=flowUtils.createElement("conditions");d.setAttribute("type",$("#"+this.id).find("#"+a).val());b.each(function(){var a=flowUtils.createElement("condition"),b=$(this).find("td").eq(0).find("input");"undefined"!=typeof b&&""!=b.text()&&null!=b.text()?(a.setAttribute("type",$(this).find("td").eq(1).text().trim()),a.appendChild(flowUtils.createTextNode("\x3c![CDATA["+b.text().trim()+"]]\x3e")),a.setAttribute("computeRes",$(this).find("td").eq(2).text().trim())):(a.setAttribute("type",$(this).find("td").eq(1).text().trim()),a.appendChild(flowUtils.createTextNode("\x3c![CDATA["+$(this).find("td").eq(2).text().trim()+"]]\x3e")));d.appendChild(a)});c.appendChild(d)}};MyBase.prototype.getUserSelectTextFieldValue=function(a){for(var b="",c="",d="",e="",f="",g="",h="",k=0;k<a.length;k++){var l=a[k],m=l.type;"dept"==m?c=""==l.position.positionId?c+(l.name+";"):c+(l.name+"#"+l.position.positionName+";"):"user"==m?d+=l.name+";":"position"==m?e+=l.name+";":"role"==m?f+=l.name+";":"group"==m?g+=l.name+";":"relation"==m&&(h+=l.name,l.deptlevel&&(h+="#"+l.deptlevel.deptlevelName),l.position&&(h+="#"+l.position.positionName),l.step&&(h+="#"+l.step.stepName),l.customfunction&&(h+="#"+l.customfunction.customfunctionName),l.variable&&(h+="#"+l.variable.dataTypeName+"#"+l.variable.variableAlias),l.intersection&&(h+="#\u4ea4\u96c6\u9009\u4eba#"+l.intersection.intersectionAlias),h+=";")}""!=c&&(b+="\u3010\u90e8\u95e8\u3011"+c);""!=d&&(b+="\u3010\u7528\u6237\u3011"+d);""!=e&&(b+="\u3010\u5c97\u4f4d\u3011"+e);""!=f&&(b+="\u3010\u89d2\u8272\u3011"+f);""!=g&&(b+="\u3010\u7fa4\u7ec4\u3011"+g);""!=h&&(b+="\u3010\u5173\u7cfb\u3011"+h);return b};MyBase.prototype.setUserSelectDom=function(a,b){var c=this.getAttr(b,"candidate-users");if(0<c.length){var d=this.getUserSelectObjFromXml(c,b);$("#"+this.id+" #"+a.dataField).val(JSON.stringify(d));$("#"+this.id+" #"+a.dataField).attr("actorsId",c);$("#"+this.id+" #"+a.textField).val(this.getUserSelectTextFieldValue(d))}};MyBase.prototype.setUserSelectXml=function(a,b){var c=$("#"+this.id+" #"+a.dataField),d=c.attr("actorsId"),e=c.val();if(void 0!=d&&void 0!=e&&0!=e.length){c=flowUtils.createElement("actors");b.setAttribute("candidate-users",d);c.setAttribute("id",d);d=JSON.parse(e);for(e=0;e<d.length;e++){var f=flowUtils.createElement("actor"),g=d[e];f.setAttribute("type",g.type);var h=flowUtils.createElement("id");h.appendChild(flowUtils.createTextNode(g.id));var k=flowUtils.createElement("name");k.appendChild(flowUtils.createTextNode(g.name));f.appendChild(h);f.appendChild(k);if("dept"==g.type){if(g.position){h=flowUtils.createElement("position");k=flowUtils.createElement("id");k.appendChild(flowUtils.createTextNode(g.position.positionId));var l=flowUtils.createElement("name");l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.position.positionName+"]]\x3e"));h.appendChild(k);h.appendChild(l);f.appendChild(h)}}else"relation"==g.type&&(g.position&&(h=flowUtils.createElement("position"),k=flowUtils.createElement("id"),k.appendChild(flowUtils.createTextNode(g.position.positionId)),l=flowUtils.createElement("name"),l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.position.positionName+"]]\x3e")),h.appendChild(k),h.appendChild(l),f.appendChild(h)),g.deptlevel&&(h=flowUtils.createElement("deptlevel"),k=flowUtils.createElement("id"),k.appendChild(flowUtils.createTextNode(g.deptlevel.deptlevelId)),l=flowUtils.createElement("name"),l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.deptlevel.deptlevelName+"]]\x3e")),h.appendChild(k),h.appendChild(l),f.appendChild(h)),g.step&&(h=flowUtils.createElement("step"),k=flowUtils.createElement("id"),k.appendChild(flowUtils.createTextNode(g.step.stepId)),l=flowUtils.createElement("name"),l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.step.stepName+"]]\x3e")),h.appendChild(k),h.appendChild(l),f.appendChild(h)),g.customfunction&&(h=flowUtils.createElement("customfunction"),k=flowUtils.createElement("id"),k.appendChild(flowUtils.createTextNode(g.customfunction.customfunctionName)),l=flowUtils.createElement("name"),l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.customfunction.customfunctionName+"]]\x3e")),h.appendChild(k),h.appendChild(l),f.appendChild(h)),g.variable&&(h=flowUtils.createElement("variable"),k=flowUtils.createElement("id"),k.appendChild(flowUtils.createTextNode("#{"+g.variable.variableName+"}")),l=flowUtils.createElement("name"),l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.variable.variableAlias+"]]\x3e")),h.appendChild(k),h.appendChild(l),f.appendChild(h),h=flowUtils.createElement("type"),k=flowUtils.createElement("id"),k.appendChild(flowUtils.createTextNode(g.variable.dataType)),l=flowUtils.createElement("name"),l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.variable.dataTypeName+"]]\x3e")),h.appendChild(k),h.appendChild(l),f.appendChild(h),h=flowUtils.createElement("deptPosition"),k=flowUtils.createElement("id"),k.appendChild(flowUtils.createTextNode(g.variable.deptPositionId)),l=flowUtils.createElement("name"),l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.variable.deptPositionName+"]]\x3e")),h.appendChild(k),h.appendChild(l),f.appendChild(h)),g.intersection&&(h=flowUtils.createElement("intersection"),k=flowUtils.createElement("id"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.intersection.intersectionValue+"]]\x3e")),l=flowUtils.createElement("name"),l.appendChild(flowUtils.createTextNode("\x3c![CDATA["+g.intersection.intersectionAlias+"]]\x3e")),h.appendChild(k),h.appendChild(l),f.appendChild(h)));c.appendChild(f)}b.appendChild(c)}};MyBase.prototype.createUserSelectXml=function(a,b,c){if(void 0!=a&&void 0!=b&&0!=b.length){var d=flowUtils.createElement("actors");d.setAttribute("id",a);a=JSON.parse(b);for(b=0;b<a.length;b++){var e=flowUtils.createElement("actor"),f=a[b];e.setAttribute("type",f.type);var g=flowUtils.createElement("id");g.appendChild(flowUtils.createTextNode(f.id));var h=flowUtils.createElement("name");h.appendChild(flowUtils.createTextNode(f.name));e.appendChild(g);e.appendChild(h);if("dept"==f.type){if(f.position){g=flowUtils.createElement("position");h=flowUtils.createElement("id");h.appendChild(flowUtils.createTextNode(f.position.positionId));var k=flowUtils.createElement("name");k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.position.positionName+"]]\x3e"));g.appendChild(h);g.appendChild(k);e.appendChild(g)}}else"relation"==f.type&&(f.position&&(g=flowUtils.createElement("position"),h=flowUtils.createElement("id"),h.appendChild(flowUtils.createTextNode(f.position.positionId)),k=flowUtils.createElement("name"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.position.positionName+"]]\x3e")),g.appendChild(h),g.appendChild(k),e.appendChild(g)),f.deptlevel&&(g=flowUtils.createElement("deptlevel"),h=flowUtils.createElement("id"),h.appendChild(flowUtils.createTextNode(f.deptlevel.deptlevelId)),k=flowUtils.createElement("name"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.deptlevel.deptlevelName+"]]\x3e")),g.appendChild(h),g.appendChild(k),e.appendChild(g)),f.step&&(g=flowUtils.createElement("step"),h=flowUtils.createElement("id"),h.appendChild(flowUtils.createTextNode(f.step.stepId)),k=flowUtils.createElement("name"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.step.stepName+"]]\x3e")),g.appendChild(h),g.appendChild(k),e.appendChild(g)),f.customfunction&&(g=flowUtils.createElement("customfunction"),h=flowUtils.createElement("id"),h.appendChild(flowUtils.createTextNode(f.customfunction.customfunctionName)),k=flowUtils.createElement("name"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.customfunction.customfunctionName+"]]\x3e")),g.appendChild(h),g.appendChild(k),e.appendChild(g)),f.variable&&(g=flowUtils.createElement("variable"),h=flowUtils.createElement("id"),h.appendChild(flowUtils.createTextNode("#{"+f.variable.variableName+"}")),k=flowUtils.createElement("name"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.variable.variableAlias+"]]\x3e")),g.appendChild(h),g.appendChild(k),e.appendChild(g),g=flowUtils.createElement("type"),h=flowUtils.createElement("id"),h.appendChild(flowUtils.createTextNode(f.variable.dataType)),k=flowUtils.createElement("name"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.variable.dataTypeName+"]]\x3e")),g.appendChild(h),g.appendChild(k),e.appendChild(g),g=flowUtils.createElement("deptPosition"),h=flowUtils.createElement("id"),h.appendChild(flowUtils.createTextNode(f.variable.deptPositionId)),k=flowUtils.createElement("name"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.variable.deptPositionName+"]]\x3e")),g.appendChild(h),g.appendChild(k),e.appendChild(g)),f.intersection&&(g=flowUtils.createElement("intersection"),h=flowUtils.createElement("id"),h.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.intersection.intersectionValue+"]]\x3e")),k=flowUtils.createElement("name"),k.appendChild(flowUtils.createTextNode("\x3c![CDATA["+f.intersection.intersectionAlias+"]]\x3e")),g.appendChild(h),g.appendChild(k),e.appendChild(g)));d.appendChild(e)}c.appendChild(d)}};MyBase.prototype.getUserSelectObjFromXml=function(a,b){var c=[];$(b).children("actors[id\x3d'"+a+"']").each(function(){$(this).children("actor").each(function(){var a={},b=$(this).attr("type"),f=$.trim($(this).children("id").text()),g=$.trim($(this).children("name").text());a.id=f;a.treeId=f;a.type=b;a.name=g;if("dept"==b)a.typeName="\u7528\u6237",g=$(this).children("position"),a.position={positionId:$.trim(g.children("id").text()),positionName:$.trim(g.children("name").text())},a.primaryId=a.treeId+"_"+b+"_"+f+(a.position.positionId?"_"+a.position.positionId:"");else if("user"==b||"position"==b||"group"==b||"role"==b)a.typeName="\u7528\u6237",a.primaryId=f+"_"+b+"_"+f;else{b="relation";g=$(this).children("position");g.get(0)&&(a.position={positionId:$.trim(g.children("id").text()),positionName:$.trim(g.children("name").text())});g=$(this).children("deptlevel");g.get(0)&&(a.deptlevel={deptlevelId:$.trim(g.children("id").text()),deptlevelName:$.trim(g.children("name").text())});g=$(this).children("step");g.get(0)&&(a.step={stepId:$.trim(g.children("id").text()),stepName:$.trim(g.children("name").text())});g=$(this).children("customfunction");g.get(0)&&(a.customfunction={customfunctionId:$.trim(g.children("id").text()),customfunctionName:$.trim(g.children("name").text())});var h=$(this).children("variable"),k=$(this).children("type"),g=$(this).children("deptPosition");if(h.get(0)){var l=$.trim(h.children("id").text()),l=l.replace("#","").replace("{","").replace("}",""),h=$.trim(h.find("name").eq(0).text()),m=$.trim(k.children("id").text()),k=$.trim(k.find("name").eq(0).text()),p="",n="";g.get(0)&&(p=$.trim(g.children("id").text()),n=$.trim(g.find("name").eq(0).text()));a.variable={variableName:l,variableAlias:h,dataType:m,dataTypeName:k,deptPositionId:p,deptPositionName:n}}l=$(this).children("intersection");l.get(0)&&(g=$.trim(l.find("id").eq(0).text()),l=$.trim(l.find("name").eq(0).text()),a.intersection={intersectionValue:g,intersectionAlias:l});a.typeName="\u5173\u7cfb";a.primaryId=a.treeId+"_"+b+"_"+f+(a.deptlevel?"_"+a.deptlevel.deptlevelId:"")+(a.position?"_"+a.position.positionId:"")+(a.step?"_"+a.step.stepId:"")+(a.customfunction?"_"+a.customfunction.customfunctionId:"")+(a.variable?"_"+a.variable.variableName:"")+(a.intersection?"_"+a.intersection.intersectionValue:"")}c.push(a)})});return c};MyBase.prototype.refreshUploader=function(){this.bpmDocUploader.uploader&&this.bpmDocUploader.uploader.refresh};function addProcessAuth(a,b,c,d){$("#"+a).find("div[class\x3d'"+b+"'] input[name\x3d'"+c+"']").val(d)}function getProcessAuth(a,b,c){return $("#"+a).find("div[class\x3d'"+b+"'] input[name\x3d'"+c+"']").val()}MyBase.prototype.addXmlElement=function(a,b,c){flowUtils.notNull(b)&&(a=flowUtils.createElement(a),a.appendChild(flowUtils.createTextNode(b)),c.appendChild(a))};MyBase.prototype.getXmlElement=function(a,b){return $.trim($(a).children(b).text())};MyBase.prototype.reloadOptions=function(a,b,c){var d=this,e=$("#"+this.id+" select[name\x3d'"+a+"']");e.empty();for(a=0;a<b.length;a++){var f=b[a];e.append("\x3coption  value\x3d'"+f.value+"'\x3e"+f.text+"\x3c/option\x3e")}e.off("change").on("change",function(){""!=this.value?$.ajax({type:"POST",url:"platform/bpm/bpmconsole/eventManageAction/getEventInfoForDesigner",data:{id:this.value},dataType:"json",success:function(a){if(!c||"\u6d41\u7a0b\u542f\u52a8\u6761\u4ef6"==c){var b=a.bpmClass;e.parent().parent().parent().find("input").val(b.path)}else if("\u6d41\u7a0b\u4e8b\u4ef6\u76d1\u542c"==c){b=a.bpmClass;a=a.properties;$("#"+d.id+" input[name\x3d'input-event-name']").val(b.name);$("#"+d.id+" input[name\x3d'input-event']").val(b.path);for(var b=$("#"+d.id+" table[name\x3d'constants']"),f=0;f<a.length;f++){var g=a[f],m=b.find("\x3etbody\x3etr").eq(f);m.get(0)?(m.children("td").eq(0).text(g.name),m.children("td").eq(1).text(g.initExpr||"")):b.find("\x3etbody").append("\x3ctr\x3e\x3ctd\x3e"+g.name+"\x3c/td\x3e\x3ctd\x3e"+(g.initExpr||"")+"\x3c/td\x3e\x3ctr\x3e")}}}}):d.nodeEvent.empty()})};MyBase.prototype.processInstance=function(){var a=null,b=this.designerEditor.myCellMap.values();$.each(b,function(b,d){if("process"==d.tagName)return a=d,!1});return a};function MyCustom(a,b){MyBase.call(this,a,b,"custom");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_custom.png;"}MyCustom.prototype=new MyBase;MyCustom.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getCustom();this.labelChanged(this.name);this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-custom-node")};MyCustom.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setCustom(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-custom-node");this.nodeEvent.setEventDom(a);var c=this.getAttr(a,"class");$("#"+this.id+" #node_class").val(c);$("#"+this.id+" input[name\x3d'custom_class_check']").each(function(a,b){$(b).val()==c&&$(b).click()})};MyCustom.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"");this.putAttr("class",$("#"+this.id+" #node_class").val(),a)};function MyEnd(a,b){MyBase.call(this,a,b,"end");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/end_event_terminate.png;"}MyEnd.prototype=new MyBase;MyEnd.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getEnd();this.labelChanged("\u7ed3\u675f");this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-end-node");this.initEvent()};MyEnd.prototype.initLoad=function(a,b){this.initBase();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-end-node");this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setEnd(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.initEvent();this.nodeEvent.setEventDom(a);var c=this;$(a).children("docRights").children("docRight").each(function(){var b=$(this).attr("type");$("#"+c.id).find("input[name\x3d'"+b+"']").trigger("click");$(this).children("subDocRight").each(function(){var d=$(this).attr("type"),f=$(this).attr("value");if("wordRead"==b||"wordEdit"==b)$("#"+c.id).find("input[type\x3d'checkbox'][name\x3d'"+d+"']").prop("checked",!0);else if("wordRedTemplet"==b||"wordCreate"==b){var g=$(this).attr("name"),d=$(this).attr("value"),f=$("#"+c.id).find("input[name\x3d'"+("wordCreate"==b?"taskFormValueWordCreate":"taskFormValueWordRedTemplet")+"']"),h=$("#"+c.id).find("input[name\x3d'"+("wordCreate"==b?"taskFormTextWordCreate":"taskFormTextWordRedTemplet")+"']");f.val(d);h.val(g);h.attr("title",g)}else if("wordPrint"==b)flowUtils.notNull(f)&&(g=$("#"+c.id).find("input[name\x3d'taskFormValue"+d+"']"),d=$("#"+c.id).find("input[name\x3d'taskFormText"+d+"']"),g.attr("actorsId",f),f=c.getUserSelectObjFromXml(f,a),g.val(JSON.stringify(f)),g=c.getUserSelectTextFieldValue(f),d.val(g),d.attr("title",g));else if("wordValue"==b){if(g=$(this).attr("name"),d=$(this).attr("value"))f=$("#"+c.id).find("input[name\x3d'taskFormValueWordValue']"),h=$("#"+c.id).find("input[name\x3d'taskFormTextWordValue']"),f.val(d),h.val(g),h.attr("title",g)}else flowUtils.error("\u4f60\u78b0\u5230\u4e86\u4e00\u4e2a\u9519\u8bef")})})};MyEnd.prototype.getOtherAttr=function(a){var b=flowUtils.createElement("docRights");this.createFormSaveXml("wordRead","\u67e5\u770b\u6b63\u6587",b);this.createFormSaveXml("wordPrint","\u6253\u5370\u6b63\u6587",b,a);0<b.childNodes.length&&a.appendChild(b);this.nodeEvent.setEventXml(a,"")};MyEnd.prototype.createFormSaveXml=function(a,b,c,d){var e=this;if($("#"+e.id).find("input[name\x3d'"+a+"']").prop("checked")){var f=flowUtils.createElement("docRight");f.setAttribute("type",a);f.setAttribute("name",b);"wordEdit"==a&&($("#"+e.id).find("input[type\x3d'checkbox'][name\x3d'wordRevisions']").prop("checked")&&(b=flowUtils.createElement("subDocRight"),b.setAttribute("type","wordRevisions"),b.setAttribute("name","\u7f16\u8f91\u65f6\u7559\u75d5"),b.setAttribute("value","wordRevisions"),f.appendChild(b)),$("#"+e.id).find("input[type\x3d'checkbox'][name\x3d'wordShowRevisions']").prop("checked")&&(b=flowUtils.createElement("subDocRight"),b.setAttribute("type","wordShowRevisions"),b.setAttribute("name","\u663e\u793a\u7559\u75d5"),b.setAttribute("value","wordShowRevisions"),f.appendChild(b)));"wordRead"==a&&($("#"+e.id).find("input[type\x3d'checkbox'][name\x3d'read1']").prop("checked")&&(b=flowUtils.createElement("subDocRight"),b.setAttribute("type","read1"),b.setAttribute("name","\u663e\u793a\u6e05\u7a3f"),b.setAttribute("value","read1"),f.appendChild(b)),$("#"+e.id).find("input[type\x3d'checkbox'][name\x3d'read2']").prop("checked")&&(b=flowUtils.createElement("subDocRight"),b.setAttribute("type","read2"),b.setAttribute("name","\u663e\u793a\u6e05\u7a3f"),b.setAttribute("value","read2"),f.appendChild(b)));if("wordCreate"==a||"wordRedTemplet"==a){var g=$("#"+e.id).find("input[name\x3d'taskFormValue"+(a.toString()[0].toUpperCase()+a.toString().slice(1))+"']"),h=$("#"+e.id).find("input[name\x3d'taskFormText"+(a.toString()[0].toUpperCase()+a.toString().slice(1))+"']");b=flowUtils.createElement("subDocRight");b.setAttribute("type","wordCreate"==a?"wordTemplates":"wordRedTemplates");b.setAttribute("name",h.val());b.setAttribute("value",g.val());f.appendChild(b)}"wordPrint"==a&&$("#"+e.id).find("input[name^\x3d'taskFormValuewordSecret']").each(function(){var a=$(this).attr("id"),b=$(this).attr("actorsid"),c=$(this).val();c&&(e.createUserSelectXml(b,c,d),c=flowUtils.createElement("subDocRight"),c.setAttribute("type",a.slice(13)),c.setAttribute("name",$(this).parent().parent().parent().find("label").text()),c.setAttribute("value",b),f.appendChild(c))});"wordValue"==a&&(g=$("#"+e.id).find("input[name\x3d'taskFormValueWordValue']"),h=$("#"+e.id).find("input[name\x3d'taskFormTextWordValue']"),b=flowUtils.createElement("subDocRight"),b.setAttribute("type","wordFieldName"),b.setAttribute("name",h.val()),b.setAttribute("value",g.val()),f.appendChild(b));c.appendChild(f)}};MyEnd.prototype.initEvent=function(){var a=this;$("#"+a.id+" div[name^\x3d'div-word']").find("input[type\x3d'checkbox']").on("click",function(){var b=$(this).attr("name"),b=$("#"+a.id+" div[name\x3d'container-"+b+"']");this.checked?b.hasClass("hidden")&&b.removeClass("hidden"):(b.addClass("hidden"),b.find("input").val(""),b.find("input[type\x3d'checkbox']").prop("checked",!1))});$("#"+a.id).find("button[name^\x3d'btnTaskFormwordSecret']").off("click").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),c=$(this).parent().siblings("div").find("input[name^\x3d'taskFormValuewordSecret']").attr("name"),d=$(this).parent().siblings("div").find("input[name^\x3d'taskFormTextwordSecret']").attr("name");new UserSelect({processId:b.id,type:"userSelect",userSelectContainer:"",dataField:c,textField:d,topId:a.id})})};function MyExclusive(a,b){MyBase.call(this,a,b,"decision");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/gateway_exclusive.png;"}MyExclusive.prototype=new MyBase;MyExclusive.prototype.init=function(){this.initBase();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-exclusive-node");this.name="exclusive"+this.designerEditor.countUtils.getExclusive();this.labelChanged(this.name);this.initJBXX()};MyExclusive.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setExclusive(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-exclusive-node");this.nodeEvent.setEventDom(a)};MyExclusive.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"")};MyExclusive.prototype.resolve=function(){return Number(this.name.replace("exclusive",""))};function MyForeach(a,b){MyBase.call(this,a,b,"foreach");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/gateway_foreach.png;"}MyForeach.prototype=new MyBase;MyForeach.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getForeach();this.labelChanged(this.name);this.initJBXX();this.initEvent();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-foreach-node")};MyForeach.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setForeach(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);"yes"==$.trim($(a).children("meta[name\x3d'isMustUser']").text())?($("#"+this.id+" #bixuxuanren").prop("checked",!0),$("#"+this.id+" div[name\x3d'zidongxuanren-area']").hasClass("hidden")&&$("#"+this.id+" div[name\x3d'zidongxuanren-area']").removeClass("hidden"),$("#"+this.id+" div[name\x3d'zidongxuanren-collection']").hasClass("hidden")||$("#"+this.id+" div[name\x3d'zidongxuanren-collection']").addClass("hidden"),"auto"==$.trim($(a).children("meta[name\x3d'userSelectType']").text())&&$("#"+this.id+" #zidongxuanren").prop("checked",!0)):($("#"+this.id+" #bixuxuanren").prop("checked",!1),$("#"+this.id+" div[name\x3d'zidongxuanren-area']").hasClass("hidden")||$("#"+this.id+" div[name\x3d'zidongxuanren-area']").addClass("hidden"),$("#"+this.id+" div[name\x3d'zidongxuanren-collection']").hasClass("hidden")&&$("#"+this.id+" div[name\x3d'zidongxuanren-collection']").removeClass("hidden"));this.initEvent();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-foreach-node");this.nodeEvent.setEventDom(a);$("#"+this.id+" #inputValueBackVar").val(this.getAttr(a,"var"));$("#"+this.id+" #inputTextBackVar").val(this.getAttr(a,"var"));$("#"+this.id+" #inputValueCollection").val(this.getAttr(a,"in"));$("#"+this.id+" #inputTextCollection").val(this.getAttr(a,"in"));this.setUserSelectDom({userSelectContainer:"candidate-container",dataField:"candidate-data-field",textField:"candidate-text-field"},a)};MyForeach.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"");this.putAttr("var",$("#"+this.id+" #inputValueBackVar").val(),a);var b=$("#"+this.id+" #inputValueCollection").val();flowUtils.notNull(b)&&this.putAttr("in",b,a);$("#"+this.id+" #inputValueBackVar");$("#"+this.id+" #bixuxuanren").is(":checked")?(this.addMeta("isMustUser","yes",a),$("#"+this.id+" #zidongxuanren").is(":checked")&&this.addMeta("userSelectType","auto",a)):this.addMeta("isMustUser","no",a);this.setUserSelectXml({userSelectContainer:"candidate-container",dataField:"candidate-data-field",textField:"candidate-text-field"},a)};MyForeach.prototype.initEvent=function(){var a=this;$("#"+a.id+" button[name\x3d'button-BackVar']").off("click").on("click",function(){var b=null,c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"process"==c.tagName&&(b=c)});new ProcessVariable({dataDomId:a.id+" #inputValueBackVar",showDomId:a.id+" #inputTextBackVar",callback:function(b){b=b[0];$("#"+a.id+" #inputValueBackVar").val(b.name);$("#"+a.id+" #inputTextBackVar").val(b.name)},process:b,multiple:!1})});$("#"+a.id+" button[name\x3d'button-Collection']").off("click").on("click",function(){var b=null,c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"process"==c.tagName&&(b=c)});new ProcessVariable({dataDomId:a.id+" #inputValueCollection",showDomId:a.id+" #inputTextCollection",callback:function(b){b=b[0];$("#"+a.id+" #inputValueCollection").val("#{"+b.name+"}");$("#"+a.id+" #inputTextCollection").val("#{"+b.name+"}")},process:b,multiple:!1})});$("#"+a.id+" #bixuxuanren").off("click").on("click",function(){this.checked?($("#"+a.id+" div[name\x3d'zidongxuanren-area']").hasClass("hidden")&&$("#"+a.id+" div[name\x3d'zidongxuanren-area']").removeClass("hidden"),$("#"+a.id+" div[name\x3d'zidongxuanren-collection']").hasClass("hidden")||$("#"+a.id+" div[name\x3d'zidongxuanren-collection']").addClass("hidden")):($("#"+a.id+" div[name\x3d'zidongxuanren-area']").hasClass("hidden")||$("#"+a.id+" div[name\x3d'zidongxuanren-area']").addClass("hidden"),$("#"+a.id+" div[name\x3d'zidongxuanren-collection']").hasClass("hidden")&&$("#"+a.id+" div[name\x3d'zidongxuanren-collection']").removeClass("hidden"))});$("#"+this.id+" button[name\x3dbutton-auth-candidate]").off("click").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey);a.candidateSelect=new UserSelect({type:"userSelect",userSelectContainer:"candidate-container",dataField:"candidate-data-field",textField:"candidate-text-field",topId:a.id,processId:b.id,callback:function(a){}})})};function MyFork(a,b){MyBase.call(this,a,b,"fork");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/gateway_fork.png;"}MyFork.prototype=new MyBase;MyFork.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getFork();this.labelChanged(this.name);this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-fork-node")};MyFork.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setFork(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-fork-node");this.nodeEvent.setEventDom(a)};MyFork.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"")};function MyJava(a,b){MyBase.call(this,a,b,"java");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_java.png;"}MyJava.prototype=new MyBase;MyJava.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getJava();this.labelChanged(this.name);this.initJBXX();this.initEvent();var a=$("#"+this.id).find("#flow-component");this.fixPlaceHold(a);a=$("#"+this.id).find("#flow-method");this.fixPlaceHold(a);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-java-node")};MyJava.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setJava(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.initEvent();$("#"+this.id).find("#flow-component").val(this.getAttr(a,"class"));$("#"+this.id).find("#flow-method").val(this.getAttr(a,"method"));$("#"+this.id+" #inputValueFlowVariable").val(this.getAttr(a,"var"));$("#"+this.id+" #inputTextFlowVariable").val(this.getAttr(a,"var"));this.methodClass.getDom(a);this.fieldClass.getDom(a);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-java-node");this.nodeEvent.setEventDom(a)};MyJava.prototype.getOtherAttr=function(a){var b=$("#"+this.id).find("#flow-component").val();this.putAttr("class",b,a);b=$("#"+this.id).find("#flow-method").val();this.putAttr("method",b,a);b=$("#"+this.id+" #inputValueFlowVariable").val();this.putAttr("var",b,a);this.methodClass.getXml(a);this.fieldClass.getXml(a);this.nodeEvent.setEventXml(a,"")};MyJava.prototype.initEvent=function(){var a=this;$("#"+a.id+" button[name\x3d'button-flow-variable']").on("click",function(){var b=null,c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"process"==c.tagName&&(b=c)});new ProcessVariable({dataDomId:a.id+" #inputValueFlowVariable",showDomId:a.id+" #inputTextFlowVariable",callback:function(b){b=b[0];$("#"+a.id+" #inputValueFlowVariable").val(b.name);$("#"+a.id+" #inputTextFlowVariable").val(b.name)},process:b,multiple:!1})});a.methodClass=new MethodAndClass({id:a.id,buttonId:"buttonAddMethodClass",tableId:a.id+" #table-flow-add-methodClass",type:"arg",callback:function(a){}});a.fieldClass=new MethodAndClass({id:a.id,buttonId:"buttonAddFieldClass",tableId:a.id+" #table-flow-add-fieldClass",type:"field",callback:function(a){}})};MyJava.prototype.fixPlaceHold=function(a){"Microsoft Internet Explorer"==navigator.appName&&9>=parseInt(navigator.appVersion.split(";")[1].replace(/[ ]/g,"").replace("MSIE",""))&&(a?a:$("input[placeholder]")).each(function(){var a=$(this);a.val(a.attr("placeholder"));a.on("focus.placeholder",function(){a.val()==a.attr("placeholder")&&a.val("")}).on("blur.placeholder",function(){a.val()||a.val(a.attr("placeholder"))})})};function MyJms(a,b){MyBase.call(this,a,b,"jms");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_jms.png;"}MyJms.prototype=new MyBase;MyJms.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getJms();this.labelChanged(this.name);this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-jms-node");this.initEvent()};MyJms.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setJms(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.initEvent();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-jms-node");this.nodeEvent.setEventDom(a);this.setDomValByAttr("initial-context-factory",a,"initial-context-factory");this.setDomValByAttr("provider-url",a,"provider-url");this.setDomValByAttr("connection-factory",a,"connection-factory");this.setDomValByAttr("destination",a,"destination");"true"==this.getAttr(a,"transacted")&&$("#"+this.id).find("#transacted").trigger("click");var c=this.getAttr(a,"acknowledge");$("#"+this.id).find("input[name\x3d'acknowledge'][value\x3d'"+c+"']").prop("checked","checked");c=this.getAttr(a,"message");$("#"+this.id).find("input[name\x3d'message'][value\x3d'"+c+"']").trigger("click");if("text"==c||"object"==c){var d;d="text"==c?$.trim($(a).children("text").text()):$.trim($(a).children("object").attr("expr"));$("#"+this.id).find("input[name\x3d'returnValue_"+c+"']").val(d)}else this.jmsCollection.getDom(a)};MyJms.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"");this.setXmlAttrByVal("initial-context-factory",a,"initial-context-factory");this.setXmlAttrByVal("provider-url",a,"provider-url");this.setXmlAttrByVal("connection-factory",a,"connection-factory");this.setXmlAttrByVal("destination",a,"destination");this.putAttr("transacted",$("#"+this.id).find("input[name\x3d'transacted']").is(":checked"),a);this.putAttr("acknowledge",$("#"+this.id).find("input[type\x3d'radio'][name\x3d'acknowledge']:checked").val(),a);var b=$("#"+this.id).find("input[type\x3d'radio'][name\x3d'message']:checked").val();this.putAttr("message",b,a);if("text"==b||"object"==b){var c=$("#"+this.id).find("input[name\x3d'returnValue_"+b+"']").val(),d=flowUtils.createElement(b);a.appendChild(d);"text"==b?d.appendChild(flowUtils.createTextNode(c)):d.setAttribute("expr",c)}else this.jmsCollection.getXml(a)};MyJms.prototype.initEvent=function(){var a=this;$("#"+a.id+" input[type\x3d'radio'][name\x3d'message']").on("click",function(){var b=$(this).val();$("#"+a.id).find("div[class^\x3d'area-input']").each(function(){$(this).hasClass("hidden")||$(this).addClass("hidden")});$("#"+a.id).find("div[class^\x3d'area-input-"+b+"']").removeClass("hidden")});a.jmsCollection=new JMSCollection({id:a.id,buttonId:"buttonAddMethodClass",tableId:a.id+" #table-flow-add-methodClass",type:"entry",callback:function(a){}})};function MyJoin(a,b){MyBase.call(this,a,b,"join");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/gateway_join.png;"}MyJoin.prototype=new MyBase;MyJoin.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getJoin();this.labelChanged(this.name);this.initJBXX();this.observeGlobalVariable();this.processInstance().notify();this.initEvent();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-join-node")};MyJoin.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setJoin(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.observeGlobalVariable();this.initEvent();var c=this.getMeta(a,"joinType");if("condition"==c)this.createConditionDom("zhi_xing_fang_shi","table-executor",a);else if("arbitrary"==c){var d=this.getAttr(a,"multiplicity");$("#"+this.id).find("input[name\x3d'input-num']").val(d)}$("#"+this.id).find("input[name\x3d'input-radio-merge-condition'][value\x3d'"+c+"']").trigger("click");this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-join-node");this.nodeEvent.setEventDom(a)};MyJoin.prototype.getOtherAttr=function(a){var b=$("#"+this.id).find("input[name\x3d'input-radio-merge-condition']:checked").val();this.addMeta("joinType",b,a);"condition"==b?this.setConditionXml("zhi_xing_fang_shi","table-executor",a):"arbitrary"==b&&this.putAttr("multiplicity",$("#"+this.id).find("input[name\x3d'input-num']").val(),a);this.nodeEvent.setEventXml(a,"")};MyJoin.prototype.updateGlobalVariable=function(a,b){var c=$("#"+this.id+" select[name\x3d'yin_ru_bian_liang']");c.empty();c.append("\x3coption selected value\x3d'0'\x3e\u5f15\u5165\u53d8\u91cf\x3c/option\x3e");if(0<a.length)for(var d=0;d<a.length;d++)c.append("\x3coption\x3e#{"+a[d].name+"}\x3c/option\x3e")};MyJoin.prototype.observeGlobalVariable=function(){this.processInstance().observers.add(this)};MyJoin.prototype.initEvent=function(){$("#"+this.id+" select[name\x3d'yin_ru_bian_liang']").on("change",function(){if(0!=this.value){var a=$(this),b=a.parent().parent().siblings("div").find("textarea"),a=0==b.val().length?a.val():b.val()+","+a.val();b.val(a)}})};MyJoin.prototype.createConditionDom=function(a,b,c){var d=this;$(c).children("conditions").each(function(){var c=$(this).attr("type");$("#"+d.id).find("#"+a).val(c);var f=$("#"+d.id).find("#"+b).find("tbody");$(this).children("condition").each(function(a){a=$(this).attr("type");var b=$(this).text();EventThatInsertStartConditionContentIntoTableWhenInit(f,a,$("\x3cinput value\x3d'"+b+"'/\x3e"))})})};MyJoin.prototype.modifyStartCondition=function(a){a=$(a);var b=a.parent().parent(),c="expr"==b.find("td:eq(1)").text().toLowerCase()?0:1,d=b.find("td:eq(2)");a.find("div[name\x3d'demoCont'] ul").find("li:eq("+c+")").click();a=a.parents("table[name\x3dtable-executor]").parent().parent();this.changeStartConditionTab(a.find("ul:eq(0)").find("li").eq(c));a.find("ul:eq(1)").find("li").eq(c).find(0==c?"textarea":"input").val(d.text().trim());a=a.find("ul:eq(1)").find("li").eq(c).find("button[name\x3d'btn-add-start-condition']");var e=a.clone(!0);a.off("click").text("\u4fdd\u5b58").on("click",function(){var a=0==c?$(this).parent().parent().parent().find("textarea"):$(this).parent().parent().parent().find("input");a&&0!=a.val().length?(d.text(a.val()),a.val(""),$(this).replaceWith(e)):alert("\u60a8\u8fd8\u6ca1\u8f93\u5165\u5185\u5bb9");return!1})};MyJoin.prototype.changeStartConditionTab=function(a){a=$(a);a.addClass("active").siblings("li").removeClass("active").parent(".global-attrs-tab").siblings(".tab-cont").find("\x3eli:eq("+a.index()+")").addClass("active").siblings("li").removeClass("active");a.find("input").prop("checked",!0)};function MyProcess(a,b){MyBase.call(this,a,b,"process");this.lock={varModifyLock:!1};this.observers=new ObserverList}MyProcess.prototype=new MyBase;MyProcess.prototype.init=function(){this.initBase();this.initEvent();this.bpmDocUploader=new BpmDocUploader({id:this.id,defineId:this.defineId,activityName:"global",uploaderId:"bpm-designer-upload"});$("#formName_biaoTi").click(function(){a.configProcessTaskTitle()});$("#shi_li_biao_ti").click(function(){a.configProcessInstanceTitle()});this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-flow-event");var a=this;this.selectPublishBpmEform1=new SelectPublishEform("guan_lian_biao_dan","formName",this.id,"Y","");this.selectPublishBpmEform1.init(function(b){var c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"task"==c.tagName&&this.syncTaskForm(b.id,b.name)})});this.name=this.designerEditor.processKey;this.alias=_bmpsName;$("#"+this.id).find("#liu_cheng_ming_cheng").val(this.alias);$("#"+this.id).find("#liu_cheng_biao_shi").val(this.name);this.observers.add(this)};MyProcess.prototype.initLoad=function(a,b){this.initBase();this.initEvent();this.name=this.designerEditor.processKey;this.bpmDocUploader=new BpmDocUploader({id:this.id,defineId:this.defineId,activityName:"global",uploaderId:"bpm-designer-upload"});var c=this;this.selectPublishBpmEform1=new SelectPublishEform("guan_lian_biao_dan","formName",this.id,"Y","");this.selectPublishBpmEform1.init(function(a){var b=c.designerEditor.myCellMap.values();$.each(b,function(b,c){"task"==c.tagName&&this.syncTaskForm(a.id,a.name)})});$("#formName_biaoTi").click(function(){c.configProcessTaskTitle()});$("#shi_li_biao_ti").click(function(){c.configProcessInstanceTitle()});this.initStartAuthTableDom(a,"table-auth-user","users");this.initStartAuthTableDom(a,"table-auth-dept","depts");this.initStartAuthTableDom(a,"table-auth-role","roles");this.initStartAuthTableDom(a,"table-auth-group","groups");this.initStartAuthTableDom(a,"table-auth-position","positions");this.createQXDom(a,"yi_jian_xiu_gai","globalIdea");this.createQXDom(a,"liu_cheng_tiao_zhuan","globalJump");this.createQXDom(a,"liu_cheng_zan_ting","globalSuspend");this.createQXDom(a,"liu_cheng_hui_fu","globalResume");this.createQXDom(a,"liu_cheng_jie_shu","globalEnd");this.createQXDom(a,"guan_zhu_gong_zuo","focus");this.createQXDom(a,"xiang_guan_liu_cheng","relationprocess");this.createQXDom(a,"guan_lian_fu_liucheng","relationparentprocess");$("#"+c.id).find("input[_type\x3d'bpm_but_attribute']").each(function(b,d){c.createQXDom(a,$(d).attr("name"),$(d).attr("name"))});this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-flow-event");this.alias=$.trim(a.getAttribute("name"));$("#"+this.id).find("#liu_cheng_ming_cheng").val($.trim(this.alias));$("#"+this.id).find("#liu_cheng_biao_shi").val(this.name);var d=$(a).children("description");0==d.length?this.setDomValByAttr("liu_cheng_miao_shu",a,"description"):$("#"+this.id).find("#liu_cheng_miao_shu").val(d.text());this.setDomValByAttr("shi_li_biao_ti",a,"title");this.setDomCheckByMeta("shi_li_biao_ti_geng_xin",a,"titleAutoUpdate");this.setDomValByMeta("dai_ban_biao_ti",a,"todo");this.setDomValByMeta("formName_biaoTi",a,"todo");this.setDomValByMeta("liu_cheng_shan_chu",a,"deleteEvent");this.setDomCheckByMeta("process_yi_dong_shen_pi",a,"processMobileApproval","yes");this.setDomCheckByMeta("wen_zi_gen_zong",a,"showTrackInForm","yes");this.createConditionDom("zhi_xing_fang_shi","table-executor",a);this.createFlowVariableDom("table-flow-variable",a);this.nodeEvent.setEventDom(a);var d=$.trim(a.getAttribute("globalformid")),e=$.trim(a.getAttribute("globalformname"));$("#"+this.id).find("#guan_lian_biao_dan").val(d);$("#"+this.id).find("#formName").val(e);this.setOpinionDOM("table-process-add-opinion",a);this.setDomValByMeta("kpi_process_reasonable_day",a,"kpiProcessReasonableDay");this.setDomValByMeta("kpi_process_reasonable_hour",a,"kpiProcessReasonableHour");this.setDomValByMeta("kpi_process_reasonable_minute",a,"kpiProcessReasonableMinute");this.setDomValByMeta("kpi_process_warning_day",a,"kpiProcessWarningDay");this.setDomValByMeta("kpi_process_warning_hour",a,"kpiProcessWarningHour");this.setDomValByMeta("kpi_process_warning_minute",a,"kpiProcessWarningMinute");this.setDomCheckByMeta("is_participate_KPI",a,"isParticipateKPI");this.setDomValByMeta("flow_owner_deptId",a,"flowOwnerDeptId");this.setDomValByMeta("flow_owner_deptName",a,"flowOwnerDeptName");this.setDomValByMeta("flow_owner_userId",a,"flowOwnerUserId");this.setDomValByMeta("flow_owner_userName",a,"flowOwnerUserName");this.setDomCheckByMeta("event_auto_perform",a,"event_auto_perform");this.observers.add(this)};MyProcess.prototype.configProcessInstanceTitle=function(){var a=this.designerEditor.myCellMap.get(this.designerEditor.processKey).id,b=$("#shi_li_biao_ti").val(),b=encodeURIComponent(b);layer.open({type:2,title:"\u914d\u7f6e\u3010\u5b9e\u4f8b\u6807\u9898\u3011",skin:"index-model",area:["400px","350px"],content:"bpm/business/expr?value\x3d"+b+"\x26processId\x3d"+a,btn:["\u786e\u8ba4","\u53d6\u6d88"],yes:function(a,b){var c=b.find("iframe")[0].contentWindow.getValue();$("#shi_li_biao_ti").val(c);layer.close(a)}})};MyProcess.prototype.configProcessTaskTitle=function(){var a=this.designerEditor.myCellMap.get(this.designerEditor.processKey).id,b=$("#dai_ban_biao_ti").val(),b=encodeURIComponent(b);layer.open({type:2,title:"\u914d\u7f6e\u3010\u5f85\u529e\u6807\u9898\u3011",skin:"index-model",area:["400px","350px"],content:"bpm/business/expr?value\x3d"+b+"\x26processId\x3d"+a,btn:["\u786e\u8ba4","\u53d6\u6d88"],yes:function(a,b){var c=b.find("iframe")[0].contentWindow.getValue();$("#formName_biaoTi").val(c);$("#dai_ban_biao_ti").val(c);layer.close(a)}})};MyProcess.prototype.getXmlDoc=function(){var a=flowUtils.createElement(this.tagName);this.putAttr("name",this.alias,a);this.putAttr("key",this.name,a);this.setOpinionXml("table-process-add-opinion",a);var b=$("#"+this.id).find("#liu_cheng_miao_shu").val(),c=flowUtils.createElement("description");c.appendChild(flowUtils.createTextNode(b));a.appendChild(c);this.setXmlAttrByVal("shi_li_biao_ti",a,"title");this.setXmlMetaByCheck("shi_li_biao_ti_geng_xin",a,"titleAutoUpdate");this.setXmlMetaByVal("dai_ban_biao_ti",a,"todo");this.setXmlMetaByVal("liu_cheng_shan_chu",a,"deleteEvent");this.setXmlMetaByCheck("process_yi_dong_shen_pi",a,"processMobileApproval");this.setXmlMetaByCheck("wen_zi_gen_zong",a,"showTrackInForm");this.setConditionXml("zhi_xing_fang_shi","table-executor",a);this.setFlowVariableXml("table-flow-variable",a);b=flowUtils.createElement("processAuth");this.getStartAuthTableXml(b,"table-auth-user","user");this.getStartAuthTableXml(b,"table-auth-dept","dept");this.getStartAuthTableXml(b,"table-auth-role","role");this.getStartAuthTableXml(b,"table-auth-group","group");this.getStartAuthTableXml(b,"table-auth-position","position");0<b.childNodes.length&&a.appendChild(b);var d=flowUtils.createElement("magics");this.createQXXml(d,"yi_jian_xiu_gai","globalIdea","\u610f\u89c1\u4fee\u6539",a);this.createQXXml(d,"liu_cheng_tiao_zhuan","globalJump","\u6d41\u7a0b\u8df3\u8f6c",a);this.createQXXml(d,"liu_cheng_zan_ting","globalSuspend","\u6d41\u7a0b\u6682\u505c",a);this.createQXXml(d,"liu_cheng_hui_fu","globalResume","\u6d41\u7a0b\u6062\u590d",a);this.createQXXml(d,"liu_cheng_jie_shu","globalEnd","\u6d41\u7a0b\u7ed3\u675f",a);this.createQXXml(d,"guan_zhu_gong_zuo","focus","\u5173\u6ce8\u5de5\u4f5c",a);this.createQXXml(d,"xiang_guan_liu_cheng","relationprocess","\u76f8\u5173\u6d41\u7a0b",a);this.createQXXml(d,"guan_lian_fu_liucheng","relationparentprocess","\u5173\u8054\u7236\u6d41\u7a0b",a);var e=this;$("#"+e.id).find("input[_type\x3d'bpm_but_attribute']").each(function(b,c){e.createQXXml(d,$(c).attr("name"),$(c).attr("name"),$(c).attr("_name"),a)});0<d.childNodes.length&&a.appendChild(d);this.nodeEvent.setEventXml(a,"start");this.putAttr("globalformid",$("#"+this.id).find("#guan_lian_biao_dan").val(),a);this.putAttr("globalformname",$("#"+this.id).find("#formName").val(),a);this.setXmlMetaByVal("kpi_process_reasonable_day",a,"kpiProcessReasonableDay");this.setXmlMetaByVal("kpi_process_reasonable_hour",a,"kpiProcessReasonableHour");this.setXmlMetaByVal("kpi_process_reasonable_minute",a,"kpiProcessReasonableMinute");this.setXmlMetaByVal("kpi_process_warning_day",a,"kpiProcessWarningDay");this.setXmlMetaByVal("kpi_process_warning_hour",a,"kpiProcessWarningHour");this.setXmlMetaByVal("kpi_process_warning_minute",a,"kpiProcessWarningMinute");this.setXmlMetaByCheck("is_participate_KPI",a,"isParticipateKPI");this.setXmlMetaByVal("flow_owner_deptId",a,"flowOwnerDeptId");this.setXmlMetaByVal("flow_owner_deptName",a,"flowOwnerDeptName");this.setXmlMetaByVal("flow_owner_userId",a,"flowOwnerUserId");this.setXmlMetaByVal("flow_owner_userName",a,"flowOwnerUserName");this.setXmlMetaByCheck("event_auto_perform",a,"event_auto_perform");$("#"+this.id).find("input[name\x3d'event_auto_perform']").is(":checked")&&(b=flowUtils.createElement("event-listener"),b.setAttribute("name","\u7ed3\u675f\u540e\u81ea\u52a8\u6fc0\u6d3b\u7236\u6d41\u7a0b"),b.setAttribute("class","avicit.platform6.bpm.bpmreform.event.AutoPerformProcess"),b.setAttribute("display","no"),c=$(a).children("on[event\x3d'end']"),0==c.length?(c=flowUtils.createElement("on"),c.setAttribute("event","end"),c.appendChild(b),a.appendChild(c)):c.append(b));return a};MyProcess.prototype.labelChanged=function(a){this.alias=a};MyProcess.prototype.setOpinionDOM=function(a,b){var c=this,d=$("#"+c.id+" table[name\x3d'"+a+"'] tbody");$(b).children("ideas").children("idea").each(function(){var a=$.trim(c.getXmlElement(this,"opinionName")),b=$.trim(c.getXmlElement(this,"opinionCode")),g=$.trim(c.getXmlElement(this,"opinionOrder")),h=$.trim(c.getXmlElement(this,"opinionNode")),k=$.trim(c.getXmlElement(this,"opinionNodeText")),l=$.trim(c.getXmlElement(this,"positionId")),m=$.trim(c.getXmlElement(this,"positionText")),p=$.trim(c.getXmlElement(this,"showPositionId")),n=$.trim(c.getXmlElement(this,"showPositionText")),q=$.trim(c.getXmlElement(this,"eSign")),t=$.trim(c.getXmlElement(this,"ideaStyle")),v=$.trim(c.getXmlElement(this,"opinionType")),w=$.trim(c.getXmlElement(this,"subprocessDefId")),u=$.trim(c.getXmlElement(this,"subopinionCode")),r=$.trim(c.getXmlElement(this,"subopinionName")),x=$.trim(c.getXmlElement(this,"showIdeaStyle"));d.append(c.getOpinionTableTr(c.id,a,b,g,l,m,n,p,q,t,x,h,k,v,w,u,r))})};MyProcess.prototype.setOpinionXml=function(a,b){var c=this,d=flowUtils.createElement("ideas");$("#"+c.id).find("table[name\x3d'"+a+"'] tbody tr").each(function(a){a=JSON.parse($(this).find("input").val());var b=flowUtils.createElement("idea");c.addXmlElement("opinionName",a.opinionName,b);c.addXmlElement("opinionCode",a.opinionCode,b);c.addXmlElement("opinionOrder",a.opinionOrder,b);c.addXmlElement("opinionNode",a.opinionNode,b);c.addXmlElement("opinionNodeText",a.opinionNodeText,b);c.addXmlElement("positionId",a.positionId,b);c.addXmlElement("positionText",a.positionText,b);c.addXmlElement("showPositionId",a.showPositionId,b);c.addXmlElement("showPositionText",a.showPositionText,b);c.addXmlElement("eSign",a.eSign,b);c.addXmlElement("ideaStyle",a.ideaStyle,b);c.addXmlElement("opinionType",a.opinionType,b);c.addXmlElement("subprocessDefId",a.subprocessDefId,b);c.addXmlElement("subopinionCode",a.subopinionCode,b);c.addXmlElement("subopinionName",a.subopinionName,b);c.addXmlElement("showIdeaStyle",a.showIdeaStyle,b);d.appendChild(b)});b.appendChild(d)};MyProcess.prototype.getInitOpinion=function(a,b){var c=$("#"+a+" table[name\x3d'table-process-add-opinion'] tbody tr").eq(b);return JSON.parse(c.find("input").val())};MyProcess.prototype.getInitOpinionCodes=function(a,b){var c=[];$("#"+a+" table[name\x3d'table-process-add-opinion'] tbody tr").each(function(a,e){if(a!=b){var d=JSON.parse($(e).find("input").val());c.push(d.opinionCode)}});return c};MyProcess.prototype.addOpinion=function(a,b){var c=$("#"+a+" table[name\x3d'table-process-add-opinion'] tbody"),d=$.trim(b.find("#opinionName").val()),e=$.trim(b.find("#opinionCode").val()),f=$.trim(b.find("#opinionOrder").val()),g=$.trim(b.find("#opinionNode").val()),h=$.trim(b.find("#opinionNodeText").val()),k=$.trim(b.find("#positionId").val().replaceAll(";",",")),l=$.trim(b.find("#positionText").val().replaceAll(";",",")),m=$.trim(b.find("#showPositionId").val().replaceAll(";",",")),p=$.trim(b.find("#showPositionText").val().replaceAll(";",",")),n=$.trim(b.find("#eSign").val()),q=$.trim(b.find("#ideaStyle").val()),t=$.trim(b.find("#opinionType").val()),v=$.trim(b.find("#subprocessDefId").val()),w=$.trim(b.find("#subopinionCode").val()),u=$.trim(b.find("#subopinionName").val()),r=$.trim(b.find("#ideaStyle option[value\x3d'"+q+"']").text());c.append(this.getOpinionTableTr(a,d,e,f,k,l,p,m,n,q,r,g,h,t,v,w,u))};MyProcess.prototype.getOpinionTableTr=function(a,b,c,d,e,f,g,h,k,l,m,p,n,q,t,v,w){var u=this,r=$("\x3ctr data-toggle\x3d'popover' data-container\x3d'body' title\x3d''\x3e\x3c/tr\x3e");r.attr("data-content",'\x3ctable width\x3d"180px" border\x3d"0" style\x3d"font-size:12px;table-layout:fixed;"  align\x3d"center"\x3e\x3ctr\x3e\x3ctd width\x3d"40%" height\x3d"25"\x3e\x3clable\x3e\u540d\u79f0:\x3c/lable\x3e\x3c/td\x3e\x3ctd\x3e'+b+'\x3c/td\x3e\x3c/tr\x3e\x3ctr \x3e\x3ctd width\x3d"40%" height\x3d"25"\x3e\u4ee3\u7801:\x3c/td\x3e\x3ctd\x3e'+c+'\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd width\x3d"40%" height\x3d"25" \x3e\u6392\u5e8f:\x3c/td\x3e\x3ctd\x3e'+d+"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e");r.popover({trigger:"hover",placement:"top",html:!0});var x=$("\x3ctd\x3e\x3c/td\x3e");x.append(b);var y=$("\x3cinput type\x3d'hidden'/\x3e");y.val(JSON.stringify({opinionName:b,opinionCode:c,opinionOrder:d,positionId:e,positionText:f,showPositionText:g,showPositionId:h,eSign:k,ideaStyle:l,opinionType:q,subprocessDefId:t,subopinionCode:v,subopinionName:w,showIdeaStyle:m,opinionNode:p,opinionNodeText:n}));x.append(y);b=$("\x3ctd\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'deleteOpinion'\x3e\x3ci class\x3d'iconfont icon-delete'\x3e\x3c/i\x3e\x3c/a\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'modifyOpinion' style\x3d'margin-left:5px'\x3e\x3ci class\x3d'iconfont icon-edit'\x3e\x3c/i\x3e\x3c/a\x3e \x3c/td\x3e");b.find("a[name\x3d'deleteOpinion']").off("click").on("click",function(){var a=$(this).parent().parent(),b=a.attr("aria-describedby");$("#"+b).remove();a.remove()});b.find("a[name\x3d'modifyOpinion']").off("click").on("click",function(){var b=$(this).parent().parent().index();layer.open({type:2,area:["80%","80%"],title:"\u610f\u89c1\u4fee\u6539",skin:"bs-modal",shade:.3,maxmin:!1,content:"avicit/platform6/bpmreform/bpmdesigner/editors/js/template/ProcessOpinion/processOpinionEdit.jsp?id\x3d"+a+"\x26idx\x3d"+b,btn:["\u786e\u5b9a","\u5173\u95ed"],yes:function(a,c){var d=c.find("iframe")[0].contentWindow,e=d.$("#form").validate();if(!e.checkForm())return e.showErrors(),!1;u.saveModifyOpinion(u.id,b,d.$("#form"));layer.close(a)}})});r.append(x).append(b);return r};MyProcess.prototype.saveModifyOpinion=function(a,b,c){var d=this,e=c.find("#opinionName").val(),f=c.find("#opinionCode").val(),g=c.find("#opinionOrder").val(),h=$.trim(c.find("#opinionNode").val()),k=$.trim(c.find("#opinionNodeText").val()),l=c.find("#positionId").val().replaceAll(";",","),m=c.find("#positionText").val().replaceAll(";",","),p=c.find("#showPositionId").val().replaceAll(";",","),n=c.find("#showPositionText").val().replaceAll(";",","),q=$.trim(c.find("#eSign").val()),t=$.trim(c.find("#ideaStyle").val()),v=$.trim(c.find("#opinionType").val()),w=$.trim(c.find("#subprocessDefId").val()),u=$.trim(c.find("#subopinionCode").val()),r=$.trim(c.find("#subopinionName").val()),x=$.trim(c.find("#ideaStyle option[value\x3d'"+t+"']").text());c=$("\x3ctr data-toggle\x3d'popover' data-container\x3d'body' title\x3d''\x3e\x3c/tr\x3e");c.attr("data-content",'\x3ctable width\x3d"180px" border\x3d"0" style\x3d"font-size:12px;table-layout:fixed;"  align\x3d"center"\x3e\x3ctr\x3e\x3ctd width\x3d"40%" height\x3d"25"\x3e\x3clable\x3e\u540d\u79f0:\x3c/lable\x3e\x3c/td\x3e\x3ctd\x3e'+e+'\x3c/td\x3e\x3c/tr\x3e\x3ctr \x3e\x3ctd width\x3d"40%" height\x3d"25"\x3e\u4ee3\u7801:\x3c/td\x3e\x3ctd\x3e'+f+'\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd width\x3d"40%" height\x3d"25" \x3e\u6392\u5e8f:\x3c/td\x3e\x3ctd\x3e'+g+"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e");c.popover({trigger:"hover",placement:"top",html:!0});var y=$("\x3ctd\x3e\x3c/td\x3e");y.append(e);var z=$("\x3cinput type\x3d'hidden'/\x3e");z.val(JSON.stringify({opinionName:e,opinionCode:f,opinionOrder:g,opinionNode:h,opinionNodeText:k,positionId:l,positionText:m,showPositionText:n,showPositionId:p,eSign:q,ideaStyle:t,opinionType:v,subprocessDefId:w,subopinionCode:u,subopinionName:r,showIdeaStyle:x}));y.append(z);e=$("\x3ctd\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'deleteOpinion'\x3e\x3ci class\x3d'iconfont icon-delete'\x3e\x3c/i\x3e\x3c/a\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'modifyOpinion' style\x3d'margin-left:5px'\x3e\x3ci class\x3d'iconfont icon-edit'\x3e\x3c/i\x3e\x3c/a\x3e \x3c/td\x3e");e.find("a[name\x3d'deleteOpinion']").off("click").on("click",function(){var a=$(this).parent().parent(),b=a.attr("aria-describedby");$("#"+b).remove();a.remove()});e.find("a[name\x3d'modifyOpinion']").off("click").on("click",function(){var b=$(this).parent().parent().index();layer.open({type:2,area:["80%","80%"],title:"\u610f\u89c1\u4fee\u6539",skin:"bs-modal",shade:.3,maxmin:!1,content:"avicit/platform6/bpmreform/bpmdesigner/editors/js/template/ProcessOpinion/processOpinionEdit.jsp?id\x3d"+a+"\x26idx\x3d"+b,btn:["\u786e\u5b9a","\u5173\u95ed"],yes:function(a,c){var e=c.find("iframe")[0].contentWindow,f=e.$("#form").validate();if(!f.checkForm())return f.showErrors(),!1;d.saveModifyOpinion(d.id,b,e.$("#form"));layer.close(a)}})});c.append(y).append(e);b=$("#"+a+" table[name\x3d'table-process-add-opinion'] tbody tr").eq(b);c.replaceAll(b)};MyProcess.prototype.createConditionDom=function(a,b,c){var d=this;$(c).children("conditions").each(function(){var c=$(this).attr("type");$("#"+d.id).find("#"+a).val(c);var f=$("#"+d.id).find("#"+b).find("tbody");$(this).children("condition").each(function(a){a=$(this).attr("type");var b=$(this).attr("computeRes"),c=$(this).text();null!=b&&""!=b?EventThatInsertStartConditionContentIntoTableWhenInit(f,a,$("\x3cinput value\x3d'"+b+"'longJson\x3d'"+c+"'/\x3e")):EventThatInsertStartConditionContentIntoTableWhenInit(f,a,$("\x3cinput value\x3d'"+c+"'/\x3e"))})})};MyProcess.prototype.modifyStartCondition=function(a){a=$(a);var b=a.parent().parent(),c="expr"==b.find("td:eq(1)").text().toLowerCase()?0:1,d=b.find("td:eq(2)");a.find("div[name\x3d'demoCont'] ul").find("li:eq("+c+")").click();a=a.parents("table[name\x3dtable-executor]").parent().parent();this.changeStartConditionTab(a.find("ul:eq(0)").find("li").eq(c));a.find("ul:eq(1)").find("li").eq(c).find(0==c?"textarea":"input").val(d.text().trim());a=a.find("ul:eq(1)").find("li").eq(c).find("button[name\x3d'btn-add-start-condition']");var e=a.clone(!0);a.off("click").text("\u4fdd\u5b58").on("click",function(){var a=0==c?$(this).parent().parent().parent().find("textarea"):$(this).parent().parent().parent().find("input");a&&0!=a.val().length?(d.text(a.val()),a.val(""),$(this).replaceWith(e)):alert("\u60a8\u8fd8\u6ca1\u8f93\u5165\u5185\u5bb9");return!1})};MyProcess.prototype.changeStartConditionTab=function(a){a=$(a);a.addClass("active").siblings("li").removeClass("active").parent(".global-attrs-tab").siblings(".tab-cont").find("\x3eli:eq("+a.index()+")").addClass("active").siblings("li").removeClass("active");a.find("input").prop("checked",!0)};MyProcess.prototype.getFlowVariables=function(a){var b=[];a=$("#"+this.id).find("table[name\x3d'table-flow-variable'] tbody tr");0<a.length&&a.each(function(a){a=$(this).find("td:eq(0) \x3e div \x3e input");try{var c=JSON.parse(a.val());b.push(c)}catch(e){}});return b};MyProcess.prototype.setFlowVariableXml=function(a,b){var c=$("#"+this.id).find("#"+a+" tbody tr");if(0<c.length){var d=flowUtils.createElement("variables");c.each(function(a){a=$(this).find("td:eq(0) \x3e div \x3e input");a=JSON.parse(a.val());var b=flowUtils.createElement("variable");b.setAttribute("alias",a.alias);b.setAttribute("name",a.name);b.setAttribute("required","N");b.setAttribute("init-expr",a.initExpr);b.setAttribute("type",a.type);b.setAttribute("desc",a.desc);d.appendChild(b)});b.appendChild(d)}};MyProcess.prototype.assembleBpmVariableJSONData=function(a,b,c,d,e){return JSON.stringify({alias:a,name:b,initExpr:c,type:d,desc:e})};MyProcess.prototype.createFlowVariableDom=function(a,b){var c=this;$(b).children("variables").children("variable").each(function(){var a=$("#"+c.id).find("table[name\x3d'table-flow-variable'] tbody"),b=$(this).attr("alias"),f=$(this).attr("name"),g=$(this).attr("init-expr"),h=$(this).attr("type"),k=$(this).attr("desc");c.insertFlowVariableContentIntoTable(a,b,f,g,h,k)});c.introVariableListener()};MyProcess.prototype.insertFlowVariableContentIntoTable=function(a,b,c,d,e,f){f="\x3cdiv class\x3d'hidden'\x3e"+("\x3cinput name\x3d'dataValue' value\x3d'"+this.assembleBpmVariableJSONData(b,c,d,e,f)+"'/\x3e")+"\x3c/div\x3e";c=c+"("+e+")"+(d?"\x3d"+d:"");a.append('\x3ctr title\x3d"'+c+'" \x3e\x3ctd style\x3d"display:none;"\x3e'+f+"\x3c/td\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3ctd\x3e"+c+'\x3c/td\x3e \x3ctd\x3e \x3ca href\x3d"javascript:void(0)" name\x3d"btn-flow-variable-delete"\x3e\x3ci class\x3d"iconfont icon-delete"\x3e\x3c/i\x3e\x3c/a\x3e\x3ca href\x3d"javascript:void(0)" name\x3d"btn-flow-variable-modify" style\x3d"margin-left:5px"\x3e\x3ci class\x3d"iconfont icon-edit"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/td\x3e\x3c/tr\x3e');this.reloadVaribaleButtonEvent()};MyProcess.prototype.reloadVaribaleButtonEvent=function(){var a=this;$("a[name\x3d'btn-flow-variable-delete']").off("click").on("click",function(b){a.lock.varModifyLock?layer.msg("\u8bf7\u5148\u4fdd\u5b58\u5f53\u524d\u64cd\u4f5c\u9879"):(a.userClickVariableDelete(this),a.introVariableListener())});$("a[name\x3d'btn-flow-variable-modify']").off("click").on("click",function(b){a.userClickVariableModify(this)})};MyProcess.prototype.userClickVariableModify=function(a){var b=this;if(b.lock.varModifyLock)return layer.msg("\u8bf7\u5148\u4fdd\u5b58\u5f53\u524d\u64cd\u4f5c\u9879"),!1;b.lock.varModifyLock=!0;b.toggleSiblingsButton($("button[name\x3d'btn-save-flow-variable']"));var c=$(a).parent().parent(),d=$(a).parent().parent().parent().parent().parent().parent();a=c.find("td\x3ediv\x3einput[name\x3ddataValue]").val();a=JSON.parse(a);d.find("input[name\x3d'avic-input-variable-name']").val(a.alias);d.find("input[name\x3d'avic-input-variable']").val(a.name);d.find("select[name\x3d'avic-input-variable-type']").val(a.type);d.find("input[name\x3d'avic-input-variable-value']").val(a.initExpr);d.find("textarea[name\x3d'avic-input-variable-desc']").val(a.desc);var e=c.find("td:eq(1)"),f=c.find("td:eq(2)");$("button[name\x3d'btn-save-flow-variable']").off("click").on("click",function(){var a=$(this);b.toggleSiblingsButton(a);var h=d.find("input[name\x3d'avic-input-variable-name']").val(),k=d.find("input[name\x3d'avic-input-variable']").val(),l=d.find("input[name\x3d'avic-input-variable-value']").val(),m=d.find("select[name\x3d'avic-input-variable-type']").val(),p=d.find("textarea[name\x3d'avic-input-variable-desc']").val();c.find("td\x3ediv\x3einput[name\x3ddataValue]").val(function(){return b.assembleBpmVariableJSONData(h,k,l,m,p)});var n=k+"("+m+")"+(l?"\x3d"+l:"");c.attr("title",n);e.text(h);f.text(n);a.parent().parent().prevAll().find("input,textarea").val("");b.lock.varModifyLock=!1;b.introVariableListener();return!1})};MyProcess.prototype.userClickVariableDelete=function(a){this.lock.varModifyLock?layer.msg("\u8bf7\u5148\u4fdd\u5b58\u5f53\u524d\u9879"):$(a).parent().parent().remove()};MyProcess.prototype.toggleSiblingsButton=function(a){a.each(function(){$(this).hasClass("hidden")?($(this).removeClass("hidden"),$(this).siblings().addClass("hidden")):($(this).addClass("hidden"),$(this).siblings().removeClass("hidden"))})};MyProcess.prototype.introVariableListener=function(){this.notify(this)};MyProcess.prototype.initStartAuthTableDom=function(a,b,c){var d=this;$(a).children("processAuth").children(c).children().each(function(){var a=d.getAttr(this,"id"),c=$.trim($(this).find("name").text()),g=$.trim($(this).find("type").text());d.addStartAuthTableContent(b,a,c,g)})};MyProcess.prototype.getStartAuthTableXml=function(a,b,c){var d=flowUtils.createElement(c+"s");$("#"+this.id+" table[name\x3d'"+b+"'] tbody input").each(function(){var a=JSON.parse($(this).val()),b=flowUtils.createElement(c);b.setAttribute("id",a.id);var g=flowUtils.createElement("name");g.appendChild(flowUtils.createTextNode(a.name));b.appendChild(g);g=flowUtils.createElement("type");g.appendChild(flowUtils.createTextNode(a.type));b.appendChild(g);d.appendChild(b)});a.appendChild(d)};MyProcess.prototype.addStartAuthTableContent=function(a,b,c,d){if(flowUtils.notNull(b)){var e=[],f=[],e=b.split(";"),f=c.split(";");if(0!=e.length&&e.length==f.length){var g=this,h=$("#"+this.id+" table[name\x3d'"+a+"'] tbody");$.each(e,function(a,b){0==$("#"+g.id+"_"+b).length&&h.append(g.getStartAuthTableTr(b,f[a],d))})}}};MyProcess.prototype.getStartAuthTableTr=function(a,b,c){var d=$("\x3ctr data-toggle\x3d'popover' data-container\x3d'body' title\x3d''\x3e\x3c/tr\x3e");d.attr("data-content",'\x3ctable width\x3d"180px" border\x3d"0" style\x3d"font-size:12px;"  align\x3d"center"\x3e\x3ctr\x3e\x3ctd width\x3d"40%" height\x3d"25"\x3e\x3clable\x3e\u540d\u79f0:\x3c/lable\x3e\x3c/td\x3e\x3ctd\x3e'+b+'\x3c/td\x3e\x3c/tr\x3e\x3ctr \x3e\x3ctd width\x3d"40%" height\x3d"25"\x3e\u7f16\u53f7:\x3c/td\x3e\x3ctd\x3e'+a+"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e");d.popover({trigger:"hover",placement:"top",html:!0});var e=$("\x3ctd\x3e\x3c/td\x3e");e.append(a);var f=$("\x3cinput type\x3d'hidden'/\x3e");f.val(JSON.stringify({id:a,name:b,type:c}));e.append(f);c=$("\x3ctd\x3e\x3c/td\x3e");c.append(b);b=$("\x3ctd\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'deleteStartAuth'\x3e\x3ci class\x3d'iconfont icon-delete'\x3e\x3c/i\x3e\x3c/a\x3e \x3c/td\x3e");b.find("a[name\x3d'deleteStartAuth']").off("click").on("click",function(){$(this).parent().parent().popover("destroy");$(this).parent().parent().siblings("div").remove();$(this).parent().parent().remove()});d.append(e).append(c).append(b);d.attr("id",this.id+"_"+a);return d};MyProcess.prototype.updateGlobalVariable=function(a,b){var c=$("#"+this.id+" select[name\x3d'yin_ru_bian_liang']");c.empty();c.append("\x3coption selected value\x3d'0'\x3e\u5f15\u5165\u53d8\u91cf\x3c/option\x3e");if(0<a.length)for(var d=0;d<a.length;d++)c.append("\x3coption\x3e#{"+a[d].name+"}\x3c/option\x3e")};MyProcess.prototype.initEvent=function(){var a=this;$("#"+a.id+" button[name\x3d'btn-process-add-opinion']").off("click").on("click",function(b){layer.open({type:2,area:["80%","80%"],title:"\u610f\u89c1\u65b0\u589e",skin:"bs-modal",shade:.3,maxmin:!1,content:"avicit/platform6/bpmreform/bpmdesigner/editors/js/template/ProcessOpinion/processOpinionAdd.jsp?id\x3d"+a.id,btn:["\u786e\u5b9a","\u5173\u95ed"],yes:function(b,d){var c=d.find("iframe")[0].contentWindow,f=c.$("#form").validate();if(!f.checkForm())return f.showErrors(),!1;a.addOpinion(a.id,c.$("#form"));layer.close(b)}});return!1});$("#"+a.id+" select[name\x3d'yin_ru_bian_liang']").off("click").on("change",function(){if(0!=this.value){var a=$(this),c=a.parent().parent().siblings("div").find("textarea"),a=0==c.val().length?a.val():c.val()+","+a.val();c.val(a)}});$("#"+a.id+" button[name\x3d'btn-add-flow-variable']").off("click").on("click",function(b){var c=$(this).parent().parent().parent();b=c.find("input[name\x3d'avic-input-variable-name']");var d=c.find("input[name\x3d'avic-input-variable']"),e=c.find("input[name\x3d'avic-input-variable-value']"),f=c.find("select[name\x3d'avic-input-variable-type']"),g=c.find("textarea[name\x3d'avic-input-variable-desc']");if(!b||0==b.val().length)return b.focus(),layer.msg("\u8fd8\u6ca1\u586b\u5199\u53d8\u91cf\u540d\u79f0"),!1;if(!d||0==d.val().length)return d.focus(),layer.msg("\u8fd8\u6ca1\u586b\u5199\u53d8\u91cf"),!1;c=c.find("table[name\x3d'table-flow-variable'] tbody");a.insertFlowVariableContentIntoTable(c,b.val(),d.val(),e.val(),f.val(),g.val());b.val("");d.val("");e.val("");g.val("");a.introVariableListener();return!1});$("#"+a.id+" div[class^\x3d'div-auth-checkbox'] input[type\x3d'checkbox']").off("click").on("click",function(){if(this.checked){var b=$(this).parentsUntil(".form-group").parent().siblings("div[class^\x3d'div-auth-box']");b.removeClass("hidden");var c=b.attr("class");if(b.find("input[name\x3d'operator-data-field']").get(0))b.find("button[name\x3d'button-auth-operator']").off("click").on("click",function(){var b={processId:a.designerEditor.myCellMap.get(a.designerEditor.processKey).id,type:"userSelect",userSelectContainer:c,dataField:"operator-data-field",textField:"operator-text-field",topId:a.id};new UserSelect(b)});if(b.find("input[name\x3d'candidate-data-field']").get(0))b.find("button[name\x3d'button-auth-candidate']").off("click").on("click",function(){var b={processId:a.designerEditor.myCellMap.get(a.designerEditor.processKey).id,type:"userSelect",userSelectContainer:c,dataField:"candidate-data-field",textField:"candidate-text-field",topId:a.id};new UserSelect(b)});if(b.find("input[name\x3d'preprocess-data-field']").get(0))b.find("button[name\x3d'button-auth-preprocess']").off("click").on("click",function(){layer.open({type:2,area:["400px","350px"],title:"\u51fd\u6570\u8f93\u5165\u6846",skin:"bs-modal",shade:.3,maxmin:!1,content:"avicit/platform6/bpmreform/bpmdesigner/editors/js/template/AuthProcessTpl/authProcessTpl.jsp?id\x3d"+a.id+"\x26name\x3dpreprocess-data-field\x26className\x3d"+c})});if(b.find("input[name\x3d'postprocess-data-field']").get(0))b.find("button[name\x3d'button-auth-postprocess']").off("click").on("click",function(){layer.open({type:2,area:["400px","350px"],title:"\u51fd\u6570\u8f93\u5165\u6846",skin:"bs-modal",shade:.3,maxmin:!1,content:"avicit/platform6/bpmreform/bpmdesigner/editors/js/template/AuthProcessTpl/authProcessTpl.jsp?id\x3d"+a.id+"\x26name\x3dpostprocess-data-field\x26className\x3d"+c})})}else $(this).parentsUntil(".form-group").parent().siblings("div[class^\x3d'div-auth-box']").addClass("hidden").find("input").val("")});$("#"+a.id+" button[name\x3d'btn-tab-add-auth']").off("click").on("click",function(b){b.preventDefault();var c=$(this).attr("data-role");"user"==c&&(b={type:"userSelect",idFiled:a.id+" #inputSelectUser",textFiled:a.id+" #inputSelectUserText",selectModel:"multi",callBack:function(b){a.addStartAuthTableContent("table-auth-"+c,b.userids,b.usernames,c)},viewScope:"currentOrg"},new H5CommonSelect(b));"dept"==c&&(b={type:"deptSelect",idFiled:a.id+" #inputSelectDept",textFiled:a.id+" #inputSelectDeptText",selectModel:"multi",callBack:function(b){a.addStartAuthTableContent("table-auth-"+c,b.deptids,b.deptnames,c)},viewScope:"currentOrg"},new H5CommonSelect(b));"role"==c&&(b={type:"roleSelect",idFiled:a.id+" #inputSelectRole",textFiled:a.id+" #inputSelectRoleText",selectModel:"multi",callBack:function(b){a.addStartAuthTableContent("table-auth-"+c,b.roleids,b.roleNames,c)},viewScope:"currentOrg"},new H5CommonSelect(b));"group"==c&&(b={type:"groupSelect",idFiled:a.id+" #inputSelectGroup",textFiled:a.id+" #inputSelectGroupText",selectModel:"multi",callBack:function(b){a.addStartAuthTableContent("table-auth-"+c,b.groupids,b.groupNames,c)},viewScope:"currentOrg"},new H5CommonSelect(b));"position"==c&&(b={type:"positionSelect",idFiled:a.id+" #inputSelectPosition",textFiled:a.id+" #inputSelectPositionText",selectModel:"multi",callBack:function(b){a.addStartAuthTableContent("table-auth-"+c,b.positionids,b.positionNames,c)},viewScope:"currentOrg"},new H5CommonSelect(b))});$("#"+a.id+" button[name\x3d'btn-expr-config']").off("click").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),b=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val());new ExprConfig({id:a.id,domId:a.id+" #expr-config-value-new",globalformid:b,processFlag:!0,callback:function(a){}})});$("#"+a.id+" #flow_owner_deptName").off("click").on("click",function(){new H5CommonSelect({type:"deptSelect",idFiled:a.id+" #flow_owner_deptId",textFiled:a.id+" #flow_owner_deptName",selectModel:"single",callBack:function(b){$("#"+a.id+" #flow_owner_userId").val("");$("#"+a.id+" #flow_owner_userName").val("")},viewScope:"currentOrg"})});$("#"+a.id+" #flow_owner_userName").off("click").on("click",function(){new H5CommonSelect({type:"userSelect",idFiled:a.id+" #flow_owner_userId",textFiled:a.id+" #flow_owner_userName",deptidFiled:a.id+" #flow_owner_deptId",deptNameFiled:a.id+" #flow_owner_deptName",selectModel:"single",viewScope:"currentOrg"})})};MyProcess.prototype.addObserver=function(a){this.observers.add(a)};MyProcess.prototype.notify=function(a){for(var b=this.observers.count(),c=this.getFlowVariables(),d=0;d<b;d++)this.observers.get(d).updateGlobalVariable(c,a)};function ObserverList(){this.observerList=[]}ObserverList.prototype.add=function(a){this.observerList.push(a)};ObserverList.prototype.removeAt=function(a){this.observerList.splice(a,1)};ObserverList.prototype.remove=function(a){a=this.indexOf(a,0);this.observerList.splice(a,1)};ObserverList.prototype.indexOf=function(a,b){for(var c=b;c<this.observerList.length;){if(this.observerList[c]===a)return c;c++}return-1};ObserverList.prototype.count=function(){return this.observerList.length};ObserverList.prototype.get=function(a){if(-1<a&&a<this.observerList.length)return this.observerList[a]};function MySql(a,b){MyBase.call(this,a,b,"sql");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_sql.png;"}MySql.prototype=new MyBase;MySql.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getSql();this.labelChanged(this.name);this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-sql-node");this.initEvent()};MySql.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setSql(this.resolve());this.initJBXX();this.initEvent();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-sql-node");this.nodeEvent.setEventDom(a);var c=this;$(a).children("dataSource").each(function(){$("#"+c.id).find("#shujuyuan").val($.trim($(this).text()))});$("#"+this.id+" input[name\x3d'inputValueBackVar']").val(this.getAttr(a,"var"));$("#"+this.id+" input[name\x3d'inputTextBackVar']").val(this.getAttr(a,"var"));"true"==this.getAttr(a,"unique")&&$("#"+this.id+" input[name\x3d'fanhuiweiyizhi']").trigger("click");$("#"+this.id+" #chaxuntiaojian").val($.trim($(a).children("query").text()));this.sqlQueryParameter.getDom(a)};MySql.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"");var b=$("#"+this.id+" #shujuyuan").val();if(flowUtils.notNull(b)){var c=flowUtils.createElement("dataSource");c.appendChild(flowUtils.createTextNode(b));a.appendChild(c)}this.addMeta("error","break",a);this.putAttr("var",$("#"+this.id+" input[name\x3d'inputValueBackVar']").val(),a);this.putAttr("unique",$("#"+this.id+" input[name\x3d'fanhuiweiyizhi']").is(":checked"),a);b=$("#"+this.id+" #chaxuntiaojian").val();flowUtils.notNull(b)&&(c=flowUtils.createElement("query"),c.appendChild(flowUtils.createTextNode(b)),a.appendChild(c));this.sqlQueryParameter.getXml(a)};MySql.prototype.initEvent=function(){var a=this;$("#"+a.id+" button[name\x3d'button-BackVar']").on("click",function(){var b=null,c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"process"==c.tagName&&(b=c)});new ProcessVariable({dataDomId:a.id+" #inputValueBackVar",showDomId:a.id+" #inputTextBackVar",callback:function(b){b=b[0].name;$("#"+a.id+" #inputValueBackVar").val(b);$("#"+a.id+" #inputTextBackVar").val(b)},process:b,multiple:!1})});a.sqlQueryParameter=new SQLQueryParameter({id:a.id,buttonId:"buttonAddSQLQueryParameter",tableId:a.id+" #table-flow-add-SQLQueryParameter",type:"parameters",callback:function(a){}})};function MyStart(a,b){MyBase.call(this,a,b,"start");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/start_event_empty.png;"}MyStart.prototype=new MyBase;MyStart.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getStart();this.labelChanged("\u5f00\u59cb");this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-start-node")};MyStart.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setStart(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.setDomValByMeta("start-node-desc",a,"remark");this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-start-node");this.nodeEvent.setEventDom(a)};MyStart.prototype.getOtherAttr=function(a){this.setXmlMetaByVal("start-node-desc",a,"remark");this.nodeEvent.setEventXml(a,"")};function MyState(a,b){MyBase.call(this,a,b,"state");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_wait.png;"}MyState.prototype=new MyBase;MyState.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getState();this.labelChanged(this.name);this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-state-node")};MyState.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setState(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-state-node");this.nodeEvent.setEventDom(a)};MyState.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"")};function MySubprocess(a,b){MyBase.call(this,a,b,"sub-process");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_subprocess.png;"}MySubprocess.prototype=new MyBase;MySubprocess.prototype.init=function(){this.initBase();this.name="Subprocess"+this.designerEditor.countUtils.getSubprocess();this.labelChanged(this.name);this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-subprocess-node");this.initEvent()};MySubprocess.prototype.initTracks=function(a,b){this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.deploymentId=this.getAttr(a,"sub-process-id");b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this)};MySubprocess.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setSubprocess(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-subprocess-node");this.nodeEvent.setEventDom(a);this.initEvent();$("#"+this.id+" #inputValueSubFlowId").val(this.getAttr(a,"sub-process-id"));$("#"+this.id+" #inputValueSubFlowName").val(this.getAttr(a,"sub-process-key"));$("#"+this.id+" #inputTextSubFlowName").val(this.getAttr(a,"sub-process-name"));var c=this.getMeta(a,"asynchronous");$("#"+this.id).find("input[name\x3d'shifoutongbu'][value\x3d'"+c+"']").prop("checked","checked");"yes"==this.getMeta(a,"isMustUser")&&($("#"+this.id+" #ziliuchengxuanren").trigger("click"),c=this.getMeta(a,"userSelectType"),$("#"+this.id).find("#yunxuzidongxuanren").prop("checked","auto"==c?!0:!1),this.setUserSelectDom({dataField:"candidate-data-field",textField:"candidate-text-field"},a));this.setDomCheckByMeta("putongliucheng",a,"putongliucheng","no");$("#"+this.id+" input[name\x3d'inputValueOutCome']").val(this.getAttr(a,"outcome"));$("#"+this.id+" input[name\x3d'inputTextOutCome']").val(this.getAttr(a,"outcome"));this.parameterIn.getDom(a);this.parameterOut.getOutDom(a);this.getFormInDom(a);this.getFormOutDom(a)};MySubprocess.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"");this.putAttr("sub-process-id",$("#"+this.id+" #inputValueSubFlowId").val(),a);this.putAttr("sub-process-key",$("#"+this.id+" #inputValueSubFlowName").val(),a);this.putAttr("sub-process-name",$("#"+this.id+" #inputTextSubFlowName").val(),a);this.addMeta("asynchronous",$("#"+this.id+" input[name\x3d'shifoutongbu']:checked").val(),a);$("#"+this.id+" input[name\x3d'ziliuchengxuanren']").is(":checked")?(this.addMeta("isMustUser","yes",a),this.addMeta("userSelectType",$("#"+this.id+" input[name\x3d'yunxuzidongxuanren']").is(":checked")?"auto":"manual",a),this.setUserSelectXml({dataField:"candidate-data-field"},a)):this.addMeta("isMustUser","no",a);this.setXmlMetaByCheck("putongliucheng",a,"putongliucheng");this.putAttr("outcome",$("#"+this.id+" input[name\x3d'inputValueOutCome']").val(),a);this.parameterIn.getXml(a);this.parameterOut.getOutXml(a);this.getFormInXml(a);this.getFormOutXml(a)};MySubprocess.prototype.resolve=function(){return Number(this.name.replace("Subprocess",""))};MySubprocess.prototype.initEvent=function(){var a=this;$("#"+a.id+" button[name\x3d'button-sub-flowname']").on("click",function(){new SubProcess({dataDomId:a.id+" #inputValueSubFlowName",showDomId:a.id+" #inputTextSubFlowName",callback:function(a){},multiple:!1,dataDomId2:a.id+" #inputValueSubFlowId"})});$("#"+a.id+" #ziliuchengxuanren").on("click",function(){this.checked?$("#"+a.id+" div[name\x3d'zidongxuanren-area']").hasClass("hidden")&&$("#"+a.id+" div[name\x3d'zidongxuanren-area']").removeClass("hidden"):$("#"+a.id+" div[name\x3d'zidongxuanren-area']").hasClass("hidden")||$("#"+a.id+" div[name\x3d'zidongxuanren-area']").addClass("hidden")});a.designerEditor.myCellMap.get(a.designerEditor.processKey);$("#"+a.id+" button[name\x3d'button-auth-candidate']").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey);new UserSelect({processId:b.id,type:"userSelect",dataField:"candidate-data-field",textField:"candidate-text-field",topId:a.id,processId:b.id})});$("#"+a.id+" button[name\x3d'button-OutCome']").on("click",function(){var b=null,c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"process"==c.tagName&&(b=c)});new ProcessVariable({dataDomId:a.id+" #inputValueOutCome",showDomId:a.id+" #inputTextOutCome",callback:function(b){b="#{"+b[0].name+"}";$("#"+a.id+" #inputValueOutCome").val(b);$("#"+a.id+" #inputTextOutCome").val(b)},process:b,multiple:!1})});a.parameterIn=new ParameterInAndOut({id:a.id,buttonId:"buttonAddParameterIn",tableId:a.id+" #table-flow-ParameterIn",type:"parameter-in",callback:function(a){}});a.parameterOut=new ParameterInAndOut({id:a.id,buttonId:"buttonAddParameterOut",tableId:a.id+" #table-flow-ParameterOut",type:"parameter-out",callback:function(a){}});$("#"+a.id+" button[name\x3d'formFieldParameterConfig']").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),c=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val()),d=$("#"+a.id+" #inputValueSubFlowName").val(),e=$("#"+a.id+" #inputValueSubFlowId").val();if(!flowUtils.notNull(e)&&!flowUtils.notNull(d))return layer.msg("\u60a8\u8fd8\u6ca1\u9009\u62e9\u5b50\u6d41\u7a0b"),!1;new FormFieldParameter({id:a.id,dataDomId1:a.id+" #fieldArgsMainProcessToSub",dataDomId2:a.id+" #fieldArgsSubProcessToMain",callback:function(a){},process:b,mainProcessFormId:c,subProcessKey:d})})};MySubprocess.prototype.getFormInXml=function(a){var b=$("#"+this.id+" #fieldArgsMainProcessToSub").val();if(flowUtils.notNull(b)&&(b=JSON.parse(b),b.length))for(i=0;i<b.length;i++){var c=b[i],d=flowUtils.createElement("form-in");d.setAttribute("formTable",c.formTable);d.setAttribute("formCol",c.formCol);d.setAttribute("subFormTable",c.subFormTable);d.setAttribute("subFormCol",c.subFormCol);d.setAttribute("colType",c.colType);d.setAttribute("tableModify",c.tableModify);d.setAttribute("colComments",c.colComments);d.setAttribute("isOrgIdentity",c.isOrgIdentity);d.setAttribute("fromComments",c.fromComments);d.setAttribute("isSubTable","1"==c.isSubTable?"1":"");d.setAttribute("fromFkColName",c.fromFkColName);d.setAttribute("toFkColName",c.toFkColName);a.appendChild(d)}};MySubprocess.prototype.getFormOutXml=function(a){var b=$("#"+this.id+" #fieldArgsSubProcessToMain").val();if(flowUtils.notNull(b)&&(b=JSON.parse(b),b.length))for(i=0;i<b.length;i++){var c=b[i],d=flowUtils.createElement("form-out");d.setAttribute("formTable",c.formTable);d.setAttribute("formCol",c.formCol);d.setAttribute("subFormTable",c.subFormTable);d.setAttribute("subFormCol",c.subFormCol);d.setAttribute("colType",c.colType);d.setAttribute("tableModify",c.tableModify);d.setAttribute("colComments",c.colComments);d.setAttribute("isOrgIdentity",c.isOrgIdentity);d.setAttribute("fromComments",c.fromComments);a.appendChild(d)}};MySubprocess.prototype.getFormInDom=function(a){var b=[];$(a).children("form-in").each(function(){var a={};a.formTable=$.trim(this.getAttribute("formTable"));a.formCol=$.trim(this.getAttribute("formCol"));a.subFormTable=$.trim(this.getAttribute("subFormTable"));a.subFormCol=$.trim(this.getAttribute("subFormCol"));a.colType=$.trim(this.getAttribute("colType"));a.tableModify=$.trim(this.getAttribute("tableModify"));a.colComments=$.trim(this.getAttribute("colComments"));a.isOrgIdentity=$.trim(this.getAttribute("isOrgIdentity"));a.fromComments=$.trim(this.getAttribute("fromComments"));a.isSubTable=$.trim(this.getAttribute("isSubTable"));a.fromFkColName=$.trim(this.getAttribute("fromFkColName"));a.toFkColName=$.trim(this.getAttribute("toFkColName"));b.push(a)});a=JSON.stringify(b);$("#"+this.id+" #fieldArgsMainProcessToSub").val(a)};MySubprocess.prototype.getFormOutDom=function(a){var b=[];$(a).children("form-out").each(function(){var a={};a.formTable=$.trim(this.getAttribute("formTable"));a.formCol=$.trim(this.getAttribute("formCol"));a.subFormTable=$.trim(this.getAttribute("subFormTable"));a.subFormCol=$.trim(this.getAttribute("subFormCol"));a.colType=$.trim(this.getAttribute("colType"));a.tableModify=$.trim(this.getAttribute("tableModify"));a.colComments=$.trim(this.getAttribute("colComments"));a.isOrgIdentity=$.trim(this.getAttribute("isOrgIdentity"));a.fromComments=$.trim(this.getAttribute("fromComments"));b.push(a)});a=JSON.stringify(b);$("#"+this.id+" #fieldArgsSubProcessToMain").val(a)};MySubprocess.prototype.doubleClickCell=function(){var a=$("#"+this.id+" #inputValueSubFlowId").val(),b=$("#"+this.id+" #inputTextSubFlowName").val();flowUtils.notNull(a)&&layer.open({type:2,title:b,area:["800px","500px"],content:"platform/bpm/bpmPublishAction/getProcessImageTrack.gif?processInstanceId\x3d"+a})};function MySwimlane(a,b){MyBase.call(this,a,b,"swimlane");this.swimlaneType=""}MySwimlane.prototype=new MyBase;MySwimlane.prototype.init=function(){this.designerEditor.isSwimlane1(this.getCell())?(this.swimlaneType="swimlane1",this.designerEditor.swimlane1++):(this.swimlaneType="swimlane2",this.designerEditor.swimlane2++);this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getSwimlane();this.labelChanged(this.name);this.initJBXX()};MySwimlane.prototype.initLoad=function(a,b){this.designerEditor.isSwimlane1(a)?(this.swimlaneType="swimlane1",this.designerEditor.swimlane1++):(this.swimlaneType="swimlane2",this.designerEditor.swimlane2++);this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setSwimlane(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this)};MySwimlane.prototype.getOtherAttr=function(a){a.setAttribute("cellType",this.swimlaneType)};MySwimlane.prototype.remove=function(){"swimlane1"==this.swimlaneType?this.designerEditor.swimlane1--:(this.swimlaneType="swimlane2",this.designerEditor.swimlane2--);$("#"+this.id).remove()};function MyTask(a,b){MyBase.call(this,a,b,"task");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_human.png;"}MyTask.prototype=new MyBase;MyTask.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getTask();this.labelChanged(this.name);this.initJBXX();this.initEvent();this.bpmDocUploader=new BpmDocUploader({id:this.id,defineId:this.defineId,activityName:this.name,uploaderId:"bpm-designer-upload"});this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-human-task-event");var a=this;this.selectPublishBpmEform1=new SelectPublishEform("task_guan_lian_biao_dan","task_formName",this.id,"Y","");this.selectPublishBpmEform1.init(function(b){$("#"+a.id).find("#task_guan_lian_biao_dan").attr("data-type","task");$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formSave']").trigger("click")});var b=this.designerEditor.myCellMap.get(this.designerEditor.processKey),c=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val()),b=$.trim($("#"+b.id).find("#formName").val());flowUtils.notNull(c)&&this.syncTaskForm(c,b);$("#"+a.id).find('input[name\x3d"input_liu_cheng_na_hui"]').trigger("click")};MyTask.prototype.setUserSelectDomText="";MyTask.prototype.initTracks=function(a,b){this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");b.appendChild(this.createMxCell(a));var c=this.getAttr(a,"candidate-users");0<c.length&&(c=this.getUserSelectObjFromXml(c,a),this.setUserSelectDomText=this.getUserSelectTextFieldValue(c));this.designerEditor.myLoadMap.put(this.name,this)};MyTask.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setTask(this.resolve());this.initJBXX();this.initEvent();this.bpmDocUploader=new BpmDocUploader({id:this.id,defineId:this.defineId,activityName:this.name,uploaderId:"bpm-designer-upload"});var c=this;this.selectPublishBpmEform1=new SelectPublishEform("task_guan_lian_biao_dan","task_formName",c.id,"Y","");this.selectPublishBpmEform1.init(function(a){$("#"+c.id).find("#task_guan_lian_biao_dan").attr("data-type","task")});this.SelectNonEform=new SelectPublishEform("task_wai_bu_url_form","task_wai_bu_url",c.id,"Y","");this.SelectNonEform.init(function(a){});b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.setDomValByMeta("dai_ban_biao_ti",a,"todo");this.setDomValByMeta("formName_biaoTi",a,"todo");this.setDomCheckByMeta("task_yi_dong_shen_pi",a,"taskMobileApproval","no");this.setDomCheckByMeta("duan_xin_tong_zhi",a,"phoneInfo","no");this.setDomCheckByMeta("gong_zuo_yi_jiao",a,"isWorkHandUser","yes");this.setDomCheckByMeta("mi_ji_kong_zhi",a,"isSecret","no");$("#"+this.id).find("#mi_ji_kong_zhi").is(":checked")&&($("#"+this.id).find("div[name\x3d'mi_ji_bian_liang_show']").removeClass("hidden"),this.setDomValByMeta("mi_ji_bian_liang",a,"secretVar"));this.setDomCheckByMeta("input_isSendReaderTodo",a,"isSendReaderTodo","no");this.createRemarkDom(a);"no"==this.getMeta(a,"down_yes")&&$("#"+this.id).find("#down_yes").prop("checked",!1);this.setDomCheckByMeta("down_yes_secret",a,"down_yes_secret","no");$("#"+this.id).find(".down_yes_class input").each(function(b,d){c.setDomCheckByMeta($(d).attr("id"),a,$(d).attr("id"),"yes")});$("#"+this.id).find("#down_yes_secret").is(":checked")&&($("#"+this.id).find(".down_yes_class").show(),$("#"+this.id).find("input[class^\x3ddown_yes_secret_class_]").each(function(a,b){var c=$(this).attr("secretLevel");this.checked?$(this).parents("form").find(".down_yes_userSecret_class_"+c).show():($("input[id^\x3ddown_yes_secret_"+c+"_]").removeAttr("checked"),$(this).parents("form").find(".down_yes_userSecret_class_"+c).hide())}));var d=this.getMeta(a,"ideaType");$("#"+this.id).find("#task_bi_xu_tian_xie_yi_jian").prop("checked",void 0==d?!1:"must"==d?!0:!1);this.setDomValByMeta("zi_ding_yi_yi_jian_kuang",a,"ideaElementIdBySelf");this.setDomCheckByMeta("task_yun_xu_qiang_zhi_biao_tai",a,"ideaCompelManner","no");this.setDomCheckByMeta("tast_tui_hui_yi_jian",a,"isNeedIdea","yes");this.setDomCheckByMeta("wen_zi_gen_zong",a,"showTrackInForm","yes");d=this.getMeta(a,"ideaDisplayStyle");$("#"+this.id).find("input[name\x3d'task-yi-jian-xian-shi'][value\x3d'"+d+"']").prop("checked","checked");this.setUserSelectDom({userSelectContainer:"draft-candidate-container",dataField:"draft-candidate-data-field",textField:"draft-candidate-text-field"},a);this.setDomValByMeta("zu_zhi_jie_kou",a,"deptImpl");this.setDomCheckByMeta("candidate-auto-polling",a,"isAutoGetUser","yes");this.setDomCheckByMeta("orgTreeOpenToDept",a,"orgTreeOpenToDept","no");this.setDomCheckByMeta("orgTreeDefaultOpen",a,"orgTreeDefaultOpen","no");this.setDomCheckByMeta("deptTreeHideOrg",a,"deptTreeHideOrg","no");this.setDomCheckByMeta("show-selection-box",a,"isSelectUser","no");this.setDomCheckByMeta("candidate-necessary",a,"isMustUser","no");$("#"+this.id).find("#person-automatic-selection").prop("checked","auto"==this.getMeta(a,"userSelectType")?!0:!1);d=this.getAttr(a,"dealtype");$("#"+this.id).find("select[name\x3d'select-human-task-process-mode']").val(d);$("#"+this.id).find("select[name\x3d'select-human-task-process-mode']").trigger("change");"4"==d&&($(a).children("meta[name\x3d'number']").each(function(){$("#"+c.id).find("input[type\x3dradio][name\x3dinput-radio-human-task-select-task]").eq(1).trigger("click");$("#"+c.id).find("input[name\x3dinput-num]").eq(1).val($.trim($(this).text()))}),$(a).children("meta[name\x3d'percent']").each(function(){$("#"+c.id).find("input[type\x3dradio][name\x3dinput-radio-human-task-select-task]").eq(2).trigger("click");$("#"+c.id).find("input[name\x3dinput-num]").eq(2).val($.trim($(this).text()))}),$(a).children("meta[name\x3d'role_number']").each(function(){$("#"+c.id).find("input[type\x3dradio][name\x3dinput-radio-human-task-select-task]").eq(3).trigger("click");$("#"+c.id).find("input[name\x3dinput-num]").eq(3).val($.trim($(this).text()))}),$(a).children("meta[name\x3d'position_number']").each(function(){$("#"+c.id).find("input[type\x3dradio][name\x3dinput-radio-human-task-select-task]").eq(4).trigger("click");$("#"+c.id).find("input[name\x3dinput-num]").eq(4).val($.trim($(this).text()))}),$(a).children("meta[name\x3d'group_number']").each(function(){$("#"+c.id).find("input[type\x3dradio][name\x3dinput-radio-human-task-select-task]").eq(5).trigger("click");$("#"+c.id).find("input[name\x3dinput-num]").eq(5).val($.trim($(this).text()))}),$(a).children("meta[name\x3d'dept_one']").each(function(){$("#"+c.id).find("input[type\x3dradio][name\x3dinput-radio-human-task-select-task]").eq(6).trigger("click")}),$(a).children("meta[name\x3d'dealtype_4_roleId']").each(function(){$("#"+c.id).find("#dealtype_4_roleId").val($.trim($(this).text()))}),$(a).children("meta[name\x3d'dealtype_4_roleName']").each(function(){$("#"+c.id).find("#dealtype_4_roleName").val($.trim($(this).text()))}),$(a).children("meta[name\x3d'dealtype_4_positionId']").each(function(){$("#"+c.id).find("#dealtype_4_positionId").val($.trim($(this).text()))}),$(a).children("meta[name\x3d'dealtype_4_positionName']").each(function(){$("#"+c.id).find("#dealtype_4_positionName").val($.trim($(this).text()))}),$(a).children("meta[name\x3d'dealtype_4_groupId']").each(function(){$("#"+c.id).find("#dealtype_4_groupId").val($.trim($(this).text()))}),$(a).children("meta[name\x3d'dealtype_4_groupName']").each(function(){$("#"+c.id).find("#dealtype_4_groupName").val($.trim($(this).text()))}));var d=$.trim(a.getAttribute("taskFormId")),e=$.trim(a.getAttribute("taskFormName")),f=$.trim(a.getAttribute("urlParam"));flowUtils.notNull(f)&&$("#"+this.id).find("#urlParam").val(f);flowUtils.notNull(d)?($("#"+this.id).find("#task_guan_lian_biao_dan").val(d),$("#"+this.id).find("#task_guan_lian_biao_dan").attr("data-type","task"),$("#"+this.id).find("#task_formName").val(e)):(e=this.designerEditor.myCellMap.get(this.designerEditor.processKey),d=$.trim($("#"+e.id).find("#guan_lian_biao_dan").val()),e=$.trim($("#"+e.id).find("#formName").val()),this.syncTaskForm(d,e));$(a).children("docRights").children("docRight[type\x3d'formSave']").each(function(){$("#"+c.id).find("input[name\x3d'formSave']").prop("checked",!0);$("#"+c.id).find(".basic-form-save-area").removeClass("hidden");$("#"+c.id).find("#task_guan_lian_biao_dan").attr("data-type","task");0<$(a).children("attrsAuth").length?$(a).children("attrsAuth").children().each(function(){var a="yes"==$.trim($(this).text())?!0:!1;$("#"+c.id).find("table[name\x3d'table-attr-auth'] tbody").append(c.syncFormAttrTr(this.nodeName,c.getAttr(this,"attrName"),a,!0,c.getAttr(this,"elementType"),!1))}):$(a).children("fieldsAuth").children().each(function(){var a=c.getAttr(this,"id"),b=c.getAttr(this,"name"),d="yes"==c.getAttr(this,"isModified")?!0:!1,e="yes"==c.getAttr(this,"accessibility")?!0:!1,f="yes"==c.getAttr(this,"required")?!0:!1,g=c.getAttr(this,"type");"eform_subtable_bpm_button_auth"==g?$("#"+c.id).find("table[name\x3d'table-attr-auth'] tbody").append(c.syncSubFormButtonAttrTr(a,b,d,e,g,f)):$("#"+c.id).find("table[name\x3d'table-attr-auth'] tbody").append(c.syncFormAttrTr(a,b,d,e,g,f))});$(a).children("attachmentAuth").children().each(function(){var a=c.getAttr(this,"id"),b=c.getAttr(this,"name"),d="yes"==c.getAttr(this,"isModified")?!0:!1,e="yes"==c.getAttr(this,"required")?!0:!1,f=c.getAttr(this,"type"),g="yes"==c.getAttr(this,"modifySecretLevel")?!0:!1;$("#"+c.id).find("table[name\x3d'table-attachment-auth'] tbody").append(c.syncFormAttachmentAttrTr(a,b,d,f,e,g))});$(a).children("fieldsRelationAuth").each(function(){var a=$(this).text();flowUtils.notNull(a)&&c.getFieldRelationAuthFromXml(a)})});$(a).children("docRights").children("docRight").each(function(){var b=$(this).attr("type");"formSave"!=b&&"attachCreate"!=b&&($("#"+c.id).find("input[name\x3d'"+b+"']").trigger("click"),$(this).children("subDocRight").each(function(){var d=$(this).attr("type"),e=$(this).attr("value");if("wordRead"==b||"wordEdit"==b)$("#"+c.id).find("input[type\x3d'checkbox'][name\x3d'"+d+"']").prop("checked",!0);else if("wordRedTemplet"==b||"wordCreate"==b){var f=$(this).attr("name"),d=$(this).attr("value"),e=$("#"+c.id).find("input[name\x3d'"+("wordCreate"==b?"taskFormValueWordCreate":"taskFormValueWordRedTemplet")+"']"),g=$("#"+c.id).find("input[name\x3d'"+("wordCreate"==b?"taskFormTextWordCreate":"taskFormTextWordRedTemplet")+"']");e.val(d);g.val(f);g.attr("title",f)}else"wordPrint"==b?flowUtils.notNull(e)&&(f=$("#"+c.id).find("input[name\x3d'taskFormValue"+d+"']"),d=$("#"+c.id).find("input[name\x3d'taskFormText"+d+"']"),f.attr("actorsId",e),e=c.getUserSelectObjFromXml(e,a),f.val(JSON.stringify(e)),f=c.getUserSelectTextFieldValue(e),d.val(f),d.attr("title",f)):"wordValue"==b&&(f=$(this).attr("name"),d=$(this).attr("value"))&&(e=$("#"+c.id).find("input[name\x3d'taskFormValueWordValue']"),g=$("#"+c.id).find("input[name\x3d'taskFormTextWordValue']"),e.val(d),g.val(f),g.attr("title",f))}))});this.createQXDom(a,"input_tui_hui_ni_gao_ren","reTreatToDraft");this.createQXDom(a,"input_tui_hui_shang_yi_bu","reTreatToPrev");this.createQXDom(a,"input_ren_yi_tui_hui","reTreatToWant");this.createQXDom(a,"input_kua_jie_dian_tui_hui","reTreatToActivity");this.createQXDom(a,"input_liu_cheng_na_hui","withdraw");this.createQXDom(a,"input_liu_cheng_bu_fa","supplement");this.createQXDom(a,"input_fa_song_yue_zhi","transmit");this.createQXDom(a,"input_chao_song","carbonCopy");this.createQXDom(a,"input_liu_cheng_wei_tuo","supersede");this.setDomCheckByMeta("input_liu_cheng_wei_tuo_multi",a,"supersede_multi","yes");this.createQXDom(a,"input_liu_cheng_jia_qian","addUser");this.createQXDom(a,"input_liu_cheng_jian_qian","withdrawAssignee");this.createQXDom(a,"input_pei_zhi_xuan_ren","stepUserDefined");this.createQXDom(a,"input_zengjiaduzhe","taskreader");this.createQXDom(a,"input_morenduzhe","defaultreader");this.createQXDom(a,"input_faqiziliucheng","startsubprocess");$("#"+c.id).find("input[_type\x3d'bpm_but_attribute']").each(function(b,d){c.createQXDom(a,$(d).attr("name"),$(d).attr("name"))});this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-human-task-event");this.nodeEvent.setEventDom(a);this.setDomCheckByMeta("task_cuiban_sd",a,"handHastenTask","no");this.setDomCheckByMeta("task_cuiban_zd",a,"autoHastenTask","no");d=this.getMeta(a,"handHastenTask");e=this.getMeta(a,"autoHastenTask");if("yes"==d||"yes"==e)this.showOrHiddenCuiban(!0,!0),this.setDomCheckByMeta("task_cuiban_txfs_dy",a,"toReadRemind","no"),this.setDomCheckByMeta("task_cuiban_txfs_xt",a,"sysMessageRemind","no"),this.setDomCheckByMeta("task_cuiban_txfs_yj",a,"mailRemind","no"),this.setDomCheckByMeta("task_cuiban_txfs_dx",a,"smsRemind","no"),this.setDomCheckByMeta("task_cuiban_txfs_zdy",a,"zdyRemind","no"),this.setDomValByMeta("task_cuiban_sxl",a,"hastenTaskClass");"yes"==e&&(this.showOrHiddenCuiban(!0,!1),this.setDomValByMeta("task_cuiban_blqx",a,"timeLimit"),this.setDomValByMeta("task_cuiban_cbcs",a,"maxHastenTimes"),this.setDomValByMeta("task_cuiban_jgsx",a,"warningTimeLimit"),this.setDomValByMeta("task_cuiban_cbpl",a,"hastenFrequency"));this.setDomValByMeta("kpi_task_reasonable_day",a,"kpiTaskReasonableDay");this.setDomValByMeta("kpi_task_reasonable_hour",a,"kpiTaskReasonableHour");this.setDomValByMeta("kpi_task_reasonable_minute",a,"kpiTaskReasonableMinute");this.setDomValByMeta("kpi_task_warning_day",a,"kpiTaskWarningDay");this.setDomValByMeta("kpi_task_warning_hour",a,"kpiTaskWarningHour");this.setDomValByMeta("kpi_task_warning_minute",a,"kpiTaskWarningMinute");this.getSubFromDom(a);"yes"==this.getMeta(a,"event_auto_start")&&($("#"+this.id).find("#event_auto_start").trigger("click"),this.setDomValByMeta("event_auto_start_defaultFlow_text",a,"event_auto_start_defaultFlow_text"),this.setDomValByMeta("event_auto_start_defaultFlow_id",a,"event_auto_start_defaultFlow_id"),this.setDomValByMeta("event_auto_start_defaultFlow_id2",a,"event_auto_start_defaultFlow_id2"),this.setDomValByMeta("event_auto_start_table_text",a,"event_auto_start_table_text"),this.setDomValByMeta("event_auto_start_table_id",a,"event_auto_start_table_id"),this.setDomValByMeta("event_auto_start_table_name",a,"event_auto_start_table_name"),this.setDomValByMeta("event_auto_start_fk_text",a,"event_auto_start_fk_text"),this.setDomValByMeta("event_auto_start_fk_id",a,"event_auto_start_fk_id"),this.setDomValByMeta("event_auto_start_user_text",a,"event_auto_start_user_text"),this.setDomValByMeta("event_auto_start_user_id",a,"event_auto_start_user_id"),this.setDomValByMeta("event_auto_start_flow_text",a,"event_auto_start_flow_text"),this.setDomValByMeta("event_auto_start_flow_id",a,"event_auto_start_flow_id"));this.setDomCheckByMeta("event_auto_deleteSubProcess",a,"event_auto_deleteSubProcess");if("yes"==this.getMeta(a,"task_zi_ding_yi_jian")){$("#"+this.id).find("#task_zi_ding_yi_jian").trigger("click");var g=$("#"+this.id).find("#table_task_zi_ding_yi_jian tbody");$(a).children("ideasBySelf").children().each(function(a,b){var c=$(this).text(),d=$(this).attr("outcome"),e=$(this).attr("outcome_name");addZiDingYiJiangTr(g,c,d,e)})}flowUtils.notNull(_processDataSynJs)&&this.getDataSynFromXml(a)};MyTask.prototype.getOtherAttr=function(a){var b=this;this.setXmlMetaByVal("dai_ban_biao_ti",a,"todo");this.setXmlMetaByCheck("task_yi_dong_shen_pi",a,"taskMobileApproval");this.setXmlMetaByCheck("duan_xin_tong_zhi",a,"phoneInfo");this.setXmlMetaByCheck("gong_zuo_yi_jiao",a,"isWorkHandUser");this.setXmlMetaByCheck("mi_ji_kong_zhi",a,"isSecret");this.addMeta("secretVar","\x3c![CDATA["+$("#"+this.id).find("input[name\x3d'mi_ji_bian_liang']").val()+"]]\x3e",a);this.setXmlMetaByCheck("input_isSendReaderTodo",a,"isSendReaderTodo");this.createRemarkXml(a);this.setXmlMetaByCheck("down_yes",a,"down_yes");this.setXmlMetaByCheck("down_yes_secret",a,"down_yes_secret");$("#"+this.id).find(".down_yes_class input:checked").each(function(c,d){b.setXmlMetaByCheck($(d).attr("id"),a,$(d).attr("id"))});var c=$("#"+this.id).find("input[name\x3d'task_bi_xu_tian_xie_yi_jian']").is(":checked")?"must":"can";this.addMeta("ideaType","\x3c![CDATA["+c+"]]\x3e",a);this.setXmlMetaByVal("zi_ding_yi_yi_jian_kuang",a,"ideaElementIdBySelf");this.setXmlMetaByCheck("task_yun_xu_qiang_zhi_biao_tai",a,"ideaCompelManner");this.setXmlMetaByCheck("tast_tui_hui_yi_jian",a,"isNeedIdea");this.setXmlMetaByCheck("wen_zi_gen_zong",a,"showTrackInForm");c=$("#"+this.id).find("input[type\x3d'radio'][name\x3d'task-yi-jian-xian-shi']:checked");this.addMeta("ideaDisplayStyle",c.val(),a);this.setUserSelectXml({userSelectContainer:"draft-candidate-container",dataField:"draft-candidate-data-field",textField:"draft-candidate-text-field"},a);this.setXmlMetaByVal("zu_zhi_jie_kou",a,"deptImpl");this.setXmlMetaByCheck("candidate-auto-polling",a,"isAutoGetUser");this.setXmlMetaByCheck("orgTreeOpenToDept",a,"orgTreeOpenToDept");this.setXmlMetaByCheck("orgTreeDefaultOpen",a,"orgTreeDefaultOpen");this.setXmlMetaByCheck("deptTreeHideOrg",a,"deptTreeHideOrg");this.addMeta("userSelectType",$("#"+this.id).find("input[name\x3d'person-automatic-selection']").is(":checked")?"auto":"manual",a);this.setXmlMetaByCheck("show-selection-box",a,"isSelectUser");this.setXmlMetaByCheck("candidate-necessary",a,"isMustUser");c=$("#"+this.id).find("select[name\x3d'select-human-task-process-mode']").val();this.putAttr("dealtype",c,a);if("4"==c){var c=$("#"+this.id).find("input[type\x3d'radio'][name\x3d'input-radio-human-task-select-task']:checked"),d=c.parents(".multiple-task");if(void 0!=c&&"none"!=c.val()&&"dept_one"!=c.val()){var e=c.parent().parent().index();this.addMeta(c.val(),d.find("input[name\x3dinput-num]").eq(e).val(),a);"role_number"==c.val()?(this.addMeta("dealtype_4_roleId",d.find("#dealtype_4_roleId").val(),a),this.addMeta("dealtype_4_roleName",d.find("#dealtype_4_roleName").val(),a)):"position_number"==c.val()?(this.addMeta("dealtype_4_positionId",d.find("#dealtype_4_positionId").val(),a),this.addMeta("dealtype_4_positionName",d.find("#dealtype_4_positionName").val(),a)):"group_number"==c.val()&&(this.addMeta("dealtype_4_groupId",d.find("#dealtype_4_groupId").val(),a),this.addMeta("dealtype_4_groupName",d.find("#dealtype_4_groupName").val(),a))}else void 0!=c&&"dept_one"==c.val()&&this.addMeta("dept_one","true",a)}if("form"==$("#"+this.id).find("input[name\x3d'input-radio-platform-form']:checked").val()){d=$("#"+this.id).find("#urlParam").val();flowUtils.notNull(d)&&this.putAttr("urlParam",d,a);var e=$("#"+this.id).find("input[name\x3d'task_guan_lian_biao_dan']").attr("data-type"),f=c=null;if(flowUtils.notNull(e)&&"global"!==e||flowUtils.notNull(d))if(flowUtils.notNull(e)&&"global"!==e?(c=$("#"+this.id).find("#task_guan_lian_biao_dan").val(),f=$("#"+this.id).find("#task_formName").val()):(d=b.designerEditor.myCellMap.get(b.designerEditor.processKey),c=$.trim($("#"+d.id).find("#guan_lian_biao_dan").val()),f=$.trim($("#"+d.id).find("#formName").val())),this.putAttr("taskFormId",c,a),this.putAttr("taskFormName",f,a),$("#"+this.id).find("input[name\x3d'formSave']").is(":checked")&&null!=c){var g=flowUtils.createElement("fieldsAuth");$("#"+b.id).find("table[name\x3d'table-attr-auth']").find("tbody \x3e tr").each(function(){var a=$(this).find("input[name\x3d'tag']").val(),b=$(this).find("input[name\x3d'tagName']").val(),c=$(this).find("input[name\x3d'isModified']").is(":checked"),d=$(this).find("input[name\x3d'accessibility']").is(":checked"),e=$(this).find("input[name\x3d'required']").is(":checked"),f=$(this).find("input[name\x3d'elementType']").val(),h=flowUtils.createElement("field");h.setAttribute("id",a);h.setAttribute("name",b);h.setAttribute("isModified",c?"yes":"no");h.setAttribute("accessibility",d?"yes":"no");h.setAttribute("required",e?"yes":"no");h.setAttribute("type",f);g.appendChild(h)});a.appendChild(g);var h=flowUtils.createElement("attachmentAuth");$("#"+b.id).find("table[name\x3d'table-attachment-auth']").find("tbody \x3e tr").each(function(){var a=$(this).find("input[name\x3d'tag']").val(),b=$(this).find("input[name\x3d'tagName']").val(),c=$(this).find("input[name\x3d'isModified']").is(":checked"),d=$(this).find("input[name\x3d'required']").is(":checked"),e=$(this).find("input[name\x3d'elementType']").val(),f=$(this).find("input[name\x3d'modifySecretLevel']").is(":checked"),g=flowUtils.createElement("attachment");g.setAttribute("id",a);g.setAttribute("name",b);g.setAttribute("isModified",c?"yes":"no");g.setAttribute("required",d?"yes":"no");g.setAttribute("type",e);g.setAttribute("modifySecretLevel",f?"yes":"no");h.appendChild(g)});a.appendChild(h);c=$("#"+b.id+" #fieldRelationControlConfigValue").val();flowUtils.notNull(c)&&(d=flowUtils.createElement("fieldsRelationAuth"),d.appendChild(flowUtils.createTextNode("\x3c![CDATA["+c+"]]\x3e")),a.appendChild(d))}c=flowUtils.createElement("docRights");b.createFormSaveXml("formSave","\u4fdd\u5b58\u8868\u5355",c);b.createFormSaveXml("attachCreate","\u589e\u5220\u9644\u4ef6",c);0<c.childNodes.length&&a.appendChild(c)}var k=flowUtils.createElement("magics");this.createQXXml(k,"input_tui_hui_ni_gao_ren","reTreatToDraft","\u9000\u56de\u62df\u7a3f\u4eba",a);this.createQXXml(k,"input_tui_hui_shang_yi_bu","reTreatToPrev","\u9000\u56de\u4e0a\u4e00\u6b65",a);this.createQXXml(k,"input_ren_yi_tui_hui","reTreatToWant","\u4efb\u610f\u9000\u56de",a);this.createQXXml(k,"input_kua_jie_dian_tui_hui","reTreatToActivity","\u8de8\u8282\u70b9\u9000\u56de",a);this.createQXXml(k,"input_liu_cheng_na_hui","withdraw","\u62ff\u56de",a);this.createQXXml(k,"input_liu_cheng_bu_fa","supplement","\u8865\u53d1",a);this.createQXXml(k,"input_fa_song_yue_zhi","transmit","\u53d1\u9001\u9605\u77e5",a);this.createQXXml(k,"input_chao_song","carbonCopy","\u6284\u9001",a);this.createQXXml(k,"input_liu_cheng_wei_tuo","supersede","\u6d41\u7a0b\u8f6c\u529e",a);this.setXmlMetaByCheck("input_liu_cheng_wei_tuo_multi",a,"supersede_multi");this.createQXXml(k,"input_liu_cheng_jia_qian","addUser","\u52a0\u7b7e",a);this.createQXXml(k,"input_liu_cheng_jian_qian","withdrawAssignee","\u51cf\u7b7e",a);this.createQXXml(k,"input_pei_zhi_xuan_ren","stepUserDefined","\u914d\u7f6e\u9009\u4eba",a);this.createQXXml(k,"input_zengjiaduzhe","taskreader","\u589e\u52a0\u8bfb\u8005",a);this.createQXXml(k,"input_morenduzhe","defaultreader","\u589e\u52a0\u8bfb\u8005",a);this.createQXXml(k,"input_faqiziliucheng","startsubprocess","\u53d1\u8d77\u5b50\u6d41\u7a0b",a);$("#"+b.id).find("input[_type\x3d'bpm_but_attribute']").each(function(c,d){b.createQXXml(k,$(d).attr("name"),$(d).attr("name"),$(d).attr("_name"),a)});0<k.childNodes.length&&a.appendChild(k);this.nodeEvent.setEventXml(a,"start");this.setXmlMetaByCheck("task_cuiban_sd",a,"handHastenTask");this.setXmlMetaByCheck("task_cuiban_zd",a,"autoHastenTask");if($("#"+this.id).find("input[name\x3d'task_cuiban_sd']").is(":checked")||$("#"+this.id).find("input[name\x3d'task_cuiban_zd']").is(":checked"))this.setXmlMetaByCheck("task_cuiban_txfs_dy",a,"toReadRemind"),this.setXmlMetaByCheck("task_cuiban_txfs_xt",a,"sysMessageRemind"),this.setXmlMetaByCheck("task_cuiban_txfs_yj",a,"mailRemind"),this.setXmlMetaByCheck("task_cuiban_txfs_dx",a,"smsRemind"),this.setXmlMetaByCheck("task_cuiban_txfs_zdy",a,"zdyRemind"),this.addMeta("hastenTaskClass",$("#"+b.id).find("#task_cuiban_sxl").val(),a);$("#"+this.id).find("input[name\x3d'task_cuiban_zd']").is(":checked")&&(e=$("#"+b.id).find("#task_cuiban_blqx").val(),f=$("#"+b.id).find("#task_cuiban_cbcs").val(),d=$("#"+b.id).find("#task_cuiban_jgsx").val(),c=$("#"+b.id).find("#task_cuiban_cbpl").val(),this.addMeta("timeLimit",e,a),this.addMeta("maxHastenTimes",f,a),this.addMeta("warningTimeLimit",d,a),this.addMeta("hastenFrequency",c,a),flowUtils.notNull(e)&&(e=parseInt(e),0<e&&(f=0,flowUtils.notNull(d)&&(f=parseInt(d),0>f&&(f=0)),f=e-f,0>f&&(f=0),d=flowUtils.createElement("on"),d.setAttribute("event","timeout"),e=flowUtils.createElement("timer"),e.setAttribute("duedate",f+" business days"),f=0,flowUtils.notNull(c)&&(f=parseInt(c),0>f&&(f=0)),0<f&&e.setAttribute("repeat",f+" business hours"),d.appendChild(e),c=flowUtils.createElement("event-listener"),c.setAttribute("name","pressTodoTimer"),c.setAttribute("class","avicit.platform6.bpm.bpmreform.event.PressTodoTimer"),d.appendChild(c),a.appendChild(d))));this.setXmlMetaByVal("kpi_task_reasonable_day",a,"kpiTaskReasonableDay");this.setXmlMetaByVal("kpi_task_reasonable_hour",a,"kpiTaskReasonableHour");this.setXmlMetaByVal("kpi_task_reasonable_minute",a,"kpiTaskReasonableMinute");this.setXmlMetaByVal("kpi_task_warning_day",a,"kpiTaskWarningDay");this.setXmlMetaByVal("kpi_task_warning_hour",a,"kpiTaskWarningHour");this.setXmlMetaByVal("kpi_task_warning_minute",a,"kpiTaskWarningMinute");this.getSubXml(a);this.setXmlMetaByCheck("event_auto_start",a,"event_auto_start");$("#"+this.id).find("input[name\x3d'event_auto_start']").is(":checked")&&(c=flowUtils.createElement("event-listener"),c.setAttribute("name","\u7ed3\u675f\u540e\u6839\u636e\u5b50\u8868\u6570\u636e\u81ea\u52a8\u53d1\u8d77\u5b50\u6d41\u7a0b"),c.setAttribute("class","avicit.platform6.bpm.bpmreform.event.AutoStartSubProcess"),c.setAttribute("display","no"),d=$(a).children("on[event\x3d'end']"),0==d.length?(d=flowUtils.createElement("on"),d.setAttribute("event","end"),d.appendChild(c),a.appendChild(d)):d.append(c),this.setXmlMetaByVal("event_auto_start_defaultFlow_text",a,"event_auto_start_defaultFlow_text"),this.setXmlMetaByVal("event_auto_start_defaultFlow_id",a,"event_auto_start_defaultFlow_id"),this.setXmlMetaByVal("event_auto_start_defaultFlow_id2",a,"event_auto_start_defaultFlow_id2"),this.setXmlMetaByVal("event_auto_start_table_text",a,"event_auto_start_table_text"),this.setXmlMetaByVal("event_auto_start_table_id",a,"event_auto_start_table_id"),this.setXmlMetaByVal("event_auto_start_table_name",a,"event_auto_start_table_name"),this.setXmlMetaByVal("event_auto_start_fk_text",a,"event_auto_start_fk_text"),this.setXmlMetaByVal("event_auto_start_fk_id",a,"event_auto_start_fk_id"),this.setXmlMetaByVal("event_auto_start_user_text",a,"event_auto_start_user_text"),this.setXmlMetaByVal("event_auto_start_user_id",a,"event_auto_start_user_id"),this.setXmlMetaByVal("event_auto_start_flow_text",a,"event_auto_start_flow_text"),this.setXmlMetaByVal("event_auto_start_flow_id",a,"event_auto_start_flow_id"));this.setXmlMetaByCheck("event_auto_deleteSubProcess",a,"event_auto_deleteSubProcess");this.setXmlMetaByCheck("task_zi_ding_yi_jian",a,"task_zi_ding_yi_jian");if($("#"+this.id).find("input[name\x3d'task_zi_ding_yi_jian']").is(":checked")){var l=flowUtils.createElement("ideasBySelf");$("#"+this.id).find("#table_task_zi_ding_yi_jian tbody tr").each(function(a,b){var c=$(b).find("td").eq(0).text(),d=$(b).find("td").eq("1").find("input").val(),e=$(b).find("td").eq("1").text(),f=flowUtils.createElement("sub");f.appendChild(flowUtils.createTextNode("\x3c![CDATA["+$.trim(c)+"]]\x3e"));f.setAttribute("outcome",$.trim(d));f.setAttribute("outcome_name",$.trim(e));l.appendChild(f)});0<l.children.length&&a.appendChild(l)}$("#"+this.id).find("input[name\x3d'event_auto_deleteSubProcess']").is(":checked")&&(c=flowUtils.createElement("event-listener"),c.setAttribute("name","\u518d\u6b21\u542f\u52a8\u65f6\u5220\u9664\u5b50\u6d41\u7a0b"),c.setAttribute("class","avicit.platform6.bpm.bpmreform.event.AutoDeleteSubProcess"),c.setAttribute("display","no"),d=$(a).children("on[event\x3d'start']"),0==d.length?(d=flowUtils.createElement("on"),d.setAttribute("event","start"),d.appendChild(c),a.appendChild(d)):d.append(c));c=flowUtils.createElement("event-listener");c.setAttribute("name","\u8868\u5355\u590d\u5236");c.setAttribute("class","avicit.platform6.bpm.bpmreform.event.AutoCopyFormData");c.setAttribute("display","no");d=$(a).children("on[event\x3d'end']");0==d.length?(d=flowUtils.createElement("on"),d.setAttribute("event","end"),d.appendChild(c),a.appendChild(d)):d.append(c);flowUtils.notNull(_processDataSynJs)&&this.saveDataSynToXml(a)};MyTask.prototype.createFormSaveXml=function(a,b,c,d){var e=this;if($("#"+e.id).find("input[name\x3d'"+a+"']").prop("checked")){var f=flowUtils.createElement("docRight");f.setAttribute("type",a);f.setAttribute("name",b);"wordEdit"==a&&($("#"+e.id).find("input[type\x3d'checkbox'][name\x3d'wordRevisions']").prop("checked")&&(b=flowUtils.createElement("subDocRight"),b.setAttribute("type","wordRevisions"),b.setAttribute("name","\u7f16\u8f91\u65f6\u7559\u75d5"),b.setAttribute("value","wordRevisions"),f.appendChild(b)),$("#"+e.id).find("input[type\x3d'checkbox'][name\x3d'wordShowRevisions']").prop("checked")&&(b=flowUtils.createElement("subDocRight"),b.setAttribute("type","wordShowRevisions"),b.setAttribute("name","\u663e\u793a\u7559\u75d5"),b.setAttribute("value","wordShowRevisions"),f.appendChild(b)));"wordRead"==a&&($("#"+e.id).find("input[type\x3d'checkbox'][name\x3d'read1']").prop("checked")&&(b=flowUtils.createElement("subDocRight"),b.setAttribute("type","read1"),b.setAttribute("name","\u663e\u793a\u6e05\u7a3f"),b.setAttribute("value","read1"),f.appendChild(b)),$("#"+e.id).find("input[type\x3d'checkbox'][name\x3d'read2']").prop("checked")&&(b=flowUtils.createElement("subDocRight"),b.setAttribute("type","read2"),b.setAttribute("name","\u663e\u793a\u6e05\u7a3f"),b.setAttribute("value","read2"),f.appendChild(b)));if("wordCreate"==a||"wordRedTemplet"==a){var g=$("#"+e.id).find("input[name\x3d'taskFormValue"+(a.toString()[0].toUpperCase()+a.toString().slice(1))+"']"),h=$("#"+e.id).find("input[name\x3d'taskFormText"+(a.toString()[0].toUpperCase()+a.toString().slice(1))+"']");b=flowUtils.createElement("subDocRight");b.setAttribute("type","wordCreate"==a?"wordTemplates":"wordRedTemplates");b.setAttribute("name",h.val());b.setAttribute("value",g.val());f.appendChild(b)}"wordPrint"==a&&$("#"+e.id).find("input[name^\x3d'taskFormValuewordSecret']").each(function(){var a=$(this).attr("id"),b=$(this).attr("actorsid"),c=$(this).val();c&&(e.createUserSelectXml(b,c,d),c=flowUtils.createElement("subDocRight"),c.setAttribute("type",a.slice(13)),c.setAttribute("name",$(this).parent().parent().parent().find("label").text()),c.setAttribute("value",b),f.appendChild(c))});"wordValue"==a&&(g=$("#"+e.id).find("input[name\x3d'taskFormValueWordValue']"),h=$("#"+e.id).find("input[name\x3d'taskFormTextWordValue']"),b=flowUtils.createElement("subDocRight"),b.setAttribute("type","wordFieldName"),b.setAttribute("name",h.val()),b.setAttribute("value",g.val()),f.appendChild(b));c.appendChild(f)}};MyTask.prototype.toggleAutoSelectUserOrShowBoxEvent=function(a){var b=$("#"+this.id).find("input[name\x3d'show-selection-box']"),c=$("#"+this.id).find("input[name\x3d'person-automatic-selection']");"person-automatic-selection"==a.attr("name")?c.prop("checked")?"":b.prop("checked",!0):b.prop("checked")?"":c.prop("checked",!0)};MyTask.prototype.toggleOrgTreeOpenToDeptOrorgTreeDefaultOpen=function(a){var b=$("#"+this.id).find("input[name\x3d'orgTreeDefaultOpen']"),c=$("#"+this.id).find("input[name\x3d'orgTreeOpenToDept']");"orgTreeDefaultOpen"==a.attr("name")?b.prop("checked")&&c.prop("checked",!1):c.prop("checked")&&b.prop("checked",!1)};MyTask.prototype.initEvent=function(){var a=this;$("#"+this.id+" #formName_biaoTi").click(function(){a.configTaskTitle()});$("#"+this.id+" button[name\x3dbtn-add-candidate]").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey);a.candidateSelect=new UserSelect({type:"userSelect",userSelectContainer:"draft-candidate-container",dataField:"draft-candidate-data-field",textField:"draft-candidate-text-field",topId:a.id,processId:b.id,callback:function(a){}})});$("#"+this.id+" select[name\x3d'select-human-task-process-mode']").on("change",function(){4==$(this).val()?$(this).parent().parent().next().removeClass("hidden"):$(this).parent().parent().next().addClass("hidden")});$("#"+this.id+" input[type\x3d'radio'][name\x3d'input-radio-human-task-select-task']").on("click",function(){var a=$(this).parent().parent().index();$(this).parent().parent().parent().next().children().eq(a).removeClass("hidden").siblings().addClass("hidden")});$("#"+this.id+" input[type\x3d'checkbox'][name\x3d'person-automatic-selection'],input[type\x3d'checkbox'][name\x3d'show-selection-box']").on("change",function(){a.toggleAutoSelectUserOrShowBoxEvent($(this))});$("#"+this.id+" input[type\x3d'checkbox'][name\x3d'orgTreeDefaultOpen'],input[type\x3d'checkbox'][name\x3d'orgTreeOpenToDept']").on("change",function(){a.toggleOrgTreeOpenToDeptOrorgTreeDefaultOpen($(this))});$("#"+this.id+" input[type\x3d'checkbox'][name\x3d'mi_ji_kong_zhi']").on("click",function(){$(this).is(":checked")?$("#"+a.id).find("div[name\x3d'mi_ji_bian_liang_show']").removeClass("hidden"):$("#"+a.id).find("div[name\x3d'mi_ji_bian_liang_show']").addClass("hidden")});$("#"+a.id+" div[class^\x3d'div-auth-checkbox'] input[type\x3d'checkbox']").on("click",function(){if(this.checked){var b=$(this).parentsUntil(".form-group").parent().siblings("div[class^\x3d'div-auth-box']");b.removeClass("hidden");var c=b.attr("class");if(b.find("input[name\x3d'operator-data-field']").get(0))b.find("button[name\x3d'button-auth-operator']").off("click").on("click",function(){var b={processId:a.designerEditor.myCellMap.get(a.designerEditor.processKey).id,type:"userSelect",userSelectContainer:c,dataField:"operator-data-field",textField:"operator-text-field",topId:a.id};new UserSelect(b)});if(b.find("input[name\x3d'candidate-data-field']").get(0))b.find("button[name\x3d'button-auth-candidate']").off("click").on("click",function(){var b={processId:a.designerEditor.myCellMap.get(a.designerEditor.processKey).id,type:"userSelect",userSelectContainer:c,dataField:"candidate-data-field",textField:"candidate-text-field",topId:a.id};new UserSelect(b)});if(b.find("input[name\x3d'preprocess-data-field']").get(0))b.find("button[name\x3d'button-auth-preprocess']").off("click").on("click",function(){layer.open({type:2,area:["400px","350px"],title:"\u51fd\u6570\u8f93\u5165\u6846",skin:"bs-modal",shade:.3,maxmin:!1,content:"avicit/platform6/bpmreform/bpmdesigner/editors/js/template/AuthProcessTpl/authProcessTpl.jsp?id\x3d"+a.id+"\x26name\x3dpreprocess-data-field\x26className\x3d"+c})});if(b.find("input[name\x3d'postprocess-data-field']").get(0))b.find("button[name\x3d'button-auth-postprocess']").off("click").on("click",function(){layer.open({type:2,area:["400px","350px"],title:"\u51fd\u6570\u8f93\u5165\u6846",skin:"bs-modal",shade:.3,maxmin:!1,content:"avicit/platform6/bpmreform/bpmdesigner/editors/js/template/AuthProcessTpl/authProcessTpl.jsp?id\x3d"+a.id+"\x26name\x3dpostprocess-data-field\x26className\x3d"+c})});if(b.find("input[name\x3d'input_kua_jie_dian_tui_hui_activity']").get(0))b.find("button[name\x3d'button-kua_jie_dian_tui_hui_activity']").off("click").on("click",function(){layer.open({type:1,area:["800px","450px"],title:"\u8282\u70b9\u9009\u62e9",content:"\x3ctable id\x3d'activityGrid'\x3e\x3c/table\x3e",btn:["\u786e\u5b9a","\u5173\u95ed"],success:function(b,c){var d=[],e=a.designerEditor.myCellMap.values();$.each(e,function(a,b){if("task"==b.tagName){var c={};c.name=b.name;c.alias=b.alias;d.push(c)}});$("#activityGrid").jqGrid({datastr:JSON.stringify(d),datatype:"jsonstring",colModel:[{label:"\u903b\u8f91\u6807\u8bc6",name:"name",key:!0,align:"center"},{label:"\u8282\u70b9\u540d\u79f0",name:"alias",align:"center"}],rownumbers:!0,altRows:!0,styleUI:"Bootstrap",autowidth:!0,height:"100%",multiselect:!0})},yes:function(b,c){var d=[],e=[],f=$("#activityGrid").getGridParam("selarrrow");if(""!=f){for(var g=f.length,h=0;h<g;h++){var q=$("#activityGrid").getRowData(f[h]);d.push(q.name);e.push(q.alias)}f="";for(h=0;h<d.length;h++)0<h&&(f+=","),f+=e[h]+"\u3010"+d[h]+"\u3011";$("#"+a.id+" input[name\x3d'input_kua_jie_dian_tui_hui_activity']").val(f);$("#"+a.id+" input[name\x3d'input_kua_jie_dian_tui_hui_activity']").attr("title",f);layer.close(b)}else layer.msg("\u8bf7\u9009\u62e9\u6570\u636e")}})})}else b=$(this).parentsUntil(".form-group").parent().siblings("div[class^\x3d'div-auth-box']"),b.addClass("hidden").find("input").val(""),b.find("#table_subprocess tbody").empty()});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formSave']").on("click",function(){this.checked?($("#"+a.id).find(".basic-form-save-area").removeClass("hidden"),a.syncFormAttrs()):($("#"+a.id).find(".basic-form-save-area").addClass("hidden"),$("#"+a.id).find(".basic-form-save-area input[type\x3d'checkbox']").prop("checked",!1),$("#"+a.id).find("table[name\x3d'table-attr-auth'] tbody\x3etr").remove(),$("#"+a.id).find("table[name\x3d'table-attachment-auth'] tbody\x3etr").remove());$("#"+a.id).find("#task_guan_lian_biao_dan").attr("data-type","task")});$("#"+a.id+" #refreshForm").on("click",function(){$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formSave']").prop("checked")&&a.syncFormAttrs(!0)});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formCheckAll']").on("click",function(){this.checked?$("#"+a.id+" table[name\x3d'table-attr-auth']").find("input[name\x3disModified]").prop("checked",!0):$("#"+a.id+" table[name\x3d'table-attr-auth']").find("input[name\x3disModified]").prop("checked",!1)});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formAccessibilityCheckAll']").on("click",function(){this.checked?$("#"+a.id+" table[name\x3d'table-attr-auth']").find("input[name\x3daccessibility]").prop("checked",!0):$("#"+a.id+" table[name\x3d'table-attr-auth']").find("input[name\x3daccessibility]").prop("checked",!1)});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formRequiredCheckAll']").on("click",function(){this.checked?$("#"+a.id+" table[name\x3d'table-attr-auth']").find("input[name\x3drequired]").prop("checked",!0):$("#"+a.id+" table[name\x3d'table-attr-auth']").find("input[name\x3drequired]").prop("checked",!1)});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formAttachmentAddCheckAll']").on("click",function(){this.checked?$("#"+a.id+" table[name\x3d'table-attachment-auth']").find("input[name\x3disModified]").prop("checked",!0):$("#"+a.id+" table[name\x3d'table-attachment-auth']").find("input[name\x3disModified]").prop("checked",!1)});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formAttachmentRequiredCheckAll']").on("click",function(){this.checked?$("#"+a.id+" table[name\x3d'table-attachment-auth']").find("input[name\x3drequired]").prop("checked",!0):$("#"+a.id+" table[name\x3d'table-attachment-auth']").find("input[name\x3drequired]").prop("checked",!1)});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'formAttachmentModifySecretLevelCheckAll']").on("click",function(){this.checked?$("#"+a.id+" table[name\x3d'table-attachment-auth']").find("input[name\x3dmodifySecretLevel]").prop("checked",!0):$("#"+a.id+" table[name\x3d'table-attachment-auth']").find("input[name\x3dmodifySecretLevel]").prop("checked",!1)});$("#"+this.id+" input[name\x3d'input-radio-platform-form']").on("click",function(){if("url"==this.value){$("#"+a.id).find(".div-formSave-area").addClass("hidden");$("#"+a.id).find(".basic-form-save-area").addClass("hidden");$("#"+a.id).find("input[type\x3d'checkbox']").prop("checked",!1);$("#"+a.id).find("table[name\x3d'table-attr-auth'] tbody\x3etr").remove();$("#"+a.id).find("#task_guan_lian_biao_dan").attr("data-type","global");var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),c=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val()),b=$.trim($("#"+b.id).find("#formName").val());a.syncTaskForm(c,b)}else $("#"+a.id).find(".div-formSave-area").removeClass("hidden")});$("#"+a.id+" div[name^\x3d'div-word']").find("input[type\x3d'checkbox']").on("click",function(){var b=$(this).attr("name"),b=$("#"+a.id+" div[name\x3d'container-"+b+"']");this.checked?b.hasClass("hidden")&&b.removeClass("hidden"):(b.addClass("hidden"),b.find("input").val(""),b.find("input[type\x3d'checkbox']").prop("checked",!1))});$("#"+a.id+" button[name\x3d'btnTaskFormWordCreate']").on("click",function(){new FormAuth({dataDomId:a.id+" #taskFormValueWordCreate",showDomId:a.id+" #taskFormTextWordCreate",callback:"",type:"wordCreate"})});$("#"+a.id+" button[name\x3d'btnTaskFormWordRedTemplet']").on("click",function(){new FormAuth({dataDomId:a.id+" #taskFormValueWordRedTemplet",showDomId:a.id+" #taskFormTextWordRedTemplet",callback:"",type:"redTemplate"})});$("#"+a.id+" button[name\x3d'btnTaskFormWordValue']").on("click",function(){var b=null,c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"process"==c.tagName&&(b=c)});new ProcessVariable({dataDomId:a.id+" #taskFormValueWordValue",showDomId:a.id+" #taskFormTextWordValue",callback:"",process:b})});$("#"+a.id).find("button[name^\x3d'btnTaskFormwordSecret']").off("click").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),c=$(this).parent().siblings("div").find("input[name^\x3d'taskFormValuewordSecret']").attr("name"),d=$(this).parent().siblings("div").find("input[name^\x3d'taskFormTextwordSecret']").attr("name");new UserSelect({processId:b.id,type:"userSelect",userSelectContainer:"",dataField:c,textField:d,topId:a.id})});$("#"+a.id+" button[name\x3d'button-mi_ji_bian_liang']").on("click",function(){var b=null,c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"process"==c.tagName&&(b=c)});new ProcessVariable({dataDomId:a.id+" #mi_ji_bian_liang",showDomId:a.id+" #mi_ji_bian_liang",callback:function(b){b="#{"+b[0].name+"}";$("#"+a.id+" #mi_ji_bian_liang").val(b)},process:b,multiple:!1})});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'task_cuiban_sd']").on("click",function(){$(this).is(":checked")?a.showOrHiddenCuiban(!0,!0):$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'task_cuiban_zd']").is(":checked")||a.showOrHiddenCuiban(!1,!0)});$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'task_cuiban_zd']").on("click",function(){$(this).is(":checked")?a.showOrHiddenCuiban(!0,!1):$("#"+a.id+" input[type\x3d'checkbox'][name\x3d'task_cuiban_sd']").is(":checked")?(a.showOrHiddenCuiban(!1,!1),a.showOrHiddenCuiban(!0,!0)):a.showOrHiddenCuiban(!1,!1)});$("#"+a.id+" button[name\x3d'addSubProcess']").on("click",function(){new SubProcess({dataDomId:a.id+" #inputValueSubFlowName",showDomId:a.id+" #inputTextSubFlowName",callback:function(b){var c=$("#"+a.id+" #table_subprocess tbody");if(null!=b&&0<b.length)for(var d=0;d<b.length;d++){var e=b[d],k=$("\x3ctr\x3e\x3c/tr\x3e"),l=$("\x3ctd\x3e\x3c/td\x3e");l.append(e.displayName);var m=$("\x3cinput type\x3d'hidden' id\x3d'subflowid_"+e.id+"' value\x3d'"+e.id+"'/\x3e"),p=$("\x3cinput type\x3d'hidden' id\x3d'subflowname_"+e.id+"' value\x3d'"+e.displayName+"'/\x3e"),n=$("\x3cinput type\x3d'hidden' id\x3d'subflowkey_"+e.id+"' value\x3d'"+e.key+"'/\x3e");l.append(m);l.append(p);l.append(n);m=$("\x3ctd\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'deleteData'\x3e\x3ci class\x3d'iconfont icon-delete'\x3e\x3c/i\x3e\x3c/a\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'modifyData' style\x3d'margin-left:5px'\x3e\x3ci class\x3d'iconfont icon-edit'\x3e\x3c/i\x3e\x3c/a\x3e \x3c/td\x3e");m.find("a[name\x3d'deleteData']").off("click").on("click",function(){$(this).parent().parent().siblings("div").remove();$(this).parent().parent().remove()});m.find("a[name\x3d'modifyData']").off("click").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),c=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val()),d=e.key;if(!flowUtils.notNull(e.id)&&!flowUtils.notNull(d))return layer.msg("\u60a8\u8fd8\u6ca1\u9009\u62e9\u5b50\u6d41\u7a0b"),!1;new FormFieldParameter({id:a.id,dataDomId1:a.id+" #formInData_"+e.id,dataDomId2:a.id+" #formOutData_"+e.id,callback:function(a){},process:b,mainProcessFormId:c,subProcessKey:d,hiddenVarParameter:"1"})});p=$("\x3cinput type\x3d'hidden' id\x3d'formInData_"+e.id+"'/\x3e");n=$("\x3cinput type\x3d'hidden' id\x3d'formOutData_"+e.id+"'/\x3e");m.append(p);m.append(n);k.append(l).append(m);c.append(k)}},multiple:!1,dataDomId2:a.id+" #inputValueSubFlowId"})});if(flowUtils.notNull(_processDataSynJs)){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),c=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val()),d=new ProcessDataSynchronization({id:a.id,dataDomId:a.id+" #shujutongbu",callback:function(a){},process:b,task:a,formId:c,tableId:"table-shujutongbu-value"});$("#"+a.id+" button[name\x3d'btn-shujutongbu-add']").on("click",function(){var a=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val());d.formId=a;d.add()});$("#"+a.id+" button[name\x3d'btn-shujutongbu-viewLog']").on("click",function(){var a=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val());d.formId=a;d.viewLog()})}$("#"+a.id+" button[name\x3d'btn-fieldRelationControlConfig']").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),c=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val());new FieldRelationControl({id:a.id,dataDomId:a.id+" #fieldRelationControlConfigValue",callback:function(a){},process:b,formId:c,tableId:"table-field-relation-control"})})};MyTask.prototype.syncFormAttrTr=function(a,b,c,d,e,f){return' \x3ctr\x3e \x3ctd title\x3d"'+b+"("+a+')"\x3e'+b+"("+a+')\x3c/td\x3e  \x3ctd\x3e   \x3cinput type\x3d"hidden" name\x3d"tag" value\x3d"'+a+'"/\x3e    \x3cinput type\x3d"hidden" name\x3d"tagName" value\x3d"'+b+'"/\x3e    \x3cinput type\x3d"hidden" name\x3d"elementType" value\x3d"'+e+'"/\x3e    \x3cinput type\x3d"checkbox" name\x3d"isModified" '+(c?"checked":"")+'/\x3e  \x3c/td\x3e  \x3ctd\x3e    \x3cinput type\x3d"checkbox" name\x3d"accessibility" '+(d?"checked":"")+'/\x3e  \x3c/td\x3e  \x3ctd\x3e    \x3cinput type\x3d"checkbox" name\x3d"required" '+(f?"checked":"")+"/\x3e  \x3c/td\x3e  \x3c/tr\x3e"};MyTask.prototype.syncSubFormButtonAttrTr=function(a,b,c,d,e,f){return' \x3ctr\x3e \x3ctd title\x3d"'+b+"("+a+')"\x3e'+b+"("+a+')\x3c/td\x3e  \x3ctd\x3e   \x3cinput type\x3d"hidden" name\x3d"tag" value\x3d"'+a+'"/\x3e    \x3cinput type\x3d"hidden" name\x3d"tagName" value\x3d"'+b+'"/\x3e    \x3cinput type\x3d"hidden" name\x3d"elementType" value\x3d"'+e+'"/\x3e  \x3c/td\x3e  \x3ctd\x3e    \x3cinput type\x3d"checkbox" name\x3d"accessibility" '+(d?"checked":"")+"/\x3e  \x3c/td\x3e  \x3ctd\x3e  \x3c/td\x3e  \x3c/tr\x3e"};MyTask.prototype.syncFormAttachmentAttrTr=function(a,b,c,d,e,f){return' \x3ctr\x3e \x3ctd title\x3d"'+b+"("+a+')"\x3e'+b+"("+a+')\x3c/td\x3e  \x3ctd\x3e   \x3cinput type\x3d"hidden" name\x3d"tag" value\x3d"'+a+'"/\x3e    \x3cinput type\x3d"hidden" name\x3d"tagName" value\x3d"'+b+'"/\x3e    \x3cinput type\x3d"hidden" name\x3d"elementType" value\x3d"'+d+'"/\x3e    \x3cinput type\x3d"checkbox" name\x3d"isModified" '+(c?"checked":"")+'/\x3e  \x3c/td\x3e  \x3ctd\x3e    \x3cinput type\x3d"checkbox" name\x3d"required" '+(e?"checked":"")+'/\x3e  \x3c/td\x3e  \x3ctd\x3e    \x3cinput type\x3d"checkbox" name\x3d"modifySecretLevel" '+(f?"checked":"")+"/\x3e  \x3c/td\x3e  \x3c/tr\x3e"};MyTask.prototype.syncFormAttrs=function(a){var b=this,c=[],d=[];a&&($("#"+b.id).find("table[name\x3d'table-attr-auth'] tbody\x3etr").each(function(a,b){var d=$(b).find("input[name\x3d'tag']").val(),e=$(b).find("input[name\x3d'isModified']").prop("checked"),f=$(b).find("input[name\x3d'accessibility']").prop("checked"),l=$(b).find("input[name\x3d'required']").prop("checked"),m={};m.tag=d;m.isModified=e;m.accessibility=f;m.required=l;c.push(m)}),$("#"+b.id).find("table[name\x3d'table-attr-auth'] tbody\x3etr").remove(),$("#"+b.id).find("table[name\x3d'table-attachment-auth'] tbody\x3etr").each(function(a,b){var c=$(b).find("input[name\x3d'tag']").val(),e=$(b).find("input[name\x3d'isModified']").prop("checked"),f=$(b).find("input[name\x3d'required']").prop("checked"),l=$(b).find("input[name\x3d'modifySecretLevel']").prop("checked"),m={};m.tag=c;m.isModified=e;m.required=f;m.modifySecretLevel=l;d.push(m)}),$("#"+b.id).find("table[name\x3d'table-attachment-auth'] tbody\x3etr").remove());a=$("#"+b.id).find("#task_guan_lian_biao_dan").val();$.ajax({type:"POST",url:"platform/bpm/designer/getFormElement",data:{id:a,formElementData:JSON.stringify(c),attachmentData:JSON.stringify(d)},dataType:"json",success:function(a){var c=a.result;c?$.each(c,function(a,c){"eform_mutiattach_auth"==c.elementType?$("#"+b.id).find("table[name\x3d'table-attachment-auth'] tbody").append(b.syncFormAttachmentAttrTr(c.tag,c.tagName,c.operability,c.elementType,c.required,c.modifySecretLevel)):"eform_subtable_bpm_button_auth"==c.elementType?$("#"+b.id).find("table[name\x3d'table-attr-auth'] tbody").append(b.syncSubFormButtonAttrTr(c.tag,c.tagName,c.operability,c.accessibility,c.elementType,c.required)):$("#"+b.id).find("table[name\x3d'table-attr-auth'] tbody").append(b.syncFormAttrTr(c.tag,c.tagName,c.operability,c.accessibility,c.elementType,c.required))}):flowUtils.error(a.error)}})};MyTask.prototype.syncTaskForm=function(a,b){var c=$("#"+this.id).find("input[name\x3d'task_guan_lian_biao_dan']").attr("data-type");if("global"==c||void 0==c||""==c)$("#"+this.id).find("#task_guan_lian_biao_dan").val(a),$("#"+this.id).find("#task_guan_lian_biao_dan").attr("data-type","global"),$("#"+this.id).find("#task_formName").val(b)};MyTask.prototype.showOrHiddenCuiban=function(a,b){a?b?($("#"+this.id).find("#task_cuiban_txfs_div").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_txfs_div1").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_txfs_div2").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_sxl_div").removeClass("hidden")):($("#"+this.id).find("#task_cuiban_txfs_div").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_txfs_div1").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_txfs_div2").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_sxl_div").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_blqx_div").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_cbcs_div").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_jgsx_div").removeClass("hidden"),$("#"+this.id).find("#task_cuiban_cbpl_div").removeClass("hidden")):b?($("#"+this.id).find("#task_cuiban_txfs_div").addClass("hidden"),$("#"+this.id).find("#task_cuiban_txfs_div1").addClass("hidden"),$("#"+this.id).find("#task_cuiban_txfs_div2").addClass("hidden"),$("#"+this.id).find("#task_cuiban_sxl_div").addClass("hidden")):($("#"+this.id).find("#task_cuiban_txfs_div").addClass("hidden"),$("#"+this.id).find("#task_cuiban_txfs_div1").addClass("hidden"),$("#"+this.id).find("#task_cuiban_txfs_div2").addClass("hidden"),$("#"+this.id).find("#task_cuiban_sxl_div").addClass("hidden"),$("#"+this.id).find("#task_cuiban_blqx_div").addClass("hidden"),$("#"+this.id).find("#task_cuiban_cbcs_div").addClass("hidden"),$("#"+this.id).find("#task_cuiban_jgsx_div").addClass("hidden"),$("#"+this.id).find("#task_cuiban_cbpl_div").addClass("hidden"))};MyTask.prototype.configTaskTitle=function(){var a=this,b=a.designerEditor.myCellMap.get(a.designerEditor.processKey).id,c=$("#"+a.id).find("#dai_ban_biao_ti").val(),c=encodeURIComponent(c);layer.open({type:2,title:"\u914d\u7f6e\u3010\u5f85\u529e\u6807\u9898\u3011",skin:"index-model",area:["400px","350px"],content:"bpm/business/expr?value\x3d"+c+"\x26processId\x3d"+b,btn:["\u786e\u8ba4","\u53d6\u6d88"],yes:function(b,c){var d=c.find("iframe")[0].contentWindow.getValue();$("#"+a.id).find("#formName_biaoTi").val(d);$("#"+a.id).find("#dai_ban_biao_ti").val(d);layer.close(b)}})};MyTask.prototype.getSubXml=function(a){var b=this,c=flowUtils.createElement("sub"),d=!1;$("#"+b.id+" input[id^\x3d'subflowid_']").each(function(){d=!0;var a=$(this).val(),f=$("#"+b.id+" #subflowname_"+a).val(),g=$("#"+b.id+" #subflowkey_"+a).val(),h=$("#"+b.id+" #formInData_"+a).val(),k=flowUtils.createElement("procmodel");k.setAttribute("id",a);k.setAttribute("name",f);k.setAttribute("key",g);c.appendChild(k);if(flowUtils.notNull(h)&&(a=JSON.parse(h),a.length))for(i=0;i<a.length;i++)f=a[i],g=flowUtils.createElement("form-in"),g.setAttribute("formTable",f.formTable),g.setAttribute("formCol",f.formCol),g.setAttribute("subFormTable",f.subFormTable),g.setAttribute("subFormCol",f.subFormCol),g.setAttribute("colType",f.colType),g.setAttribute("tableModify",f.tableModify),g.setAttribute("colComments",f.colComments),g.setAttribute("isOrgIdentity",f.isOrgIdentity),g.setAttribute("fromComments",f.fromComments),g.setAttribute("isSubTable","1"==f.isSubTable?"1":""),g.setAttribute("fromFkColName",f.fromFkColName),g.setAttribute("toFkColName",f.toFkColName),k.appendChild(g)});d&&a.appendChild(c)};MyTask.prototype.getSubFromDom=function(a){var b=this,c=$("#"+b.id+" #table_subprocess tbody");c.empty();$(a).children("sub").children("procmodel").each(function(){var a=$.trim(this.getAttribute("id")),e=$.trim(this.getAttribute("name")),f=$.trim(this.getAttribute("key")),g=[];$(this).children("form-in").each(function(){var a={};a.formTable=$.trim(this.getAttribute("formTable"));a.formCol=$.trim(this.getAttribute("formCol"));a.subFormTable=$.trim(this.getAttribute("subFormTable"));a.subFormCol=$.trim(this.getAttribute("subFormCol"));a.colType=$.trim(this.getAttribute("colType"));a.tableModify=$.trim(this.getAttribute("tableModify"));a.colComments=$.trim(this.getAttribute("colComments"));a.isOrgIdentity=$.trim(this.getAttribute("isOrgIdentity"));a.fromComments=$.trim(this.getAttribute("fromComments"));a.isSubTable=$.trim(this.getAttribute("isSubTable"));a.fromFkColName=$.trim(this.getAttribute("fromFkColName"));a.toFkColName=$.trim(this.getAttribute("toFkColName"));g.push(a)});var h=JSON.stringify(g),k=$("\x3ctr\x3e\x3c/tr\x3e"),l=$("\x3ctd\x3e\x3c/td\x3e");l.append(e);var m=$("\x3cinput type\x3d'hidden' id\x3d'subflowid_"+a+"' value\x3d'"+a+"'/\x3e"),e=$("\x3cinput type\x3d'hidden' id\x3d'subflowname_"+a+"' value\x3d'"+e+"'/\x3e"),p=$("\x3cinput type\x3d'hidden' id\x3d'subflowkey_"+a+"' value\x3d'"+f+"'/\x3e");l.append(m);l.append(e);l.append(p);m=$("\x3ctd\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'deleteData'\x3e\x3ci class\x3d'iconfont icon-delete'\x3e\x3c/i\x3e\x3c/a\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'modifyData' style\x3d'margin-left:5px'\x3e\x3ci class\x3d'iconfont icon-edit'\x3e\x3c/i\x3e\x3c/a\x3e \x3c/td\x3e");m.find("a[name\x3d'deleteData']").off("click").on("click",function(){$(this).parent().parent().siblings("div").remove();$(this).parent().parent().remove()});m.find("a[name\x3d'modifyData']").off("click").on("click",function(){var c=b.designerEditor.myCellMap.get(b.designerEditor.processKey),d=$.trim($("#"+c.id).find("#guan_lian_biao_dan").val());if(!flowUtils.notNull(a)&&!flowUtils.notNull(f))return layer.msg("\u60a8\u8fd8\u6ca1\u9009\u62e9\u5b50\u6d41\u7a0b"),!1;new FormFieldParameter({id:b.id,dataDomId1:b.id+" #formInData_"+a,dataDomId2:b.id+" #formOutData_"+a,callback:function(a){},process:c,mainProcessFormId:d,subProcessKey:f,hiddenVarParameter:"1"})});h=$("\x3cinput type\x3d'hidden' id\x3d'formInData_"+a+"' value\x3d'"+h+"'/\x3e");m.append(h);k.append(l).append(m);c.append(k)})};MyTask.prototype.saveDataSynToXml=function(a){var b=$("#"+this.id+" #table-shujutongbu-value tbody").find("tr");if(b&&b.length){var c=flowUtils.createElement("dataSyns");b.each(function(){var a=flowUtils.createElement("dataSyn"),b=$(this).find("td").eq(0).find("input").val();a.appendChild(flowUtils.createTextNode("\x3c![CDATA["+b.trim()+"]]\x3e"));c.appendChild(a)});a.appendChild(c);b=flowUtils.createElement("event-listener");b.setAttribute("name","\u8282\u70b9\u5b8c\u6210\u540e\u540c\u6b65\u6d41\u7a0b\u6570\u636e");var d=getWaSysDataAfterClass();b.setAttribute("class",d);b.setAttribute("display","no");d=$(a).children("on[event\x3d'end']");0==d.length?(d=flowUtils.createElement("on"),d.setAttribute("event","end"),d.appendChild(b),a.appendChild(d)):d.append(b);b=flowUtils.createElement("event-listener");b.setAttribute("name","\u8282\u70b9\u521b\u5efa\u524d\u540c\u6b65\u6d41\u7a0b\u6570\u636e");d=getWaSynDataBeforeClass();b.setAttribute("class",d);b.setAttribute("display","no");d=$(a).children("on[event\x3d'start']");0==d.length?(d=flowUtils.createElement("on"),d.setAttribute("event","start"),d.appendChild(b),a.appendChild(d)):d.append(b)}};MyTask.prototype.getDataSynFromXml=function(a){var b=this,c=$("#"+b.id+" #table-shujutongbu-value tbody");c.empty();var d=b.id+" #shujutongbu",e=encodeURIComponent(d),f=b.designerEditor.myCellMap.get(b.designerEditor.processKey),g=$.trim($("#"+f.id).find("#guan_lian_biao_dan").val()),h={};h.dataDomId=d;h.formId=g;h.process=f;$("#"+d).data("data-object",h);$(a).children("dataSyns").children("dataSyn").each(function(){var a=$(this).text(),a=JSON.parse(a);c.append(b.getDataSynTableTr(a,d,e))})};MyTask.prototype.getDataSynTableTr=function(a,b,c){var d=this,e=$("\x3ctr\x3e\x3c/tr\x3e"),f=$("\x3ctd\x3e\x3c/td\x3e");f.append(a.dbTableName);var g=$("\x3cinput type\x3d'hidden'/\x3e");g.val(JSON.stringify(a));f.append(g);e.append(f);f=$("\x3ctd\x3e\x3c/td\x3e");g="";"0"==a.type?g="\u65b0\u589e":"1"==a.type?g="\u4fee\u6539":"2"==a.type?g="\u65b0\u589e\u6216\u4fee\u6539":"3"==a.type&&(g="\u5220\u9664");f.append(g);e.append(f);a=$("\x3ctd\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'deleteData'\x3e\x3ci class\x3d'iconfont icon-delete'\x3e\x3c/i\x3e\x3c/a\x3e\x3ca href\x3d'javascript:void(0)' name\x3d'modifyData' style\x3d'margin-left:5px'\x3e\x3ci class\x3d'iconfont icon-edit'\x3e\x3c/i\x3e\x3c/a\x3e \x3c/td\x3e");a.find("a[name\x3d'deleteData']").off("click").on("click",function(){$(this).parent().parent().remove()});a.find("a[name\x3d'modifyData']").off("click").on("click",function(){var a=$(this).parentsUntil("tr").parent(),e=a.find("td:eq(0)").find("input").val(),e=JSON.parse(e);$("#"+b).data("synObject",e);layer.config({extend:"skin/layer-bootstrap.css"});layer.open({type:2,area:["700px","600px"],title:"\u6d41\u7a0b\u6570\u636e\u540c\u6b65",skin:"bs-modal",shade:.3,maxmin:!0,content:"avicit/platform6/bpmreform/bpmdesigner/editors/js/template/ProcessDataSynchronization/ProcessDataSynchronization.jsp?dataDomId\x3d"+c+"\x26edit\x3d1",btn:["\u786e\u5b9a","\u5173\u95ed"],yes:function(e,f){var g=f.find("iframe")[0].contentWindow;g.validateForm()&&(g=g.getSynObject(),a.replaceWith(d.getDataSynTableTr(g,b,c)),layer.close(e))},cancel:function(a){layer.close(a);$("html").addClass("fix-ie-font-face");setTimeout(function(){$("html").removeClass("fix-ie-font-face")},10)},success:function(a,b){}})});e.append(a);return e};MyTask.prototype.getFieldRelationAuthFromXml=function(a){$("#"+this.id+" #fieldRelationControlConfigValue").val(a);var b=$("#"+this.id+" #table-field-relation-control tbody");b.empty();if(""!=a&&(a=JSON.parse(a))&&a.length)for(var c=0;c<a.length;c++){var d=a[c],e=d.conditonValues,f="",g="";if(e&&e.length)for(var h=0;h<e.length;h++)f+=e[h].controlTagName+" "+e[h].operName+" "+e[h].compareValueName+"\x3cbr\x3e",g+=e[h].controlTagName+" "+e[h].operName+" "+e[h].compareValueName+"\n";e=$("\x3ctr\x3e\x3c/tr\x3e");h=$("\x3ctd\x3e\x3c/td\x3e");h.append(f);h.attr("title",g);e.append(h);var f=$("\x3ctd\x3e\x3c/td\x3e"),d=d.beControledFields,k=g="";if(d&&d.length)for(var l=0;l<d.length;l++)g+=d[l].tagName,"1"==d[l].accessibility?(g+=" \u53ef\u663e\u793a",k+=" \u53ef\u663e\u793a"):(g+=" \u9690\u85cf",k+=" \u9690\u85cf"),"1"==d[l].hideRow?(g+=" \u9690\u85cf\u884c",k+=" \u9690\u85cf\u884c"):(g+=" \u4e0d\u9690\u85cf\u884c",k+=" \u4e0d\u9690\u85cf\u884c"),"1"==d[l].operability?(g+=" \u53ef\u7f16\u8f91",k+=" \u53ef\u7f16\u8f91"):(g+=" \u4e0d\u53ef\u7f16\u8f91",k+=" \u4e0d\u53ef\u7f16\u8f91"),"1"==d[l].required?(g+=" \u5fc5\u586b",k+=" \u5fc5\u586b"):(g+=" \u975e\u5fc5\u586b",k+=" \u975e\u5fc5\u586b"),g+="\x3cbr\x3e",k+="\n";f.append(g);f.attr("title",k);e.append(h);e.append(f);b.append(e)}};function MyTransition(a,b){MyBase.call(this,a,b,"transition")}MyTransition.prototype=new MyBase;MyTransition.prototype.init=function(){this.initBase();this.name="to "+this.designerEditor.myCellMap.get(this.getCell().target.id).name;this.alias="\u63d0\u4ea4";this.initJBXX();this.observeGlobalVariable();this.processInstance().notify();this.initEvent();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-human-task-event")};MyTransition.prototype.initTracks=function(a,b,c){this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");b.appendChild(this.createMxCell(c,a))};MyTransition.prototype.initLoad=function(a,b,c){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.order=a.getAttribute("order");$("#"+this.id).find("#xian_shi_shun_xu").val(this.order);this.description=a.getAttribute("description");$("#"+this.id).find("#miao_shu").val(this.description);this.initJBXX();b.appendChild(this.createMxCell(c,a));this.observeGlobalVariable();this.initEvent();this.createConditionDom("zhi_xing_fang_shi","table-executor",a);this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-human-task-event");this.nodeEvent.setEventDom(a);this.createTimeOutDom(a);this.setUserSelectDom({userSelectContainer:"draft-candidate-container",dataField:"draft-candidate-data-field",textField:"draft-candidate-text-field"},a)};MyTransition.prototype.getOtherAttr=function(a){this.putAttr("to",this.designerEditor.myCellMap.get(this.cell.target.id).name,a);this.putAttr("order",$.trim($("#"+this.id).find("#xian_shi_shun_xu").val()),a);this.putAttr("description",$.trim($("#"+this.id).find("#miao_shu").val()),a);this.setConditionXml("zhi_xing_fang_shi","table-executor",a);this.nodeEvent.setEventXml(a,"event");this.saveTimeOutXml(a);this.setUserSelectXml({userSelectContainer:"draft-candidate-container",dataField:"draft-candidate-data-field",textField:"draft-candidate-text-field"},a)};MyTransition.prototype.labelChanged=function(a){this.alias=a};MyTransition.prototype.createMxCell=function(a,b){var c=this.name.split(" ")[1],d=this.designerEditor.myLoadMap.get(c);"fork"!=d.tagName&&"join"!=d.tagName&&"foreach"!=d.tagName||this.designerEditor.myCellMap.get(a).addForkJoin(d.id);if(this.designerEditor.useNewDesigner)return flowUtils.notNull(b.firstElementChild)?b.firstElementChild:b.firstChild;var d=flowUtils.createElement("mxCell"),e=flowUtils.createElement("mxGeometry");d.setAttribute("id",this.id);d.setAttribute("value","");d.setAttribute("edge","1");d.setAttribute("parent","1");d.setAttribute("source",a);d.setAttribute("target",this.designerEditor.myLoadMap.get(c).id);e.setAttribute("relative","1");e.setAttribute("as","geometry");c=this.getmxCellG();if(flowUtils.notNull(c)){var f=flowUtils.createElement("Array");f.setAttribute("as","points");var g=flowUtils.createElement("mxPoint");g.setAttribute("x",c.x);g.setAttribute("y",c.y);f.appendChild(g);e.appendChild(f)}d.appendChild(e);return d};MyTransition.prototype.getG=function(){var a=this.cell.getGeometry();return flowUtils.notNull(a.points)&&0<a.points.length?(a=a.points[0],a.x+","+a.y+",-5,-22"):"-5,-22"};MyTransition.prototype.getmxCellG=function(){var a=this.g.split(",");if(4==a.length){var b={};b.x=a[0];b.y=a[1];return b}return null};MyTransition.prototype.updateGlobalVariable=function(a,b){var c=$("#"+this.id+" select[name\x3d'yin_ru_bian_liang']");c.empty();c.append("\x3coption selected value\x3d'0'\x3e\u5f15\u5165\u53d8\u91cf\x3c/option\x3e");if(0<a.length)for(var d=0;d<a.length;d++)c.append("\x3coption\x3e#{"+a[d].name+"}\x3c/option\x3e")};MyTransition.prototype.observeGlobalVariable=function(){this.processInstance().observers.add(this)};MyTransition.prototype.initEvent=function(){var a=this;$("#"+this.id+" button[name\x3dbtn-add-candidate]").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey);a.candidateSelect=new UserSelect({type:"userSelect",userSelectContainer:"draft-candidate-container",dataField:"draft-candidate-data-field",textField:"draft-candidate-text-field",topId:a.id,processId:b.id,callback:function(a){}})});$("#"+a.id+" select[name\x3d'yin_ru_bian_liang']").on("change",function(){if(0!=this.value){var a=$(this),c=a.parent().parent().siblings("div").find("textarea"),a=0==c.val().length?a.val():c.val()+","+a.val();c.val(a)}});$("#"+a.id+" button[name\x3d'button_chu_fa_gui_ze']").on("click",function(){new TransitionTimeOut({id:a.id,domId:a.id+" #chu_fa_gui_ze",callback:function(a){}})});$("#"+a.id+" button[name\x3d'btn-expr-config']").on("click",function(){var b=a.designerEditor.myCellMap.get(a.designerEditor.processKey),c=$.trim($("#"+b.id).find("#guan_lian_biao_dan").val());new ExprConfig({id:a.id,domId:a.id+" #expr-config-value-new",globalformid:c,processFlag:!1,process:b,callback:function(a){}})})};MyTransition.prototype.createConditionDom=function(a,b,c){var d=this;$(c).children("conditions").each(function(){var c=$(this).attr("type");$("#"+d.id).find("#"+a).val(c);var f=$("#"+d.id).find("#"+b).find("tbody");$(this).children("condition").each(function(a){a=$(this).attr("type");var b=$(this).attr("computeRes"),c=$(this).text();null!=b&&""!=b?EventThatInsertStartConditionContentIntoTableWhenInit(f,a,$("\x3cinput value\x3d'"+b+"'longJson\x3d'"+c+"'/\x3e")):EventThatInsertStartConditionContentIntoTableWhenInit(f,a,$("\x3cinput value\x3d'"+c+"'/\x3e"))})})};MyTransition.prototype.modifyStartCondition=function(a){a=$(a);var b=a.parent().parent(),c="expr"==b.find("td:eq(1)").text().toLowerCase()?0:1,d=b.find("td:eq(2)");a.find("div[name\x3d'demoCont'] ul").find("li:eq("+c+")").click();a=a.parents("table[name\x3dtable-executor]").parent().parent();this.changeStartConditionTab(a.find("ul:eq(0)").find("li").eq(c));a.find("ul:eq(1)").find("li").eq(c).find(0==c?"textarea":"input").val(d.text().trim());a=a.find("ul:eq(1)").find("li").eq(c).find("button[name\x3d'btn-add-start-condition']");var e=a.clone(!0);a.off("click").text("\u4fdd\u5b58").on("click",function(){var a=0==c?$(this).parent().parent().parent().find("textarea"):$(this).parent().parent().parent().find("input");a&&0!=a.val().length?(d.text(a.val()),a.val(""),$(this).replaceWith(e)):alert("\u60a8\u8fd8\u6ca1\u8f93\u5165\u5185\u5bb9");return!1})};MyTransition.prototype.changeStartConditionTab=function(a){a=$(a);a.addClass("active").siblings("li").removeClass("active").parent(".global-attrs-tab").siblings(".tab-cont").find("\x3eli:eq("+a.index()+")").addClass("active").siblings("li").removeClass("active");a.find("input").prop("checked",!0)};MyTransition.prototype.saveTimeOutXml=function(a){var b=$("#"+this.id+" #chu_fa_gui_ze").val();if(""!=b){var c=flowUtils.createElement("timer");c.setAttribute("duedate",b);a.appendChild(c)}};MyTransition.prototype.createTimeOutDom=function(a){a=$(a).children("timer");null!=a&&0<a.length&&(a=a[0].getAttribute("duedate"),$("#"+this.id+" #chu_fa_gui_ze").val(a))};function MyWs(a,b){MyBase.call(this,a,b,"ws");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_webservice.png;"}MyWs.prototype=new MyBase;MyWs.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getWs();this.labelChanged(this.name);this.initJBXX();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-ws-node");this.initEvent()};MyWs.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setWs(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.initEvent();this.nodeEvent=new NodeEvent(this.designerEditor,this.id,"avic-digital-event-ws-node");this.nodeEvent.setEventDom(a);$("#"+this.id+" #inputValueBackVar").val(this.getAttr(a,"var"));$("#"+this.id+" #inputTextBackVar").val(this.getAttr(a,"var"));$("#"+this.id+" #jgzhl").val(this.getAttr(a,"resultConvertClass"));$("#"+this.id+" #dingzhishixian").val(this.getMeta(a,"wsClient"));"true"==$.trim(this.getMeta(a,"sync"))&&$("#"+this.id+" #shifoutongbu").trigger("click");var c=this.getAttr(a,"serviceId");flowUtils.notNull(c)?($("#"+this.id+" #serviceId").val(c),$("#"+this.id+" #serviceName").val(this.getAttr(a,"serviceName")),$("#"+this.id+" #serviceType").val(this.getAttr(a,"serviceType")),"restful"==this.getAttr(a,"serviceType")?($("#"+this.id+" #paramType").val(this.getAttr(a,"paramType")),"text"==this.getAttr(a,"paramType")?($("#"+this.id+" #paramTableDiv").hide(),$("#"+this.id+" table[name\x3d'methodParamsTable'] tbody").empty(),$("#"+this.id+" #paramTextDiv").attr("style","display:block;"),this.setParamText(a)):($("#"+this.id+" #paramTableDiv").attr("style","display:block;"),$("#"+this.id+" #paramTextDiv").hide(),this.setParamTable(a))):($("#"+this.id+" #paramTableDiv").attr("style","display:block;"),$("#"+this.id+" #paramTextDiv").hide(),this.setParamTable(a)),this.hiddenServiceItems()):($("#"+this.id+" #fuwudizhi").val(this.getAttr(a,"url")),$("#"+this.id+" #zhixingfangfa").val(this.getAttr(a,"method")),$("#"+this.id+" #yonghuming").val(this.getMeta(a,"accessUser")),$("#"+this.id+" #mima").val(this.getMeta(a,"accessPwd")));this.methodClass.getDom(a)};MyWs.prototype.getOtherAttr=function(a){this.nodeEvent.setEventXml(a,"");this.putAttr("url",$("#"+this.id+" #fuwudizhi").val(),a);this.putAttr("method",$("#"+this.id+" #zhixingfangfa").val(),a);this.putAttr("var",$("#"+this.id+" #inputValueBackVar").val(),a);this.putAttr("serviceId",$("#"+this.id+" #serviceId").val(),a);this.putAttr("serviceName",$("#"+this.id+" #serviceName").val(),a);this.putAttr("serviceType",$("#"+this.id+" #serviceType").val(),a);this.putAttr("paramType",$("#"+this.id+" #paramType").val(),a);this.putAttr("paramText",$("#"+this.id+" #paramText").val(),a);this.getParamTextValues(a);this.putAttr("resultConvertClass",$("#"+this.id+" #jgzhl").val(),a);this.addMeta("accessUser",$("#"+this.id+" #yonghuming").val(),a);this.addMeta("accessPwd",$("#"+this.id+" #mima").val(),a);this.addMeta("wsClient",$("#"+this.id+" #dingzhishixian").val(),a);this.addMeta("error","break",a);this.addMeta("sync",$("#"+this.id+" #shifoutongbu").is(":checked"),a);this.methodClass.getXml(a);this.getParamValues(a)};MyWs.prototype.initEvent=function(){var a=this;$("#"+a.id+" button[name\x3d'button-BackVar']").on("click",function(){var b=null,c=a.designerEditor.myCellMap.values();$.each(c,function(a,c){"process"==c.tagName&&(b=c)});new ProcessVariable({dataDomId:a.id+" #inputValueBackVar",showDomId:a.id+" #inputTextBackVar",callback:function(b){b=b[0];$("#"+a.id+" #inputValueBackVar").val(b.name);$("#"+a.id+" #inputTextBackVar").val(b.name)},process:b,multiple:!1})});a.methodClass=new MethodAndClass({id:a.id,buttonId:"buttonAddMethodClass",tableId:a.id+" #table-flow-add-methodClass",type:"arg",callback:function(a){}});$("#"+this.id+" button[name\x3dserviceSelect]").on("click",function(){a.serviceSelect=new WebService({selectContainer:"webservice-container",dataField:"serviceId",textField:"serviceName",topId:a.id,processId:process.id,callback:function(b,c){a.hiddenServiceItems();$("#"+a.id+" #serviceType").val(b);if("restful"==b)if($("#"+a.id+" #paramType").val(c.paramType),"text"==c.paramType){$("#"+a.id+" #paramTableDiv").hide();$("#"+a.id+" table[name\x3d'methodParamsTable'] tbody").empty();$("#"+a.id+" #paramTextDiv").attr("style","display:block;");$("#"+a.id+" #paramTextValueType").val("text");$("#"+a.id+" input[name\x3d'paramTextValueTypeCheck']").prop("checked",!1);var d=a.getFieldsSelectHtml();$("#"+a.id+" #selectFieldDiv").empty();$("#"+a.id+" #selectFieldDiv").append(d);$("#"+a.id+" #selectFieldDiv").find("select[name\x3d'field']").hide();$("#"+a.id+" #paramTextDiv").find("#paramText").attr("style","display:block;");$("#"+a.id+" input[name\x3d'paramTextValueTypeCheck']").on("change",function(){$(this).is(":checked")?($("#"+a.id+" #paramTextValueType").val("select"),$(this).parent().find(" select[name\x3d'field']").attr("style","display:block;"),$(this).parent().find(" #paramText").hide()):($("#"+a.id+" #paramTextValueType").val("text"),$(this).parent().find("select[name\x3d'field']").hide(),$(this).parent().find("#paramText").attr("style","display:block;"))})}else $("#"+a.id+" #paramTableDiv").attr("style","display:block;"),$("#"+a.id+" #paramTextDiv").hide(),$("#"+a.id+" #paramText").val(),a.initParamTable(c,"methodParamsTable");else $("#"+a.id+" #paramTableDiv").attr("style","display:block;"),$("#"+a.id+" #paramTextDiv").hide(),a.initParamTable(c,"methodParamsTable")}})})};MyWs.prototype.hiddenServiceItems=function(){$("#"+this.id+" #fuwudizhi").attr("disabled",!0);$("#"+this.id+" #zhixingfangfa").attr("disabled",!0);$("#"+this.id+" #yonghuming").attr("disabled",!0);$("#"+this.id+" #mima").attr("disabled",!0)};MyWs.prototype.initParamTable=function(a,b){var c=a.paramName;if(null!=c&&""!=c){var c=c.split(","),d=$("#"+this.id+" table[name\x3d'"+b+"'] tbody");$("#"+this.id+" table[name\x3d'"+b+"'] tbody tr").remove();for(var e=this.getFieldsSelectHtml(),f=0;f<c.length;f++){var g=$("\x3ctr\x3e\x3c/tr\x3e"),h=$("\x3ctd width\x3d'30%'\x3e\x3c/td\x3e");h.append(c[f]);g.append(h);var h=$("\x3ctd\x3e\x3c/td\x3e"),k="\x3cinput type\x3d'text' class\x3d'form-control' name\x3d'"+c[f]+"' value\x3d'' title\x3d'"+c[f]+"'/\x3e";h.append("\x3cinput type\x3d'hidden' name\x3d'valueType' \x3e");h.append("\x3cinput type\x3d'checkbox' name\x3d'valueTypeCheck' /\x3e\x26nbsp;\u9009\u62e9");h.append(k);h.append(e);h.find("input[type\x3d'checkbox']").on("change",function(){$(this).is(":checked")?($(this).parent().find("input[type\x3d'hidden']").val("select"),$(this).parent().find("input[type\x3d'text']").hide(),$(this).parent().find("select[name\x3d'field']").attr("style","display:block;")):($(this).parent().find("input[type\x3d'hidden']").val("text"),$(this).parent().find("input[type\x3d'text']").attr("style","display:block;"),$(this).parent().find("select[name\x3d'field']").hide())});g.append(h);d.append(g)}}};MyWs.prototype.getParamValues=function(a){$("#"+this.id+" #methodParamsTable input").each(function(){if("text"==this.type){var b=this.name,c=this.value,d=flowUtils.createElement("param");d.setAttribute("name",b);d.setAttribute("value",c);b=$(this).parent().find("input[name\x3d'valueType']");flowUtils.notNull(b)?"select"==b.val()?(d.setAttribute("valueType","select"),b=$(this).parent().find("select[name\x3d'field']").find("option:selected"),c=b.attr("fieldType"),d.setAttribute("fieldType",c),c=b.attr("fieldId"),d.setAttribute("fieldId",c),c=b.attr("fieldName"),d.setAttribute("fieldName",c),c=b.attr("colType"),d.setAttribute("colType",c),c=b.attr("formId"),d.setAttribute("formId",c),b=b.attr("tableName"),d.setAttribute("tableName",b)):d.setAttribute("valueType","text"):d.setAttribute("valueType","text");a.appendChild(d)}})};MyWs.prototype.getParamTextValues=function(a){if("text"==$("#"+this.id+" #paramType").val())if("select"==$("#"+this.id+" #paramTextValueType").val()){this.putAttr("paramTextValueType","select",a);var b=flowUtils.createElement("paramText"),c=$("#"+this.id+" #selectFieldDiv select[name\x3d'field']").find("option:selected"),d=c.attr("fieldType");b.setAttribute("fieldType",d);d=c.attr("fieldId");b.setAttribute("fieldId",d);d=c.attr("fieldName");b.setAttribute("fieldName",d);d=c.attr("colType");b.setAttribute("colType",d);d=c.attr("formId");b.setAttribute("formId",d);c=c.attr("tableName");b.setAttribute("tableName",c);a.appendChild(b)}else this.putAttr("paramTextValueType","text",a)};MyWs.prototype.setParamText=function(a){var b=this,c=b.getAttr(a,"paramTextValueType"),d=b.getFieldsSelectHtml();$("#"+b.id+" #selectFieldDiv").append(d);"select"==c?($("#"+b.id+"#paramTextValueType").val("select"),$("#"+b.id+" #paramText").hide(),$("#"+b.id+" select[name\x3d'field']").attr("style","display:block;"),$("#"+b.id+" input[name\x3d'paramTextValueTypeCheck']").prop("checked",!0),$(a).children("paramText")&&$(a).children("paramText").length&&$(a).children("paramText").each(function(){var a=$.trim(this.getAttribute("fieldId"));$("#"+b.id+" select[name\x3d'field']").find("option:contains('"+a+"')").attr("selected",!0)})):($("#"+b.id+"#paramTextValueType").val("text"),$("#"+b.id+" #paramText").val(b.getAttr(a,"paramText")),$("#"+b.id+" select[name\x3d'field']").hide(),$("#"+b.id+" #paramText").attr("style","display:block;"),$("#"+b.id+" input[name\x3d'paramTextValueTypeCheck']").prop("checked",!1));$("#"+b.id+" input[name\x3d'paramTextValueTypeCheck']").on("change",function(){$(this).is(":checked")?($("#"+b.id+" #paramTextValueType").val("select"),$(this).parent().find(" select[name\x3d'field']").attr("style","display:block;"),$(this).parent().find(" #paramText").hide()):($("#"+b.id+" #paramTextValueType").val("text"),$(this).parent().find("select[name\x3d'field']").hide(),$(this).parent().find("#paramText").attr("style","display:block;"))})};MyWs.prototype.setParamTable=function(a){var b=$("#"+this.id+" table[name\x3d'methodParamsTable'] tbody");if($(a).children("param")&&$(a).children("param").length){var c=this.getFieldsSelectHtml();$(a).children("param").each(function(){var a=$.trim(this.getAttribute("name")),e=$.trim(this.getAttribute("value")),f=this.getAttribute("valueType");this.getAttribute("fieldType");var g=this.getAttribute("fieldId");this.getAttribute("fieldName");this.getAttribute("colType");this.getAttribute("formId");this.getAttribute("tableName");var h=$("\x3ctr\x3e\x3c/tr\x3e"),k=$("\x3ctd width\x3d'30%'\x3e\x3c/td\x3e");k.append(a);h.append(k);var k=$("\x3ctd\x3e\x3c/td\x3e"),l="";"select"==f&&(l="checked");l="\x3cinput type\x3d'checkbox' name\x3d'valueTypeCheck' "+l+"/\x3e\x26nbsp;\u9009\u62e9\x26nbsp;";a="\x3cinput type\x3d'text' class\x3d'form-control' name\x3d'"+a+"' value\x3d'"+e+"' title\x3d'"+a+"'/\x3e";k.append("\x3cinput type\x3d'hidden' name\x3d'valueType' value\x3d'"+f+"'\x3e");k.append(l);k.append(a);k.append(c);"select"==f?(k.find("input[type\x3d'text']").hide(),k.find("select[name\x3d'field']").attr("style","display:block;"),k.find("select[name\x3d'field']").find("option:contains('"+g+"')").attr("selected",!0)):(k.find("input[type\x3d'text']").attr("style","display:block;"),k.find("select[name\x3d'field']").hide());k.find("input[type\x3d'checkbox']").on("change",function(){$(this).is(":checked")?($(this).parent().find("input[type\x3d'hidden']").val("select"),$(this).parent().find("input[type\x3d'text']").hide(),$(this).parent().find("select[name\x3d'field']").attr("style","display:block;")):($(this).parent().find("input[type\x3d'hidden']").val("text"),$(this).parent().find("input[type\x3d'text']").attr("style","display:block;"),$(this).parent().find("select[name\x3d'field']").hide())});h.append(k);b.append(h)})}};MyWs.prototype.getFieldsSelectHtml=function(){var a=this.designerEditor.myCellMap.get(this.designerEditor.processKey),b=$.trim($("#"+a.id).find("#guan_lian_biao_dan").val()),c="",c=c+'\x3cselect class\x3d"form-control input-sm"  name\x3d"field"  title\x3d""  style\x3d"display: none;"\x3e',c=c+'\x3coption value\x3d""\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u8bf7\u9009\u62e9\x3c/option\x3e',c=c+"\x3coptgroup label\x3d'\u6d41\u7a0b\u5e38\u91cf'\x3e\x3c/optgroup\x3e",c=c+("\x3coption value\x3d'currPerfomer'  formId\x3d'"+b+"' fieldType\x3d'4' fieldId\x3d'currPerfomer' fieldName\x3d'\u5f53\u524d\u8282\u70b9\u5904\u7406\u4eba' colType\x3d'string'\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u5f53\u524d\u8282\u70b9\u5904\u7406\u4eba\x3c/option\x3e"),c=c+("\x3coption value\x3d'currPerfomerCurrDept'  formId\x3d'"+b+"' fieldType\x3d'4' fieldId\x3d'currPerfomerCurrDept' fieldName\x3d'\u5f53\u524d\u8282\u70b9\u5904\u7406\u4eba' colType\x3d'string'\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u8282\u70b9\u5904\u7406\u4eba\u5f53\u524d\u90e8\u95e8\x3c/option\x3e"),c=c+("\x3coption value\x3d'starter'  formId\x3d'"+b+"' fieldType\x3d'4' fieldId\x3d'starter' fieldName\x3d'\u62df\u7a3f\u4eba' colType\x3d'string'\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u62df\u7a3f\u4eba\x3c/option\x3e"),c=c+("\x3coption value\x3d'starterCurrDept'  formId\x3d'"+b+"' fieldType\x3d'4' fieldId\x3d'starterCurrDept' fieldName\x3d'\u62df\u7a3f\u4eba\u90e8\u95e8' colType\x3d'string'\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u62df\u7a3f\u4eba\u90e8\u95e8\x3c/option\x3e"),c=c+("\x3coption value\x3d'processInstanceId'  formId\x3d'"+b+"' fieldType\x3d'4' fieldId\x3d'processInstanceId' fieldName\x3d'\u6d41\u7a0b\u5b9e\u4f8bID' colType\x3d'string'\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u6d41\u7a0b\u5b9e\u4f8bID\x3c/option\x3e"),c=c+("\x3coption value\x3d'formId'  formId\x3d'"+b+"' fieldType\x3d'4' fieldId\x3d'formId' fieldName\x3d'\u8868\u5355ID' colType\x3d'string'\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u8868\u5355ID\x3c/option\x3e"),c=c+("\x3coption value\x3d'processDefId'  formId\x3d'"+b+"' fieldType\x3d'4' fieldId\x3d'processDefId' fieldName\x3d'\u6d41\u7a0b\u5b9a\u4e49ID' colType\x3d'string'\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u6d41\u7a0b\u5b9a\u4e49ID\x3c/option\x3e"),c=c+("\x3coption value\x3d'activityName'  formId\x3d'"+b+"' fieldType\x3d'4' fieldId\x3d'activityName' fieldName\x3d'\u5f53\u524d\u8282\u70b9\u540d\u79f0' colType\x3d'string'\x3e\x26nbsp;\x26nbsp;\x26nbsp;\u5f53\u524d\u8282\u70b9\u540d\u79f0\x3c/option\x3e");avicAjax.ajax({url:"platform/bpm/designer/getProcessFormFieldsForVar",data:"globalformid\x3d"+b,type:"post",async:!1,dataType:"json",success:function(a){var d=null;flowUtils.notNull(a.fields)&&(d=JSON.parse(a.fields));if(flowUtils.notNull(d)){c+="\x3coptgroup label\x3d'\u4e3b\u8868\u5b57\u6bb5'\x3e\x3c/optgroup\x3e";for(var f=0;f<d.length;f++){var g=a.tableName;d[f].domdataId&&(g="@"+d[f].tableName);c+="\x3coption value\x3d'"+d[f].colName+"'  colType\x3d'"+d[f].colType+"' fieldType\x3d'2' fieldId\x3d'"+d[f].colName+"' fieldName\x3d'"+d[f].colLabel+"' formId\x3d'"+b+"' tableName\x3d'"+g+"'\x3e\x26nbsp;\x26nbsp;\x26nbsp;"+d[f].colLabel+"("+d[f].colName+")\x3c/option\x3e"}}d=a.subFieldsMap;if(flowUtils.notNull(d))for(var h in d)if(f="\u5b50\u8868\u5b57\u6bb5("+h+")",g=d[h],null!=g&&""!=g)for(g=JSON.parse(g),0<g.length&&(c+="\x3coptgroup label\x3d'"+f+"'\x3e\x3c/optgroup\x3e"),f=0;f<g.length;f++)c+="\x3coption value\x3d'"+g[f].colName+"'  subFlag\x3d'true' colType\x3d'"+g[f].colType+"' fieldType\x3d'3' fieldId\x3d'"+g[f].colName+"' fieldName\x3d'"+g[f].colLabel+"' tableName\x3d'"+h+"' formId\x3d'"+b+"' mainTableName\x3d'"+a.tableName+"' fieldShowType\x3d'"+g[f].elementType+"'\x3e\x26nbsp;\x26nbsp;\x26nbsp;"+g[f].colLabel+"("+g[f].colName+")\x3c/option\x3e"}});return c+="\x3c/select\x3e"};function MyRules(a,b){MyBase.call(this,a,b,"rules");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_rule.png;"}MyRules.prototype=new MyBase;MyRules.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getRules();this.labelChanged(this.name);this.initJBXX()};MyRules.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setRules(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this);this.setDomValByMeta("rulesPath",a,"rulesPath")};MyRules.prototype.getOtherAttr=function(a){this.setXmlMetaByVal("rulesPath",a,"rulesPath")};function MyText(a,b){MyBase.call(this,a,b,"text")}MyText.prototype=new MyBase;MyText.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getText();this.labelChanged("\u6dfb\u52a0\u6587\u672c");this.initJBXX()};MyText.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setText(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this)};MyText.prototype.getOtherAttr=function(a){};MyText.prototype.afterShowProp=function(){var a=this.getCell(),b=this.designerEditor.getStyleValue("fontColor",a);b&&$("#"+this.id).find("#textColor").val(b);(a=this.designerEditor.getStyleValue("fontSize",a))&&$("#"+this.id).find("#textSize").val(a+"")};function MyRest(a,b){MyBase.call(this,a,b,"rest");this.style="symbol;image\x3davicit/platform6/bpmreform/bpmdesigner/editors/images/48/task_rest.png;"}MyRest.prototype=new MyBase;MyRest.prototype.init=function(){this.initBase();this.name=this.tagName+this.designerEditor.countUtils.getRest();this.labelChanged(this.name);this.initJBXX()};MyRest.prototype.initLoad=function(a,b){this.initBase();this.name=a.getAttribute("name");this.alias=$.trim(a.getAttribute("alias"));this.g=a.getAttribute("g");this.designerEditor.countUtils.setRest(this.resolve());this.initJBXX();b.appendChild(this.createMxCell(a));this.designerEditor.myLoadMap.put(this.name,this)};MyRest.prototype.getOtherAttr=function(a){};function DesignerEditor(){}DesignerEditor.prototype.editor=null;DesignerEditor.prototype.setEditor=function(a){this.editor=a};DesignerEditor.prototype.myCellMap=null;DesignerEditor.prototype.processKey=null;DesignerEditor.prototype.myLoadMap=null;DesignerEditor.prototype.countUtils=null;DesignerEditor.prototype.myCurCellId=null;DesignerEditor.prototype.homeDiv=null;DesignerEditor.prototype.profileDiv=null;DesignerEditor.prototype.controlPath="platform/bpm/designer/";DesignerEditor.prototype.useNewDesigner=!1;DesignerEditor.prototype.swimlane1=0;DesignerEditor.prototype.swimlane2=0;DesignerEditor.prototype.allowSave=!0;DesignerEditor.prototype.isUflow=!1;DesignerEditor.prototype.init=function(){var a=this;this.myCellMap=new Map;this.myLoadMap=new Map;this.countUtils=new CountUtils;this.homeDiv=$("#homeDiv");this.profileDiv=$("#profileDiv");if(3==_type){this.processKey=_id;var b=new MyProcess(this,this.processKey);b.init();this.myCellMap.put(this.processKey,b);flowUtils.notNull(_name)&&(b.alias=_name,$("#"+this.processKey).find("#liu_cheng_ming_cheng").val(_name));if("1"==_isUflow&&flowUtils.notNull(_swimlane)){_swimlane=$.trim(_swimlane);_swimlane=_swimlane.replaceAll("\uff0c",",");_swimlane=_swimlane.replaceAll(" ",",");for(var b=_swimlane.split(","),c=this.editor.templates.swimlane1,d=this.editor.templates.start,e=this.editor.templates.task,f=this.editor.templates.end,d=this.editor.graph.cloneCells([d])[0],f=this.editor.graph.cloneCells([f])[0],g=null,h=0;h<b.length;h++)if(flowUtils.notNull(b[h])){var k=this.editor.graph.cloneCells([c])[0];this.editor.addVertex(null,k,10,10+110*h);$("#"+k.id).find("#xian_shi_ming_cheng").val(b[h]);this.myCellMap.get(k.id).labelChanged(b[h]);0==h&&this.editor.addVertex(k,d,k.getGeometry().x+50,k.getGeometry().y+(k.getGeometry().height-d.getGeometry().height)/2);var l=this.editor.graph.cloneCells([e])[0];this.editor.addVertex(k,l,d.getGeometry().x+d.getGeometry().width+60,k.getGeometry().y+(k.getGeometry().height-l.getGeometry().height)/2);$("#"+l.id).find("#xian_shi_ming_cheng").val(b[h]);this.myCellMap.get(l.id).labelChanged(b[h]);null==g?(this.editor.graph.addEdge(this.editor.createEdge(d,l),null,d,l),this.editor.graph.selectVertices(k),this.editor.execute("alignCellsMiddle"),this.editor.execute("selectNone")):this.editor.graph.addEdge(this.editor.createEdge(g,l),null,g,l);g=l;h==b.length-1&&(this.editor.addVertex(k,f,l.getGeometry().x+l.getGeometry().width+60,k.getGeometry().y+(k.getGeometry().height-f.getGeometry().height)/2),this.editor.graph.addEdge(this.editor.createEdge(l,f),null,l,f),this.editor.graph.selectVertices(k),this.editor.execute("alignCellsMiddle"),this.editor.execute("selectNone"))}this.editor.execute("autoLayout")}"2"==_isUflow&&(d=this.editor.templates.start,e=this.editor.templates.task,f=this.editor.templates.end,d=this.editor.graph.cloneCells([d])[0],this.editor.addVertex(null,d,30,30),l=this.editor.graph.cloneCells([e])[0],this.editor.addVertex(null,l,d.getGeometry().x+d.getGeometry().width+30,30),$("#"+l.id).find("#xian_shi_ming_cheng").val("\u8282\u70b91"),this.myCellMap.get(l.id).labelChanged("\u8282\u70b91"),f=this.editor.graph.cloneCells([f])[0],this.editor.addVertex(null,f,l.getGeometry().x+l.getGeometry().width+30,30),this.editor.graph.addEdge(this.editor.createEdge(d,l),null,d,l),b=this.editor.graph.addEdge(this.editor.createEdge(l,f),null,l,f),$("#"+b.id).find("#xian_shi_ming_cheng").val("\u7ed3\u675f\u6d41\u7a0b"),this.myCellMap.get(b.id).labelChanged("\u7ed3\u675f\u6d41\u7a0b"),this.editor.execute("selectAll"),this.editor.execute("alignCellsMiddle"),this.editor.execute("selectNone"))}else avicAjax.ajax({type:"POST",data:{id:_id,type:_type,pdId:_pdId,deployId:_deployId,_iconType:_iconType},url:this.controlPath+"getProcessXml?date\x3d"+(new Date).getTime(),dataType:"json",success:function(b){if(flowUtils.notNull(b.processXml)){b=mxUtils.parseXml(b.processXml);_oldProcess=b.getElementsByTagName("process")[0];b=a.converToGraphXml(b);a.editor.readGraphModel(b);var c=null;b=a.myCellMap.values();$.each(b,function(a,b){if("process"==b.tagName)return c=b,!1});null!=c&&c.notify()}else flowUtils.error("\u67e5\u4e0d\u5230\u5bf9\u5e94\u6d41\u7a0b\u6587\u4ef6")}});"2"==_isUflow&&(this.isUflow=!0);this.isUflow&&(this.editor.graph.cellsLocked=!0,$("#toolbar_div").hide(),$("#graph").css("left","5px"))};DesignerEditor.prototype.createBaseByTagName=function(a,b,c,d){var e=null;c?"start"==a?e=new MyStart(this,b):"end"==a?e=new MyEnd(this,b):"task"==a?e=new MyTask(this,b):"java"==a?e=new MyJava(this,b):"sql"==a?e=new MySql(this,b):"ws"==a?e=new MyWs(this,b):"state"==a?e=new MyState(this,b):"fork"==a?e=new MyFork(this,b):"join"==a?e=new MyJoin(this,b):"decision"==a?e=new MyExclusive(this,b):"sub-process"==a?e=new MySubprocess(this,b):"foreach"==a?e=new MyForeach(this,b):"jms"==a?e=new MyJms(this,b):"custom"==a?e=new MyCustom(this,b):"rules"==a?e=new MyRules(this,b):"swimlane"==a?e=new MySwimlane(this,b):"text"==a?e=new MyText(this,b):"rest"==a&&(e=new MyRest(this,b)):d&&(e=new MyTransition(this,b));return e};DesignerEditor.prototype.isSwimlane1=function(a){return"swimlane1"==a.getAttribute("cellType")};DesignerEditor.prototype.addCell=function(a){if(!this.myCellMap.containsKey(a.id)){var b=this.createBaseByTagName(a.value.nodeName,a.id,a.vertex,a.edge);b.init();this.myCellMap.put(a.id,b)}};DesignerEditor.prototype.removeCells=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.myCellMap.get(c.id).remove();this.myCellMap.remove(c.id);"swimlane"==c.value.nodeName&&null!=c.children&&this.removeCells(c.children)}};DesignerEditor.prototype.doubleClickCell=function(a){flowUtils.notNull(a)&&"sub-process"==a.value.nodeName&&this.myCellMap.get(a.id).doubleClickCell()};DesignerEditor.prototype.showProcess=function(){var a=this.myCellMap.get(this.processKey).getXmlDoc();a.setAttribute("useNewDesigner","true");a.setAttribute("iconType",_iconType);a.setAttribute("isUflow",_isUflow);for(var b=new Map,c=this.myCellMap.values(),d=0;d<c.length;d++){var e=c[d];if("transition"==e.tagName){var f=e.getCell().source.id;if(b.containsKey(f))b.get(f).push(e.getXmlDoc());else{var g=[];g.push(e.getXmlDoc());b.put(f,g)}}}for(var h=f=0,k=0,d=0;d<c.length;d++){e=c[d];g=e.getCell();if("start"==e.tagName&&(f++,"true"!=_needfirstuser&&g.edges&&0<g.edges.length)){var l=$("#"+g.edges[0].target.id+" #draft-candidate-data-field").val();if(0<l.length&&0<JSON.parse(l).length){this.allowSave=!1;flowUtils.warning("\u62df\u7a3f\u8282\u70b9\u4e0d\u5e94\u8be5\u914d\u7f6e\u53c2\u4e0e\u8005");return}}"end"==e.tagName&&h++;"task"==e.tagName&&k++;if("process"!=e.tagName&&"transition"!=e.tagName){if("swimlane"!=e.tagName&&"text"!=e.tagName&&(!g.edges||0==g.edges.length)){this.allowSave=!1;flowUtils.warning("\u4e0d\u5e94\u6709\u5b64\u7acb\u7684\u6d41\u7a0b\u8282\u70b9");return}l=e.getXmlDoc();if(b.containsKey(e.id))for(g=b.get(e.id),j=0;j<g.length;j++)l.appendChild(g[j]);a.appendChild(l)}}if(0==f||0==h||0==k)this.allowSave=!1,flowUtils.warning("\u6d41\u7a0b\u6587\u4ef6\u81f3\u5c11\u5e94\u5305\u542b\u5f00\u59cb\u8282\u70b9\u3001\u7ed3\u675f\u8282\u70b9\u548c\u4e00\u4e2a\u4eba\u5de5\u8282\u70b9");else return this.getPrettyXml(a)};DesignerEditor.prototype.cycleTags=function(a,b,c,d){b=b.getElementsByTagName(a);for(var e=0;e<b.length;e++)if("text"!=a||flowUtils.notNull(b[e].getAttribute("id"))){var f=this.countUtils.getSelfId();this.useNewDesigner&&(f=b[e].getAttribute("id"),this.countUtils.setSelfId(Number(f)));var g=this.createBaseByTagName(a,f,1,0);g.initLoad(b[e],c);this.myCellMap.put(f,g);for(var g=b[e].getElementsByTagName("transition"),h=0;h<g.length;h++){var k={};k.xml=g[h];k.sourceId=f;d.push(k)}}};DesignerEditor.prototype.converToGraphXml=function(a){var b=a.getElementsByTagName("process")[0];this.processKey=b.getAttribute("key");this.useNewDesigner="true"==b.getAttribute("useNewDesigner")?!0:!1;a=new MyProcess(this,this.processKey);a.initLoad(b);this.myCellMap.put(this.processKey,a);a=flowUtils.createElement("mxGraphModel");var c=flowUtils.createElement("root"),d=flowUtils.createElement("Workflow");d.setAttribute("id","0");var e=flowUtils.createElement("mxCell");d.appendChild(e);e=flowUtils.createElement("Layer");e.setAttribute("id","1");var f=flowUtils.createElement("mxCell");f.setAttribute("parent","0");e.appendChild(f);c.appendChild(d);c.appendChild(e);d=[];this.cycleTags("swimlane",b,c,d);this.cycleTags("start",b,c,d);this.cycleTags("end",b,c,d);this.cycleTags("task",b,c,d);this.cycleTags("java",b,c,d);this.cycleTags("sql",b,c,d);this.cycleTags("ws",b,c,d);this.cycleTags("state",b,c,d);this.cycleTags("fork",b,c,d);this.cycleTags("join",b,c,d);this.cycleTags("decision",b,c,d);this.cycleTags("sub-process",b,c,d);this.cycleTags("foreach",b,c,d);this.cycleTags("jms",b,c,d);this.cycleTags("custom",b,c,d);this.cycleTags("rules",b,c,d);this.cycleTags("text",b,c,d);this.cycleTags("rest",b,c,d);for(b=0;b<d.length;b++)e=this.countUtils.getSelfId(),this.useNewDesigner&&(e=d[b].xml.getAttribute("_id"),this.countUtils.setSelfId(Number(e))),f=new MyTransition(this,e),f.initLoad(d[b].xml,c,d[b].sourceId),this.myCellMap.put(e,f);a.appendChild(c);return a};DesignerEditor.prototype.saveToNew_xml=function(){var a=this.getPostData();if(flowUtils.notNull(a)){var b=this;a.type="3";flowUtils.confirm("\u786e\u5b9a\u4fdd\u5b58\u4e3a\u65b0\u7248\u672c\uff1f",function(){avicAjax.ajax({url:b.controlPath+"saveFlowModel",type:"POST",data:a,datatype:"json",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):flowUtils.success("\u4fdd\u5b58\u4e3a\u65b0\u7248\u672c\u6210\u529f\uff01\u9875\u9762\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindow();flowUtils.notNull(_processDataSynJs)&&""!=_pdId&&saveWaProcessSynConfigLog(_oldProcess,_newProcess)},!0)}})})}};DesignerEditor.prototype.save_xml=function(){var a=this.getPostData();if(flowUtils.notNull(a)){var b=this;flowUtils.confirm(this.validDelNodeFlg()?"\u786e\u5b9a\u4fdd\u5b58\uff1f":"\u672c\u6b21\u7f16\u8f91\u6709\u8282\u70b9\u88ab\u5220\u9664\uff0c\u53ef\u80fd\u4f1a\u5f71\u54cd\u73b0\u6709\u6b63\u5728\u8fd0\u884c\u7684\u6570\u636e\uff0c\u786e\u5b9a\u4fdd\u5b58\u5e76\u8986\u76d6\u73b0\u6709\u6d41\u7a0b\u7248\u672c\u5417\uff1f",function(){avicAjax.ajax({url:b.controlPath+"saveFlowModel",type:"POST",data:a,datatype:"json",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):(flowUtils.success("\u4fdd\u5b58\u6210\u529f"),flowUtils.refreshBack(),flowUtils.notNull(_processDataSynJs)&&""!=_pdId&&(b=mxUtils.parseXml(a.flow_xml).getElementsByTagName("process")[0],saveWaProcessSynConfigLog(_oldProcess,b)))}})})}};DesignerEditor.prototype.send_xml=function(){var a=this.getPostData();if(flowUtils.notNull(a)){var b=this;a.sendXml="true";flowUtils.confirm("\u786e\u5b9a\u4fdd\u5b58\u5e76\u53d1\u5e03\u5417\uff1f",function(){avicAjax.ajax({url:b.controlPath+"saveFlowModel",type:"POST",data:a,datatype:"json",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):flowUtils.success("\u4fdd\u5b58\u5e76\u53d1\u5e03\u6210\u529f\uff01\u9875\u9762\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindow();flowUtils.notNull(_processDataSynJs)&&""!=_pdId&&saveWaProcessSynConfigLog(_oldProcess,_newProcess)},!0)}})})}};DesignerEditor.prototype.validDelNodeFlg=function(){for(var a=0;a<this.myLoadMap.values().length;a++){var b=this.myLoadMap.values()[a];if(!this.myCellMap.containsKey(b.id))return!1}return!0};DesignerEditor.prototype.getPostData=function(){var a=this.myCellMap.get(this.processKey).alias;if(flowUtils.notNull(a)){this.allowSave=!0;var b={};b.catalogId=_catalog;b.id=_id;b.type=_type;b.flowName=a;b.flowKey=this.processKey;b.flowDesc="";b.pdId=_pdId;b.deployId=_deployId;b.isUflow=_isUflow;a=this.showProcess();if(this.allowSave){var c=this.getImageXml();b.flow_xml=Base64.encode(a);b.png_xml=Base64.encode(c);a=this.editor.graph.getGraphBounds();c=Math.ceil(a.y+a.height+4);b.w=Math.ceil(a.x+a.width+4);b.h=c;return b}}else flowUtils.warning("\u6d41\u7a0b\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a")};DesignerEditor.prototype.validMoveCells=function(a,b,c,d,e,f,g){if(null!=e&&"swimlane"==e.value.nodeName)for(b=0;b<a.length;b++)if("swimlane"==a[b].value.nodeName)return flowUtils.warning("\u6cf3\u9053\u5185\u4e0d\u80fd\u653e\u7f6e\u6cf3\u9053"),!1;return!0};DesignerEditor.prototype.getImageXml=function(){var a=mxUtils.createXmlDocument(),b=a.createElement("output");a.appendChild(b);a=new mxXmlCanvas2D(b);a.converter.setBaseUrl(_bpm_baseurl);(new mxImageExport).drawState(this.editor.graph.getView().getState(this.editor.graph.model.root),a);return mxUtils.getXml(b)};DesignerEditor.prototype.validDeleteCell=function(a,b){return this.isUflow?(flowUtils.warning("\u81ea\u7531\u6d41\u7a0b\u53ea\u80fd\u8c03\u6574\u5e03\u5c40\uff0c\u4e0d\u80fd\u624b\u52a8\u589e\u5220\u8282\u70b9"),!1):!0};DesignerEditor.prototype.validAddCell=function(a,b,c,d,e){if(this.isUflow)return flowUtils.warning("\u81ea\u7531\u6d41\u7a0b\u53ea\u80fd\u8c03\u6574\u5e03\u5c40\uff0c\u4e0d\u80fd\u624b\u52a8\u589e\u5220\u8282\u70b9"),!1;if(a.edge){if("end"==d.value.nodeName)return flowUtils.warning("\u7ed3\u675f\u8282\u70b9\u4e0d\u80fd\u4f5c\u4e3a\u8d77\u70b9"),!1;if("start"==e.value.nodeName)return flowUtils.warning("\u5f00\u59cb\u8282\u70b9\u4e0d\u80fd\u4f5c\u4e3a\u7ec8\u70b9"),!1;if("start"==d.value.nodeName){if("task"!=e.value.nodeName)return flowUtils.warning("\u5f00\u59cb\u8282\u70b9\u53ea\u80fd\u6307\u5411\u4eba\u5de5\u8282\u70b9"),!1;if(d.edges&&0!=d.edges.length)return flowUtils.warning("\u5f00\u59cb\u8282\u70b9\u53ea\u80fd\u6307\u5411\u4e00\u4e2a\u4eba\u5de5\u8282\u70b9"),!1}}else if(a.vertex&&"start"==a.value.nodeName)for(a=this.myCellMap.values(),b=0;b<a.length;b++){if("start"==a[b].tagName)return flowUtils.warning("\u4e0d\u80fd\u6dfb\u52a0\u591a\u4e2a\u5f00\u59cb\u8282\u70b9"),!1}else if(a.vertex&&"swimlane"==a.value.nodeName){if(this.isSwimlane1(a)&&0<this.swimlane2||!this.isSwimlane1(a)&&0<this.swimlane1)return flowUtils.warning("\u6a2a\u5411\u6cf3\u9053\u4e0e\u7eb5\u5411\u6cf3\u9053\u4e0d\u80fd\u6df7\u7528"),!1;if("swimlane"==b.value.nodeName)return flowUtils.warning("\u6cf3\u9053\u5185\u4e0d\u80fd\u653e\u7f6e\u6cf3\u9053"),!1}return!0};DesignerEditor.prototype.validConnectCell=function(a,b,c,d,e){if(this.isUflow)return flowUtils.warning("\u81ea\u7531\u6d41\u7a0b\u53ea\u80fd\u8c03\u6574\u5e03\u5c40\uff0c\u4e0d\u80fd\u624b\u52a8\u6539\u52a8\u8fde\u7ebf"),!1;e=a=null;d?(a=c,e=b.target):(a=b.source,e=c);if("end"==a.value.nodeName)return flowUtils.warning("\u7ed3\u675f\u8282\u70b9\u4e0d\u80fd\u4f5c\u4e3a\u8d77\u70b9"),!1;if("start"==e.value.nodeName)return flowUtils.warning("\u5f00\u59cb\u8282\u70b9\u4e0d\u80fd\u4f5c\u4e3a\u7ec8\u70b9"),!1;if("start"==a.value.nodeName){if("task"!=e.value.nodeName)return flowUtils.warning("\u5f00\u59cb\u8282\u70b9\u53ea\u80fd\u6307\u5411\u4eba\u5de5\u8282\u70b9"),!1;if(a.edges&&0!=a.edges.length)return flowUtils.warning("\u5f00\u59cb\u8282\u70b9\u53ea\u80fd\u6307\u5411\u4e00\u4e2a\u4eba\u5de5\u8282\u70b9"),!1}var f=this.myCellMap.get(b.id);d||f.rename("to "+this.myCellMap.get(e.id).name);setTimeout(function(){f.controlCandidate()},500);return!0};DesignerEditor.prototype.changeSelected=function(){if(null!=this.editor.graph){if(null!=this.myCurCellId){var a=this.editor.graph.getModel().getCell(this.myCurCellId);flowUtils.notNull(a)&&flowUtils.notNull(a.style)&&"0"==a.style.indexOf("symbol")&&this.editor.graph.setCellStyles("imageBorder","",[a])}this.editor.graph.isSelectionEmpty()?($(".prop_wrap").hide(),this.myCurCellId=null,setTimeout(function(){$("#propMainDiv").find(".nav-tabs").find("li").eq(0).trigger("click");$("#propMainDiv").find(".nav-tabs").find("a").eq(1).trigger("blur");$("#toolbar").find("img").eq(0).trigger("click")},100)):(a=this.editor.graph.getSelectionCell(),flowUtils.notNull(a,a.style)&&"0"==a.style.indexOf("symbol")&&this.editor.graph.setCellStyles("imageBorder","green",[a]),this.myCellMap.get(a.id).showProp())}};DesignerEditor.prototype.validUndoCell=function(a,b){for(var c=0;c<b.changes.length;c++)if(b.changes[c].constructor!=mxGeometryChange)return a.clear(),!1;return!0};DesignerEditor.prototype.goLeft=function(a){var b=a.graph.getSelectionCells();flowUtils.notNull(b)&&a.graph.moveCells(b,-1,0)};DesignerEditor.prototype.goUp=function(a){var b=a.graph.getSelectionCells();flowUtils.notNull(b)&&a.graph.moveCells(b,0,-1)};DesignerEditor.prototype.goRight=function(a){var b=a.graph.getSelectionCells();flowUtils.notNull(b)&&a.graph.moveCells(b,1,0)};DesignerEditor.prototype.goDown=function(a){var b=a.graph.getSelectionCells();flowUtils.notNull(b)&&a.graph.moveCells(b,0,1)};DesignerEditor.prototype.autoLayout=function(a){var b=a.graph.getChildVertices();if(flowUtils.notNull(b)){var c={},d=new Map;if(0<this.swimlane1){for(var e=0;e<b.length;e++)if(b[e].vertex&&"swimlane"==b[e].value.nodeName){var f=Number(b[e].getGeometry().y);d.put(f,b[e]);if(!flowUtils.notNull(c.miny)||c.miny>f)c.miny=f;if(!flowUtils.notNull(c.maxy)||c.maxy<f)c.maxy=f}if(1<d.size())for(var b=d.keys(),b=b.sort(function(a,b){return a-b}),g=d.get(b[0]).getGeometry().width,f=d.get(b[0]).getGeometry().x,h=0,e=0;e<b.length;e++)d.get(b[e]).getGeometry().width=g,a.graph.moveCells([d.get(b[e])],1,0),a.graph.moveCells([d.get(b[e])],f-d.get(b[e]).getGeometry().x,c.miny+h-Number(b[e])),h+=d.get(b[e]).getGeometry().height,d.remove(b[e])}else{for(e=0;e<b.length;e++)if(b[e].vertex&&"swimlane"==b[e].value.nodeName){f=Number(b[e].getGeometry().x);d.put(f,b[e]);if(!flowUtils.notNull(c.minx)||c.minx>f)c.minx=f;if(!flowUtils.notNull(c.maxx)||c.maxx<f)c.maxx=f}if(1<d.size())for(b=d.keys(),b=b.sort(function(a,b){return a-b}),g=d.get(b[0]).getGeometry().height,f=d.get(b[0]).getGeometry().y,e=h=0;e<b.length;e++)d.get(b[e]).getGeometry().height=g,a.graph.moveCells([d.get(b[e])],0,1),a.graph.moveCells([d.get(b[e])],c.minx+h-Number(b[e]),f-d.get(b[e]).getGeometry().y),h+=d.get(b[e]).getGeometry().width,d.remove(b[e])}}};DesignerEditor.prototype.changeEdgeStyle1=function(a){var b=a.graph.getSelectionCell();flowUtils.notNull(b)&&b.edge&&a.graph.setCellStyles("edgeStyle","straightEdge",[b]);this.clearWaypoints(a)};DesignerEditor.prototype.changeEdgeStyle2=function(a){var b=a.graph.getSelectionCell();flowUtils.notNull(b)&&b.edge&&a.graph.setCellStyles("edgeStyle",null,[b]);this.clearWaypoints(a)};DesignerEditor.prototype.clearWaypoints=function(a){a=a.graph;var b=a.getSelectionCells();if(null!=b){b=a.addAllEdges(b);a.getModel().beginUpdate();try{for(var c=0;c<b.length;c++){var d=b[c];if(a.getModel().isEdge(d)){var e=a.getCellGeometry(d);null!=e&&(e=e.clone(),e.points=null,a.getModel().setGeometry(d,e))}}}finally{a.getModel().endUpdate()}}};DesignerEditor.prototype.addWayPoint=function(a){var b=a.graph,c=b.getSelectionCell();if(null!=c&&b.getModel().isEdge(c)&&(a=b.selectionCellsHandler.getHandler(c),a instanceof mxEdgeHandler)){for(var d=b.view.translate,e=b.view.scale,f=d.x,d=d.y,c=b.getModel().getParent(c),g=b.getCellGeometry(c);b.getModel().isVertex(c)&&null!=g;)f+=g.x,d+=g.y,c=b.getModel().getParent(c),g=b.getCellGeometry(c);f=Math.round(b.snap(b.popupMenuHandler.triggerX/e-f));b=Math.round(b.snap(b.popupMenuHandler.triggerY/e-d));a.addPointAt(a.state,f,b)}};DesignerEditor.prototype.comWidth=function(a){var b=a.graph.getSelectionCells();if(flowUtils.notNull(b)){for(var c={},d=new Map,e=0;e<b.length;e++)if(b[e].vertex&&"swimlane"!=b[e].value.nodeName){var f=Number(b[e].getGeometry().x);d.put(f,b[e]);if(!flowUtils.notNull(c.minx)||c.minx>f)c.minx=f;if(!flowUtils.notNull(c.maxx)||c.maxx<f)c.maxx=f}if(1<d.size())for(b=(c.maxx-c.minx)/(d.size()-1),f=d.keys(),f=f.sort(function(a,b){return a-b}),e=0;e<f.length;e++)a.graph.moveCells([d.get(f[e])],c.minx+b*e-Number(f[e]),0),d.remove(f[e])}};DesignerEditor.prototype.comHeight=function(a){var b=a.graph.getSelectionCells();if(flowUtils.notNull(b)){for(var c={},d=new Map,e=0;e<b.length;e++)if(b[e].vertex&&"swimlane"!=b[e].value.nodeName){var f=Number(b[e].getGeometry().y);d.put(f,b[e]);if(!flowUtils.notNull(c.miny)||c.miny>f)c.miny=f;if(!flowUtils.notNull(c.maxy)||c.maxy<f)c.maxy=f}if(1<d.size())for(b=(c.maxy-c.miny)/(d.size()-1),f=d.keys(),f=f.sort(function(a,b){return a-b}),e=0;e<f.length;e++)a.graph.moveCells([d.get(f[e])],0,c.miny+b*e-Number(f[e])),d.remove(f[e])}};DesignerEditor.prototype.getPrettyXml=function(a,b,c){var d=[];if(null!=a)if(b=b||"  ",c=c||"",a.nodeType==mxConstants.NODETYPE_TEXT)d.push(a.nodeValue);else{d.push(c+"\x3c"+a.nodeName);var e=a.attributes;if(null!=e)for(var f=0;f<e.length;f++){var g=mxUtils.htmlEntities(e[f].nodeValue);d.push(" "+e[f].nodeName+'\x3d"'+g+'"')}e=a.firstChild;if(null!=e){f="";d.push("\x3e");e.nodeType!=mxConstants.NODETYPE_TEXT&&(f=c,d.push("\n"));for(;null!=e;)d.push(this.getPrettyXml(e,b,c+b)),e=e.nextSibling;d.push(f+"\x3c/"+a.nodeName+"\x3e\n")}else d.push("/\x3e\n")}return d.join("")};DesignerEditor.prototype.getStyleValue=function(a,b){var c=this.editor.graph.model.getStyle(b);if(null!=c)for(var c=c.split(";"),d=0;d<c.length;d++)if(-1!=c[d].indexOf("\x3d")){var e=c[d].split("\x3d");if(e[0]==a)return e[1]}return null};function isEdgeStraight(a,b,c){a=a.graph;return null!=b&&b.edge&&1==a.getSelectionCells().length&&(b=a.view.getState(b),"straightEdge"==mxUtils.getValue(b.style,"edgeStyle",null))?!0:!1}function isEdgeNotStraight(a,b,c){a=a.graph;return null!=b&&b.edge&&1==a.getSelectionCells().length&&(b=a.view.getState(b),"straightEdge"!=mxUtils.getValue(b.style,"edgeStyle",null))?!0:!1}function canAddPoint(a,b,c){if(!isEdgeStraight(a,b,c))return!1;a=a.graph;b=a.selectionCellsHandler.getHandler(b);var d=!1;b instanceof mxEdgeHandler&&null!=b.bends&&2<b.bends.length&&(c=b.getHandleForEvent(a.updateMouseEvent(new mxMouseEvent(c))),d=0<c&&c<b.bends.length-1);return!d}function isEdgeSolidLine(a,b,c){return!isEdgeDottedLine(a,b,c)}function isEdgeDottedLine(a,b,c){a=a.graph;return null!=b&&b.edge&&1==a.getSelectionCells().length&&(b=a.view.getState(b),"1"==mxUtils.getValue(b.style,mxConstants.STYLE_DASHED,null))?!0:!1}DesignerEditor.prototype.changeSolidLine=function(a){var b=a.graph.getSelectionCell();flowUtils.notNull(b)&&b.edge&&a.graph.setCellStyles(mxConstants.STYLE_DASHED,null,[b])};DesignerEditor.prototype.changeDottedLine=function(a){var b=a.graph.getSelectionCell();flowUtils.notNull(b)&&b.edge&&a.graph.setCellStyles(mxConstants.STYLE_DASHED,"1",[b])};