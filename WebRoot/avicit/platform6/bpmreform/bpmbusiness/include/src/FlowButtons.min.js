/**
 * 业务操作父类
 *//**
 * 数据模板
 *//**
 * 按钮基类
 *//**
 * 流程增发
 *//**
 * 流程跳转
 *//**
 * 流程退回，包括退回上一步和退回拟稿人
 *//**
 * 提交，多个提交合成一个
 *//**
 * 增加读者
 *//**
 * 相关流程
 *//**
 * 流程转发
 *//**
 * 按钮单独操作
 */
function DefaultForm(){}DefaultForm.prototype.flowEditor=null;DefaultForm.prototype.isAutoSave=!0;DefaultForm.prototype.id=null;DefaultForm.prototype.setId=function(a){this.id=a};DefaultForm.prototype.initFormData=function(){};DefaultForm.prototype.start=function(a,b){};DefaultForm.prototype.save=function(a){};DefaultForm.prototype.afterCreateButtons=function(){};DefaultForm.prototype.afterControlFormInput=function(){};DefaultForm.prototype.filterSecretLevel=function(a){return a};DefaultForm.prototype.validSecretLevel=function(a){return!0};DefaultForm.prototype.setAttachMagic=function(a){};DefaultForm.prototype.setAttachCanAddOrDel=function(a,b,c){};DefaultForm.prototype.setAttachRequired=function(a,b,c){};DefaultForm.prototype.setAttachSecretLevelModify=function(a,b,c){};DefaultForm.prototype.controlSelfElement=function(a,b,c){};DefaultForm.prototype.controlSelfElementForAccess=function(a,b,c){};DefaultForm.prototype.controlSelfElementForRequired=function(a,b,c){};DefaultForm.prototype.controlSubTableButtonForAccess=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForAccess=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForOperability=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForRequired=function(a,b,c){};DefaultForm.prototype.reGetidea=function(a,b){return a};DefaultForm.prototype.getDefaultIdea=function(a){return null};DefaultForm.prototype.selectUserSuccess=function(a){return!0};DefaultForm.prototype.afterInit=function(){};DefaultForm.prototype.checkUserSecretLevel=function(){return"undefined"!==typeof checkUserSecretLevel&&checkUserSecretLevel};DefaultForm.prototype.secretLevelCode=function(){return"undefined"!==typeof secretLevelCode?secretLevelCode:null};DefaultForm.prototype.beforeSubmit=function(a){return!0};DefaultForm.prototype.afterSubmit=function(a){};DefaultForm.prototype.beforeRetreat=function(a){return!0};DefaultForm.prototype.afterRetreat=function(a){};DefaultForm.prototype.beforeWithdraw=function(a){return!0};DefaultForm.prototype.afterWithdraw=function(a){};DefaultForm.prototype.beforeSupplement=function(a){return!0};DefaultForm.prototype.afterSupplement=function(a){};DefaultForm.prototype.beforeAdduser=function(a){return!0};DefaultForm.prototype.afterAdduser=function(a){};DefaultForm.prototype.beforeSupersede=function(a){return!0};DefaultForm.prototype.afterSupersede=function(a){};DefaultForm.prototype.beforeTransmit=function(a){return!0};DefaultForm.prototype.afterTransmit=function(a){};DefaultForm.prototype.beforeTaskreader=function(a){return!0};DefaultForm.prototype.afterTaskreader=function(a){};DefaultForm.prototype.beforeWithdrawassignee=function(a){return!0};DefaultForm.prototype.afterWithdrawassignee=function(a){};DefaultForm.prototype.beforeGlobalend=function(a){return!0};DefaultForm.prototype.afterGlobalend=function(a){};DefaultForm.prototype.beforeGlobaljump=function(a){return!0};DefaultForm.prototype.afterGlobaljump=function(a){};DefaultForm.prototype.beforeGlobalresume=function(a){return!0};DefaultForm.prototype.afterGlobalresume=function(a){};DefaultForm.prototype.beforeGlobalsuspend=function(a){return!0};DefaultForm.prototype.afterGlobalsuspend=function(a){};DefaultForm.prototype.beforeStepuserdefined=function(a){return!0};DefaultForm.prototype.afterStepuserdefined=function(a){};DefaultForm.prototype.beforePresstodo=function(a){return!0};DefaultForm.prototype.afterPresstodo=function(a){};DefaultForm.prototype.getLeadButCodeList=function(){var a=[];a.push("dosubmit");a.push("dosubmit_mesh");a.push("dostart");a.push("dotransmitsubmit");return a};function FlowModel(a,b,c,e,f){this.defineId=a;this.deploymentId=b;this.entryId=_fileupload_entryId=c;this.executionId=e;this.taskId=f}FlowModel.prototype.defineId=null;FlowModel.prototype.setDefineId=function(a){this.defineId=a};FlowModel.prototype.deploymentId=null;FlowModel.prototype.setDeploymentId=function(a){this.deploymentId=a};FlowModel.prototype.entryId=null;FlowModel.prototype.setEntryId=function(a){this.entryId=_fileupload_entryId=a};FlowModel.prototype.executionId=null;FlowModel.prototype.setExecutionId=function(a){this.executionId=a};FlowModel.prototype.taskId=null;FlowModel.prototype.setTaskId=function(a){this.taskId=a};FlowModel.prototype.activityname=null;FlowModel.prototype.setActivityname=function(a){this.activityname=_fileupload_taskName=a};FlowModel.prototype.activitylabel=null;FlowModel.prototype.setActivitylabel=function(a){this.activitylabel=a};FlowModel.prototype.userIdentityKey=null;FlowModel.prototype.setUserIdentityKey=function(a){this.userIdentityKey=a};FlowModel.prototype.userIdentity=null;FlowModel.prototype.setUserIdentity=function(a){this.userIdentity=a};FlowModel.prototype.ideasBySelf=null;FlowModel.prototype.setIdeasBySelf=function(a){this.ideasBySelf=a};var _fileupload_entryId="",_fileupload_taskName="";function BpmButton(a,b,c,e){this.flowEditor=a;this.defaultForm=b;this.data=c;flowUtils.notNull(this.data)&&(this.enable=!0);this.domeId="";this.isEvent=e}BpmButton.prototype.enable=!1;BpmButton.prototype.isEnable=function(){return this.enable};BpmButton.prototype.execute=function(){flowUtils.success("\u8be5\u65b9\u6cd5\u5f00\u53d1\u4e2d")};BpmButton.prototype.getHtml=function(){if(!this.isEvent)if(this.isEnable()){var a=this;this.data.alias?$("#"+this.domeId).html(this.data.alias):$("#"+this.domeId).html(this.data.lable);$("#"+this.domeId).off("click");$("#"+this.domeId).on("click",function(){a.execute()});$("#"+this.domeId).show();$("#"+this.domeId).parent().show();$("#"+this.domeId).parent().prev().show();$("#bpm_buttons_more").show()}else $("#"+this.domeId).hide(),$("#"+this.domeId).off("click")};BpmButton.prototype.getIdeaText=function(){return this.isEvent?"":this.flowEditor.flowIdea.getIdea(this.ideaElementIdBySelf)};BpmButton.prototype.focusIdeaText=function(){this.flowEditor.flowIdea.focusIdeaText(this.ideaElementIdBySelf)};BpmButton.prototype.hasIdeaElementBySelf=function(){return this.isEvent?!1:this.flowEditor.flowIdea.hasIdeaElementBySelf(this.ideaElementIdBySelf)};BpmButton.prototype.submit=function(a,b){flowUtils.warning("\u672a\u5b9e\u73b0\u7684\u65b9\u6cd5")};BpmButton.prototype.validIdeasBySelf=function(a,b){var c=this;if(null!=this.flowEditor.flowModel.ideasBySelf&&0<this.flowEditor.flowModel.ideasBySelf.length){for(var e="\x3cform class\x3d'container-fluid'\x3e\n",f=!1,d=0;d<this.flowEditor.flowModel.ideasBySelf.length;d++){var g=this.flowEditor.flowModel.ideasBySelf[d];if("0"==g.outcome||g.outcome==a)f=!0,e+="  \x3cdiv class\x3d\"form-group\"\x3e\n    \x3clabel\x3e\x3cinput type\x3d'radio' name\x3d'ideas_radio'/\x3e "+g.content+"\x3c/label\x3e\n  \x3c/div\x3e\n"}f?layer.open({type:1,title:"\u5f3a\u5236\u8868\u6001",area:["300px","400px"],content:e+"\x3c/form\x3e",btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(a,e){var d=$("input[name\x3d'ideas_radio']:checked");0==d.length?flowUtils.warning("\u8bf7\u5148\u8868\u6001"):(c.ideas_text=d.parent().text().trim(),b(),layer.close(a))}}):b()}else b()};BpmButton.prototype.getConditions=function(a){return{isBranch:function(){return null!=a.nextTask&&1<a.nextTask.length?!0:!1},isUserSelectTypeAuto:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.userSelectType?"auto"==a.nextTask[b].currentActivityAttr.userSelectType?!0:!1:!1},isWorkHandUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isWorkHandUser?"no"==a.nextTask[b].currentActivityAttr.isWorkHandUser?!1:!0:!0},getDealType:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.dealType?a.nextTask[b].currentActivityAttr.dealType:"2"},getSingle:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.single?a.nextTask[b].currentActivityAttr.single:"no"},isMustUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isMustUser?"no"==a.nextTask[b].currentActivityAttr.isMustUser?!1:!0:!0},isSecret:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isSecret?"yes"==a.nextTask[b].currentActivityAttr.isMustUser?!0:!1:!1},getIdeaType:function(){return a.currentActivityAttr.ideaType?a.currentActivityAttr.ideaType:""},isIdeaCompelManner:function(){return a.currentActivityAttr.ideaCompelManner?"yes"==a.currentActivityAttr.ideaCompelManner?!0:!1:!1},isNeedIdea:function(){return a.currentActivityAttr.isNeedIdea?"no"==a.currentActivityAttr.isNeedIdea?!1:!0:!0},isSelectUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isSelectUser?"no"==a.nextTask[b].currentActivityAttr.isSelectUser?!1:!0:!0},isAutoGetUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isAutoGetUser?"no"==a.nextTask[b].currentActivityAttr.isAutoGetUser?!1:!0:!1},getNextActivityType:function(){return a.activityType},isUflow:function(){return"2"==a.isUflow}}};function BpmAdduser(a,b,c,e){BpmButton.call(this,a,b,c.doadduser,e);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_adduser";this.getHtml()}BpmAdduser.prototype=new BpmButton;BpmAdduser.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeAdduser(this.data)){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.data.procinstDbid,executionId:a.data.executionId,taskId:a.data.taskId,outcome:a.data.name,targetActivityName:a.data.targetActivityName,type:"doadduser"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):(new BpmActor(a.data,b.taskUserSelect,a)).open()}})}};BpmAdduser.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,e={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dosupplementassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(e),opType:"doadduser"},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u52a0\u7b7e\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterAdduser(a)}catch(d){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmGlobaljump(a,b,c,e){BpmButton.call(this,a,b,c.doglobaljump,e);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_globaljump";this.getHtml()}BpmGlobaljump.prototype=new BpmButton;BpmGlobaljump.prototype.execute=function(){this.flowEditor.defaultForm.beforeGlobaljump(this.data)&&(this.jumpTaskDialog=layer.open({type:2,title:"\u8df3\u8f6c\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.data.procinstDbid+"\x26type\x3ddoglobaljump"}),this.isEvent&&layer.full(this.jumpTaskDialog),window.bpmGlobaljump=this)};BpmGlobaljump.prototype.callback=function(a,b){layer.close(this.jumpTaskDialog);var c=flowUtils.clone(this.data);flowUtils.notNull(a)&&(c.executionId=a);c.targetActivityName=b;var e=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:c.procinstDbid,executionId:c.executionId,taskId:c.taskId,outcome:c.name,targetActivityName:c.targetActivityName,type:"doglobaljump"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(new BpmActor(c,a.taskUserSelect,e)).open()}})};BpmGlobaljump.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,e={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dojump",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(e),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{c.isEvent?(flowUtils.success("\u8df3\u8f6c\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u8df3\u8f6c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterGlobaljump(a)}catch(d){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmRetreat(a,b,c,e){BpmButton.call(this,a,b,null,e);this.doretreattodraft=c.doretreattodraft;this.doretreattoprev=c.doretreattoprev;this.doretreattowant=c.doretreattowant;this.doretreattoactivity=c.doretreattoactivity;if(flowUtils.notNull(this.doretreattodraft)||flowUtils.notNull(this.doretreattoprev)||flowUtils.notNull(this.doretreattowant)||flowUtils.notNull(this.doretreattoactivity))this.enable=!0,this.flowEditor.needIdeaText=!0;this.getHtml()}BpmRetreat.prototype=new BpmButton;BpmRetreat.prototype.executeTodraft=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattodraft)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeTodraftBack();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeTodraftBack()})}};BpmRetreat.prototype.executeTodraftBack=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.doretreattodraft.procinstDbid,executionId:a.doretreattodraft.executionId,taskId:a.doretreattodraft.taskId,outcome:a.doretreattodraft.name,targetActivityName:a.doretreattodraft.targetActivityName,type:"doretreattodraft"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.validJsonData(a.doretreattodraft,b.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u62df\u7a3f\u4eba\u5417\uff1f")}});this.submit=function(b,c){if(flowUtils.notNull(c)&&0!=c.length){var e=a.getIdeaText();flowUtils.notNull(this.ideas_text)&&(e=this.ideas_text+" "+e);avicAjax.ajax({url:"platform/bpm/business/dobacktofirst",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,userJson:JSON.stringify({users:c,idea:e,compelManner:"",outcome:b.name})},type:"POST",dataType:"JSON",success:function(c){if(flowUtils.notNull(c.error))flowUtils.error(c.error,c.errorDetail);else{a.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterRetreat(b)}catch(d){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeToprev=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattoprev)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeToprevBack();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeToprevBack()})}};BpmRetreat.prototype.executeToprevBack=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.doretreattoprev.procinstDbid,executionId:a.doretreattoprev.executionId,taskId:a.doretreattoprev.taskId,outcome:a.doretreattoprev.name,targetActivityName:a.doretreattoprev.targetActivityName,type:"doretreattoprev"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.validJsonData(a.doretreattoprev,b.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u4e0a\u4e00\u6b65\u5417\uff1f")}});this.submit=function(b,c){if(flowUtils.notNull(c)&&0!=c.length){var e=a.getIdeaText();flowUtils.notNull(this.ideas_text)&&(e=this.ideas_text+" "+e);avicAjax.ajax({url:"platform/bpm/business/dobacktoprev",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,userJson:JSON.stringify({users:c,idea:e,compelManner:"",outcome:b.name})},type:"POST",dataType:"JSON",success:function(c){if(flowUtils.notNull(c.error))flowUtils.error(c.error,c.errorDetail);else{a.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterRetreat(b)}catch(d){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeTowant=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattowant)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeTowantSelectTask();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeTowantSelectTask()})}};BpmRetreat.prototype.executeTowantSelectTask=function(){this.retreattowantDialog=layer.open({type:2,title:"\u4efb\u610f\u9000\u56de\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.doretreattowant.procinstDbid+"\x26type\x3ddoretreattowant"});this.isEvent&&layer.full(this.retreattowantDialog);window.bpmRetreatToWant=this};BpmRetreat.prototype.callback=function(a){layer.close(this.retreattowantDialog);var b=flowUtils.clone(this.doretreattowant);b.targetActivityName=a;var c=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,taskId:b.taskId,outcome:b.name,targetActivityName:b.targetActivityName,type:"doretreattowant"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):c.validJsonData(b,a.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u5417\uff1f")}});this.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var d=c.getIdeaText();flowUtils.notNull(this.ideas_text)&&(d=this.ideas_text+" "+d);avicAjax.ajax({url:"platform/bpm/business/dobacktowant",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:d,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{c.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterRetreat(a)}catch(h){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeToactivity=function(a){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattoactivity)){var b=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){b.executeToactivityBack(a);b.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){b.executeToactivityBack(a)})}};BpmRetreat.prototype.executeToactivityBack=function(a){var b=flowUtils.clone(this.doretreattoactivity);b.targetActivityName=a;var c=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,taskId:b.taskId,outcome:b.name,targetActivityName:b.targetActivityName,type:"doretreattoactivity"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):c.validJsonData(b,a.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u5417\uff1f")}});this.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var d=c.getIdeaText();flowUtils.notNull(this.ideas_text)&&(d=this.ideas_text+" "+d);avicAjax.ajax({url:"platform/bpm/business/dobacktoactivity",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:d,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{c.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterRetreat(a)}catch(h){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.validJsonData=function(a,b,c){var e=this;flowUtils.notNull(b)&&(this.conditions=this.getConditions(b),this.validIdeaMust()&&(this.conditions.isBranch()?(new BpmActor(a,b,this)).open():flowUtils.confirm(c,function(){var c=(new BpmActor(a,b,e)).getUsers();e.submit(a,c)})))};BpmRetreat.prototype.validIdeaMust=function(){if(this.isEvent)return!0;if(this.conditions.isNeedIdea()){var a=this.getIdeaText();if(!flowUtils.notNull(a))return flowUtils.warning("\u8bf7\u586b\u5199\u6d41\u7a0b\u610f\u89c1"),this.focusIdeaText(),!1}return!0};BpmRetreat.prototype.getHtml=function(){if(this.isEvent)return!0;if(this.isEnable()){var a=this,b=$('\x3cbutton class\x3d"listBtn grey btn btn-default dropdown-toggle" type\x3d"button" id\x3d"dropmenu_retreat" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u9000\u56de\x3c/span\x3e\x3ci\x3e\x3c/i\x3e\x3c/button\x3e'),c=$('\x3cul class\x3d"dropdown-menu" aria-labelledby\x3d"dropmenu_retreat"\x3e');if(null!=this.doretreattodraft){var e=$("\x3cli\x3e\x3c/li\x3e"),f=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattodraft.lable+"\x3c/a\x3e");f.on("click",function(){a.executeTodraft()});e.append(f);c.append(e)}null!=this.doretreattoprev&&(e=$("\x3cli\x3e\x3c/li\x3e"),f=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattoprev.lable+"\x3c/a\x3e"),f.on("click",function(){a.executeToprev()}),e.append(f),c.append(e));null!=this.doretreattowant&&(e=$("\x3cli\x3e\x3c/li\x3e"),f=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattowant.lable+"\x3c/a\x3e"),f.on("click",function(){a.executeTowant()}),e.append(f),c.append(e));if(null!=this.doretreattoactivity){var e=this.doretreattoactivity.targetName.split(","),d=this.doretreattoactivity.lable.split(",");$.each(e,function(b,e){var f=$("\x3cli\x3e\x3c/li\x3e"),g=$('\x3ca href\x3d"javascript:void(0);"\x3e\u9000\u56de\u5230\u3010'+d[b]+"\u3011\u8282\u70b9\x3c/a\x3e");g.on("click",function(){a.executeToactivity(e)});f.append(g);c.append(f)})}$("#bpm_buttons_default1").append(b);$("#bpm_buttons_default1").append(c)}};function BpmSubmit(a,b,c,e){BpmButton.call(this,a,b,null,e);this.data=c.dosubmit;this.transmitData=c.dotransmitsubmit;if(this.flowEditor.isStart||flowUtils.notNull(this.data)||flowUtils.notNull(this.transmitData))this.enable=!0;flowUtils.notNull(c.dosubmit)&&flowUtils.notNull(c.dosubmit[0].attribute)&&flowUtils.notNull(c.dosubmit[0].attribute.ideaElementIdBySelf)&&(this.ideaElementIdBySelf=c.dosubmit[0].attribute.ideaElementIdBySelf);this.enable&&!this.hasIdeaElementBySelf()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_submit";this.getHtml();this.isAutoClickAfterStart=!1}BpmSubmit.prototype=new BpmButton;BpmSubmit.prototype.disabled=!1;BpmSubmit.prototype.execute=function(a){var b=this;this.disabled||(this.disabled=!0,setTimeout(function(){b.disabled=!1},2E3),this.flowEditor.isStart?this.defaultForm.start(this.flowEditor.flowModel.defineId,function(a){b.flowEditor.afterStart(a);b.flowEditor.createButtons(!0);flowUtils.refreshBack()}):this.flowEditor.defaultForm.beforeSubmit(a)&&(!this.isAutoClickAfterStart&&!this.isEvent&&this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){b.flowEditor.createButtons(!0,a.name)}):this.validIdeasBySelf("1",function(){b.executeBack(a)})))};BpmSubmit.prototype.executeBack=function(a){var b=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,taskId:a.taskId,outcome:a.name,targetActivityName:a.targetActivityName,type:"dosubmit"},type:"POST",dataType:"JSON",success:function(c){flowUtils.notNull(c.error)?flowUtils.error(c.error):b.validJsonData(a,c.taskUserSelect)}})};BpmSubmit.prototype.validJsonData=function(a,b){var c=this;if(flowUtils.notNull(b))if(this.conditions=this.getConditions(b),!this.isEvent&&this.conditions.isIdeaCompelManner()&&0==$(".bpm_compelManner_div input[name\x3d'bpm_compelManner']:checked").length)$(".bpm_compelManner_div").show(),flowUtils.warning("\u8bf7\u60a8\u8868\u6001");else if(this.validIdeaMust()){var e=this.conditions.getNextActivityType();if(e)if("end"==e)flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});else{if("sub-process"==e){if(!this.conditions.isMustUser()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});return}}else if("foreach"==e){if(!this.conditions.isMustUser()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});return}}else if("task"==e&&!this.conditions.isBranch()){if(!this.conditions.isSelectUser()&&this.conditions.isUserSelectTypeAuto()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){var e=(new BpmActor(a,b,c)).getUsers();c.submit(a,e)});return}if(!this.conditions.isSelectUser()){flowUtils.warning("\u914d\u7f6e\u9519\u8bef\uff1a\u914d\u7f6e\u4e0d\u663e\u793a\u9009\u4eba\u6846\uff0c\u4f46\u672a\u914d\u7f6e\u81ea\u52a8\u9009\u4eba");return}}(new BpmActor(a,b,this,this.conditions.isUflow())).open()}else b.nextTask||flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)})}};BpmSubmit.prototype.validIdeaMust=function(){if(!this.isEvent&&"must"==this.conditions.getIdeaType()){var a=this.getIdeaText();if(!flowUtils.notNull(a))return flowUtils.warning("\u8bf7\u586b\u5199\u6d41\u7a0b\u610f\u89c1"),this.focusIdeaText(),!1}return!0};BpmSubmit.prototype.submit=function(a,b,c,e){if(c||flowUtils.notNull(b)&&0!=b.length){c=this.isEvent?"\u540c\u610f":this.getIdeaText();c=this.flowEditor.defaultForm.reGetidea(c,b);var f="";this.conditions.isIdeaCompelManner()&&(f=this.isEvent?"yes":$(".bpm_compelManner_div input[name\x3d'bpm_compelManner']:checked").val());flowUtils.notNull(this.ideas_text)&&(c=this.ideas_text+" "+c);var d=this;avicAjax.ajax({url:"platform/bpm/business/dosubmit",data:{instanceId:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify({users:b,idea:c,compelManner:f,outcome:a.name}),outcome:a.name,formJson:null,uflowDealType:e,isUflow:this.conditions.isUflow()},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{d.isEvent?flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01",function(){flowUtils.refreshCurrentBack()},!0):flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){d.flowEditor.createButtons()},500)},!0);try{d.flowEditor.defaultForm.afterSubmit(a)}catch(h){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};BpmSubmit.prototype.getHtml=function(){if(this.isEnable()&&!this.isEvent){var a=this;if(null!=this.data&&1<this.data.length){var b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3ci\x3e\x3c/i\x3e\x3c/button\x3e');b.attr("id",this.domeId);var c=$('\x3cul class\x3d"dropdown-menu" aria-labelledby\x3d"'+this.domeId+'"\x3e');$.each(this.data,function(b,d){var e=$("\x3cli\x3e\x3c/li\x3e"),f=$('\x3ca href\x3d"javascript:void(0);"\x3e'+d.lable+"\x3c/a\x3e");f.attr("title",d.description);f.on("click",function(){a.execute(d)});e.append(f);c.append(e);flowUtils.notNull(d.attribute)&&"yes"==d.attribute.ideaCompelManner&&$(".bpm_compelManner_div").show()});$("#bpm_buttons_default2").append(b);$("#bpm_buttons_default2").append(c)}else if(null!=this.data){var e=this.data[0],b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e');b.attr("id",this.domeId);b.attr("title",e.description);b.on("click",function(){a.execute(e)});$("#bpm_buttons_default2").append(b);flowUtils.notNull(e.attribute)&&"yes"==e.attribute.ideaCompelManner&&$(".bpm_compelManner_div").show()}else null!=this.transmitData?(b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e'),b.attr("id",this.domeId),b.attr("title","\u586b\u5199\u610f\u89c1"),b.on("click",function(){a.executeTransmit()}),$("#bpm_buttons_default2").append(b)):(b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt" id\x3d"bpm_firsttasksubmitname"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e'),b.attr("id",this.domeId),b.on("click",function(){a.execute()}),$("#bpm_buttons_default2").append(b),flowUtils.notNull(this.flowEditor.ideaCompelManner)&&"yes"==this.flowEditor.ideaCompelManner&&$(".bpm_compelManner_div").show(),$.ajax({url:"platform/bpm/business/getFirstTaskSubmitName",data:{},type:"POST",dataType:"TEXT",success:function(a){flowUtils.notNull(a)&&$("#bpm_firsttasksubmitname").html(a)}}))}};BpmSubmit.prototype.executeTransmit=function(){var a=this;flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){a.submitTransmit()})};BpmSubmit.prototype.submitTransmit=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/dosubmitTransmit",data:{instanceId:this.transmitData.procinstDbid,message:this.getIdeaText(),taskId:this.transmitData.taskId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error,b.errorDetail):flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0)}})};BpmSubmit.prototype.clickBut=function(a){var b=this;if(this.isEnable())if(flowUtils.notNull(a)){if(null!=this.data&&0<this.data.length)for(var c=0;c<this.data.length;c++)if(this.data[c].name==a){this.validIdeasBySelf("1",function(){b.executeBack(b.data[c])});return}layer.msg("\u8def\u7531\u6761\u4ef6\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\uff0c\u8bf7\u91cd\u65b0\u8fdb\u884c\u63d0\u4ea4")}else if(null!=this.data&&1<this.data.length)layer.msg("\u6d41\u7a0b\u5df2\u521b\u5efa\uff0c\u8bf7\u9009\u62e9\u4e00\u4e2a\u5206\u652f\u8fdb\u884c\u63d0\u4ea4"),$("#"+this.domeId).parent().addClass("open");else if(null!=this.data){this.isAutoClickAfterStart=!0;try{$("#"+this.domeId).click()}catch(e){this.isAutoClickAfterStart=!1}this.isAutoClickAfterStart=!1}};BpmSubmit.prototype.quickExecute=function(){if(this.isEnable()&&this.isEvent){var a=this;if(null!=this.data&&1<this.data.length){var b="";$.each(this.data,function(a,e){b=0==a?b+('\x3cinput checked _val\x3d"'+a+'" type\x3d"radio" name\x3d"submitName" id\x3d"'+e.id+'"\x3e\x26nbsp;\x26nbsp;\x3clabel for\x3d"'+e.id+'"\x3e'+e.lable+"\x3c/label\x3e"):b+('\x3cbr/\x3e\x3cinput _val\x3d"'+a+'" type\x3d"radio" name\x3d"submitName" id\x3d"'+e.id+'"\x3e\x26nbsp;\x26nbsp;\x3clabel for\x3d"'+e.id+'"\x3e'+e.lable+"\x3c/label\x3e")});layer.open({title:"\u8bf7\u9009\u62e9\u529e\u7406\u4e8b\u9879",content:b,btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(b,e){var c=e.find("input[name\x3d'submitName']:checked");0==c.length?flowUtils.error("\u8bf7\u9009\u62e9\u529e\u7406\u4e8b\u9879"):(c=Number(c.attr("_val")),layer.close(b),a.execute(a.data[c]))}})}else null!=this.data&&this.execute(this.data[0])}else flowUtils.error("\u76ee\u524d\u6ca1\u6709\u529e\u7406\u6743\u9650")};function BpmActor(a,b,c,e){this.data=a;this.submitObj=c;this.taskJsonData=b;this.isUflow=e}BpmActor.prototype.open=function(){var a=this,b=a.getActorHandTitle();flowUtils.notNull(b)||(b="\u4e0b\u4e00\u8282\u70b9");top.layer.open({skin:"bpm_selectUser_class",type:2,title:"\u9009\u62e9\u3010"+b+"\u3011\u5904\u7406\u4eba",area:["800px","450px"],content:"platform/bpmActor/bpmSelectUserAction2/main?procinstDbid\x3d"+this.data.procinstDbid+"\x26executionId\x3d"+this.data.executionId+"\x26taskId\x3d"+this.data.taskId+"\x26outcome\x3d"+this.data.name+"\x26targetActivityName\x3d"+this.data.targetActivityName+"\x26type\x3d"+this.data.event+"\x26doSubmitUrl\x3d\x26doSubmitCallEvent\x3d",btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(b,e){var c=e.find("iframe")[0].contentWindow,d=c.getSelectedUsers(),g=c.targetActivityName;if(("yes"==c.currentActivityAttr_single||"1"==c.currentActivityAttr_dealType)&&1<d.length)top.layer.msg("\u5f53\u524d\u8282\u70b9\u53ea\u5141\u8bb8\u9009\u62e9\u4e00\u4e2a\u5904\u7406\u4eba\uff01");else if(null==d||0==d.length)top.layer.msg("\u8bf7\u9009\u62e9\u5904\u7406\u4eba");else{if(1==d.length&&"carbonCopy"==d[0].targetActivityName)return top.layer.msg("\u8bf7\u9009\u62e9\u5904\u7406\u4eba"),!1;if(a.submitObj instanceof BpmSubmit&&!a.submitObj.flowEditor.defaultForm.selectUserSuccess(d))return!1;c=a.getUflowDealType();if(a.checkIsBranch()){if(a.checkWorkHandUser()){g=a.geBranchWorkHandSelectedUsers(d);actorWorkerHandlerOperation(g,a,!0,d,c);return}}else{if(a.checkWorkHandUser()){actorWorkerHandlerOperation(d,a,!1,null,c,g);return}d=[{selectedUsers:d,targetActivityName:g,outcome:null==a.data.name?"":a.data.name,workhandUsers:[]}]}top.layer.closeAll();a.submitObj.submit(a.data,d,!1,c)}},success:function(b,e){if(a.isUflow){var c=$(".bpm_selectUser_class");0==c.length&&(c=parent.$(".bpm_selectUser_class"));if(0==c.length)return;c.find(".layui-layer-btn").append("\x3cdiv class\x3d'pull-left'\x3e\x3cinput type\x3d'radio' name\x3d'dealtype' value\x3d'4' checked style\x3d'vertical-align:middle; margin-top:-2px; margin-bottom:1px;'/\x3e\u591a\u4eba\u5e76\u884c\x26nbsp;\x26nbsp\x3cinput type\x3d'radio' name\x3d'dealtype' value\x3d'3' style\x3d'vertical-align:middle; margin-top:-2px; margin-bottom:1px;'/\x3e\u591a\u4eba\u4efb\u610f\x3c/div\x3e")}if(flowUtils.notNull(a.data)&&"dostepuserdefined"==a.data.event){var d=b.find("iframe")[0].contentWindow;$.ajax({url:"platform/bpm/business/getBpmStepPerson",data:{entryId:a.data.procinstDbid,activityName:a.data.activityName},type:"POST",dataType:"JSON",success:function(a){if(flowUtils.notNull(a))for(var b=0;b<a.length;b++){var c=a[b];d.selectorData({id:c.id,name:c.name,attributes:{deptId:c.deptId,deptName:c.deptName}})}}})}}})};BpmActor.prototype.getUflowDealType=function(){if(this.isUflow){var a=$(".bpm_selectUser_class");0==a.length&&(a=parent.$(".bpm_selectUser_class"));return 0==a.length?"":a.find(".layui-layer-btn").find("input[name\x3d'dealtype']:checked").val()}return""};BpmActor.prototype.getUsers=function(){var a,b=this;$.ajax({url:"platform/bpmActor/bpmSelectUserAction2/getAutoSelectedUsersJSONData",async:!1,dataType:"JSON",data:{procinstDbid:this.data.procinstDbid,executionId:this.data.executionId,taskId:this.data.taskId,targetActivityName:this.data.targetActivityName,type:this.data.event,outcome:this.data.name},type:"GET",success:function(c){a="doretreattodraft"==b.data.event||"doretreattoprev"==b.data.event||"dowithdraw"==b.data.event?[{selectedUsers:c,targetActivityName:null==b.data.targetActivityName?"":b.data.targetActivityName,outcome:null==b.data.name?"":b.data.name,workhandUsers:[]}]:c}});return a};BpmActor.prototype.checkIsBranch=function(){try{return this.submitObj.conditions.isBranch()?!0:!1}catch(a){return!1}};BpmActor.prototype.getActorHandTitle=function(){try{if(this.checkIsBranch())return"\u5206\u652f";var a=this.taskJsonData.nextTask[0].currentActivityAttr.activityAlias;return null!=a?a:this.submitObj.data.lable}catch(b){return this.submitObj.data.lable}};BpmActor.prototype.checkWorkHandUser=function(){if(this.taskJsonData&&this.taskJsonData.nextTask)for(var a=0;a<this.taskJsonData.nextTask.length;a++){if("yes"==this.taskJsonData.nextTask[a].currentActivityAttr.isWorkHandUser)return!0}else return!1};BpmActor.prototype.geBranchWorkHandSelectedUsers=function(a){for(var b=[],c=0;c<a.length;c++)for(var e=a[c].selectedUsers,f=0;f<e.length;f++)b.push(e[f]);return b};function actorWorkerHandlerOperation(a,b,c,e,f,d){$.ajax({type:"POST",url:"platform/bpmActor/bpmSelectUserAction2/getWorkHandUsers",async:!1,data:{userList:JSON.stringify(a),processKey:b.taskJsonData.processKey},dataType:"json",success:function(g){g&&0<g.length?(g="platform/bpmActor/bpmSelectUserAction2/getWorkHandSelectUser?userList\x3d"+encodeURI(encodeURI(JSON.stringify(g))),top.layer.open({skin:"bs-modal",title:"\u9009\u62e9\u6d41\u7a0b\u59d4\u6258\u5904\u7406\u4eba",content:g,area:["600px","400px"],type:2,shade:.3,btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(g,l){var h=l.find("iframe")[0].contentWindow.getWorkhandSelectedUsers();if(c){for(var k=0;k<e.length;k++)e[k].workhandUsers=h;top.layer.closeAll();b.submitObj.submit(b.data,e,!1,f)}else h=[{selectedUsers:a,targetActivityName:d,outcome:b.data.name,workhandUsers:h}],top.layer.closeAll(),b.submitObj.submit(b.data,h,!1,f)},init:function(a,b){}})):c?(top.layer.closeAll(),b.submitObj.submit(b.data,e,!1,f)):(g=[{selectedUsers:a,targetActivityName:d,outcome:b.data.name,workhandUsers:null}],top.layer.closeAll(),b.submitObj.submit(b.data,g,!1,f))},error:function(a){layer.alert(a,{icon:2})}})}function BpmTaskreader(a,b,c,e){BpmButton.call(this,a,b,c.dotaskreader,e);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_taskreader";this.getHtml()}BpmTaskreader.prototype=new BpmButton;BpmTaskreader.prototype.execute=function(){this.flowEditor.defaultForm.beforeTaskreader(this.data)&&(new BpmActor(this.data,null,this)).open()};BpmTaskreader.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,e={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dotaskreader",data:{procinstDbid:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify(e)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterTaskreader(a)}catch(d){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmRelationflow(a,b,c,e){BpmButton.call(this,a,b,c.dorelationprocess,e);this.domeId="bpm_relationprocess";this.getHtml()}BpmRelationflow.prototype=new BpmButton;BpmRelationflow.prototype.execute=function(){var a=this;this.index=layer.open({type:2,area:["90%","90%"],title:"\u6dfb\u52a0",skin:"bs-modal",maxmin:!1,content:"avicit/platform6/bpmreform/bpmbusiness/include/relatedBpm.jsp?pid\x3d"+encodeURIComponent(this.data.procinstDbid),end:function(){a.flowEditor.reloadProcesslevelPage()}})};function BpmTransmit(a,b,c,e){BpmButton.call(this,a,b,c.dotransmit,e);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_transmit";this.getHtml()}BpmTransmit.prototype=new BpmButton;BpmTransmit.prototype.execute=function(){this.flowEditor.defaultForm.beforeTransmit(this.data)&&(new BpmActor(this.data,null,this)).open()};BpmTransmit.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,e={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dotransmit",data:{procinstDbid:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify(e)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterTransmit(a)}catch(d){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function FlowButtons(){this.flowModel=new FlowModel;this.defaultForm=new DefaultForm;this.defaultForm.flowEditor=this;this.defaultForm.isAutoSave=!1}FlowButtons.prototype.isStart=!1;FlowButtons.prototype.createButtons=function(){};FlowButtons.prototype.adduser=function(a,b,c,e,f){var d={};d.procinstDbid=a;d.executionId=b;d.taskId=c;d.name=e;d.targetActivityName=f;d.event="doadduser";d.lable="\u52a0\u7b7e";this.bpmAdduser=new BpmAdduser(this,this.defaultForm,{doadduser:d},!0);this.bpmAdduser.execute()};FlowButtons.prototype.globaljump=function(a,b,c,e,f){var d={};d.procinstDbid=a;d.executionId=b;d.taskId=c;d.name=e;d.targetActivityName=f;d.event="doglobaljump";d.lable="\u6d41\u7a0b\u8df3\u8f6c";this.bpmGlobaljump=new BpmGlobaljump(this,this.defaultForm,{doglobaljump:d},!0);this.bpmGlobaljump.execute()};FlowButtons.prototype.todraft=function(a,b,c,e,f){var d={};d.procinstDbid=a;d.executionId=b;d.taskId=c;d.name=e;d.targetActivityName=f;d.event="doretreattodraft";d.lable="\u9000\u56de\u62df\u7a3f\u4eba";this.bpmRetreat=new BpmRetreat(this,this.defaultForm,{doretreattodraft:d},!0);this.bpmRetreat.executeTodraft()};FlowButtons.prototype.toprev=function(a,b,c,e,f){var d={};d.procinstDbid=a;d.executionId=b;d.taskId=c;d.name=e;d.targetActivityName=f;d.event="doretreattoprev";d.lable="\u9000\u56de\u4e0a\u4e00\u6b65";this.bpmRetreat=new BpmRetreat(this,this.defaultForm,{doretreattoprev:d},!0);this.bpmRetreat.executeToprev()};FlowButtons.prototype.dotransmit=function(a,b,c,e,f){var d={};d.procinstDbid=a;d.executionId=b;d.taskId=c;d.name=e;d.targetActivityName=f;d.event="dotransmit";d.lable="\u53d1\u9001\u9605\u77e5";this.bpmTransmit=new BpmTransmit(this,this.defaultForm,{dotransmit:d},!0);this.bpmTransmit.execute()};FlowButtons.prototype.dotaskreader=function(a,b,c,e,f){var d={};d.procinstDbid=a;d.executionId=b;d.taskId=c;d.name=e;d.targetActivityName=f;d.event="dotaskreader";d.lable="\u589e\u52a0\u8bfb\u8005";this.bpmTaskreader=new BpmTaskreader(this,this.defaultForm,{dotaskreader:d},!0);this.bpmTaskreader.execute()};FlowButtons.prototype.dorelationprocess=function(a,b,c,e,f){var d={};d.procinstDbid=a;d.executionId=b;d.taskId=c;d.name=e;d.targetActivityName=f;d.event="dorelationprocess";d.lable="\u76f8\u5173\u6d41\u7a0b";this.bpmRelationflow=new BpmRelationflow(this,this.defaultForm,{dorelationprocess:d},!0);this.bpmRelationflow.execute()};FlowButtons.prototype.dosubmit=function(a,b,c,e){var f=this;avicAjax.ajax({type:"POST",data:{processInstanceId:a,executionId:b,taskId:c},url:"platform/bpm/business/getoperateright",dataType:"JSON",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error);else if(a=a.operateRight,null==a)flowUtils.error("\u83b7\u53d6\u6743\u9650\u5931\u8d25");else{var b={};$.each(a,function(a,c){"dosubmit"==c.event&&(null==b.dosubmit&&(b.dosubmit=[]),b.dosubmit.push(c))});f.bpmSubmit=new BpmSubmit(f,f.defaultForm,b,!0);f.bpmSubmit.quickExecute()}}})};