/**
 * 业务操作父类
 *//**
 * 数据模板
 *//**
 * 引用文档
 *//**
 * 按钮基类
 *//**
 * 流程增发
 *//**
 * 关注工作
 *//**
 * 流程结束
 *//**
 * 流程意见修改
 *//**
 * 流程跳转
 *//**
 * 流程恢复
 *//**
 * 流程暂停
 *//**
 * 流程退回，包括退回上一步和退回拟稿人
 *//**
 * 保存
 *//**
 * 自定义选人
 *//**
 * 提交，多个提交合成一个
 *//**
 * 流程转办
 *//**
 * 催办下节点
 *//**
 * 补发
 *//**
 * 增加读者
 *//**
 * 流程转发
 *//**
 * 拿回
 *//**
 * 相关流程
 *//**
 * 发起子流程
 *//**
 * 关联父流程
 *//**
 * 节点内拿回
 */
function DefaultForm(){}DefaultForm.prototype.flowEditor=null;DefaultForm.prototype.isAutoSave=!0;DefaultForm.prototype.id=null;DefaultForm.prototype.setId=function(a){this.id=a};DefaultForm.prototype.initFormData=function(){};DefaultForm.prototype.start=function(a,b){};DefaultForm.prototype.save=function(a){};DefaultForm.prototype.afterCreateButtons=function(){};DefaultForm.prototype.afterControlFormInput=function(){};DefaultForm.prototype.filterSecretLevel=function(a){return a};DefaultForm.prototype.validSecretLevel=function(a){return!0};DefaultForm.prototype.setAttachMagic=function(a){};DefaultForm.prototype.setAttachCanAddOrDel=function(a,b,c){};DefaultForm.prototype.setAttachRequired=function(a,b,c){};DefaultForm.prototype.setAttachSecretLevelModify=function(a,b,c){};DefaultForm.prototype.controlSelfElement=function(a,b,c){};DefaultForm.prototype.controlSelfElementForAccess=function(a,b,c){};DefaultForm.prototype.controlSelfElementForRequired=function(a,b,c){};DefaultForm.prototype.controlSubTableButtonForAccess=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForAccess=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForOperability=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForRequired=function(a,b,c){};DefaultForm.prototype.reGetidea=function(a,b){return a};DefaultForm.prototype.getDefaultIdea=function(a){return null};DefaultForm.prototype.selectUserSuccess=function(a){return!0};DefaultForm.prototype.afterInit=function(){};DefaultForm.prototype.checkUserSecretLevel=function(){return"undefined"!==typeof checkUserSecretLevel&&checkUserSecretLevel};DefaultForm.prototype.secretLevelCode=function(){return"undefined"!==typeof secretLevelCode?secretLevelCode:null};DefaultForm.prototype.beforeSubmit=function(a){return!0};DefaultForm.prototype.afterSubmit=function(a){};DefaultForm.prototype.beforeRetreat=function(a){return!0};DefaultForm.prototype.afterRetreat=function(a){};DefaultForm.prototype.beforeWithdraw=function(a){return!0};DefaultForm.prototype.afterWithdraw=function(a){};DefaultForm.prototype.beforeSupplement=function(a){return!0};DefaultForm.prototype.afterSupplement=function(a){};DefaultForm.prototype.beforeAdduser=function(a){return!0};DefaultForm.prototype.afterAdduser=function(a){};DefaultForm.prototype.beforeSupersede=function(a){return!0};DefaultForm.prototype.afterSupersede=function(a){};DefaultForm.prototype.beforeTransmit=function(a){return!0};DefaultForm.prototype.afterTransmit=function(a){};DefaultForm.prototype.beforeTaskreader=function(a){return!0};DefaultForm.prototype.afterTaskreader=function(a){};DefaultForm.prototype.beforeWithdrawassignee=function(a){return!0};DefaultForm.prototype.afterWithdrawassignee=function(a){};DefaultForm.prototype.beforeGlobalend=function(a){return!0};DefaultForm.prototype.afterGlobalend=function(a){};DefaultForm.prototype.beforeGlobaljump=function(a){return!0};DefaultForm.prototype.afterGlobaljump=function(a){};DefaultForm.prototype.beforeGlobalresume=function(a){return!0};DefaultForm.prototype.afterGlobalresume=function(a){};DefaultForm.prototype.beforeGlobalsuspend=function(a){return!0};DefaultForm.prototype.afterGlobalsuspend=function(a){};DefaultForm.prototype.beforeStepuserdefined=function(a){return!0};DefaultForm.prototype.afterStepuserdefined=function(a){};DefaultForm.prototype.beforePresstodo=function(a){return!0};DefaultForm.prototype.afterPresstodo=function(a){};DefaultForm.prototype.getLeadButCodeList=function(){var a=[];a.push("dosubmit");a.push("dosubmit_mesh");a.push("dostart");a.push("dotransmitsubmit");return a};function FlowModel(a,b,c,d,e){this.defineId=a;this.deploymentId=b;this.entryId=_fileupload_entryId=c;this.executionId=d;this.taskId=e}FlowModel.prototype.defineId=null;FlowModel.prototype.setDefineId=function(a){this.defineId=a};FlowModel.prototype.deploymentId=null;FlowModel.prototype.setDeploymentId=function(a){this.deploymentId=a};FlowModel.prototype.entryId=null;FlowModel.prototype.setEntryId=function(a){this.entryId=_fileupload_entryId=a};FlowModel.prototype.executionId=null;FlowModel.prototype.setExecutionId=function(a){this.executionId=a};FlowModel.prototype.taskId=null;FlowModel.prototype.setTaskId=function(a){this.taskId=a};FlowModel.prototype.activityname=null;FlowModel.prototype.setActivityname=function(a){this.activityname=_fileupload_taskName=a};FlowModel.prototype.activitylabel=null;FlowModel.prototype.setActivitylabel=function(a){this.activitylabel=a};FlowModel.prototype.userIdentityKey=null;FlowModel.prototype.setUserIdentityKey=function(a){this.userIdentityKey=a};FlowModel.prototype.userIdentity=null;FlowModel.prototype.setUserIdentity=function(a){this.userIdentity=a};FlowModel.prototype.ideasBySelf=null;FlowModel.prototype.setIdeasBySelf=function(a){this.ideasBySelf=a};var _fileupload_entryId="",_fileupload_taskName="";function FlowUploader(a){this.flowEditor=a}FlowUploader.prototype.flowEditor=null;FlowUploader.prototype.uploader=null;FlowUploader.prototype.filesdiv="bpm_files_div";FlowUploader.prototype.filesaddId="bpm_files_add";FlowUploader.prototype.filesUploadId="bpm_files_upload";FlowUploader.prototype.secretLevelList=[];FlowUploader.prototype.saveType="DataBase";FlowUploader.prototype.init=function(){var a=this;$.ajax({type:"POST",data:{entryId:this.flowEditor.flowModel.entryId},url:"platform/bpm/business/getSecretLevelList",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.secretLevelList=b.result}});_flowUploader_uploader=this.uploader=WebUploader.create({swf:"static/h5/webuploader-0.1.5/dist/Uploader.swf",server:"platform/bpm/business/upload.json",pick:"#"+this.filesaddId,resize:!1,fileSingleSizeLimit:10485760});this.uploader.on("ready",function(){});this.uploader.on("beforeFileQueued",function(b){if(flowUtils.notNull(a.flowEditor.flowModel.entryId))return!0;flowUtils.warning("\u8bf7\u4fdd\u5b58\u8868\u5355\u540e\u518d\u6dfb\u52a0\u6587\u6863");return!1});this.uploader.on("fileQueued",function(b){a.addFile(b)});this.uploader.on("uploadBeforeSend",function(b,c){var d=$("#"+b.file.id).find('select[name\x3d"secretLevel"]');c.secretLevel=d.val();c.entryId=a.flowEditor.flowModel.entryId;c.saveType=a.saveType});this.uploader.on("uploadProgress",function(a,c){$("#"+a.id).children().last().html("\u6b63\u5728\u4e0a\u4f20")});this.uploader.on("uploadSuccess",function(b,c){if(flowUtils.notNull(c.error))flowUtils.error(c.error);else{var d=$("#"+b.id);d.children().last().html("\u4e0a\u4f20\u6210\u529f");a.uploader.removeFile(b);setTimeout(function(){var b=a.getTr(c.bpmFiles);d.replaceWith(b)},500)}});this.uploader.on("uploadError",function(a,c){flowUtils.error("\u4e0a\u4f20\u5931\u8d25\u4e86")});this.uploader.on("error",function(a,c){"F_EXCEED_SIZE"==a?flowUtils.warning("\u8d85\u8fc7\u9644\u4ef6\u5927\u5c0f\u9650\u5236"):"Q_TYPE_DENIED"==a?flowUtils.warning("\u4e0d\u80fd\u4e0a\u4f20\u7a7a\u6587\u4ef6"):flowUtils.warning("\u9644\u4ef6\u4e0d\u80fd\u4e0a\u4f20")});this.uploader.on("uploadComplete",function(a){});$("#"+this.filesUploadId).on("click",function(){var b=[],c=$("#"+a.filesdiv).find('select[name\x3d"secretLevel"]');$.each(c,function(a,c){b.push(c.value)});a.flowEditor.defaultForm.validSecretLevel(b)&&a.uploader.upload()})};FlowUploader.prototype.refresh=function(){var a=this;this.flowEditor.isStart||"6"!=this.flowEditor.flowModel.userIdentityKey?($("#"+this.filesaddId).hide(),$("#"+this.filesUploadId).hide()):($("#"+this.filesaddId).show(),$("#"+this.filesUploadId).show());$.ajax({type:"POST",data:{entryId:this.flowEditor.flowModel.entryId,defineId:this.flowEditor.flowModel.defineId,activityName:this.flowEditor.flowModel.activityname},url:"platform/bpm/business/getBpmFiles",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):($("#"+a.filesdiv).empty(),$.each(b.result,function(b,d){var c=a.getTr(d);$("#"+a.filesdiv).append(c)}))}})};FlowUploader.prototype.addFile=function(a){var b=$("\x3ctr\x3e\x3c/tr\x3e");b.attr("id",a.id);b.append(this.getTd(a.name));b.append(this.getTdSecretLevel());b.append(this.getTd(""));b.append(this.getTd(""));b.append(this.getOperateTd(!0,a.name,a.id));b.append(this.getTd("\u7b49\u5f85\u4e0a\u4f20"));$("#"+this.filesdiv).append(b)};FlowUploader.prototype.getTr=function(a){var b=$("\x3ctr\x3e\x3c/tr\x3e");b.attr("id",a.id);b.append(this.getTd(a.attachName));b.append(this.getTd(a.secretLevelString));b.append(this.getTd(a.createdByString));b.append(this.getTd(a.creationDateString));b.append(this.getOperateTd(!1,a.attachName,a.id,a.processDefineid));b.append(this.getTd("\u5df2\u4e0a\u4f20"));return b};FlowUploader.prototype.getOperateTd=function(a,b,c,d){b=$("\x3ctd\x3e\x3c/td\x3e");var e=$("\x3ca href\x3d'javascript:void(0);'\x3e\x3ci class\x3d'glyphicon glyphicon-download-alt'\x3e\x3c/i\x3e\x3c/a\x3e"),g=$("\x3ca href\x3d'javascript:void(0);'\x3e\x3ci class\x3d'glyphicon glyphicon-remove'\x3e\x3c/i\x3e\x3c/a\x3e");a?(g.on("click",function(){_flowUploader_removeFile(!0,c)}),b.append(g)):flowUtils.notNull(d)||"6"!=this.flowEditor.flowModel.userIdentityKey?(e.on("click",function(){_flowUploader_downloadFile(c)}),b.append(e)):(e.on("click",function(){_flowUploader_downloadFile(c)}),b.append(e),b.append("\x26nbsp;\x26nbsp;"),g.on("click",function(){_flowUploader_removeFile(!1,c)}),b.append(g));return b};FlowUploader.prototype.getTdSecretLevel=function(){var a=this.flowEditor.defaultForm.filterSecretLevel(flowUtils.clone(this.secretLevelList)),b=$("\x3ctd\x3e\x3c/td\x3e"),c=$("\x3cselect\x3e\x3c/select\x3e");c.attr("name","secretLevel");$.each(a,function(a,b){var d=$("\x3coption\x3e\x3c/option\x3e");d.attr("value",b.lookupCode);d.html(b.lookupName);c.append(d)});b.append(c);return b};FlowUploader.prototype.getTd=function(a){var b=$("\x3ctd\x3e\x3c/td\x3e");b.html(a);return b};var _flowUploader_uploader=null;function _flowUploader_removeFile(a,b){a?(_flowUploader_uploader.removeFile(_flowUploader_uploader.getFile(b)),$("#"+b).remove()):flowUtils.confirm("\u786e\u5b9a\u5220\u9664\uff1f",function(){avicAjax.ajax({type:"POST",data:{id:b},url:"platform/bpm/business/deleteBpmFiles",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):$("#"+b).remove()}})})}function _flowUploader_downloadFile(a){(new FlowDownLoad4URL("iframe","form",null,"platform/bpm/business/doDownload?id\x3d"+a)).downLoad()}function BpmButton(a,b,c,d){this.flowEditor=a;this.defaultForm=b;this.data=c;flowUtils.notNull(this.data)&&(this.enable=!0);this.domeId="";this.isEvent=d}BpmButton.prototype.enable=!1;BpmButton.prototype.isEnable=function(){return this.enable};BpmButton.prototype.execute=function(){flowUtils.success("\u8be5\u65b9\u6cd5\u5f00\u53d1\u4e2d")};BpmButton.prototype.getHtml=function(){if(!this.isEvent)if(this.isEnable()){var a=this;this.data.alias?$("#"+this.domeId).html(this.data.alias):$("#"+this.domeId).html(this.data.lable);$("#"+this.domeId).off("click");$("#"+this.domeId).on("click",function(){a.execute()});$("#"+this.domeId).show();$("#"+this.domeId).parent().show();$("#"+this.domeId).parent().prev().show();$("#bpm_buttons_more").show()}else $("#"+this.domeId).hide(),$("#"+this.domeId).off("click")};BpmButton.prototype.getIdeaText=function(){return this.isEvent?"":this.flowEditor.flowIdea.getIdea(this.ideaElementIdBySelf)};BpmButton.prototype.focusIdeaText=function(){this.flowEditor.flowIdea.focusIdeaText(this.ideaElementIdBySelf)};BpmButton.prototype.hasIdeaElementBySelf=function(){return this.isEvent?!1:this.flowEditor.flowIdea.hasIdeaElementBySelf(this.ideaElementIdBySelf)};BpmButton.prototype.submit=function(a,b){flowUtils.warning("\u672a\u5b9e\u73b0\u7684\u65b9\u6cd5")};BpmButton.prototype.validIdeasBySelf=function(a,b){var c=this;if(null!=this.flowEditor.flowModel.ideasBySelf&&0<this.flowEditor.flowModel.ideasBySelf.length){for(var d="\x3cform class\x3d'container-fluid'\x3e\n",e=!1,g=0;g<this.flowEditor.flowModel.ideasBySelf.length;g++){var f=this.flowEditor.flowModel.ideasBySelf[g];if("0"==f.outcome||f.outcome==a)e=!0,d+="  \x3cdiv class\x3d\"form-group\"\x3e\n    \x3clabel\x3e\x3cinput type\x3d'radio' name\x3d'ideas_radio'/\x3e "+f.content+"\x3c/label\x3e\n  \x3c/div\x3e\n"}e?layer.open({type:1,title:"\u5f3a\u5236\u8868\u6001",area:["300px","400px"],content:d+"\x3c/form\x3e",btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(a,d){var e=$("input[name\x3d'ideas_radio']:checked");0==e.length?flowUtils.warning("\u8bf7\u5148\u8868\u6001"):(c.ideas_text=e.parent().text().trim(),b(),layer.close(a))}}):b()}else b()};BpmButton.prototype.getConditions=function(a){return{isBranch:function(){return null!=a.nextTask&&1<a.nextTask.length?!0:!1},isUserSelectTypeAuto:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.userSelectType?"auto"==a.nextTask[b].currentActivityAttr.userSelectType?!0:!1:!1},isWorkHandUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isWorkHandUser?"no"==a.nextTask[b].currentActivityAttr.isWorkHandUser?!1:!0:!0},getDealType:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.dealType?a.nextTask[b].currentActivityAttr.dealType:"2"},getSingle:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.single?a.nextTask[b].currentActivityAttr.single:"no"},isMustUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isMustUser?"no"==a.nextTask[b].currentActivityAttr.isMustUser?!1:!0:!0},isSecret:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isSecret?"yes"==a.nextTask[b].currentActivityAttr.isMustUser?!0:!1:!1},getIdeaType:function(){return a.currentActivityAttr.ideaType?a.currentActivityAttr.ideaType:""},isIdeaCompelManner:function(){return a.currentActivityAttr.ideaCompelManner?"yes"==a.currentActivityAttr.ideaCompelManner?!0:!1:!1},isNeedIdea:function(){return a.currentActivityAttr.isNeedIdea?"no"==a.currentActivityAttr.isNeedIdea?!1:!0:!0},isSelectUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isSelectUser?"no"==a.nextTask[b].currentActivityAttr.isSelectUser?!1:!0:!0},isAutoGetUser:function(b){"undefined"==typeof b&&(b=0);return null!=a.nextTask&&a.nextTask[b].currentActivityAttr.isAutoGetUser?"no"==a.nextTask[b].currentActivityAttr.isAutoGetUser?!1:!0:!1},getNextActivityType:function(){return a.activityType},isUflow:function(){return"2"==a.isUflow}}};function BpmAdduser(a,b,c,d){BpmButton.call(this,a,b,c.doadduser,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_adduser";this.getHtml()}BpmAdduser.prototype=new BpmButton;BpmAdduser.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeAdduser(this.data)){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.data.procinstDbid,executionId:a.data.executionId,taskId:a.data.taskId,outcome:a.data.name,targetActivityName:a.data.targetActivityName,type:"doadduser"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):(new BpmActor(a.data,b.taskUserSelect,a)).open()}})}};BpmAdduser.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dosupplementassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),opType:"doadduser"},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u52a0\u7b7e\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterAdduser(a)}catch(g){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmFocus(a,b,c,d){BpmButton.call(this,a,b,c.dofocus,d);this.domeId="bpm_focus";this.getHtml()}BpmFocus.prototype=new BpmButton;BpmFocus.prototype.execute=function(){avicAjax.ajax({url:"platform/bpm/business/setFocusedTask",data:{processInstanceId:this.flowEditor.flowModel.entryId,dbid:this.flowEditor.flowModel.taskId},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error,a.errorDetail):0==a.mes?flowUtils.success("\u8be5\u4efb\u52a1\u6b64\u524d\u5df2\u88ab\u5173\u6ce8"):flowUtils.success("\u5df2\u6210\u529f\u5173\u6ce8\u8be5\u4efb\u52a1")}})};BpmFocus.prototype.getHtml=function(){if(this.isEnable()){var a=this;$("#"+this.domeId).off("click");$("#"+this.domeId).on("click",function(){a.execute()});$("#"+this.domeId).show()}else $("#"+this.domeId).hide(),$("#"+this.domeId).off("click")};function BpmGlobalend(a,b,c,d){BpmButton.call(this,a,b,c.doglobalend,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_globalend";this.getHtml()}BpmGlobalend.prototype=new BpmButton;BpmGlobalend.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeGlobalend(this.data)){var a=this;flowUtils.confirm("\u6d41\u7a0b\u4e00\u65e6\u7ed3\u675f\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u60a8\u786e\u5b9a\u7ed3\u675f\u8be5\u6d41\u7a0b\u5417\uff1f",function(){avicAjax.ajax({url:"platform/bpm/business/doend",data:{executionId:a.data.executionId,message:a.getIdeaText()},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterGlobalend(a.data)}catch(c){}}}})})}};function BpmGlobalidea(a,b,c,d){BpmButton.call(this,a,b,c.doglobalidea,d);this.domeId="bpm_globalidea";this.getHtml()}BpmGlobalidea.prototype=new BpmButton;BpmGlobalidea.prototype.execute=function(){var a=this;layer.open({type:1,title:"\u4fee\u6539\u610f\u89c1",area:["800px","450px"],content:"\x3ctable id\x3d'ideaTable'\x3e\x3c/table\x3e",btn:["\u786e\u5b9a","\u5173\u95ed"],success:function(b,c){$("#ideaTable").jqGrid({url:"platform/bpm/business/doGettracksByPage?entryId\x3d"+a.data.procinstDbid,mtype:"POST",datatype:"json",rowNum:-1,colModel:[{name:"dbid",key:!0,hidden:!0},{label:"\u8282\u70b9",name:"currentActiveLabel",align:"center"},{label:"\u5904\u7406\u4eba",name:"assigneeName",align:"center"},{label:"\u63a5\u6536\u65f6\u95f4",name:"iTime",align:"center"},{label:"\u5904\u7406\u65f6\u95f4",name:"eTime",align:"center"},{label:"\u64cd\u4f5c\u7c7b\u578b",name:"opType",align:"center"},{label:"\u5904\u7406\u610f\u89c1",name:"message",editable:!0}],rownumbers:!0,altRows:!0,styleUI:"Bootstrap",autowidth:!0,cellEdit:!0,cellsubmit:"clientArray",height:300})},yes:function(b,c){$("#ideaTable").jqGrid("endEditCell");var d=$("#ideaTable").jqGrid("getChangedCells");avicAjax.ajax({url:"platform/bpm/business/saveGettracks",data:{data:JSON.stringify(d),processInstanceId:a.data.procinstDbid},type:"post",dataType:"json",success:function(c){flowUtils.notNull(c.error)?flowUtils.error(c.error):(flowUtils.success("\u4fee\u6539\u6210\u529f"),layer.close(b),a.flowEditor.refreshTracks())}})}})};function BpmGlobaljump(a,b,c,d){BpmButton.call(this,a,b,c.doglobaljump,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_globaljump";this.getHtml()}BpmGlobaljump.prototype=new BpmButton;BpmGlobaljump.prototype.execute=function(){this.flowEditor.defaultForm.beforeGlobaljump(this.data)&&(this.jumpTaskDialog=layer.open({type:2,title:"\u8df3\u8f6c\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.data.procinstDbid+"\x26type\x3ddoglobaljump"}),this.isEvent&&layer.full(this.jumpTaskDialog),window.bpmGlobaljump=this)};BpmGlobaljump.prototype.callback=function(a,b){layer.close(this.jumpTaskDialog);var c=flowUtils.clone(this.data);flowUtils.notNull(a)&&(c.executionId=a);c.targetActivityName=b;var d=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:c.procinstDbid,executionId:c.executionId,taskId:c.taskId,outcome:c.name,targetActivityName:c.targetActivityName,type:"doglobaljump"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(new BpmActor(c,a.taskUserSelect,d)).open()}})};BpmGlobaljump.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dojump",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{c.isEvent?(flowUtils.success("\u8df3\u8f6c\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u8df3\u8f6c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterGlobaljump(a)}catch(g){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmGlobalresume(a,b,c,d){BpmButton.call(this,a,b,c.doglobalresume,d);this.domeId="bpm_globalresume";this.getHtml()}BpmGlobalresume.prototype=new BpmButton;BpmGlobalresume.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeGlobalresume(this.data)){var a=this;flowUtils.confirm("\u60a8\u786e\u5b9a\u6062\u590d\u8be5\u6d41\u7a0b\u5417\uff1f",function(){avicAjax.ajax({url:"platform/bpm/business/doresume",data:{processInstanceId:a.data.procinstDbid},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");try{a.flowEditor.defaultForm.afterGlobalresume(a.data)}catch(c){}a.flowEditor.createButtons();flowUtils.refreshBack()}}})})}};function BpmGlobalsuspend(a,b,c,d){BpmButton.call(this,a,b,c.doglobalsuspend,d);this.domeId="bpm_globalsuspend";this.getHtml()}BpmGlobalsuspend.prototype=new BpmButton;BpmGlobalsuspend.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeGlobalsuspend(this.data)){var a=this;flowUtils.confirm("\u60a8\u786e\u5b9a\u6682\u505c\u8be5\u6d41\u7a0b\u5417\uff1f",function(){avicAjax.ajax({url:"platform/bpm/business/dosuspend",data:{processInstanceId:a.data.procinstDbid},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f!");try{a.flowEditor.defaultForm.afterGlobalsuspend(a.data)}catch(c){}a.flowEditor.createButtons();flowUtils.refreshBack()}}})})}};function BpmRetreat(a,b,c,d){BpmButton.call(this,a,b,null,d);this.doretreattodraft=c.doretreattodraft;this.doretreattoprev=c.doretreattoprev;this.doretreattowant=c.doretreattowant;this.doretreattoactivity=c.doretreattoactivity;if(flowUtils.notNull(this.doretreattodraft)||flowUtils.notNull(this.doretreattoprev)||flowUtils.notNull(this.doretreattowant)||flowUtils.notNull(this.doretreattoactivity))this.enable=!0,this.flowEditor.needIdeaText=!0;this.getHtml()}BpmRetreat.prototype=new BpmButton;BpmRetreat.prototype.executeTodraft=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattodraft)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeTodraftBack();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeTodraftBack()})}};BpmRetreat.prototype.executeTodraftBack=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.doretreattodraft.procinstDbid,executionId:a.doretreattodraft.executionId,taskId:a.doretreattodraft.taskId,outcome:a.doretreattodraft.name,targetActivityName:a.doretreattodraft.targetActivityName,type:"doretreattodraft"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.validJsonData(a.doretreattodraft,b.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u62df\u7a3f\u4eba\u5417\uff1f")}});this.submit=function(b,c){if(flowUtils.notNull(c)&&0!=c.length){var d=a.getIdeaText();flowUtils.notNull(this.ideas_text)&&(d=this.ideas_text+" "+d);avicAjax.ajax({url:"platform/bpm/business/dobacktofirst",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,userJson:JSON.stringify({users:c,idea:d,compelManner:"",outcome:b.name})},type:"POST",dataType:"JSON",success:function(c){if(flowUtils.notNull(c.error))flowUtils.error(c.error,c.errorDetail);else{a.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterRetreat(b)}catch(g){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeToprev=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattoprev)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeToprevBack();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeToprevBack()})}};BpmRetreat.prototype.executeToprevBack=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.doretreattoprev.procinstDbid,executionId:a.doretreattoprev.executionId,taskId:a.doretreattoprev.taskId,outcome:a.doretreattoprev.name,targetActivityName:a.doretreattoprev.targetActivityName,type:"doretreattoprev"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):a.validJsonData(a.doretreattoprev,b.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u4e0a\u4e00\u6b65\u5417\uff1f")}});this.submit=function(b,c){if(flowUtils.notNull(c)&&0!=c.length){var d=a.getIdeaText();flowUtils.notNull(this.ideas_text)&&(d=this.ideas_text+" "+d);avicAjax.ajax({url:"platform/bpm/business/dobacktoprev",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,userJson:JSON.stringify({users:c,idea:d,compelManner:"",outcome:b.name})},type:"POST",dataType:"JSON",success:function(c){if(flowUtils.notNull(c.error))flowUtils.error(c.error,c.errorDetail);else{a.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterRetreat(b)}catch(g){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeTowant=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattowant)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeTowantSelectTask();a.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){a.executeTowantSelectTask()})}};BpmRetreat.prototype.executeTowantSelectTask=function(){this.retreattowantDialog=layer.open({type:2,title:"\u4efb\u610f\u9000\u56de\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.doretreattowant.procinstDbid+"\x26type\x3ddoretreattowant"});this.isEvent&&layer.full(this.retreattowantDialog);window.bpmRetreatToWant=this};BpmRetreat.prototype.callback=function(a){layer.close(this.retreattowantDialog);var b=flowUtils.clone(this.doretreattowant);b.targetActivityName=a;var c=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,taskId:b.taskId,outcome:b.name,targetActivityName:b.targetActivityName,type:"doretreattowant"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):c.validJsonData(b,a.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u5417\uff1f")}});this.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var d=c.getIdeaText();flowUtils.notNull(this.ideas_text)&&(d=this.ideas_text+" "+d);avicAjax.ajax({url:"platform/bpm/business/dobacktowant",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:d,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{c.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterRetreat(a)}catch(h){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeToactivity=function(a){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattoactivity)){var b=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){b.executeToactivityBack(a);b.flowEditor.createButtons()}):this.validIdeasBySelf("2",function(){b.executeToactivityBack(a)})}};BpmRetreat.prototype.executeToactivityBack=function(a){var b=flowUtils.clone(this.doretreattoactivity);b.targetActivityName=a;var c=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,taskId:b.taskId,outcome:b.name,targetActivityName:b.targetActivityName,type:"doretreattoactivity"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):c.validJsonData(b,a.taskUserSelect,"\u786e\u5b9a\u9000\u56de\u5417\uff1f")}});this.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var d=c.getIdeaText();flowUtils.notNull(this.ideas_text)&&(d=this.ideas_text+" "+d);avicAjax.ajax({url:"platform/bpm/business/dobacktoactivity",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:d,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{c.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterRetreat(a)}catch(h){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.validJsonData=function(a,b,c){var d=this;flowUtils.notNull(b)&&(this.conditions=this.getConditions(b),this.validIdeaMust()&&(this.conditions.isBranch()?(new BpmActor(a,b,this)).open():flowUtils.confirm(c,function(){var c=(new BpmActor(a,b,d)).getUsers();d.submit(a,c)})))};BpmRetreat.prototype.validIdeaMust=function(){if(this.isEvent)return!0;if(this.conditions.isNeedIdea()){var a=this.getIdeaText();if(!flowUtils.notNull(a))return flowUtils.warning("\u8bf7\u586b\u5199\u6d41\u7a0b\u610f\u89c1"),this.focusIdeaText(),!1}return!0};BpmRetreat.prototype.getHtml=function(){if(this.isEvent)return!0;if(this.isEnable()){var a=this,b=$('\x3cbutton class\x3d"listBtn grey btn btn-default dropdown-toggle" type\x3d"button" id\x3d"dropmenu_retreat" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u9000\u56de\x3c/span\x3e\x3ci\x3e\x3c/i\x3e\x3c/button\x3e'),c=$('\x3cul class\x3d"dropdown-menu" aria-labelledby\x3d"dropmenu_retreat"\x3e');if(null!=this.doretreattodraft){var d=$("\x3cli\x3e\x3c/li\x3e"),e=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattodraft.lable+"\x3c/a\x3e");e.on("click",function(){a.executeTodraft()});d.append(e);c.append(d)}null!=this.doretreattoprev&&(d=$("\x3cli\x3e\x3c/li\x3e"),e=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattoprev.lable+"\x3c/a\x3e"),e.on("click",function(){a.executeToprev()}),d.append(e),c.append(d));null!=this.doretreattowant&&(d=$("\x3cli\x3e\x3c/li\x3e"),e=$('\x3ca href\x3d"javascript:void(0);"\x3e'+this.doretreattowant.lable+"\x3c/a\x3e"),e.on("click",function(){a.executeTowant()}),d.append(e),c.append(d));if(null!=this.doretreattoactivity){var d=this.doretreattoactivity.targetName.split(","),g=this.doretreattoactivity.lable.split(",");$.each(d,function(b,d){var e=$("\x3cli\x3e\x3c/li\x3e"),f=$('\x3ca href\x3d"javascript:void(0);"\x3e\u9000\u56de\u5230\u3010'+g[b]+"\u3011\u8282\u70b9\x3c/a\x3e");f.on("click",function(){a.executeToactivity(d)});e.append(f);c.append(e)})}$("#bpm_buttons_default1").append(b);$("#bpm_buttons_default1").append(c)}};function BpmSave(a,b,c,d){BpmButton.call(this,a,b,null,d);this.data=c.doformsave;if(this.flowEditor.isStart||flowUtils.notNull(this.data))this.enable=!0;this.domeId="bpm_save";this.getHtml()}BpmSave.prototype=new BpmButton;BpmSave.prototype.disabled=!1;BpmSave.prototype.execute=function(){var a=this;this.disabled||(this.disabled=!0,setTimeout(function(){a.disabled=!1},2E3),this.flowEditor.isStart?this.defaultForm.start(this.flowEditor.flowModel.defineId,function(b){flowUtils.success("\u6682\u5b58\u6210\u529f");a.flowEditor.afterStart(b);a.flowEditor.createButtons();flowUtils.refreshBack()}):this.defaultForm.save(function(){flowUtils.success("\u6682\u5b58\u6210\u529f");a.flowEditor.createButtons()}))};BpmSave.prototype.getHtml=function(){if(this.isEnable()){var a=this;$("#"+this.domeId).off("click");$("#"+this.domeId).on("click",function(){a.execute()});$("#"+this.domeId).show()}else $("#"+this.domeId).hide(),$("#"+this.domeId).off("click")};function BpmStepuserdefined(a,b,c,d){BpmButton.call(this,a,b,c.dostepuserdefined,d);this.domeId="bpm_stepuserdefined";this.getHtml()}BpmStepuserdefined.prototype=new BpmButton;BpmStepuserdefined.prototype.execute=function(){this.flowEditor.defaultForm.beforeStepuserdefined(this.data)&&(this.stepuserdefinedDialog=layer.open({type:2,title:"\u81ea\u5b9a\u4e49\u5ba1\u6279\u4eba",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.data.procinstDbid+"\x26type\x3ddostepuserdefined"}),this.isEvent&&layer.full(this.stepuserdefinedDialog),window.bpmStepuserdefined=this)};BpmStepuserdefined.prototype.callback=function(a){var b=flowUtils.clone(this.data);b.activityName=a;b.targetActivityName=a;(new BpmActor(b,null,this)).open()};BpmStepuserdefined.prototype.submit=function(a,b){flowUtils.notNull(b)&&0!=b.length?avicAjax.ajax({url:"platform/bpm/business/douserdefined",data:{procinstDbid:a.procinstDbid,userJson:JSON.stringify({users:b,idea:"",compelManner:"",outcome:a.name}),activityName:a.activityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");try{_self.flowEditor.defaultForm.afterStepuserdefined(a)}catch(d){}}}}):flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmSubmit(a,b,c,d){BpmButton.call(this,a,b,null,d);this.data=c.dosubmit;this.transmitData=c.dotransmitsubmit;if(this.flowEditor.isStart||flowUtils.notNull(this.data)||flowUtils.notNull(this.transmitData))this.enable=!0;flowUtils.notNull(c.dosubmit)&&flowUtils.notNull(c.dosubmit[0].attribute)&&flowUtils.notNull(c.dosubmit[0].attribute.ideaElementIdBySelf)&&(this.ideaElementIdBySelf=c.dosubmit[0].attribute.ideaElementIdBySelf);this.enable&&!this.hasIdeaElementBySelf()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_submit";this.getHtml();this.isAutoClickAfterStart=!1}BpmSubmit.prototype=new BpmButton;BpmSubmit.prototype.disabled=!1;BpmSubmit.prototype.execute=function(a){var b=this;this.disabled||(this.disabled=!0,setTimeout(function(){b.disabled=!1},2E3),this.flowEditor.isStart?this.defaultForm.start(this.flowEditor.flowModel.defineId,function(a){b.flowEditor.afterStart(a);b.flowEditor.createButtons(!0);flowUtils.refreshBack()}):this.flowEditor.defaultForm.beforeSubmit(a)&&(!this.isAutoClickAfterStart&&!this.isEvent&&this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){b.flowEditor.createButtons(!0,a.name)}):this.validIdeasBySelf("1",function(){b.executeBack(a)})))};BpmSubmit.prototype.executeBack=function(a){var b=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,taskId:a.taskId,outcome:a.name,targetActivityName:a.targetActivityName,type:"dosubmit"},type:"POST",dataType:"JSON",success:function(c){flowUtils.notNull(c.error)?flowUtils.error(c.error):b.validJsonData(a,c.taskUserSelect)}})};BpmSubmit.prototype.validJsonData=function(a,b){var c=this;if(flowUtils.notNull(b))if(this.conditions=this.getConditions(b),!this.isEvent&&this.conditions.isIdeaCompelManner()&&0==$(".bpm_compelManner_div input[name\x3d'bpm_compelManner']:checked").length)$(".bpm_compelManner_div").show(),flowUtils.warning("\u8bf7\u60a8\u8868\u6001");else if(this.validIdeaMust()){var d=this.conditions.getNextActivityType();if(d)if("end"==d)flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});else{if("sub-process"==d){if(!this.conditions.isMustUser()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});return}}else if("foreach"==d){if(!this.conditions.isMustUser()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)});return}}else if("task"==d&&!this.conditions.isBranch()){if(!this.conditions.isSelectUser()&&this.conditions.isUserSelectTypeAuto()){flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){var d=(new BpmActor(a,b,c)).getUsers();c.submit(a,d)});return}if(!this.conditions.isSelectUser()){flowUtils.warning("\u914d\u7f6e\u9519\u8bef\uff1a\u914d\u7f6e\u4e0d\u663e\u793a\u9009\u4eba\u6846\uff0c\u4f46\u672a\u914d\u7f6e\u81ea\u52a8\u9009\u4eba");return}}(new BpmActor(a,b,this,this.conditions.isUflow())).open()}else b.nextTask||flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){c.submit(a,[],!0)})}};BpmSubmit.prototype.validIdeaMust=function(){if(!this.isEvent&&"must"==this.conditions.getIdeaType()){var a=this.getIdeaText();if(!flowUtils.notNull(a))return flowUtils.warning("\u8bf7\u586b\u5199\u6d41\u7a0b\u610f\u89c1"),this.focusIdeaText(),!1}return!0};BpmSubmit.prototype.submit=function(a,b,c,d){if(c||flowUtils.notNull(b)&&0!=b.length){c=this.isEvent?"\u540c\u610f":this.getIdeaText();c=this.flowEditor.defaultForm.reGetidea(c,b);var e="";this.conditions.isIdeaCompelManner()&&(e=this.isEvent?"yes":$(".bpm_compelManner_div input[name\x3d'bpm_compelManner']:checked").val());flowUtils.notNull(this.ideas_text)&&(c=this.ideas_text+" "+c);var g=this;avicAjax.ajax({url:"platform/bpm/business/dosubmit",data:{instanceId:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify({users:b,idea:c,compelManner:e,outcome:a.name}),outcome:a.name,formJson:null,uflowDealType:d,isUflow:this.conditions.isUflow()},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{g.isEvent?flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01",function(){flowUtils.refreshCurrentBack()},!0):flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){g.flowEditor.createButtons()},500)},!0);try{g.flowEditor.defaultForm.afterSubmit(a)}catch(h){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};BpmSubmit.prototype.getHtml=function(){if(this.isEnable()&&!this.isEvent){var a=this;if(null!=this.data&&1<this.data.length){var b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3ci\x3e\x3c/i\x3e\x3c/button\x3e');b.attr("id",this.domeId);var c=$('\x3cul class\x3d"dropdown-menu" aria-labelledby\x3d"'+this.domeId+'"\x3e');$.each(this.data,function(b,d){var e=$("\x3cli\x3e\x3c/li\x3e"),g=$('\x3ca href\x3d"javascript:void(0);"\x3e'+d.lable+"\x3c/a\x3e");g.attr("title",d.description);g.on("click",function(){a.execute(d)});e.append(g);c.append(e);flowUtils.notNull(d.attribute)&&"yes"==d.attribute.ideaCompelManner&&$(".bpm_compelManner_div").show()});$("#bpm_buttons_default2").append(b);$("#bpm_buttons_default2").append(c)}else if(null!=this.data){var d=this.data[0],b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e');b.attr("id",this.domeId);b.attr("title",d.description);b.on("click",function(){a.execute(d)});$("#bpm_buttons_default2").append(b);flowUtils.notNull(d.attribute)&&"yes"==d.attribute.ideaCompelManner&&$(".bpm_compelManner_div").show()}else null!=this.transmitData?(b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e'),b.attr("id",this.domeId),b.attr("title","\u586b\u5199\u610f\u89c1"),b.on("click",function(){a.executeTransmit()}),$("#bpm_buttons_default2").append(b)):(b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt" id\x3d"bpm_firsttasksubmitname"\x3e\u63d0\u4ea4\x3c/span\x3e\x3c/button\x3e'),b.attr("id",this.domeId),b.on("click",function(){a.execute()}),$("#bpm_buttons_default2").append(b),flowUtils.notNull(this.flowEditor.ideaCompelManner)&&"yes"==this.flowEditor.ideaCompelManner&&$(".bpm_compelManner_div").show(),$.ajax({url:"platform/bpm/business/getFirstTaskSubmitName",data:{},type:"POST",dataType:"TEXT",success:function(a){flowUtils.notNull(a)&&$("#bpm_firsttasksubmitname").html(a)}}))}};BpmSubmit.prototype.executeTransmit=function(){var a=this;flowUtils.confirm("\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",function(){a.submitTransmit()})};BpmSubmit.prototype.submitTransmit=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/dosubmitTransmit",data:{instanceId:this.transmitData.procinstDbid,message:this.getIdeaText(),taskId:this.transmitData.taskId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error,b.errorDetail):flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0)}})};BpmSubmit.prototype.clickBut=function(a){var b=this;if(this.isEnable())if(flowUtils.notNull(a)){if(null!=this.data&&0<this.data.length)for(var c=0;c<this.data.length;c++)if(this.data[c].name==a){this.validIdeasBySelf("1",function(){b.executeBack(b.data[c])});return}layer.msg("\u8def\u7531\u6761\u4ef6\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\uff0c\u8bf7\u91cd\u65b0\u8fdb\u884c\u63d0\u4ea4")}else if(null!=this.data&&1<this.data.length)layer.msg("\u6d41\u7a0b\u5df2\u521b\u5efa\uff0c\u8bf7\u9009\u62e9\u4e00\u4e2a\u5206\u652f\u8fdb\u884c\u63d0\u4ea4"),$("#"+this.domeId).parent().addClass("open");else if(null!=this.data){this.isAutoClickAfterStart=!0;try{$("#"+this.domeId).click()}catch(d){this.isAutoClickAfterStart=!1}this.isAutoClickAfterStart=!1}};BpmSubmit.prototype.quickExecute=function(){if(this.isEnable()&&this.isEvent){var a=this;if(null!=this.data&&1<this.data.length){var b="";$.each(this.data,function(a,d){b=0==a?b+('\x3cinput checked _val\x3d"'+a+'" type\x3d"radio" name\x3d"submitName" id\x3d"'+d.id+'"\x3e\x26nbsp;\x26nbsp;\x3clabel for\x3d"'+d.id+'"\x3e'+d.lable+"\x3c/label\x3e"):b+('\x3cbr/\x3e\x3cinput _val\x3d"'+a+'" type\x3d"radio" name\x3d"submitName" id\x3d"'+d.id+'"\x3e\x26nbsp;\x26nbsp;\x3clabel for\x3d"'+d.id+'"\x3e'+d.lable+"\x3c/label\x3e")});layer.open({title:"\u8bf7\u9009\u62e9\u529e\u7406\u4e8b\u9879",content:b,btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(b,d){var c=d.find("input[name\x3d'submitName']:checked");0==c.length?flowUtils.error("\u8bf7\u9009\u62e9\u529e\u7406\u4e8b\u9879"):(c=Number(c.attr("_val")),layer.close(b),a.execute(a.data[c]))}})}else null!=this.data&&this.execute(this.data[0])}else flowUtils.error("\u76ee\u524d\u6ca1\u6709\u529e\u7406\u6743\u9650")};function BpmSupersede(a,b,c,d){BpmButton.call(this,a,b,c.dosupersede,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_supersede";this.getHtml()}BpmSupersede.prototype=new BpmButton;BpmSupersede.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeSupersede(this.data)){var a=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:a.data.procinstDbid,executionId:a.data.executionId,taskId:a.data.taskId,outcome:a.data.name,targetActivityName:a.data.targetActivityName,type:"dosupersede"},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):(new BpmActor(a.data,b.taskUserSelect,a)).open()}})}};BpmSupersede.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dosupersede",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),selectUserId:null,formJson:null,activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterSupersede(a)}catch(g){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmPresstodo(a,b,c,d){BpmButton.call(this,a,b,c.dopresstodo,d);this.domeId="bpm_presstodo";this.getHtml()}BpmPresstodo.prototype=new BpmButton;BpmPresstodo.prototype.execute=function(){if(this.flowEditor.defaultForm.beforePresstodo(this.data)){var a=this;avicAjax.ajax({url:"platform/bpm/business/beforepresstodo",data:{executionId:a.data.executionId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error,b.errorDetail):a.presstodo(b.result)}})}};BpmPresstodo.prototype.presstodo=function(a){var b=this,c="",c="true"==a.flg?"\u786e\u5b9a\u5bf9\u4e0b\u4e00\u8282\u70b9\u8fdb\u884c\u50ac\u529e\u5417\uff1f"+a.msg:"\u4e0b\u4e00\u8282\u70b9\u5728"+a.time+"\u88ab\u50ac\u529e\u8fc7\uff0c\u786e\u5b9a\u7ee7\u7eed\u8fdb\u884c\u50ac\u529e\u5417\uff1f"+a.msg;flowUtils.confirm(c,function(){avicAjax.ajax({url:"platform/bpm/business/dopresstodo",data:{executionId:b.data.executionId},type:"POST",dataType:"JSON",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error,a.errorDetail);else{flowUtils.success("\u50ac\u529e\u6210\u529f");try{b.flowEditor.defaultForm.afterPresstodo(b.data)}catch(e){}}}})})};function BpmSupplement(a,b,c,d){BpmButton.call(this,a,b,c.dosupplement,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_supplement"}BpmSupplement.prototype=new BpmButton;BpmSupplement.prototype.getHtmlForDefaultBar=function(){if(this.isEnable()){var a=this,b=$('\x3cbutton class\x3d"listBtn btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e'+this.data.lable+"\x3c/span\x3e\x3c/button\x3e");b.on("click",function(){a.execute()});$("#bpm_buttons_default2").append(b)}};BpmSupplement.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeSupplement(this.data)){var a=this;avicAjax.ajax({type:"POST",data:{processInstanceId:a.data.procinstDbid},url:"platform/bpm/clientbpmdisplayaction/getcoordinate",dataType:"json",success:function(b){if(flowUtils.notNull(b,b.activity)){for(var c in b.activity){var d=b.activity[c],e=d.activityName,g=d.isCurrent,f=d.executionId;if(d.executionAlone&&"true"==g){a.callback(f,e);return}}a.supplementTaskDialog=layer.open({type:2,title:"\u8865\u53d1\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+a.data.procinstDbid+"\x26type\x3ddosupplement"});a.isEvent&&layer.full(a.supplementTaskDialog);window.bpmSupplement=a}}})}};BpmSupplement.prototype.callback=function(a,b){flowUtils.notNull(this.supplementTaskDialog)&&(layer.close(this.supplementTaskDialog),this.supplementTaskDialog=null);var c=flowUtils.clone(this.data);c.executionId=a;c.targetActivityName=b;var d=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:c.procinstDbid,executionId:c.executionId,taskId:c.taskId,outcome:c.name,targetActivityName:c.targetActivityName,type:"dosupplement"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(new BpmActor(c,a.taskUserSelect,d)).open()}})};BpmSupplement.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dosupplementassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),opType:"dosupplement"},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u8865\u53d1\u6210\u529f");try{c.flowEditor.defaultForm.afterSupplement(a)}catch(g){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmTaskreader(a,b,c,d){BpmButton.call(this,a,b,c.dotaskreader,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_taskreader";this.getHtml()}BpmTaskreader.prototype=new BpmButton;BpmTaskreader.prototype.execute=function(){this.flowEditor.defaultForm.beforeTaskreader(this.data)&&(new BpmActor(this.data,null,this)).open()};BpmTaskreader.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dotaskreader",data:{procinstDbid:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify(d)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterTaskreader(a)}catch(g){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmTransmit(a,b,c,d){BpmButton.call(this,a,b,c.dotransmit,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_transmit";this.getHtml()}BpmTransmit.prototype=new BpmButton;BpmTransmit.prototype.execute=function(){this.flowEditor.defaultForm.beforeTransmit(this.data)&&(new BpmActor(this.data,null,this)).open()};BpmTransmit.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dotransmit",data:{procinstDbid:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify(d)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");c.isEvent&&flowUtils.refreshCurrentBack();try{c.flowEditor.defaultForm.afterTransmit(a)}catch(g){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmWithdraw(a,b,c,d){BpmButton.call(this,a,b,c.dowithdraw,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_withdraw"}BpmWithdraw.prototype=new BpmButton;BpmWithdraw.prototype.getHtmlForDefaultBar=function(){if(this.isEnable()){var a=this,b=$('\x3cbutton class\x3d"listBtn grey btn btn-default dropdown-toggle center" type\x3d"button" data-toggle\x3d"dropdown" aria-haspopup\x3d"true" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"txt"\x3e'+this.data.lable+"\x3c/span\x3e\x3c/button\x3e");b.on("click",function(){a.execute()});$("#bpm_buttons_default1").append(b)}};BpmWithdraw.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeWithdraw(this.data)){var a=this;avicAjax.ajax({type:"POST",data:{processInstanceId:a.data.procinstDbid},url:"platform/bpm/clientbpmdisplayaction/getcoordinate",dataType:"json",success:function(b){if(flowUtils.notNull(b,b.activity)){for(var c in b.activity){var d=b.activity[c],e=d.activityName,g=d.isCurrent,f=d.executionId;if(d.executionAlone&&"true"==g){a.callback(f,e);return}if(f==a.data.executionId){a.callback(f,e);return}}a.withdrawTaskDialog=layer.open({type:2,title:"\u62ff\u56de\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+a.data.procinstDbid+"\x26type\x3ddowithdraw"});a.isEvent&&layer.full(a.withdrawTaskDialog);window.bpmWithdraw=a}}})}};BpmWithdraw.prototype.callback=function(a,b){var c=this;flowUtils.notNull(this.withdrawTaskDialog)&&(layer.close(this.withdrawTaskDialog),this.withdrawTaskDialog=null);var d=flowUtils.clone(this.data);d.executionId=a;d.targetActivityName=b;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:d.procinstDbid,executionId:d.executionId,taskId:d.taskId,outcome:d.name,targetActivityName:d.targetActivityName,type:"dowithdraw"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):flowUtils.confirm("\u786e\u5b9a\u62ff\u56de\u5417\uff1f",function(){var b=(new BpmActor(d,a.taskUserSelect,c)).getUsers();c.submit(d,b)})}})};BpmWithdraw.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dowithdrawcurract",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u62ff\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterWithdraw(a)}catch(g){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmRelationflow(a,b,c,d){BpmButton.call(this,a,b,c.dorelationprocess,d);this.domeId="bpm_relationprocess";this.getHtml()}BpmRelationflow.prototype=new BpmButton;BpmRelationflow.prototype.execute=function(){var a=this;this.index=layer.open({type:2,area:["90%","90%"],title:"\u6dfb\u52a0",skin:"bs-modal",maxmin:!1,content:"avicit/platform6/bpmreform/bpmbusiness/include/relatedBpm.jsp?pid\x3d"+encodeURIComponent(this.data.procinstDbid),end:function(){a.flowEditor.reloadProcesslevelPage()}})};function BpmStartsubflow(a,b,c,d){BpmButton.call(this,a,b,c.dostartsubprocess,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_startsubprocess";this.getHtml()}BpmStartsubflow.prototype=new BpmButton;BpmStartsubflow.prototype.execute=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/getSubPdId",data:{procinstDbid:this.data.procinstDbid,executionId:this.data.executionId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):0==b.ids.length?a.showAllFlowModel():1==b.ids.length?a.executeUserInfo(b.ids[0].id):a.executeSelectId(b.ids)}})};var _bpm_BpmStartsubflow=null;BpmStartsubflow.prototype.showAllFlowModelFlg=!1;BpmStartsubflow.prototype.showAllFlowModel=function(){_bpm_BpmStartsubflow=this;var a=this;layer.open({type:2,title:"\u9009\u62e9\u5b50\u6d41\u7a0b\u6a21\u677f",area:["800px","450px"],content:"platform/bpm/business/showAllFlowModel",end:function(){a.showAllFlowModelFlg=!1}});this.showAllFlowModelFlg=!0};BpmStartsubflow.prototype.executeSelectId=function(a){var b=this;layer.open({type:1,area:["300px","450px"],title:"\u6d41\u7a0b\u6a21\u677f\u9009\u62e9",content:"\x3ctable id\x3d'processGrid'\x3e\x3c/table\x3e",btn:["\u786e\u5b9a","\u5173\u95ed"],success:function(c,d){$("#processGrid").jqGrid({datastr:JSON.stringify(a),datatype:"jsonstring",colModel:[{name:"id",key:!0,hidden:!0},{label:"\u6d41\u7a0b\u540d\u79f0",name:"name",align:"center"}],rownumbers:!0,altRows:!0,styleUI:"Bootstrap",autowidth:!0,height:"100%",multiselect:!1,multiboxonly:!0,beforeSelectRow:b.beforeSelectRow})},yes:function(a,d){var c=$("#processGrid").jqGrid("getGridParam","selrow");""!=c?(b.executeUserInfo(c),layer.close(a)):layer.msg("\u8bf7\u9009\u62e9\u6570\u636e")}})};BpmStartsubflow.prototype.beforeSelectRow=function(){$("#processGrid").jqGrid("resetSelection");return!0};BpmStartsubflow.prototype.executeUserInfo=function(a){this.showAllFlowModelFlg&&layer.closeAll();this.data.deployId=a;var b=this;avicAjax.ajax({url:"platform/bpm/business/getActJsonInfo",data:{procinstDbid:b.data.procinstDbid,executionId:b.data.executionId,taskId:b.data.taskId,outcome:b.data.name,targetActivityName:b.data.targetActivityName,type:"dostartsubprocess"},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(new BpmActor(b.data,a.taskUserSelect,b)).open()}})};BpmStartsubflow.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dostartsubprocess",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d),id:a.deployId},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(flowUtils.success("\u64cd\u4f5c\u6210\u529f!"),c.flowEditor.createButtons(),c.flowEditor.reloadProcesslevelPage(),flowUtils.refreshBack())}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmRelationparentflow(a,b,c,d){BpmButton.call(this,a,b,c.dorelationparentprocess,d);this.domeId="bpm_relationparentprocess";this.getHtml()}BpmRelationparentflow.prototype=new BpmButton;BpmRelationparentflow.prototype.showDialog=function(a,b){var c=this;layer.open({type:2,area:["100%","100%"],title:"\u6dfb\u52a0\u9875",skin:"bs-modal",maxmin:!1,btn:["\u4fdd\u5b58","\u53d6\u6d88\u5df2\u5173\u8054\u7684\u7236\u6d41\u7a0b","\u8fd4\u56de"],content:"avicit/platform6/bpmreform/bpmbusiness/include/SubprocessAdd.jsp",yes:function(b,c){var d=layer.getChildFrame("body",b),e=d.find("#firstjqGrid").getGridParam("selarrrow"),h=e.length;0==h?flowUtils.warning("\u8bf7\u9009\u62e9\u8981\u5173\u8054\u7684\u7236\u6d41\u7a0b\uff01"):1<h?flowUtils.warning("\u53ea\u5141\u8bb8\u5173\u8054\u4e00\u6761\u7236\u6d41\u7a0b\uff01"):(d=d.find("#firstjqGrid").getRowData(e[0]),avicAjax.ajax({url:"bpm/business/related/subProcessSaveData",data:{dbid1:a,task:"",dbid2:d.dbId},type:"post",dataType:"json",success:function(a){"success"==a.flag?(flowUtils.success("\u5173\u8054\u6210\u529f\uff01"),layer.close(b)):"same"==a.flag?flowUtils.warning("\u7236\u6d41\u7a0b\u4e0d\u80fd\u4e0e\u5f53\u524d\u6d41\u7a0b\u76f8\u540c\uff01"):"parentOrSub"==a.flag?flowUtils.warning("\u5df2\u7ecf\u5b58\u5728\u7236\u5b50\u6d41\u7a0b\u5173\u7cfb\uff01"):flowUtils.warning("\u5173\u8054\u5931\u8d25\uff01")}}));return!1},end:function(){c.flowEditor.createButtons();c.flowEditor.reloadProcesslevelPage()},btn2:function(c,e){if(!b)return flowUtils.warning("\u5f53\u524d\u65e0\u5df2\u5173\u8054\u7684\u7236\u6d41\u7a0b\uff01"),!1;flowUtils.confirm("\u786e\u5b9a\u53d6\u6d88\u5df2\u5173\u8054\u7684\u7236\u6d41\u7a0b\u5417?",function(){avicAjax.ajax({url:"bpm/business/related/subDelData",data:{id:a},type:"post",dataType:"json",success:function(a){"success"==a.flag?(flowUtils.success("\u53d6\u6d88\u6210\u529f\uff01"),layer.close(c)):flowUtils.warning("\u53d6\u6d88\u5931\u8d25\uff01")}})});return!1}})};BpmRelationparentflow.prototype.execute=function(){var a=this,b=this.data.procinstDbid;avicAjax.ajax({url:"bpm/business/related/findSubProcessById",data:{data:b},type:"post",dataType:"json",success:function(c){"success"==c.flag?a.showDialog(b,!1):"exist"==c.flag?flowUtils.confirm("\u5df2\u5173\u8054\u7236\u6d41\u7a0b\uff0c\u786e\u8ba4\u8981\u91cd\u65b0\u5173\u8054\u5417?",function(){a.showDialog(b,!0)}):"existAndNoEdit"==c.flag?flowUtils.warning("\u8be5\u6d41\u7a0b\u4e3a\u7236\u6d41\u7a0b\u81ea\u52a8\u53d1\u8d77\uff0c\u4e0d\u5141\u8bb8\u624b\u52a8\u5173\u8054\u7236\u6d41\u7a0b\uff01"):"failure"==c.flag&&flowUtils.warning("\u67e5\u8be2\u6570\u636e\u5f02\u5e38\uff01")}})};function BpmWithdrawassignee(a,b,c,d){BpmButton.call(this,a,b,c.dowithdrawassignee,d);this.isEnable()&&(this.flowEditor.needIdeaText=!0);this.domeId="bpm_withdrawassignee";this.getHtml()}BpmWithdrawassignee.prototype=new BpmButton;BpmWithdrawassignee.prototype.execute=function(){this.flowEditor.defaultForm.beforeWithdrawassignee(this.data)&&(new BpmActor(this.data,null,this)).open()};BpmWithdrawassignee.prototype.submit=function(a,b){if(flowUtils.notNull(b)&&0!=b.length){var c=this,d={users:b,idea:c.getIdeaText(),compelManner:"",outcome:a.name};avicAjax.ajax({url:"platform/bpm/business/dowithdrawactassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify(d)},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u51cf\u7b7e\u6210\u529f");try{c.flowEditor.defaultForm.afterWithdrawassignee(a)}catch(g){}c.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};var mxBasePath="avicit/platform6/bpmreform/bpmdesigner/editors/mxgraph/src";flowUtils.include("avicit/platform6/bpmreform/bpmdesigner/editors/mxgraph/mxClient.js");flowUtils.include("avicit/platform6/bpmreform/bpmdesigner/editors/js/CountUtils.js");flowUtils.include("avicit/platform6/bpmreform/bpmdesigner/editors/js/DesignerEditor.js");flowUtils.include("avicit/platform6/bpmreform/bpmdesigner/picture/MyDesignerEditor.js");var designerEditor=null,_iconType;function initFlowPic(a,b,c){designerEditor=new MyDesignerEditor;mxUtils.alert=function(a){flowUtils.warning(a)};mxGraph.prototype.htmlLabels=!0;mxGraph.prototype.collapseExpandResource="";mxConstants.DEFAULT_HOTSPOT=1;mxGraphHandler.prototype.guidesEnabled=!0;mxGuide.prototype.isEnabledForEvent=function(a){return!mxEvent.isAltDown(a)};mxEdgeHandler.prototype.snapToTerminals=!0;avicAjax.ajax({type:"POST",data:{entryId:a,deploymentId:b},url:"platform/bpm/business/getIconType",dataType:"json",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error);else{mxObjectCodec.allowEval=!0;var b="";_iconType=a.iconType;"1"==a.iconType?b="avicit/platform6/bpmreform/bpmdesigner/picture/config/new/workfloweditor.xml":(b="avicit/platform6/bpmreform/bpmdesigner/picture/config/workfloweditor.xml",$(".uFlowKeyCss").hide(),$(".uFlowKeyCss").next().hide());a=mxUtils.load(b).getDocumentElement();a=new mxEditor(a);mxObjectCodec.allowEval=!1;designerEditor.setEditor(a);a.graph.addListener(mxEvent.CLICK,function(a,b){var c=b.getProperty("cell");if(flowUtils.notNull(c)){var d=c.id,c=c.pid;flowUtils.notNull(c)&&(d=c);d=designerEditor.myCellMap.get(d);flowUtils.notNull(d)&&"function"==typeof d.actNodeClick&&d.actNodeClick()}});c(designerEditor)}}});flowUtils.notNull(a)&&($.ajax({type:"POST",data:{entryId:a},url:"platform/bpm/business/getParentprocess",dataType:"text",success:function(a){flowUtils.notNull(a)&&($("#bpmParentFlowPic").show(),$("#bpmParentFlowPic").on("click",function(){var b=layer.open({type:2,title:"\u7236\u6d41\u7a0b",area:["800px","450px"],content:"avicit/platform6/bpmreform/bpmdesigner/picture/picAndTracks.jsp?entryId\x3d"+a});layer.full(b)}))}}),"undefined"!=typeof _showBpmOpenFormBut&&($("#bpmOpenForm").show(),$("#bpmOpenForm").on("click",function(){flowUtils.detail(a,"2")})))}function bpm_RefreshTracks(a){flowUtils.notNull(a)&&$.ajax({type:"POST",data:{entryId:a},url:"platform/bpm/business/doGettracks",dataType:"JSON",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error);else{var b=a.textTrackLimit;$(".bpm_tracks_list").empty();$.each(a.result.tracklist,function(a,c){$.each(c,function(d,g){if(d>=b){var e=$("\x3ctr class\x3d'\" + tempClass + \"'\x3e\x3c/tr\x3e");e.append($("\x3ctd\x3e\x3c/td\x3e"));e.append($("\x3ctd\x3e\x3c/td\x3e"));e.append($("\x3ctd\x3e\x3c/td\x3e"));e.append($("\x3ctd\x3e\x3c/td\x3e"));e.append($("\x3ctd\x3e\x3c/td\x3e"));e.append($("\x3ctd\x3e\x3c/td\x3e"));e.append($("\x3ctd\x3e\x3c/td\x3e"));var f=$("\x3ca href\x3d'javascript:void(0)'\x3e\u66f4\u591a\x3c/a\x3e");f.on("click",function(){layer.open({type:2,title:"\u6587\u5b57\u8ddf\u8e2a",skin:"bs-modal",area:["100%","100%"],maxmin:!1,content:"bpm/business/openSearchTracks?processInstanceId\x3d"+g.processInstanceId+"\x26historyActivityInstanceId\x3d"+g.historyActivityInstanceId})});var h=$("\x3ctd\x3e\x3c/td\x3e");h.append(f);e.append(h);$(".bpm_tracks_list").append(e);return!1}var q="bpm_tracks_"+a,e=$("\x3ctr\x3e\x3c/tr\x3e");e.addClass(q);e.hover(function(){$("."+q).addClass("hover")},function(){$("."+q).removeClass("hover")});f=$("\x3ctd\x3e\x3c/td\x3e");f.html(g.currentActiveLabel);1<c.length&&(0==d?(f.attr("rowspan",c.length>b?2*b:2*c.length-1),f.addClass("merge")):(f=null,$(".bpm_tracks_list").append($("\x3ctr class\x3d'"+q+"'\x3e\x3c/tr\x3e"))));e.append(f);e.append(bpm_createTd(g.assigneeName,null));e.append(bpm_createTd(g.iTime,null));e.append(bpm_createTd(g.oTime,null));e.append(bpm_createTd(g.eTime,null));e.append(bpm_createTd(g.opType,null));e.append(bpm_createTd(g.useTime,null));e.append(bpm_createTd(g.targetuser,null));e.append(bpm_createTd(g.message,null));$(".bpm_tracks_list").append(e)})});var d={list:[]};$.each(a.result.timelist,function(a,b){var c={};c.title=b[0].dayName;c.list=[];$.each(b,function(a,b){var d={};d.l=b.timeName;d.r='\x3cspan style\x3d"color:#c426b3"\x3e'+b.operateUserName+'\x3c/span\x3e\u5728\x3cspan style\x3d"color:#2d52df"\x3e'+b.currentActiveLabel+"\x3c/span\x3e\u8282\u70b9\u8fdb\u884c\u4e86"+bpm_createOpTypeTd(b.opType)+"\u64cd\u4f5c";flowUtils.notNull(b.targetuser)&&(d.r+=',\u76ee\u6807\u63a5\u6536\u4eba\u662f\x3cspan style\x3d"color:#c426b3"\x3e'+b.targetuser+"\x3c/span\x3e");d.r+="\x3cbr/\x3e\x3ci class\x3d'glyphicon glyphicon-pencil'\x3e\x3c/i\x3e\x3cspan style\x3d\"color:#2d52df\"\x3e"+$.trim(b.message)+"\x3c/span\x3e";c.list.push(d)});d.list.push(c)});$(".time-line").timeliner({data:d})}}})}function bpm_createTd(a,b){var c=$("\x3ctd\x3e\x3c/td\x3e");c.html(a);flowUtils.notNull(b)&&c.css("border-top",b);return c}function bpm_createOpTypeTd(a){return'\x3cspan style\x3d"color:#49bd32"\x3e'+a+"\x3c/span\x3e"}function BpmActor(a,b,c,d){this.data=a;this.submitObj=c;this.taskJsonData=b;this.isUflow=d}BpmActor.prototype.open=function(){var a=this,b=a.getActorHandTitle();flowUtils.notNull(b)||(b="\u4e0b\u4e00\u8282\u70b9");top.layer.open({skin:"bpm_selectUser_class",type:2,title:"\u9009\u62e9\u3010"+b+"\u3011\u5904\u7406\u4eba",area:["800px","450px"],content:"platform/bpmActor/bpmSelectUserAction2/main?procinstDbid\x3d"+this.data.procinstDbid+"\x26executionId\x3d"+this.data.executionId+"\x26taskId\x3d"+this.data.taskId+"\x26outcome\x3d"+this.data.name+"\x26targetActivityName\x3d"+this.data.targetActivityName+"\x26type\x3d"+this.data.event+"\x26doSubmitUrl\x3d\x26doSubmitCallEvent\x3d",btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(b,d){var c=d.find("iframe")[0].contentWindow,g=c.getSelectedUsers(),f=c.targetActivityName;if(("yes"==c.currentActivityAttr_single||"1"==c.currentActivityAttr_dealType)&&1<g.length)top.layer.msg("\u5f53\u524d\u8282\u70b9\u53ea\u5141\u8bb8\u9009\u62e9\u4e00\u4e2a\u5904\u7406\u4eba\uff01");else if(null==g||0==g.length)top.layer.msg("\u8bf7\u9009\u62e9\u5904\u7406\u4eba");else{if(1==g.length&&"carbonCopy"==g[0].targetActivityName)return top.layer.msg("\u8bf7\u9009\u62e9\u5904\u7406\u4eba"),!1;if(a.submitObj instanceof BpmSubmit&&!a.submitObj.flowEditor.defaultForm.selectUserSuccess(g))return!1;c=a.getUflowDealType();if(a.checkIsBranch()){if(a.checkWorkHandUser()){f=a.geBranchWorkHandSelectedUsers(g);actorWorkerHandlerOperation(f,a,!0,g,c);return}}else{if(a.checkWorkHandUser()){actorWorkerHandlerOperation(g,a,!1,null,c,f);return}g=[{selectedUsers:g,targetActivityName:f,outcome:null==a.data.name?"":a.data.name,workhandUsers:[]}]}top.layer.closeAll();a.submitObj.submit(a.data,g,!1,c)}},success:function(b,d){if(a.isUflow){var c=$(".bpm_selectUser_class");0==c.length&&(c=parent.$(".bpm_selectUser_class"));if(0==c.length)return;c.find(".layui-layer-btn").append("\x3cdiv class\x3d'pull-left'\x3e\x3cinput type\x3d'radio' name\x3d'dealtype' value\x3d'4' checked style\x3d'vertical-align:middle; margin-top:-2px; margin-bottom:1px;'/\x3e\u591a\u4eba\u5e76\u884c\x26nbsp;\x26nbsp\x3cinput type\x3d'radio' name\x3d'dealtype' value\x3d'3' style\x3d'vertical-align:middle; margin-top:-2px; margin-bottom:1px;'/\x3e\u591a\u4eba\u4efb\u610f\x3c/div\x3e")}if(flowUtils.notNull(a.data)&&"dostepuserdefined"==a.data.event){var g=b.find("iframe")[0].contentWindow;$.ajax({url:"platform/bpm/business/getBpmStepPerson",data:{entryId:a.data.procinstDbid,activityName:a.data.activityName},type:"POST",dataType:"JSON",success:function(a){if(flowUtils.notNull(a))for(var b=0;b<a.length;b++){var c=a[b];g.selectorData({id:c.id,name:c.name,attributes:{deptId:c.deptId,deptName:c.deptName}})}}})}}})};BpmActor.prototype.getUflowDealType=function(){if(this.isUflow){var a=$(".bpm_selectUser_class");0==a.length&&(a=parent.$(".bpm_selectUser_class"));return 0==a.length?"":a.find(".layui-layer-btn").find("input[name\x3d'dealtype']:checked").val()}return""};BpmActor.prototype.getUsers=function(){var a,b=this;$.ajax({url:"platform/bpmActor/bpmSelectUserAction2/getAutoSelectedUsersJSONData",async:!1,dataType:"JSON",data:{procinstDbid:this.data.procinstDbid,executionId:this.data.executionId,taskId:this.data.taskId,targetActivityName:this.data.targetActivityName,type:this.data.event,outcome:this.data.name},type:"GET",success:function(c){a="doretreattodraft"==b.data.event||"doretreattoprev"==b.data.event||"dowithdraw"==b.data.event?[{selectedUsers:c,targetActivityName:null==b.data.targetActivityName?"":b.data.targetActivityName,outcome:null==b.data.name?"":b.data.name,workhandUsers:[]}]:c}});return a};BpmActor.prototype.checkIsBranch=function(){try{return this.submitObj.conditions.isBranch()?!0:!1}catch(a){return!1}};BpmActor.prototype.getActorHandTitle=function(){try{if(this.checkIsBranch())return"\u5206\u652f";var a=this.taskJsonData.nextTask[0].currentActivityAttr.activityAlias;return null!=a?a:this.submitObj.data.lable}catch(b){return this.submitObj.data.lable}};BpmActor.prototype.checkWorkHandUser=function(){if(this.taskJsonData&&this.taskJsonData.nextTask)for(var a=0;a<this.taskJsonData.nextTask.length;a++){if("yes"==this.taskJsonData.nextTask[a].currentActivityAttr.isWorkHandUser)return!0}else return!1};BpmActor.prototype.geBranchWorkHandSelectedUsers=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].selectedUsers,e=0;e<d.length;e++)b.push(d[e]);return b};function actorWorkerHandlerOperation(a,b,c,d,e,g){$.ajax({type:"POST",url:"platform/bpmActor/bpmSelectUserAction2/getWorkHandUsers",async:!1,data:{userList:JSON.stringify(a),processKey:b.taskJsonData.processKey},dataType:"json",success:function(f){f&&0<f.length?(f="platform/bpmActor/bpmSelectUserAction2/getWorkHandSelectUser?userList\x3d"+encodeURI(encodeURI(JSON.stringify(f))),top.layer.open({skin:"bs-modal",title:"\u9009\u62e9\u6d41\u7a0b\u59d4\u6258\u5904\u7406\u4eba",content:f,area:["600px","400px"],type:2,shade:.3,btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(f,k){var h=k.find("iframe")[0].contentWindow.getWorkhandSelectedUsers();if(c){for(var m=0;m<d.length;m++)d[m].workhandUsers=h;top.layer.closeAll();b.submitObj.submit(b.data,d,!1,e)}else h=[{selectedUsers:a,targetActivityName:g,outcome:b.data.name,workhandUsers:h}],top.layer.closeAll(),b.submitObj.submit(b.data,h,!1,e)},init:function(a,b){}})):c?(top.layer.closeAll(),b.submitObj.submit(b.data,d,!1,e)):(f=[{selectedUsers:a,targetActivityName:g,outcome:b.data.name,workhandUsers:null}],top.layer.closeAll(),b.submitObj.submit(b.data,f,!1,e))},error:function(a){layer.alert(a,{icon:2})}})}flowUtils.include("avicit/platform6/bpmreform/bpmbusiness/include/src/FlowIdeaBase.js");flowUtils.include("avicit/platform6/bpmreform/bpmbusiness/include/src/FlowIdea.js");function FlowEditor(a,b){var c=_bpm_defineId,d=_bpm_deploymentId,e=_bpm_firstTaskName,g=_bpm_firstTaskAlias,f=_bpm_entryId,h=_bpm_executionId,k=_bpm_taskId,l=_bpm_formId,m=_bpm_ideaCompelManner,q=_bpm_showTrackInForm;_flow_editor=this;var n=this;this.simulation=_bpm_simulation;this.flowModel=new FlowModel(c,d,f,h,k);this.defaultForm=a;this.defaultForm.flowEditor=this;flowUtils.notNull(b)?this.flowIdea=b:this.flowIdea=new FlowIdea;this.flowIdea.flowEditor=this;this.ideaCompelManner=m;this.createTrackInForm();"yes"==q&&this.showTrackInForm();if(flowUtils.notNull(c))this.isStart=!0,this.flowModel.setActivityname(e),this.flowModel.setActivitylabel(g),this.flowModel.setUserIdentityKey("6"),this.flowModel.setUserIdentity("\u62df\u7a3f\u4eba"),this.doInit();else if(flowUtils.notNull(f,h,k,l))this.defaultForm.setId(l),this.defaultForm.checkUserSecretLevel()?avicAjax.ajax({type:"POST",data:{processInstanceId:f,secretLevelCode:n.defaultForm.secretLevelCode()},url:"platform/bpm/clientbpmdisplayaction/isUserSecretLevel",dataType:"json",success:function(a){if(a.result)n.defaultForm.initFormData(),n.flowModel.defineId=n.getDefineIdByEntryId(f),n.doInit();else return n.hideBody(),flowUtils.error("\u4eba\u5458\u5bc6\u7ea7\u4e0d\u7b26\u5408\u8981\u6c42",function(){flowUtils.closeWindowOnDialog()}),!1}}):(this.defaultForm.initFormData(),this.flowModel.defineId=this.getDefineIdByEntryId(f),this.doInit());else return this.hideBody(),flowUtils.error("\u6d41\u7a0b\u53c2\u6570\u9519\u8bef\uff01\u65e0\u6cd5\u521d\u59cb\u5316\u6743\u9650\u6309\u94ae\uff01\u60a8\u53ef\u80fd\u662f\u901a\u8fc7\u975e\u6cd5\u7684\u9014\u5f84\u8fdb\u5165\u4e86\u5f53\u524d\u9875\u9762\uff0c\u4f8b\u5982\u91cd\u590d\u5237\u65b0\u9875\u9762\uff0c\u62f7\u8d1d\u94fe\u63a5\u5230\u6d4f\u89c8\u5668\u5730\u5740\u680f\u7b49\u64cd\u4f5c\u3002\u70b9\u51fb\u786e\u5b9a\u5173\u95ed\u8868\u5355",function(){flowUtils.closeWindowOnDialog()}),!1;c=flowUtils.getUrlQuery("title");flowUtils.notNull(c)&&(document.title=unescape(c))}FlowEditor.prototype.doInit=function(){var a=this;this.flowUploader=new FlowUploader(this);this.flowUploader.init();initFlowPic(this.flowModel.entryId,this.flowModel.deploymentId,function(b){a.designerEditor=b});this.flowIdea.init();this.initProcesslevelPage();this.createButtons()};FlowEditor.prototype.defaultForm=null;FlowEditor.prototype.flowModel=null;FlowEditor.prototype.isStart=!1;FlowEditor.prototype.needRefreshPic=!1;FlowEditor.prototype.needIdeaText=!1;FlowEditor.prototype.simulation="0";FlowEditor.prototype.afterInit=!1;FlowEditor.prototype.hideBody=function(){this.hideButtons();$(".main").hide()};FlowEditor.prototype.hideButtons=function(){$(".bpmhide").hide();$("#bpm_buttons_default1").empty();$("#bpm_buttons_default2").empty()};FlowEditor.prototype.createButtons=function(a,b){var c=this;this.hideButtons();"1"==this.simulation?(this.bpmSubmit=new BpmSubmit(this,this.defaultForm,{}),this.bpmSave=new BpmSave(this,this.defaultForm,{}),this.bpmSubmit.execute=function(){flowUtils.success("\u6a21\u62df\u63d0\u4ea4")},this.bpmSave.execute=function(){flowUtils.success("\u6a21\u62df\u4fdd\u5b58")},$("#bpm_buttons_title").html("\u5f53\u524d\u8282\u70b9\uff1a"+this.flowModel.activitylabel),$("#bpm_buttons_desc").html("\u5f53\u524d\u8eab\u4efd\uff1a"+this.flowModel.userIdentity),this.hoverRemark(),this.controlFormInput(),this.refreshFiles(),this.needRefreshPic=!0,this.refreshTracks(),this.defaultForm.afterCreateButtons(),this.afterInit||(this.defaultForm.afterInit(),this.afterInit=!0),this.flowIdea.show()):this.isStart?(this.bpmSubmit=new BpmSubmit(this,this.defaultForm,{}),this.bpmSave=new BpmSave(this,this.defaultForm,{}),$("#bpm_buttons_title").html("\u5f53\u524d\u8282\u70b9\uff1a"+this.flowModel.activitylabel),$("#bpm_buttons_desc").html("\u5f53\u524d\u8eab\u4efd\uff1a"+this.flowModel.userIdentity),this.hoverRemark(),this.controlFormInput(),this.refreshFiles(),this.needRefreshPic=!0,this.refreshTracks(),this.defaultForm.afterCreateButtons(),this.afterInit||(this.defaultForm.afterInit(),this.afterInit=!0),this.flowIdea.show()):(1==_avicTabIndex?this.refreshPic():this.needRefreshPic=!0,this.refreshTracks(),avicAjax.ajax({type:"POST",data:{processInstanceId:c.flowModel.entryId,executionId:c.flowModel.executionId,taskId:c.flowModel.taskId},url:"platform/bpm/business/getoperateright",dataType:"JSON",success:function(d){flowUtils.notNull(d.error)?flowUtils.error(d.error):(c.drawButtons(d),"undefined"!=typeof word_oa_refresh&&flowUtils.notNull(word_oa_refresh)&&word_oa_refresh(c),a&&c.bpmSubmit.clickBut(b),c.defaultForm.afterCreateButtons(),c.afterInit||(c.defaultForm.afterInit(),c.afterInit=!0))}}))};FlowEditor.prototype.drawButtons=function(a){var b=a.bpmContent;this.flowModel.setActivityname(b.processActivityName);this.flowModel.setActivitylabel(b.processActivityLabel);this.flowModel.setUserIdentityKey(b.userIdentityKey);this.flowModel.setUserIdentity(b.userIdentity);this.flowModel.setIdeasBySelf(b.ideasBySelf);$("#bpm_buttons_title").html("\u5f53\u524d\u8282\u70b9\uff1a"+this.flowModel.activitylabel);$("#bpm_buttons_desc").html("\u5f53\u524d\u8eab\u4efd\uff1a"+this.flowModel.userIdentity);this.hoverRemark();this.refreshFiles();"yes"==b.showTrackInForm&&this.showTrackInForm();a=a.operateRight;if(null!=a){var c={};$.each(a,function(a,b){"dosubmit"==b.event?(null==c.dosubmit&&(c.dosubmit=[]),c.dosubmit.push(b)):eval("buttonData."+b.event+"\x3d button")});this.needIdeaText=!1;this.bpmSave=new BpmSave(this,this.defaultForm,c);this.bpmRetreat=new BpmRetreat(this,this.defaultForm,c);this.bpmSubmit=new BpmSubmit(this,this.defaultForm,c);this.bpmWithdraw=new BpmWithdraw(this,this.defaultForm,c);this.bpmSupplement=new BpmSupplement(this,this.defaultForm,c);this.bpmRetreat.enable||this.bpmSubmit.enable?(this.bpmWithdraw.getHtml(),this.bpmSupplement.getHtml()):(this.bpmWithdraw.getHtmlForDefaultBar(),this.bpmSupplement.getHtmlForDefaultBar());this.bpmAdduser=new BpmAdduser(this,this.defaultForm,c);this.bpmSupersede=new BpmSupersede(this,this.defaultForm,c);this.bpmTransmit=new BpmTransmit(this,this.defaultForm,c);this.bpmWithdrawassignee=new BpmWithdrawassignee(this,this.defaultForm,c);this.bpmFocus=new BpmFocus(this,this.defaultForm,c);this.bpmGlobalend=new BpmGlobalend(this,this.defaultForm,c);this.bpmGlobalidea=new BpmGlobalidea(this,this.defaultForm,c);this.bpmGlobaljump=new BpmGlobaljump(this,this.defaultForm,c);this.bpmGlobalresume=new BpmGlobalresume(this,this.defaultForm,c);this.bpmGlobalsuspend=new BpmGlobalsuspend(this,this.defaultForm,c);this.bpmStepuserdefined=new BpmStepuserdefined(this,this.defaultForm,c);this.bpmTaskreader=new BpmTaskreader(this,this.defaultForm,c);this.bpmPresstodo=new BpmPresstodo(this,this.defaultForm,c);this.bpmStartsubflow=new BpmStartsubflow(this,this.defaultForm,c);this.bpmRelationparentflow=new BpmRelationparentflow(this,this.defaultForm,c);this.bpmRelationflow=new BpmRelationflow(this,this.defaultForm,c);this.needIdeaText?(this.flowIdea.readonly(!1),this.flowIdea.show()):(this.flowIdea.clear(),this.flowIdea.readonly(!0),this.flowIdea.hide());this.controlFormInput()}};FlowEditor.prototype.afterStart=function(a){this.isStart=!1;this.flowModel.setDefineId(a.defineId);this.flowModel.setEntryId(a.entryId);this.flowModel.setExecutionId(a.executionId);this.flowModel.setTaskId(a.taskId);this.defaultForm.setId(a.formId)};FlowEditor.prototype.refreshPic=function(){this.designerEditor.init(this.flowModel.entryId,this.flowModel.deploymentId);mxClient.IS_IE8&&$("#graph").parent().height(500)};FlowEditor.prototype.refreshTracks=function(){bpm_RefreshTracks(this.flowModel.entryId)};FlowEditor.prototype.refreshFiles=function(){this.flowUploader.refresh()};FlowEditor.prototype.createTrackInForm=function(){var a=$("#showTrackDiv").clone(!0,!0);a.attr("id","showTrackInForm");a.hide();a.find(".l").attr("for","timer2");a.find(".r").attr("for","list2");a.find(".timer").addClass("timer2");a.find(".list").addClass("list2");a.appendTo($(".panel-main").eq(0))};FlowEditor.prototype.showTrackInForm=function(){$("#showTrackInForm").show()};FlowEditor.prototype.getDefineIdByEntryId=function(a){var b=null;$.ajax({type:"POST",async:!1,data:{entryId:a},url:"platform/bpm/business/getDefineIdByEntryId",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):b=a.defineId}});return b};FlowEditor.prototype.controlFormInput=function(){var a=this;if("7"!=this.flowModel.userIdentityKey||!this.bpmSave.isEnable()){$(".panel-body").eq(0).find("select").not(".bpm_nosec_class").not(".ui-pg-selbox").attr("disabled","disabled");$(".panel-body").eq(0).find(":checkbox").not(".bpm_nosec_class").not(".bpm_nosec_class :checkbox").not(".eform_subtable_bpm_auth :checkbox").not(".customform_subtable_bpm_auth :checkbox").attr("disabled","disabled");var b=$(".panel-body").eq(0).find(".customform_subtable_bpm_auth");b&&b.length&&b.each(function(){var a=$("this").attr("id");(a=$("#cb_"+a))&&a.removeAttr("disabled")});$(".panel-body").eq(0).find(":radio").not(".bpm_nosec_class").attr("disabled","disabled");$(".panel-body").eq(0).find(":text").not(".bpm_nosec_class").not(".view-box :text").not(".ui-pg-input").attr("disabled","disabled");$(".panel-body").eq(0).find("textarea").not(".bpm_nosec_class").attr("readonly","readonly");$(".panel-body").eq(0).find(".input-group-addon").not(".bpm_nosec_class").css("cursor","not-allowed");$(".panel-body").eq(0).find(".input-group-addon").not(".bpm_nosec_class").bind("click",function(){return!1});$(".panel-body").eq(0).find(".input-group-addon").not(".bpm_nosec_class").off("click");$(".panel-body").eq(0).find(".eform_subtable_bpm_button_auth").hide();$(".panel-body").eq(0).find(".eform_subtable_bpm_auth").each(function(a,b){var c=$(b).attr("title");if(void 0!=c&&""!=c){var d=$("#"+c).jqGrid("getGridParam","colModel");if(null!=d&&0<d.length)for(var f=0;f<d.length;f++)$("#"+c).jqGrid("endEditCell"),$("#"+c).setColProp(d[f].name,{editable:!1,classes:"datatable-readonly"});$("#"+c).jqGrid("setGridParam",{altRows:!1}).trigger("reloadGrid");$("#"+c).hideCol("cb")}});$(".panel-body").eq(0).find(".customform_subtable_bpm_auth").each(function(a,b){var c=$(b).attr("id");if(void 0!=c&&""!=c){var d=c+"_insert";$("#"+d)&&$("#"+d).hide();d=c+"_del";$("#"+d)&&$("#"+d).hide();d=$("#"+c).jqGrid("getGridParam","colModel");if(null!=d&&0<d.length)for(var f=0;f<d.length;f++)$("#"+c).jqGrid("endEditCell"),$("#"+c).setColProp(d[f].name,{editable:!1,classes:"datatable-readonly"})}});$(".bpm_self_class").each(function(b){b=$(this).attr("id");a.defaultForm.controlSelfElement(b,!1)});$(".panel-body").eq(0).find("select").not(".bpm_nosec_class").removeAttr("readonly");$(".panel-body").eq(0).find(":checkbox").not(".bpm_nosec_class").not(".bpm_nosec_class :checkbox").removeAttr("readonly");$(".panel-body").eq(0).find(":radio").not(".bpm_nosec_class").removeAttr("readonly");$(".panel-body").eq(0).find(":checkbox").parent("label").not(".bpm_nosec_class").not(".bpm_nosec_class :checkbox").removeAttr("readonly");$(".panel-body").eq(0).find(":radio").parent("label").not(".bpm_nosec_class").removeAttr("readonly");$(".panel-body").eq(0).find(":text").not(".bpm_nosec_class").removeAttr("readonly");$(".panel-body").eq(0).find(".input-group-addon").not(".bpm_nosec_class").removeAttr("readonly");this.defaultForm.setAttachMagic(!1);$(".panel-body").eq(0).find(".eform_mutiattach_auth").each(function(){a.defaultForm.setAttachCanAddOrDel($(this).attr("id"),!1,null);a.defaultForm.setAttachSecretLevelModify($(this).attr("id"),!1,null)});avicAjax.ajax({type:"POST",data:{defineId:this.flowModel.defineId,activityname:this.flowModel.activityname},url:"platform/bpm/business/getFormSecuritys",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error);else{var c=a.getInitFieldGroupAuths(b);a.bpmSave.isEnable()&&(a.controlAttachmentAuths(b.attachMagic,b.attachmentAuths),a.controlFormOperability(b.result),a.controlFormOperability(c),a.controlFormRequired(b.result,!0),a.controlFormRequired(c,!0),a.bindEventByFieldGroupAuth(b,!0));a.controlFormAccessibility(b.result);a.controlFormAccessibility(c);$(window).resize()}a.defaultForm.afterControlFormInput()}})}};FlowEditor.prototype.controlFormOperability=function(a){var b=this,c={};$.each(a,function(a,d){var e="1"==d.operability;if(e)if("bpm_self_class"==d.elementType||"autocode-box"==d.elementType||"waautocode-box"==d.elementType||"bpmopinion-box"==d.elementType||"waidea-box"==d.elementType||"photo-box"==d.elementType)b.defaultForm.controlSelfElement(d.tag,e,d);else if("pt6:h5checkbox"==d.elementType||"pt6:h5radio"==d.elementType||"checkbox"==d.elementType||"radio"==d.elementType){var g=$('input[name\x3d"'+d.tag+'"]');g.removeAttr("disabled")}else if("textarea"==d.elementType)g=$("#"+d.tag),g.removeAttr("readonly");else if("eform_subtable_bpm_auth"==d.elementType){var k=d.tag.split("__"),e=k[1],k=k[0],l=$("#"+k).jqGrid("getGridParam","colModel"),m=!1,q=e+"Name";if(null!=l&&0<l.length)for(var n=0;n<l.length;n++)if(l[n].name==q){m=!0;break}m?($("#"+k).setColProp(e+"Name",{editable:!0,classes:""}),$("[aria-describedby\x3d'"+k+"_"+e+"Name']").removeClass("datatable-readonly")):($("#"+k).setColProp(e,{editable:!0,classes:""}),$("[aria-describedby\x3d'"+k+"_"+e+"']").removeClass("datatable-readonly"));c[k]=!0}else"eform_subtable_bpm_button_auth"!=d.elementType&&("customform_subtable_bpm_auth"==d.elementType?(k=d.tag.split("__"),e=k[1],b.defaultForm.controlCustomSubTableForOperability(e,!0,d)):"fileupload"==d.elementType||"eform_mutiattach_auth"==d.elementType?b.defaultForm.setAttachCanAddOrDel(d.tag,e,d):(g=$("#"+d.tag),g.removeAttr("disabled"),g.parent().find(".input-group-addon").css("cursor","pointer"),g.parent().find(".input-group-addon")&&(g.parent().find(".input-group-addon").unbind("click"),g.parent().find(".input-group-addon").click(function(){g.trigger("focus")}))));else if("bpm_self_class"==d.elementType||"autocode-box"==d.elementType||"waautocode-box"==d.elementType||"bpmopinion-box"==d.elementType||"waidea-box"==d.elementType||"photo-box"==d.elementType)b.defaultForm.controlSelfElement(d.tag,e,d);else if("pt6:h5checkbox"==d.elementType||"pt6:h5radio"==d.elementType||"checkbox"==d.elementType||"radio"==d.elementType)g=$('input[name\x3d"'+d.tag+'"]'),g.attr("disabled","disabled");else if("textarea"==d.elementType)g=$("#"+d.tag),g.attr("readonly","readonly");else if("eform_subtable_bpm_auth"==d.elementType){k=d.tag.split("__");e=k[1];k=k[0];l=$("#"+k).jqGrid("getGridParam","colModel");m=!1;q=e+"Name";if(null!=l&&0<l.length)for(n=0;n<l.length;n++)l[n].name==q&&(m=!0);m?($("#"+k).jqGrid("endEditCell"),$("#"+k).setColProp(e+"Name",{editable:!1,classes:"datatable-readonly"}),$("[aria-describedby\x3d'"+k+"_"+e+"Name']").addClass("datatable-readonly")):($("#"+k).jqGrid("endEditCell"),$("#"+k).setColProp(e,{editable:!1,classes:"datatable-readonly"}),$("[aria-describedby\x3d'"+k+"_"+e+"']").addClass("datatable-readonly"))}else"customform_subtable_bpm_auth"==d.elementType?(k=d.tag.split("__"),e=k[1],b.defaultForm.controlCustomSubTableForOperability(e,!1,d)):"eform_subtable_bpm_button_auth"!=d.elementType&&("fileupload"==d.elementType||"eform_mutiattach_auth"==d.elementType?b.defaultForm.setAttachCanAddOrDel(d.tag,e,d):(g=$("#"+d.tag),g.attr("disabled","disabled"),g.parent().find(".input-group-addon").css("cursor","")))});for(var d in c)c[d]&&($("#"+d).jqGrid("setGridParam",{altRows:!0}).trigger("reloadGrid"),$("#"+d).showCol("cb"))};FlowEditor.prototype.controlAttachmentAuths=function(a,b){var c=this;(a=a||"true"==a)&&c.defaultForm.setAttachMagic(a);$.each(b,function(a,b){var d="1"==b.operability,e="1"==b.required,h="1"==b.modifySecretLevel;c.defaultForm.setAttachCanAddOrDel(b.tag,d,b);c.defaultForm.setAttachRequired(b.tag,d&&e?!0:!1,b);c.defaultForm.setAttachSecretLevelModify(b.tag,h,b)})};FlowEditor.prototype.controlFormRequired=function(a,b){var c=this;$(".errDom").remove();$.each(a,function(a,e){if("0"==e.required||"1"==e.required&&("0"==e.accessibility||"0"==e.operability))if("bpm_self_class"==e.elementType||"autocode-box"==e.elementType||"waautocode-box"==e.elementType||"bpmopinion-box"==e.elementType||"waidea-box"==e.elementType||"photo-box"==e.elementType){$("#"+e.tag).removeAttr("required");c.defaultForm.controlSelfElementForRequired(e.tag,!1,e);var d=$('label[for\x3d"'+e.tag+'"]'),f=d.children("i[class\x3drequired]");f.remove();d=$("form").validate();d.removeRequiredError()}else if("pt6:h5checkbox"==e.elementType||"pt6:h5radio"==e.elementType||"checkbox"==e.elementType||"radio"==e.elementType)d=$('input[name\x3d"'+e.tag+'"]'),b?d.removeAttr("required","required"):d.rules("remove"),d=$('label[for\x3d"'+e.tag+'"]'),f=d.children("i[class\x3drequired]"),f.remove(),d=$("form").validate(),d.removeRequiredError();else if("textarea"==e.elementType)d=$("#"+e.tag),b?d.removeAttr("required","required"):d.rules("remove"),d=$('label[for\x3d"'+e.tag+'"]'),f=d.children("i[class\x3drequired]"),f.remove(),d=$("form").validate(),d.removeRequiredError();else if("eform_subtable_bpm_auth"==e.elementType){var f=e.tag.split("__"),d=f[1],f=f[0],h=$("#"+f).jqGrid("getGridParam","colModel"),k=!1,l=d+"Name";if(null!=h&&0<h.length)for(var m=0;m<h.length;m++)if(h[m].name==l){k=!0;break}k&&$("#"+f).validateJqGrid("deleteValidate",d+"Name","required");$("#"+f).validateJqGrid("deleteValidate",d,"required")}else"eform_subtable_bpm_button_auth"!=e.elementType&&("customform_subtable_bpm_auth"==e.elementType?(f=e.tag.split("__"),d=f[1],c.defaultForm.controlCustomSubTableForRequired(d,!1,e)):"fileupload"==e.elementType||"eform_mutiattach_auth"==e.elementType?($("#"+e.tag).removeAttr("required"),c.defaultForm.setAttachRequired(e.tag,!1,e)):(d=$("#"+e.tag),b?d.removeAttr("required","required"):d.rules("remove"),d=$('label[for\x3d"'+e.tag+'"]'),f=d.children("i[class\x3drequired]"),f.remove(),d=$("form").validate(),d.removeRequiredError()));else if("1"==e.required&&"1"==e.accessibility&&"1"==e.operability)if("bpm_self_class"==e.elementType||"autocode-box"==e.elementType||"waautocode-box"==e.elementType||"bpmopinion-box"==e.elementType||"waidea-box"==e.elementType||"photo-box"==e.elementType){if($("#"+e.tag).attr("required","required"),c.defaultForm.controlSelfElementForRequired(e.tag,!0,e),d=$('label[for\x3d"'+e.tag+'"]'),f=d.children("i[class\x3drequired]"),!f||1>f.length)f=$("\x3ci class\x3d'required'\x3e*\x3c/i\x3e"),d.prepend(f)}else if("pt6:h5checkbox"==e.elementType||"pt6:h5radio"==e.elementType||"checkbox"==e.elementType||"radio"==e.elementType){if(d=$('input[name\x3d"'+e.tag+'"]'),b?d.attr("required","required"):d.rules("add",{required:!0}),d=$('label[for\x3d"'+e.tag+'"]'),f=d.children("i[class\x3drequired]"),!f||1>f.length)f=$("\x3ci class\x3d'required'\x3e*\x3c/i\x3e"),d.prepend(f)}else if("textarea"==e.elementType){if(d=$("#"+e.tag),b?d.attr("required","required"):d.rules("add",{required:!0}),d=$('label[for\x3d"'+e.tag+'"]'),f=d.children("i[class\x3drequired]"),!f||1>f.length)f=$("\x3ci class\x3d'required'\x3e*\x3c/i\x3e"),d.prepend(f)}else if("eform_subtable_bpm_auth"==e.elementType){f=e.tag.split("__");d=f[1];f=f[0];h=$("#"+f).jqGrid("getGridParam","colModel");k=!1;l=d+"Name";if(null!=h&&0<h.length)for(m=0;m<h.length;m++)if(h[m].name==l){k=!0;break}k?$("#"+f).validateJqGrid("addValidate",d+"Name","required"):$("#"+f).validateJqGrid("addValidate",d,"required")}else if("eform_subtable_bpm_button_auth"!=e.elementType)if("customform_subtable_bpm_auth"==e.elementType)f=e.tag.split("__"),d=f[1],c.defaultForm.controlCustomSubTableForRequired(d,!0,e);else if("fileupload"==e.elementType||"eform_mutiattach_auth"==e.elementType)$("#"+e.tag).attr("required","required"),c.defaultForm.setAttachRequired(e.tag,!0,e);else if(d=$("#"+e.tag),b?d.attr("required","required"):d.rules("add",{required:!0}),d=$('label[for\x3d"'+e.tag+'"]'),f=d.children("i[class\x3drequired]"),!f||1>f.length)f=$("\x3ci class\x3d'required'\x3e*\x3c/i\x3e"),d.prepend(f)})};FlowEditor.prototype.controlFormAccessibility=function(a){var b=this;$.each(a,function(a,d){var c="1"==d.accessibility,g=!1;flowUtils.notNull(d.hideRow)&&"1"==d.hideRow&&(g=!0);if(c)if("bpm_self_class"==d.elementType||"autocode-box"==d.elementType||"waautocode-box"==d.elementType||"bpmopinion-box"==d.elementType||"waidea-box"==d.elementType||"photo-box"==d.elementType)b.defaultForm.controlSelfElementForAccess(d.tag,c,d),c=$("#"+d.tag),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.show(),b.showRow(c);else if("pt6:h5checkbox"==d.elementType||"pt6:h5radio"==d.elementType||"checkbox"==d.elementType||"radio"==d.elementType)c=$('input[name\x3d"'+d.tag+'"]'),c.show(),c.parent("label").show(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.show(),b.showRow(c);else if("textarea"==d.elementType)c=$("#"+d.tag),c.show(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.show(),b.showRow(c);else if("eform_subtable_bpm_auth"==d.elementType){f=d.tag.split("__");g=f[1];c=f[0];f=$("#"+c).jqGrid("getGridParam","colModel");h=!1;k=g+"Name";if(null!=f&&0<f.length)for(l=0;l<f.length;l++)if(f[l].name==k){h=!0;break}h?jQuery("#"+c).setGridParam().showCol(g+"Name"):jQuery("#"+c).setGridParam().showCol(g);$(window).trigger("resize")}else"eform_subtable_bpm_button_auth"==d.elementType?b.defaultForm.controlSubTableButtonForAccess(d.tag,c,d):"customform_subtable_bpm_auth"==d.elementType?(f=d.tag.split("__"),g=f[1],b.defaultForm.controlCustomSubTableForAccess(g,c,d)):"datatable"==d.elementType?(c=$("#"+d.tag+"_control"),b.showRowForSubTable(c),$(window).resize(),c.show(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.show()):("photo-box"==d.elementType?(c=$("#"+d.tag+"photo"),c.show(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.show()):"fileupload"==d.elementType||"eform_mutiattach_auth"==d.elementType?(c=$("#"+d.tag),c.show(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.show()):(c=$("#"+d.tag),c.show(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.show(),c.parent().find(".input-group-addon").show()),b.showRow(c));else if("bpm_self_class"==d.elementType||"autocode-box"==d.elementType||"waautocode-box"==d.elementType||"bpmopinion-box"==d.elementType||"waidea-box"==d.elementType||"photo-box"==d.elementType){b.defaultForm.controlSelfElementForAccess(d.tag,c,d);var c=$("#"+d.tag),f=$('label[for\x3d"'+d.tag+'"]');f&&f.length&&f.hide();g&&b.hideRow(c)}else if("pt6:h5checkbox"==d.elementType||"pt6:h5radio"==d.elementType||"checkbox"==d.elementType||"radio"==d.elementType)c=$('input[name\x3d"'+d.tag+'"]'),c.hide(),c.parent("label").hide(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.hide(),g&&b.hideRow(c);else if("textarea"==d.elementType)c=$("#"+d.tag),c.hide(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.hide(),g&&b.hideRow(c);else if("eform_subtable_bpm_auth"==d.elementType){var f=d.tag.split("__"),g=f[1],c=f[0],f=$("#"+c).jqGrid("getGridParam","colModel"),h=!1,k=g+"Name";if(null!=f&&0<f.length)for(var l=0;l<f.length;l++)if(f[l].name==k){h=!0;break}h?jQuery("#"+c).setGridParam().hideCol(g+"Name"):jQuery("#"+c).setGridParam().hideCol(g);$(window).trigger("resize")}else"eform_subtable_bpm_button_auth"==d.elementType?b.defaultForm.controlSubTableButtonForAccess(d.tag,c,d):"customform_subtable_bpm_auth"==d.elementType?(f=d.tag.split("__"),g=f[1],b.defaultForm.controlCustomSubTableForAccess(g,c,d)):"datatable"==d.elementType?(c=$("#"+d.tag+"_control"),c.hide(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.hide(),g&&b.hideRowForSubTable(c)):("photo-box"==d.elementType?(c=$("#"+d.tag+"photo"),c.hide(),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.hide()):"fileupload"==d.elementType||"eform_mutiattach_auth"==d.elementType?(c=$("#"+d.tag),c.attr("style","display:none;"),(f=$('label[for\x3d"'+d.tag+'"]'))&&f.length&&f.hide()):(c=$("#"+d.tag),c.hide(),f=$('label[for\x3d"'+d.tag+'"]'),f.hide(),c.parent().find(".input-group-addon").hide()),g&&b.hideRow(c))})};FlowEditor.prototype.hideRow=function(a){flowUtils.notNull(a)&&(a=a.parents("tr"))&&a.hide()};FlowEditor.prototype.hideRowForSubTable=function(a){flowUtils.notNull(a)&&(a=a.parents("table").parents("tr"))&&a.hide()};FlowEditor.prototype.showRow=function(a){flowUtils.notNull(a)&&(a=a.parents("tr"))&&a.show()};FlowEditor.prototype.showRowForSubTable=function(a){flowUtils.notNull(a)&&(a=a.parents("table").parents("tr"))&&a.show()};FlowEditor.prototype.hoverRemark=function(){"true"!=$("#bpm_buttons_remark").attr("isload")&&($("#bpm_buttons_remark").attr("isload","true"),$.ajax({type:"POST",data:{defineId:this.flowModel.defineId,activityname:this.flowModel.activityname},url:"platform/bpm/business/getTaskRemark",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(a=flowUtils.notNull(a.result)?"\x3cp\x3e"+a.result+"\x3c/p\x3e":"\x3cp\x3e\u5f53\u524d\u8282\u70b9\u65e0\u63cf\u8ff0\x3c/p\x3e",$("#bpm_buttons_remark").popover({html:!0,title:"\u8282\u70b9\u63cf\u8ff0",placement:"left",container:"body",trigger:"hover",template:'\x3cdiv class\x3d"popover" role\x3d"tooltip"\x3e\x3cdiv class\x3d"arrow"\x3e\x3c/div\x3e\x3ch3 class\x3d"popover-title"\x3e\x3c/h3\x3e\x3cdiv class\x3d"popover-content"\x3e\x3c/div\x3e\x3c/div\x3e',content:a}))}}))};FlowEditor.prototype.initProcesslevelPage=function(){var a=this.flowModel.entryId;0<$("#iframeCenter_processlevel_graph").length&&void 0!=a&&null!=a&&""!=a&&avicAjax.ajax({url:"bpm/bpmdomain/getParentAndSubProcessses",data:"procInstId\x3d"+a,type:"post",dataType:"json",success:function(a){var b={view:{fontCss:getFont},data:{key:{id:"id",name:"name",children:"children"},simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:"-1"}},callback:{onClick:function(a,b,c){"-1"!=c.id&&"-2"!=c.id&&(a="avicit/platform6/bpmreform/bpmdesigner/picture/pic.jsp?entryId\x3d"+c.id.replace("relation_",""),$("#iframeCenter_processlevel_graph").attr("src",a))}}};$.fn.zTree.init($("#processLevelTree"),b,a.result)}})};FlowEditor.prototype.reloadProcesslevelPage=function(){var a=this.flowModel.entryId;0<$("#iframeCenter_processlevel_graph").length&&void 0!=a&&null!=a&&""!=a&&avicAjax.ajax({url:"bpm/bpmdomain/getParentAndSubProcessses",data:"procInstId\x3d"+a,type:"post",dataType:"json",success:function(a){var b={view:{fontCss:getFont},data:{key:{id:"id",name:"name",children:"children"},simpleData:{enable:!0,idKey:"id",pIdKey:"parentId",rootPId:"-1"}},callback:{onClick:function(a,b,c){"-1"!=c.id&&"-2"!=c.id&&(a="avicit/platform6/bpmreform/bpmdesigner/picture/pic.jsp?entryId\x3d"+c.id.replace("relation_",""),$("#iframeCenter_processlevel_graph").attr("src",a))}}};$.fn.zTree.init($("#processLevelTree"),b,a.result)}})};FlowEditor.prototype.bindEventByFieldGroupAuth=function(a,b){var c=a.fieldRelationAuthList;if(flowUtils.notNull(c))for(var d=0;d<c.length;d++)this.bindEventByFieldRelationAuth(c[d],c,a.result,a.attachmentAuths,b)};FlowEditor.prototype.bindEventByFieldRelationAuth=function(a,b,c,d,e){var g=this;flowUtils.notNull(a)&&$.each(a.conditonValues,function(f,h){var k=flowUtils.notNull(h.controlDomId)?h.controlDomId:h.controlTag,l=h.controlDomType,m={fieldGroup:a,fieldGroupList:b,defaultAuths:c,defaultAttachmentAuths:d};"radio-box"==l||"radio"==l||"select-box"==l||"select"==l||"check-box"==l||"check"==l||"secret-box"==l||"secret"==l?g.bindFieldEvent(k,l,"change",m,e):g.bindFieldEvent(k,l,"blur",m,e)})};FlowEditor.prototype.bindFieldEvent=function(a,b,c,d,e){var g=this;if("user-box"==b||"user"==b||"dept-box"==b||"dept"==b||"position-box"==b||"position"==b||"role-box"==b||"role"==b||"group-box"==b||"group"==b||"org-box"==b||"org"==b||"waorg-box"==b||"custom-select-box"==b)a+="Name";var f=$("#"+a);if("radio-box"==b||"radio"==b||"check-box"==b||"check"==b)f=$("input[name\x3d'"+a+"']");f.on(c,null,d,function(a){var b=a.data.fieldGroup,c=a.data.fieldGroupList,d=b.beControledFields[0];d.domId=flowUtils.notNull(d.domId)?d.domId:d.tag;var f=a.data.defaultAuths;a=a.data.defaultAttachmentAuths;var h=g.calculateFieldGroup(b,c),t=!0;if(!h&&0<b.repeatCount)for(var r=0;r<c.length;r++){var u=c[r];u.order!=b.order&&g.calculateFieldGroup(u)&&(t=!1)}b=d.tag;if("user-box"==d.domType||"user"==d.domType||"dept-box"==d.domType||"dept"==d.domType||"position-box"==d.domType||"position"==d.domType||"role-box"==d.domType||"role"==d.domType||"group-box"==d.domType||"group"==d.domType||"org-box"==d.domType||"org"==d.domType||"waorg-box"==d.domType||"custom-select-box"==d.domType)b+="Name";if(h){var p=[],h={};h.domId=d.domId;h.tag=b;h.tagName=d.tagName;h.elementType=d.elementType;h.accessibility=d.accessibility;h.operability=d.operability;h.required=d.required;h.hideRow=d.hideRow;g.dealSameRowFields(h,f,c);g.dealSameRowFields(h,a,c);g.dealSameRowFieldsForRelation(h,c);p.push(h);g.controlFormAccessibility(p);g.controlFormOperability(p);g.controlFormRequired(p,e)}else if(t){if(f&&f.length){c=[];for(h=0;h<f.length;h++)if(b==f[h].tag){p=f[h];break}if(p){c.push(p);g.controlFormAccessibility(c);g.controlFormOperability(c);g.controlFormRequired(c,e);return}}if(a&&a.length){c=[];for(h=0;h<a.length;h++)if(b==a[h].tag){p=a[h];p.accessibility="1";break}p&&(c.push(p),g.controlFormAccessibility(c),g.controlFormOperability(c),g.controlFormRequired(c,e))}if("datatable"==d.elementType||"bpmopinion-box"==d.elementType)f={},c=[],f.tag=b,f.elementType=d.elementType,f.accessibility="1",f.operability="1",f.required="0",f.hideRow="0",c.push(f),g.controlFormAccessibility(c)}})};FlowEditor.prototype.getInitFieldGroupAuths=function(a){var b=a.fieldRelationAuthList,c=a.result;a=a.attachmentAuths;var d=[];if(flowUtils.notNull(b))for(var e=0;e<b.length;e++){var g=b[e];if(this.calculateFieldGroup(g)){var f={};f.domId=g.beControledFields[0].domId;f.tag=g.beControledFields[0].tag;f.elementType=g.beControledFields[0].elementType;f.tagName=g.beControledFields[0].tagName;f.accessibility=g.beControledFields[0].accessibility;f.operability=g.beControledFields[0].operability;f.required=g.beControledFields[0].required;f.hideRow=g.beControledFields[0].hideRow;if("user-box"==g.beControledFields[0].domType||"user"==g.beControledFields[0].domType||"dept-box"==g.beControledFields[0].domType||"dept"==g.beControledFields[0].domType||"position-box"==g.beControledFields[0].domType||"position"==g.beControledFields[0].domType||"role-box"==g.beControledFields[0].domType||"role"==g.beControledFields[0].domType||"group-box"==g.beControledFields[0].domType||"group"==g.beControledFields[0].domType||"org-box"==g.beControledFields[0].domType||"org"==g.beControledFields[0].domType||"waorg-box"==g.beControledFields[0].domType||"custom-select-box"==g.beControledFields[0].domType)f.tag+="Name";this.dealSameRowFields(f,c,b);this.dealSameRowFields(f,a,b);d.push(f)}}return d};FlowEditor.prototype.dealSameRowFields=function(a,b,c){if("1"==a.hideRow)for(var d=0;d<b.length;d++)if(b[d].tag!=a.tag&&"1"==b[d].required){var e=$("#"+a.tag).parents("tr").find("#"+b[d].tag);if(e&&e.attr("id")==b[d].tag){for(var e=!1,g=0;g<c.length;g++)if(c[g].beControledFields[0].tag==b[d].tag&&this.calculateFieldGroup(c[g])){e=!0;break}e||(a.hideRow="0")}}};FlowEditor.prototype.dealSameRowFieldsForRelation=function(a,b){if("1"==a.hideRow)for(var c=0;c<b.length;c++){var d=b[c].beControledFields[0];if(d.tag!=a.tag&&"1"==d.required){var e;if((e="datatable"==a.elementType?$("#"+a.tag).parents("table").parents("tr").find("#"+d.tag):$("#"+a.tag).parents("tr").find("#"+d.tag))&&e.attr("id")==d.tag&&this.calculateFieldGroup(b[c])){a.hideRow="0";break}}}};FlowEditor.prototype.calculateFieldGroup=function(a){a=a.conditonValues;var b=!0;if(!a||1>a.length)b=!1;else for(var c=0;c<a.length;c++){var d=flowUtils.notNull(a[c].controlDomId)?a[c].controlDomId:a[c].controlTag,e=$("#"+d).val(),g=a[c].controlDomType;if("waautocode-box"==g||"autocode-box"==g)e=$("#"+d).attr("initvalue");if("radio-box"==g||"radio"==g)e=$("input[name\x3d'"+d+"']:checked").val();if("check-box"==g||"check"==g){var e="",f=$("input[type\x3dcheckbox][name\x3d"+d+"]:checked");if(f&&f.length){var h=0;f.each(function(){e=h==f.length-1?e+$(this).val():e+($(this).val()+"@@@");h++})}}if(!flowUtils.calculateExpr(g,e,a[c].oper,a[c].compareValue)){b=!1;break}}return b};function getFont(a,b){if("Y"==b.fontCss)return{color:"#BA55D3"}}var _flow_editor=null,_avicTabIndex=0;function avicTabOnSwitch(a){_avicTabIndex=a;0==a?$(".main").removeClass("noright"):$(".main").addClass("noright");$(document).resize();1==a?_flow_editor.needRefreshPic&&(_flow_editor.needRefreshPic=!1,_flow_editor.refreshPic()):3==a&&$("#processLevelLayout").layout("resize")};