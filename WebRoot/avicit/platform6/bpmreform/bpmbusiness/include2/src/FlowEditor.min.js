/**
 * 业务操作父类
 *//**
 * 数据模板
 *//**
 * 按钮基类
 *//**
 * 扩展按钮
 *//**
 * 流程增发
 *//**
 * 关注工作
 *//**
 * 流程结束
 *//**
 * 流程意见修改
 *//**
 * 流程跳转
 *//**
 * 流程恢复
 *//**
 * 流程暂停
 *//**
 * 流程退回，包括退回上一步和退回拟稿人
 *//**
 * 保存
 *//**
 * 自定义选人
 *//**
 * 提交，多个提交合成一个
 *//**
 * 流程转办
 *//**
 * 催办下节点
 *//**
 * 补发
 *//**
 * 增加读者
 *//**
 * 流程转发
 *//**
 * 拿回
 *//**
 * 相关流程
 *//**
 * 发起子流程
 *//**
 * 关联父流程
 *//**
 * 节点内拿回
 *//**
 * 引用文档
 *//**
 * 流程跟踪
 *//**
 * 关联流程
 *//**
 * 帮助
 *//**
 * 流程意见操作
 *//**
 * 表单操作
 *//**
 * 流程操作
 */
function DefaultForm(){}DefaultForm.prototype.flowEditor=null;DefaultForm.prototype.isAutoSave=!0;DefaultForm.prototype.id=null;DefaultForm.prototype.setId=function(a){this.id=a};DefaultForm.prototype.initFormData=function(){};DefaultForm.prototype.start=function(a,b){};DefaultForm.prototype.save=function(a){};DefaultForm.prototype.afterCreateButtons=function(){};DefaultForm.prototype.afterControlFormInput=function(){};DefaultForm.prototype.filterSecretLevel=function(a){return a};DefaultForm.prototype.validSecretLevel=function(a){return!0};DefaultForm.prototype.setAttachMagic=function(a){};DefaultForm.prototype.setAttachCanAddOrDel=function(a,b,c){};DefaultForm.prototype.setAttachRequired=function(a,b,c){};DefaultForm.prototype.setAttachSecretLevelModify=function(a,b,c){};DefaultForm.prototype.controlSelfElement=function(a,b,c){};DefaultForm.prototype.controlSelfElementForAccess=function(a,b,c){};DefaultForm.prototype.controlSelfElementForRequired=function(a,b,c){};DefaultForm.prototype.controlSubTableButtonForAccess=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForAccess=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForOperability=function(a,b,c){};DefaultForm.prototype.controlCustomSubTableForRequired=function(a,b,c){};DefaultForm.prototype.reGetidea=function(a,b){return a};DefaultForm.prototype.getDefaultIdea=function(a){return null};DefaultForm.prototype.selectUserSuccess=function(a){return!0};DefaultForm.prototype.afterInit=function(){};DefaultForm.prototype.checkUserSecretLevel=function(){return"undefined"!==typeof checkUserSecretLevel&&checkUserSecretLevel};DefaultForm.prototype.secretLevelCode=function(){return"undefined"!==typeof secretLevelCode?secretLevelCode:null};DefaultForm.prototype.beforeSubmit=function(a){return!0};DefaultForm.prototype.afterSubmit=function(a){};DefaultForm.prototype.beforeRetreat=function(a){return!0};DefaultForm.prototype.afterRetreat=function(a){};DefaultForm.prototype.beforeWithdraw=function(a){return!0};DefaultForm.prototype.afterWithdraw=function(a){};DefaultForm.prototype.beforeSupplement=function(a){return!0};DefaultForm.prototype.afterSupplement=function(a){};DefaultForm.prototype.beforeAdduser=function(a){return!0};DefaultForm.prototype.afterAdduser=function(a){};DefaultForm.prototype.beforeSupersede=function(a){return!0};DefaultForm.prototype.afterSupersede=function(a){};DefaultForm.prototype.beforeTransmit=function(a){return!0};DefaultForm.prototype.afterTransmit=function(a){};DefaultForm.prototype.beforeTaskreader=function(a){return!0};DefaultForm.prototype.afterTaskreader=function(a){};DefaultForm.prototype.beforeWithdrawassignee=function(a){return!0};DefaultForm.prototype.afterWithdrawassignee=function(a){};DefaultForm.prototype.beforeGlobalend=function(a){return!0};DefaultForm.prototype.afterGlobalend=function(a){};DefaultForm.prototype.beforeGlobaljump=function(a){return!0};DefaultForm.prototype.afterGlobaljump=function(a){};DefaultForm.prototype.beforeGlobalresume=function(a){return!0};DefaultForm.prototype.afterGlobalresume=function(a){};DefaultForm.prototype.beforeGlobalsuspend=function(a){return!0};DefaultForm.prototype.afterGlobalsuspend=function(a){};DefaultForm.prototype.beforeStepuserdefined=function(a){return!0};DefaultForm.prototype.afterStepuserdefined=function(a){};DefaultForm.prototype.beforePresstodo=function(a){return!0};DefaultForm.prototype.afterPresstodo=function(a){};DefaultForm.prototype.getLeadButCodeList=function(){var a=[];a.push("dosubmit");a.push("dosubmit_mesh");a.push("dostart");a.push("dotransmitsubmit");return a};function FlowModel(a,b,c,d,f){this.defineId=a;this.deploymentId=b;this.entryId=_fileupload_entryId=c;this.executionId=d;this.taskId=f}FlowModel.prototype.defineId=null;FlowModel.prototype.setDefineId=function(a){this.defineId=a};FlowModel.prototype.deploymentId=null;FlowModel.prototype.setDeploymentId=function(a){this.deploymentId=a};FlowModel.prototype.entryId=null;FlowModel.prototype.setEntryId=function(a){this.entryId=_fileupload_entryId=a};FlowModel.prototype.executionId=null;FlowModel.prototype.setExecutionId=function(a){this.executionId=a};FlowModel.prototype.taskId=null;FlowModel.prototype.setTaskId=function(a){this.taskId=a};FlowModel.prototype.activityname=null;FlowModel.prototype.setActivityname=function(a){this.activityname=_fileupload_taskName=a};FlowModel.prototype.activitylabel=null;FlowModel.prototype.setActivitylabel=function(a){this.activitylabel=a};FlowModel.prototype.userIdentityKey=null;FlowModel.prototype.setUserIdentityKey=function(a){this.userIdentityKey=a};FlowModel.prototype.userIdentity=null;FlowModel.prototype.setUserIdentity=function(a){this.userIdentity=a};FlowModel.prototype.ideasBySelf=null;FlowModel.prototype.setIdeasBySelf=function(a){this.ideasBySelf=a};var _fileupload_entryId="",_fileupload_taskName="";function BpmButton(a,b,c,d){this.flowEditor=a;this.defaultForm=b;this.data=c;flowUtils.notNull(this.data)&&(this.enable=!0);this.domeId="";this.isEvent=d}BpmButton.prototype.enable=!1;BpmButton.prototype.isEnable=function(){return this.enable};BpmButton.prototype.execute=function(){flowUtils.success("\u8be5\u65b9\u6cd5\u5f00\u53d1\u4e2d")};BpmButton.prototype.getHtml=function(){if(!this.isEvent&&($("#"+this.domeId).children("a").off("click"),this.isEnable())){this.data&&this.data.alias?$("#"+this.domeId).find("span").html(this.data.alias):$("#"+this.domeId).find("span").html($("#"+this.domeId).find("a").attr("title"));var a=this;$("#"+this.domeId).children("a").on("click",function(){a.execute()});this.flowEditor.showButtons(this.domeId)}};BpmButton.prototype.submit=function(a,b){flowUtils.warning("\u672a\u5b9e\u73b0\u7684\u65b9\u6cd5")};BpmButton.prototype.validIdeasBySelf=function(a,b){var c=this;if(null!=this.flowEditor.flowModel.ideasBySelf&&0<this.flowEditor.flowModel.ideasBySelf.length){for(var d="\x3cform class\x3d'container-fluid'\x3e\n",f=!1,g=0;g<this.flowEditor.flowModel.ideasBySelf.length;g++){var e=this.flowEditor.flowModel.ideasBySelf[g];if("0"==e.outcome||e.outcome==a)f=!0,d+="  \x3cdiv class\x3d\"form-group\"\x3e\n    \x3clabel\x3e\x3cinput type\x3d'radio' name\x3d'ideas_radio'/\x3e "+e.content+"\x3c/label\x3e\n  \x3c/div\x3e\n"}f?layer.open({type:1,title:"\u5f3a\u5236\u8868\u6001",area:["300px","400px"],content:d+"\x3c/form\x3e",btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(a,d){var f=$("input[name\x3d'ideas_radio']:checked");0==f.length?flowUtils.warning("\u8bf7\u5148\u8868\u6001"):(c.ideas_text=f.parent().text().trim(),b(),layer.close(a))}}):b()}else b()};function BpmAttribute(a,b,c,d){BpmButton.call(this,a,b,null,d);this.buttonData=c;this.getHtml()}BpmAttribute.prototype=new BpmButton;BpmAttribute.prototype.getHtml=function(){var a=this;if(!this.isEvent){$("._attribute").each(function(a,b){$(b).children("a").off("click")});var b=new Map;$.each(this.buttonData,function(a,d){if(flowUtils.notNull(d.event)&&d.event.endsWith("_attribute")){var c=d.event.replaceAll("_attribute","");c.endsWith("_mesh")&&($("#"+c).children("ul").empty(),c=c.replaceAll("_mesh",""),b.put(c,d))}});$.each(this.buttonData,function(c,d){if(flowUtils.notNull(d.event)&&d.event.endsWith("_attribute")){var f=d.event.replaceAll("_attribute",""),g=$("#"+f).attr("_function");if(flowUtils.notNull(g)){if(!f.endsWith("_mesh")&&-1!=f.indexOf("_")){var e=f.substr(0,f.indexOf("_"));if(b.containsKey(e)){e+="_mesh";f=$("#"+f).find("span").text();f=$('\x3cli class\x3d"sub-list-li"\x3e\x3ca href\x3d"javascript:void(0);" title\x3d"'+f+'"\x3e'+f+"\x3c/a\x3e\x3c/li\x3e");f.children("a").on("click",function(){eval(g+"(_self)")});$("#"+e).children("ul").append(f);a.flowEditor.showButtons(e);return}}$("#"+f).children("a").on("click",function(){eval(g+"(_self)")});a.flowEditor.showButtons(f)}}})}};function BpmAdduser(a,b,c,d){BpmButton.call(this,a,b,c.doadduser,d);this.domeId="doadduser";this.getHtml()}BpmAdduser.prototype=new BpmButton;BpmAdduser.prototype.execute=function(){this.flowEditor.defaultForm.beforeAdduser(this.data)&&(new BpmActor(this.data,this)).open()};BpmAdduser.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dosupplementassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name}),opType:"doadduser"},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u52a0\u7b7e\u6210\u529f");e.isEvent&&flowUtils.refreshCurrentBack();try{e.flowEditor.defaultForm.afterAdduser(a)}catch(k){}e.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmFocus(a,b,c,d){BpmButton.call(this,a,b,c.dofocus,d);this.domeId="dofocus";this.getHtml()}BpmFocus.prototype=new BpmButton;BpmFocus.prototype.execute=function(){avicAjax.ajax({url:"platform/bpm/business/setFocusedTask",data:{processInstanceId:this.flowEditor.flowModel.entryId,dbid:this.flowEditor.flowModel.taskId},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error,a.errorDetail):0==a.mes?flowUtils.success("\u8be5\u4efb\u52a1\u6b64\u524d\u5df2\u88ab\u5173\u6ce8"):flowUtils.success("\u5df2\u6210\u529f\u5173\u6ce8\u8be5\u4efb\u52a1")}})};function BpmGlobalend(a,b,c,d){BpmButton.call(this,a,b,c.doglobalend,d);this.domeId="doglobalend";this.getHtml()}BpmGlobalend.prototype=new BpmButton;BpmGlobalend.prototype.execute=function(){this.flowEditor.defaultForm.beforeGlobalend(this.data)&&(new BpmActor(this.data,this)).open()};BpmGlobalend.prototype.submit=function(a,b,c,d,f,g){var e=this;avicAjax.ajax({url:"platform/bpm/business/doend",data:{executionId:e.data.executionId,message:c},type:"POST",dataType:"JSON",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error,a.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){e.flowEditor.createButtons()},500)},!0);try{e.flowEditor.defaultForm.afterGlobalend(e.data)}catch(k){}}}})};function BpmGlobalidea(a,b,c,d){BpmButton.call(this,a,b,c.doglobalidea,d);this.domeId="doglobalidea";this.getHtml()}BpmGlobalidea.prototype=new BpmButton;BpmGlobalidea.prototype.execute=function(){var a=this;layer.open({type:1,title:"\u4fee\u6539\u610f\u89c1",area:["800px","450px"],content:"\x3ctable id\x3d'ideaTable'\x3e\x3c/table\x3e",btn:["\u786e\u5b9a","\u5173\u95ed"],success:function(b,c){$("#ideaTable").jqGrid({url:"platform/bpm/business/doGettracksByPage?entryId\x3d"+a.data.procinstDbid,mtype:"POST",datatype:"json",rowNum:-1,colModel:[{name:"dbid",key:!0,hidden:!0},{label:"\u8282\u70b9",name:"currentActiveLabel",align:"center"},{label:"\u5904\u7406\u4eba",name:"assigneeName",align:"center"},{label:"\u63a5\u6536\u65f6\u95f4",name:"iTime",align:"center"},{label:"\u5904\u7406\u65f6\u95f4",name:"eTime",align:"center"},{label:"\u64cd\u4f5c\u7c7b\u578b",name:"opType",align:"center"},{label:"\u5904\u7406\u610f\u89c1",name:"message",editable:!0}],rownumbers:!0,altRows:!0,styleUI:"Bootstrap",autowidth:!0,cellEdit:!0,cellsubmit:"clientArray",height:300})},yes:function(b,c){$("#ideaTable").jqGrid("endEditCell");var d=$("#ideaTable").jqGrid("getChangedCells");avicAjax.ajax({url:"platform/bpm/business/saveGettracks",data:{data:JSON.stringify(d),processInstanceId:a.data.procinstDbid},type:"post",dataType:"json",success:function(d){flowUtils.notNull(d.error)?flowUtils.error(d.error):(flowUtils.success("\u4fee\u6539\u6210\u529f"),layer.close(b),a.flowEditor.refreshIdea())}})}})};function BpmGlobaljump(a,b,c,d){BpmButton.call(this,a,b,c.doglobaljump,d);this.domeId="doglobaljump";this.getHtml()}BpmGlobaljump.prototype=new BpmButton;BpmGlobaljump.prototype.execute=function(){this.flowEditor.defaultForm.beforeGlobaljump(this.data)&&(this.jumpTaskDialog=layer.open({type:2,title:"\u8df3\u8f6c\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.data.procinstDbid+"\x26type\x3ddoglobaljump"}),this.isEvent&&layer.full(this.jumpTaskDialog),window.bpmGlobaljump=this)};BpmGlobaljump.prototype.callback=function(a,b){layer.close(this.jumpTaskDialog);var c=flowUtils.clone(this.data);flowUtils.notNull(a)&&(c.executionId=a);c.targetActivityName=b;(new BpmActor(c,this)).open()};BpmGlobaljump.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dojump",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{e.isEvent?(flowUtils.success("\u8df3\u8f6c\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u8df3\u8f6c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){e.flowEditor.createButtons()},500)},!0);try{e.flowEditor.defaultForm.afterGlobaljump(a)}catch(k){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmGlobalresume(a,b,c,d){BpmButton.call(this,a,b,c.doglobalresume,d);this.domeId="doglobalresume";this.getHtml()}BpmGlobalresume.prototype=new BpmButton;BpmGlobalresume.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeGlobalresume(this.data)){var a=this;flowUtils.confirm("\u60a8\u786e\u5b9a\u6062\u590d\u8be5\u6d41\u7a0b\u5417\uff1f",function(){avicAjax.ajax({url:"platform/bpm/business/doresume",data:{processInstanceId:a.data.procinstDbid},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");try{a.flowEditor.defaultForm.afterGlobalresume(a.data)}catch(c){}a.flowEditor.createButtons();flowUtils.refreshBack()}}})})}};function BpmGlobalsuspend(a,b,c,d){BpmButton.call(this,a,b,c.doglobalsuspend,d);this.domeId="doglobalsuspend";this.getHtml()}BpmGlobalsuspend.prototype=new BpmButton;BpmGlobalsuspend.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeGlobalsuspend(this.data)){var a=this;flowUtils.confirm("\u60a8\u786e\u5b9a\u6682\u505c\u8be5\u6d41\u7a0b\u5417\uff1f",function(){avicAjax.ajax({url:"platform/bpm/business/dosuspend",data:{processInstanceId:a.data.procinstDbid},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f!");try{a.flowEditor.defaultForm.afterGlobalsuspend(a.data)}catch(c){}a.flowEditor.createButtons();flowUtils.refreshBack()}}})})}};function BpmRetreat(a,b,c,d){BpmButton.call(this,a,b,null,d);this.doretreattodraft=c.doretreattodraft;this.doretreattoprev=c.doretreattoprev;this.doretreattowant=c.doretreattowant;this.doretreattoactivity=c.doretreattoactivity;if(flowUtils.notNull(this.doretreattodraft)||flowUtils.notNull(this.doretreattoprev)||flowUtils.notNull(this.doretreattowant)||flowUtils.notNull(this.doretreattoactivity))this.enable=!0;this.retreattodraftDomeId="doretreattodraft";this.retreattoprevDomeId="doretreattoprev";this.retreattowantDomeId="doretreattowant";this.retreattoactivityDomeId="doretreattoactivity";this.meshDomeId="doretreat_mesh";this.getHtml()}BpmRetreat.prototype=new BpmButton;BpmRetreat.prototype.executeTodraft=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattodraft)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeTodraftBack();a.flowEditor.createButtons()}):this.executeTodraftBack()}};BpmRetreat.prototype.executeTodraftBack=function(){var a=this;this.validIdeasBySelf("2",function(){(new BpmActor(a.doretreattodraft,a)).open()});this.submit=function(b,c,d,f,g,e){flowUtils.notNull(c)&&0!=c.length?(flowUtils.notNull(a.ideas_text)&&(d=a.ideas_text+" "+d),avicAjax.ajax({url:"platform/bpm/business/dobacktofirst",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,userJson:JSON.stringify({users:c,idea:d,compelManner:"",outcome:b.name})},type:"POST",dataType:"JSON",success:function(d){if(flowUtils.notNull(d.error))flowUtils.error(d.error,d.errorDetail);else{a.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterRetreat(b)}catch(k){}}}})):flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeToprev=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattoprev)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeToprevBack();a.flowEditor.createButtons()}):this.executeToprevBack()}};BpmRetreat.prototype.executeToprevBack=function(){var a=this;this.validIdeasBySelf("2",function(){(new BpmActor(a.doretreattoprev,a)).open()});this.submit=function(b,c,d,f,g,e){flowUtils.notNull(c)&&0!=c.length?(flowUtils.notNull(a.ideas_text)&&(d=a.ideas_text+" "+d),avicAjax.ajax({url:"platform/bpm/business/dobacktoprev",data:{procinstDbid:b.procinstDbid,executionId:b.executionId,userJson:JSON.stringify({users:c,idea:d,compelManner:"",outcome:b.name})},type:"POST",dataType:"JSON",success:function(d){if(flowUtils.notNull(d.error))flowUtils.error(d.error);else{a.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){a.flowEditor.createButtons()},500)},!0);try{a.flowEditor.defaultForm.afterRetreat(b)}catch(k){}}}})):flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeTowant=function(){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattowant)){var a=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){a.executeTowantSelectTask();a.flowEditor.createButtons()}):this.executeTowantSelectTask()}};BpmRetreat.prototype.executeTowantSelectTask=function(){this.retreattowantDialog=layer.open({type:2,title:"\u4efb\u610f\u9000\u56de\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.doretreattowant.procinstDbid+"\x26type\x3ddoretreattowant"});this.isEvent&&layer.full(this.retreattowantDialog);window.bpmRetreatToWant=this};BpmRetreat.prototype.callback=function(a){layer.close(this.retreattowantDialog);var b=flowUtils.clone(this.doretreattowant);b.targetActivityName=a;var c=this;this.validIdeasBySelf("2",function(){(new BpmActor(b,c)).open()});this.submit=function(a,b,g,e,h,k){flowUtils.notNull(b)&&0!=b.length?(flowUtils.notNull(c.ideas_text)&&(g=c.ideas_text+" "+g),avicAjax.ajax({url:"platform/bpm/business/dobacktowant",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:g,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{c.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterRetreat(a)}catch(m){}}}})):flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.executeToactivity=function(a){if(this.flowEditor.defaultForm.beforeRetreat(this.doretreattoactivity)){var b=this;this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){b.executeToactivityBack(a);b.flowEditor.createButtons()}):this.executeToactivityBack(a)}};BpmRetreat.prototype.executeToactivityBack=function(a){var b=flowUtils.clone(this.doretreattoactivity);b.targetActivityName=a;var c=this;this.validIdeasBySelf("2",function(){(new BpmActor(b,c)).open()});this.submit=function(a,b,g,e,h,k){flowUtils.notNull(b)&&0!=b.length?(flowUtils.notNull(c.ideas_text)&&(g=c.ideas_text+" "+g),avicAjax.ajax({url:"platform/bpm/business/dobacktoactivity",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:g,compelManner:"",outcome:a.name}),activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{c.isEvent?(flowUtils.success("\u9000\u56de\u6210\u529f"),flowUtils.refreshCurrentBack()):flowUtils.success("\u9000\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){c.flowEditor.createButtons()},500)},!0);try{c.flowEditor.defaultForm.afterRetreat(a)}catch(m){}}}})):flowUtils.warning("\u9009\u4eba\u9519\u8bef")}};BpmRetreat.prototype.getHtml=function(){if(this.isEvent)return!0;$("#"+this.meshDomeId).children("ul").empty();$("#"+this.retreattodraftDomeId).children("a").off("click");$("#"+this.retreattoprevDomeId).children("a").off("click");$("#"+this.retreattowantDomeId).children("a").off("click");$("#"+this.retreattoactivityDomeId).children("a").off("click");if(this.isEnable()){var a=this,b=0;null!=this.doretreattodraft&&(b+=1);null!=this.doretreattoprev&&(b+=1);null!=this.doretreattowant&&(b+=1);if(null!=this.doretreattoactivity){var c=this.doretreattoactivity.targetName.split(",");$.each(c,function(a,c){b+=1})}if(1<b){null!=this.doretreattodraft&&(c=$("#"+this.retreattodraftDomeId).find("span").text(),c=$('\x3cli class\x3d"sub-list-li"\x3e\x3ca href\x3d"javascript:void(0);" title\x3d"'+c+'"\x3e'+c+"\x3c/a\x3e\x3c/li\x3e"),c.children("a").on("click",function(){a.executeTodraft()}),$("#"+this.meshDomeId).children("ul").append(c));null!=this.doretreattoprev&&(c=$("#"+this.retreattoprevDomeId).find("span").text(),c=$('\x3cli class\x3d"sub-list-li"\x3e\x3ca href\x3d"javascript:void(0);" title\x3d"'+c+'"\x3e'+c+"\x3c/a\x3e\x3c/li\x3e"),c.children("a").on("click",function(){a.executeToprev()}),$("#"+this.meshDomeId).children("ul").append(c));null!=this.doretreattowant&&(c=$("#"+this.retreattowantDomeId).find("span").text(),c=$('\x3cli class\x3d"sub-list-li"\x3e\x3ca href\x3d"javascript:void(0);" title\x3d"'+c+'"\x3e'+c+"\x3c/a\x3e\x3c/li\x3e"),c.children("a").on("click",function(){a.executeTowant()}),$("#"+this.meshDomeId).children("ul").append(c));if(null!=this.doretreattoactivity){var c=this.doretreattoactivity.targetName.split(","),d=this.doretreattoactivity.lable.split(","),f=$("#"+this.retreattoactivityDomeId).attr("label-template");$.each(c,function(b,c){var g=f.replaceAll("taskName",d[b]),g=$('\x3cli class\x3d"sub-list-li"\x3e\x3ca href\x3d"javascript:void(0);" title\x3d"'+g+'"\x3e'+g+"\x3c/a\x3e\x3c/li\x3e");g.children("a").on("click",function(){a.executeToactivity(c)});$("#"+a.meshDomeId).children("ul").append(g)})}this.flowEditor.showButtons(this.meshDomeId)}else null!=this.doretreattodraft&&($("#"+this.retreattodraftDomeId).children("a").on("click",function(){a.executeTodraft()}),this.flowEditor.showButtons(this.retreattodraftDomeId)),null!=this.doretreattoprev&&($("#"+this.retreattoprevDomeId).children("a").on("click",function(){a.executeToprev()}),this.flowEditor.showButtons(this.retreattoprevDomeId)),null!=this.doretreattowant&&($("#"+this.retreattowantDomeId).children("a").on("click",function(){a.executeTowant()}),this.flowEditor.showButtons(this.retreattowantDomeId)),null!=this.doretreattoactivity&&(c=this.doretreattoactivity.targetName.split(","),d=this.doretreattoactivity.lable.split(","),f=$("#"+this.retreattoactivityDomeId).attr("label-template"),$.each(c,function(b,c){var g=f.replaceAll("taskName",d[b]);$("#"+a.retreattoactivityDomeId).find("span").text(g);$("#"+a.retreattoactivityDomeId).children("a").on("click",function(){a.executeToactivity(c)})}),this.flowEditor.showButtons(this.retreattoactivityDomeId))}};function BpmSave(a,b,c,d){BpmButton.call(this,a,b,null,d);this.data=c.doformsave;if(this.flowEditor.isStart||flowUtils.notNull(this.data))this.enable=!0;this.domeId="doformsave";this.getHtml()}BpmSave.prototype=new BpmButton;BpmSave.prototype.disabled=!1;BpmSave.prototype.execute=function(){var a=this;this.disabled||(this.disabled=!0,setTimeout(function(){a.disabled=!1},2E3),this.flowEditor.isStart?this.defaultForm.start(this.flowEditor.flowModel.defineId,function(b){flowUtils.success("\u6682\u5b58\u6210\u529f");a.flowEditor.afterStart(b);a.flowEditor.createButtons();flowUtils.refreshBack()}):this.defaultForm.save(function(){flowUtils.success("\u6682\u5b58\u6210\u529f");a.flowEditor.createButtons()}))};function BpmStepuserdefined(a,b,c,d){BpmButton.call(this,a,b,c.dostepuserdefined,d);this.domeId="dostepuserdefined";this.getHtml()}BpmStepuserdefined.prototype=new BpmButton;BpmStepuserdefined.prototype.execute=function(){this.flowEditor.defaultForm.beforeStepuserdefined(this.data)&&(this.stepuserdefinedDialog=layer.open({type:2,title:"\u81ea\u5b9a\u4e49\u5ba1\u6279\u4eba",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+this.data.procinstDbid+"\x26type\x3ddostepuserdefined"}),this.isEvent&&layer.full(this.stepuserdefinedDialog),window.bpmStepuserdefined=this)};BpmStepuserdefined.prototype.callback=function(a){var b=flowUtils.clone(this.data);b.activityName=a;b.targetActivityName=a;(new BpmActor(b,this)).open()};BpmStepuserdefined.prototype.submit=function(a,b,c,d,f,g){var e=this;flowUtils.notNull(b)&&0!=b.length?avicAjax.ajax({url:"platform/bpm/business/douserdefined",data:{procinstDbid:a.procinstDbid,userJson:JSON.stringify({users:b,idea:"",compelManner:"",outcome:a.name}),activityName:a.activityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");try{e.flowEditor.defaultForm.afterStepuserdefined(a)}catch(k){}}}}):flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmSubmit(a,b,c,d){BpmButton.call(this,a,b,null,d);this.data=c.dosubmit;this.transmitData=c.dotransmitsubmit;if(this.flowEditor.isStart||flowUtils.notNull(this.data)||flowUtils.notNull(this.transmitData))this.enable=!0;this.domeId="dosubmit";this.meshDomeId="dosubmit_mesh";this.startDomeId="dostart";this.transmitsubmitDomeId="dotransmitsubmit";this.getHtml();this.isAutoClickAfterStart=!1}BpmSubmit.prototype=new BpmButton;BpmSubmit.prototype.disabled=!1;BpmSubmit.prototype.execute=function(a){var b=this;this.disabled||(this.disabled=!0,setTimeout(function(){b.disabled=!1},2E3),this.flowEditor.isStart?this.defaultForm.start(this.flowEditor.flowModel.defineId,function(a){b.flowEditor.afterStart(a);b.flowEditor.createButtons(!0);flowUtils.refreshBack()}):this.flowEditor.defaultForm.beforeSubmit(a)&&(!this.isAutoClickAfterStart&&!this.isEvent&&this.flowEditor.defaultForm.isAutoSave&&this.flowEditor.bpmSave.isEnable()?this.flowEditor.defaultForm.save(function(){b.flowEditor.createButtons(!0,a.name)}):this.validIdeasBySelf("1",function(){(new BpmActor(a,b)).open()})))};BpmSubmit.prototype.submit=function(a,b,c,d,f,g){c=this.flowEditor.defaultForm.reGetidea(c,b);flowUtils.notNull(this.ideas_text)&&(c=this.ideas_text+" "+c);if(null!=this.transmitData)this.submitTransmit(c);else{var e=this;avicAjax.ajax({url:"platform/bpm/business/dosubmit",data:{instanceId:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify({users:b,idea:c,compelManner:d,outcome:a.name}),outcome:a.name,formJson:null,uflowDealType:f,isUflow:g},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{e.isEvent?flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01",function(){flowUtils.refreshCurrentBack()},!0):flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){e.flowEditor.createButtons()},500)},!0);try{e.flowEditor.defaultForm.afterSubmit(a)}catch(k){}}}})}};BpmSubmit.prototype.getHtml=function(){$("#"+this.meshDomeId).children("ul").empty();$("#"+this.domeId).children("a").off("click");$("#"+this.startDomeId).children("a").off("click");$("#"+this.transmitsubmitDomeId).children("a").off("click");if(this.isEnable()&&!this.isEvent){var a=this;if(null!=this.data&&1<this.data.length)$.each(this.data,function(b,d){var c=$('\x3cli class\x3d"sub-list-li"\x3e\x3ca href\x3d"javascript:void(0);" title\x3d"'+d.lable+'"\x3e'+d.lable+"\x3c/a\x3e\x3c/li\x3e");c.children("a").attr("title",d.description);c.children("a").on("click",function(){a.execute(d)});$("#"+a.meshDomeId).children("ul").append(c)}),this.flowEditor.showButtons(this.meshDomeId);else if(null!=this.data){var b=this.data[0];$("#"+this.domeId).attr("title",b.description);$("#"+this.domeId).find("span").text(b.lable);$("#"+this.domeId).children("a").on("click",function(){a.execute(b)});this.flowEditor.showButtons(this.domeId)}else null!=this.transmitData?($("#"+this.transmitsubmitDomeId).children("a").on("click",function(){a.executeTransmit()}),this.flowEditor.showButtons(this.transmitsubmitDomeId)):($("#"+this.startDomeId).children("a").on("click",function(){a.execute()}),this.flowEditor.showButtons(this.startDomeId))}};BpmSubmit.prototype.executeTransmit=function(){(new BpmActor(this.transmitData,this)).open()};BpmSubmit.prototype.submitTransmit=function(a){var b=this;avicAjax.ajax({url:"platform/bpm/business/dosubmitTransmit",data:{instanceId:this.transmitData.procinstDbid,message:a||"\u5df2\u9605",taskId:this.transmitData.taskId},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error,a.errorDetail):flowUtils.success("\u63d0\u4ea4\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){b.flowEditor.createButtons()},500)},!0)}})};BpmSubmit.prototype.clickBut=function(a){var b=this;if(this.isEnable())if(flowUtils.notNull(a)){if(null!=this.data&&0<this.data.length)for(var c=0;c<this.data.length;c++)if(this.data[c].name==a){this.validIdeasBySelf("1",function(){(new BpmActor(b.data[c],b)).open()});return}layer.msg("\u8def\u7531\u6761\u4ef6\u53ef\u80fd\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\uff0c\u8bf7\u91cd\u65b0\u8fdb\u884c\u63d0\u4ea4")}else if(null!=this.data&&1<this.data.length)layer.msg("\u6d41\u7a0b\u5df2\u521b\u5efa\uff0c\u8bf7\u9009\u62e9\u4e00\u4e2a\u5206\u652f\u8fdb\u884c\u63d0\u4ea4");else if(null!=this.data){this.isAutoClickAfterStart=!0;try{$("#"+this.domeId).find("a").click()}catch(d){this.isAutoClickAfterStart=!1}this.isAutoClickAfterStart=!1}};function BpmSupersede(a,b,c,d){BpmButton.call(this,a,b,c.dosupersede,d);this.domeId="dosupersede";this.getHtml()}BpmSupersede.prototype=new BpmButton;BpmSupersede.prototype.execute=function(){this.flowEditor.defaultForm.beforeSupersede(this.data)&&(new BpmActor(this.data,this)).open()};BpmSupersede.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dosupersede",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name}),selectUserId:null,formJson:null,activityName:a.targetActivityName},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){e.flowEditor.createButtons()},500)},!0);try{e.flowEditor.defaultForm.afterSupersede(a)}catch(k){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmPresstodo(a,b,c,d){BpmButton.call(this,a,b,c.dopresstodo,d);this.domeId="dopresstodo";this.getHtml()}BpmPresstodo.prototype=new BpmButton;BpmPresstodo.prototype.execute=function(){if(this.flowEditor.defaultForm.beforePresstodo(this.data)){var a=this;avicAjax.ajax({url:"platform/bpm/business/beforepresstodo",data:{executionId:a.data.executionId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(msg.error,msg.errorDetail):a.presstodo(b.result)}})}};BpmPresstodo.prototype.presstodo=function(a){var b=this,c="",c="true"==a.flg?"\u786e\u5b9a\u5bf9\u4e0b\u4e00\u8282\u70b9\u8fdb\u884c\u50ac\u529e\u5417\uff1f"+a.msg:"\u4e0b\u4e00\u8282\u70b9\u5728"+a.time+"\u88ab\u50ac\u529e\u8fc7\uff0c\u786e\u5b9a\u7ee7\u7eed\u8fdb\u884c\u50ac\u529e\u5417\uff1f"+a.msg;flowUtils.confirm(c,function(){avicAjax.ajax({url:"platform/bpm/business/dopresstodo",data:{executionId:b.data.executionId},type:"POST",dataType:"JSON",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error,a.errorDetail);else{flowUtils.success("\u50ac\u529e\u6210\u529f");try{b.flowEditor.defaultForm.afterPresstodo(b.data)}catch(f){}}}})})};function BpmSupplement(a,b,c,d){BpmButton.call(this,a,b,c.dosupplement,d);this.domeId="dosupplement";this.getHtml()}BpmSupplement.prototype=new BpmButton;BpmSupplement.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeSupplement(this.data)){var a=this;avicAjax.ajax({type:"POST",data:{processInstanceId:a.data.procinstDbid},url:"platform/bpm/clientbpmdisplayaction/getcoordinate",dataType:"json",success:function(b){if(flowUtils.notNull(b,b.activity)){for(var c in b.activity){var d=b.activity[c],f=d.activityName,g=d.isCurrent,e=d.executionId;if(d.executionAlone&&"true"==g){a.callback(e,f);return}}a.supplementTaskDialog=layer.open({type:2,title:"\u8865\u53d1\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+a.data.procinstDbid+"\x26type\x3ddosupplement"});a.isEvent&&layer.full(a.supplementTaskDialog);window.bpmSupplement=a}}})}};BpmSupplement.prototype.callback=function(a,b){flowUtils.notNull(this.supplementTaskDialog)&&(layer.close(this.supplementTaskDialog),this.supplementTaskDialog=null);var c=flowUtils.clone(this.data);c.executionId=a;c.targetActivityName=b;(new BpmActor(c,this)).open()};BpmSupplement.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dosupplementassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name}),opType:"dosupplement"},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u8865\u53d1\u6210\u529f");try{e.flowEditor.defaultForm.afterSupplement(a)}catch(k){}e.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmTaskreader(a,b,c,d){BpmButton.call(this,a,b,c.dotaskreader,d);this.domeId="dotaskreader";this.getHtml()}BpmTaskreader.prototype=new BpmButton;BpmTaskreader.prototype.execute=function(){this.flowEditor.defaultForm.beforeTaskreader(this.data)&&(new BpmActor(this.data,this)).open()};BpmTaskreader.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dotaskreader",data:{procinstDbid:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name})},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");e.isEvent&&flowUtils.refreshCurrentBack();try{e.flowEditor.defaultForm.afterTaskreader(a)}catch(k){}e.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmTransmit(a,b,c,d){BpmButton.call(this,a,b,c.dotransmit,d);this.domeId="dotransmit";this.getHtml()}BpmTransmit.prototype=new BpmButton;BpmTransmit.prototype.execute=function(){this.flowEditor.defaultForm.beforeTransmit(this.data)&&(new BpmActor(this.data,this)).open()};BpmTransmit.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dotransmit",data:{procinstDbid:a.procinstDbid,taskId:a.taskId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name})},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u64cd\u4f5c\u6210\u529f");e.isEvent&&flowUtils.refreshCurrentBack();try{e.flowEditor.defaultForm.afterTransmit(a)}catch(k){}e.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmWithdraw(a,b,c,d){BpmButton.call(this,a,b,c.dowithdraw,d);this.domeId="dowithdraw";this.getHtml()}BpmWithdraw.prototype=new BpmButton;BpmWithdraw.prototype.execute=function(){if(this.flowEditor.defaultForm.beforeWithdraw(this.data)){var a=this;avicAjax.ajax({type:"POST",data:{processInstanceId:a.data.procinstDbid},url:"platform/bpm/clientbpmdisplayaction/getcoordinate",dataType:"json",success:function(b){if(flowUtils.notNull(b,b.activity)){for(var c in b.activity){var d=b.activity[c],f=d.activityName,g=d.isCurrent,e=d.executionId;if(d.executionAlone&&"true"==g){a.callback(e,f);return}if(e==a.data.executionId){a.callback(e,f);return}}a.withdrawTaskDialog=layer.open({type:2,title:"\u62ff\u56de\u8282\u70b9\u9009\u62e9",area:["800px","450px"],content:flowUtils.graphPath+"?entryId\x3d"+a.data.procinstDbid+"\x26type\x3ddowithdraw"});a.isEvent&&layer.full(a.withdrawTaskDialog);window.bpmWithdraw=a}}})}};BpmWithdraw.prototype.callback=function(a,b){flowUtils.notNull(this.withdrawTaskDialog)&&(layer.close(this.withdrawTaskDialog),this.withdrawTaskDialog=null);var c=flowUtils.clone(this.data);c.executionId=a;c.targetActivityName=b;(new BpmActor(c,this)).open()};BpmWithdraw.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dowithdrawcurract",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name})},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u62ff\u56de\u6210\u529f\uff01\u8868\u5355\u5c06\u81ea\u52a8\u5173\u95ed",function(){flowUtils.refreshBack();flowUtils.closeWindowOnDialog();setTimeout(function(){e.flowEditor.createButtons()},500)},!0);try{e.flowEditor.defaultForm.afterWithdraw(a)}catch(k){}}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmRelationflow(a,b,c,d){BpmButton.call(this,a,b,c.dorelationprocess,d);this.domeId="dorelationprocess";this.getHtml()}BpmRelationflow.prototype=new BpmButton;BpmRelationflow.prototype.execute=function(){this.index=layer.open({type:2,area:["90%","90%"],title:"\u6dfb\u52a0",skin:"bs-modal",maxmin:!1,content:"avicit/platform6/bpmreform/bpmbusiness/include/relatedBpm.jsp?pid\x3d"+encodeURIComponent(this.data.procinstDbid),end:function(){}})};function BpmStartsubflow(a,b,c,d){BpmButton.call(this,a,b,c.dostartsubprocess,d);this.domeId="dostartsubprocess";this.getHtml()}BpmStartsubflow.prototype=new BpmButton;BpmStartsubflow.prototype.execute=function(){var a=this;avicAjax.ajax({url:"platform/bpm/business/getSubPdId",data:{procinstDbid:this.data.procinstDbid,executionId:this.data.executionId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b.error)?flowUtils.error(b.error):0==b.ids.length?a.showAllFlowModel():1==b.ids.length?a.executeUserInfo(b.ids[0].id):a.executeSelectId(b.ids)}})};var _bpm_BpmStartsubflow=null;BpmStartsubflow.prototype.showAllFlowModelFlg=!1;BpmStartsubflow.prototype.showAllFlowModel=function(){_bpm_BpmStartsubflow=this;var a=this;layer.open({type:2,title:"\u9009\u62e9\u5b50\u6d41\u7a0b\u6a21\u677f",area:["800px","450px"],content:"platform/bpm/business/showAllFlowModel",end:function(){a.showAllFlowModelFlg=!1}});this.showAllFlowModelFlg=!0};BpmStartsubflow.prototype.executeSelectId=function(a){var b=this;layer.open({type:1,area:["300px","450px"],title:"\u6d41\u7a0b\u6a21\u677f\u9009\u62e9",content:"\x3ctable id\x3d'processGrid'\x3e\x3c/table\x3e",btn:["\u786e\u5b9a","\u5173\u95ed"],success:function(c,d){$("#processGrid").jqGrid({datastr:JSON.stringify(a),datatype:"jsonstring",colModel:[{name:"id",key:!0,hidden:!0},{label:"\u6d41\u7a0b\u540d\u79f0",name:"name",align:"center"}],rownumbers:!0,altRows:!0,styleUI:"Bootstrap",autowidth:!0,height:"100%",multiselect:!1,multiboxonly:!0,beforeSelectRow:b.beforeSelectRow})},yes:function(a,d){var c=$("#processGrid").jqGrid("getGridParam","selrow");""!=c?(b.executeUserInfo(c),layer.close(a)):layer.msg("\u8bf7\u9009\u62e9\u6570\u636e")}})};BpmStartsubflow.prototype.beforeSelectRow=function(){$("#processGrid").jqGrid("resetSelection");return!0};BpmStartsubflow.prototype.executeUserInfo=function(a){this.showAllFlowModelFlg&&layer.closeAll();this.data.deployId=a;(new BpmActor(this.data,this)).open()};BpmStartsubflow.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dostartsubprocess",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name}),id:a.deployId},type:"POST",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(flowUtils.success("\u64cd\u4f5c\u6210\u529f!"),e.flowEditor.createButtons(),flowUtils.refreshBack())}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmRelationparentflow(a,b,c,d){BpmButton.call(this,a,b,c.dorelationparentprocess,d);this.domeId="dorelationparentprocess";this.getHtml()}BpmRelationparentflow.prototype=new BpmButton;BpmRelationparentflow.prototype.showDialog=function(a,b){var c=this;layer.open({type:2,area:["100%","100%"],title:"\u6dfb\u52a0\u9875",skin:"bs-modal",maxmin:!1,btn:["\u4fdd\u5b58","\u53d6\u6d88\u5df2\u5173\u8054\u7684\u7236\u6d41\u7a0b","\u8fd4\u56de"],content:"avicit/platform6/bpmreform/bpmbusiness/include/SubprocessAdd.jsp",yes:function(b,c){var d=layer.getChildFrame("body",b),e=d.find("#firstjqGrid").getGridParam("selarrrow"),f=e.length;0==f?flowUtils.warning("\u8bf7\u9009\u62e9\u8981\u5173\u8054\u7684\u7236\u6d41\u7a0b\uff01"):1<f?flowUtils.warning("\u53ea\u5141\u8bb8\u5173\u8054\u4e00\u6761\u7236\u6d41\u7a0b\uff01"):(d=d.find("#firstjqGrid").getRowData(e[0]),avicAjax.ajax({url:"bpm/business/related/subProcessSaveData",data:{dbid1:a,task:"",dbid2:d.dbId},type:"post",dataType:"json",success:function(a){"success"==a.flag?(flowUtils.success("\u5173\u8054\u6210\u529f\uff01"),layer.close(b)):"same"==a.flag?flowUtils.warning("\u7236\u6d41\u7a0b\u4e0d\u80fd\u4e0e\u5f53\u524d\u6d41\u7a0b\u76f8\u540c\uff01"):"parentOrSub"==a.flag?flowUtils.warning("\u5df2\u7ecf\u5b58\u5728\u7236\u5b50\u6d41\u7a0b\u5173\u7cfb\uff01"):flowUtils.warning("\u5173\u8054\u5931\u8d25\uff01")}}));return!1},end:function(){c.flowEditor.createButtons()},btn2:function(c,f){if(!b)return flowUtils.warning("\u5f53\u524d\u65e0\u5df2\u5173\u8054\u7684\u7236\u6d41\u7a0b\uff01"),!1;flowUtils.confirm("\u786e\u5b9a\u53d6\u6d88\u5df2\u5173\u8054\u7684\u7236\u6d41\u7a0b\u5417?",function(){avicAjax.ajax({url:"bpm/business/related/subDelData",data:{id:a},type:"post",dataType:"json",success:function(a){"success"==a.flag?(flowUtils.success("\u53d6\u6d88\u6210\u529f\uff01"),layer.close(c)):flowUtils.warning("\u53d6\u6d88\u5931\u8d25\uff01")}})});return!1}})};BpmRelationparentflow.prototype.execute=function(){var a=this,b=this.data.procinstDbid;avicAjax.ajax({url:"bpm/business/related/findSubProcessById",data:{data:b},type:"post",dataType:"json",success:function(c){"success"==c.flag?a.showDialog(b,!1):"exist"==c.flag?flowUtils.confirm("\u5df2\u5173\u8054\u7236\u6d41\u7a0b\uff0c\u786e\u8ba4\u8981\u91cd\u65b0\u5173\u8054\u5417?",function(){a.showDialog(b,!0)}):"existAndNoEdit"==c.flag?flowUtils.warning("\u8be5\u6d41\u7a0b\u4e3a\u7236\u6d41\u7a0b\u81ea\u52a8\u53d1\u8d77\uff0c\u4e0d\u5141\u8bb8\u624b\u52a8\u5173\u8054\u7236\u6d41\u7a0b\uff01"):"failure"==c.flag&&flowUtils.warning("\u67e5\u8be2\u6570\u636e\u5f02\u5e38\uff01")}})};function BpmWithdrawassignee(a,b,c,d){BpmButton.call(this,a,b,c.dowithdrawassignee,d);this.domeId="dowithdrawassignee";this.getHtml()}BpmWithdrawassignee.prototype=new BpmButton;BpmWithdrawassignee.prototype.execute=function(){this.flowEditor.defaultForm.beforeWithdrawassignee(this.data)&&(new BpmActor(this.data,this)).open()};BpmWithdrawassignee.prototype.submit=function(a,b,c,d,f,g){if(flowUtils.notNull(b)&&0!=b.length){var e=this;avicAjax.ajax({url:"platform/bpm/business/dowithdrawactassignee",data:{procinstDbid:a.procinstDbid,executionId:a.executionId,userJson:JSON.stringify({users:b,idea:c,compelManner:"",outcome:a.name})},type:"POST",dataType:"JSON",success:function(b){if(flowUtils.notNull(b.error))flowUtils.error(b.error,b.errorDetail);else{flowUtils.success("\u51cf\u7b7e\u6210\u529f");try{e.flowEditor.defaultForm.afterWithdrawassignee(a)}catch(k){}e.flowEditor.createButtons()}}})}else flowUtils.warning("\u9009\u4eba\u9519\u8bef")};function BpmButFile(a,b,c,d){BpmButton.call(this,a,b,null,d);this.enable=!1;this.domeId="bpm_but_file";this.getHtml()}BpmButFile.prototype=new BpmButton;BpmButFile.prototype.execute=function(){var a=layer.open({type:2,title:"\u5f15\u7528\u6587\u6863",area:["800px","450px"],content:""});layer.full(a)};function BpmButTrack(a,b,c,d){BpmButton.call(this,a,b,null,d);this.enable=!0;this.domeId="bpm_but_track";this.getHtml()}BpmButTrack.prototype=new BpmButton;BpmButTrack.prototype.execute=function(){var a="avicit/platform6/bpmreform/bpmdesigner/picture/picAndTracks.jsp?",a=flowUtils.notNull(this.flowEditor.flowModel.entryId)?a+("entryId\x3d"+this.flowEditor.flowModel.entryId):a+("deploymentId\x3d"+this.flowEditor.flowModel.deploymentId),a=layer.open({type:2,title:"\u6d41\u7a0b\u8ddf\u8e2a",area:["800px","450px"],content:a});layer.full(a)};function BpmButRelation(a,b,c,d){BpmButton.call(this,a,b,null,d);this.enable=flowUtils.notNull(this.flowEditor.flowModel.entryId);this.domeId="bpm_but_relation";this.getHtml()}BpmButRelation.prototype=new BpmButton;BpmButRelation.prototype.execute=function(){var a=layer.open({type:2,title:"\u5173\u8054\u6d41\u7a0b",area:["800px","450px"],content:"avicit/platform6/bpmreform/bpmbusiness/include2/bpmRelationflow.jsp?entryId\x3d"+this.flowEditor.flowModel.entryId});layer.full(a)};function BpmButHelp(a,b,c,d){BpmButton.call(this,a,b,null,d);this.enable=!0;this.domeId="bpm_but_help";this.getHtml()}BpmButHelp.prototype=new BpmButton;BpmButHelp.prototype.execute=function(){help($("#"+this.domeId).find("a"))};function FlowIdea(a){this.flowEditor=a}FlowIdea.prototype.flowEditor=null;FlowIdea.prototype.refresh=function(){if(flowUtils.notNull(this.flowEditor.flowModel.entryId)){var a=this;$.ajax({url:"platform/bpm/business/getAllIdeaStyleData",data:{entryId:this.flowEditor.flowModel.entryId},type:"POST",dataType:"JSON",success:function(b){flowUtils.notNull(b)&&a.drawIdeaAndSign(b)}})}else $('.l-radio[data-for\x3d"bpm_idea_tab"]').click()};FlowIdea.prototype.drawIdeaAndSign=function(a){a=a.result;if(flowUtils.notNull(a)){var b=this;$("#ideaDiv").empty();$.each(a,function(a,d){if(flowUtils.notNull(d)){var c=$("\x3ctr class\x3d'pttable'\x3e\x3c/tr\x3e"),g=$("\x3ctd class\x3d'l pttable'\x3e\x3c/td\x3e");c.append(g);var e=$("\x3ctd class\x3d'r pttable'\x3e\x3c/td\x3e"),h=$("\x3ctable class\x3d'pslist-table'\x3e\x3c/table\x3e"),k=$("\x3ctbody class\x3d'pslist-text'\x3e\x3c/tbody\x3e");$.each(d,function(a,c){0==a&&g.text(c.title);var d=$("\x3ctr\x3e\x3c/tr\x3e"),e=$("\x3ctd\x3e\x3c/td\x3e");if("1"==c.showSign){var f=$('\x3cimg width\x3d"80" height\x3d"30" title\x3d"\u7535\u5b50\u7b7e\u540d" style\x3d"cursor: pointer;" src\x3d"platform/cc/sysuserphoto/upload/signphoto?sysUserId\x3d'+c.userId+'"/\x3e');e.append(f)}else e.text(c.user+"/"+c.dept);d.append(e);e=$("\x3ctd class\x3d'r'\x3e\x3c/td\x3e");e.text(b.getComment(c));d.append(e);k.append(d)});h.append(k);e.append(h);c.append(e);$("#ideaDiv").append(c)}})}else $('.l-radio[data-for\x3d"bpm_idea_tab"]').click()};FlowIdea.prototype.getComment=function(a){for(var b="",c=a.displayStyle.split(","),d=0;d<c.length;d++)"user"!=c[d]&&"dept"!=c[d]&&(b+=a[c[d]]+" ");return b};function FlowForm(a){this.flowEditor=a}FlowForm.prototype.flowEditor=null;FlowForm.prototype.controlFormInput=function(){var a=this,b=this.flowEditor.flowModel.userIdentityKey;if("7"!=this.flowEditor.flowModel.userIdentityKey||!this.flowEditor.bpmSave.isEnable()){$("#formTab").find("select").not(".bpm_nosec_class").not(".ui-pg-selbox").attr("disabled","disabled");$("#formTab").find(":checkbox").not(".bpm_nosec_class").not(".bpm_nosec_class :checkbox").not(".eform_subtable_bpm_auth :checkbox").not(".customform_subtable_bpm_auth :checkbox").attr("disabled","disabled");$("#formTab").find(":radio").not(".bpm_nosec_class").attr("disabled","disabled");$("#formTab").find(":text").not(".bpm_nosec_class").not(".view-box :text").not(".ui-pg-input").attr("disabled","disabled");$("#formTab").find("textarea").not(".bpm_nosec_class").attr("readonly","readonly");var c=$(".panel-body").eq(0).find(".customform_subtable_bpm_auth");c&&c.length&&c.each(function(){var a=$("this").attr("id");(a=$("#cb_"+a))&&a.removeAttr("disabled")});$("#formTab").find(".input-group-addon").not(".bpm_nosec_class").css("cursor","not-allowed");$("#formTab").find(".input-group-addon").not(".bpm_nosec_class").bind("click",function(){return!1});$("#formTab").find(".input-group-addon").not(".bpm_nosec_class").off("click");$("#formTab").find(".eform_subtable_bpm_button_auth").hide();$("#formTab").find(".eform_subtable_bpm_auth").each(function(a,b){var c=$(b).attr("title");if(void 0!=c&&""!=c){var d=$("#"+c).jqGrid("getGridParam","colModel");if(null!=d&&0<d.length)for(var f=0;f<d.length;f++)$("#"+c).jqGrid("endEditCell"),$("#"+c).setColProp(d[f].name,{editable:!1});$("#"+c).jqGrid("setGridParam",{altRows:!1}).trigger("reloadGrid");$("#"+c).hideCol("cb")}});$("#formTab").find(".customform_subtable_bpm_auth").each(function(a,b){var c=$(b).attr("id");if(void 0!=c&&""!=c){var d=c+"_insert";$("#"+d)&&$("#"+d).hide();d=c+"_del";$("#"+d)&&$("#"+d).hide();d=$("#"+c).jqGrid("getGridParam","colModel");if(null!=d&&0<d.length)for(var f=0;f<d.length;f++)$("#"+c).jqGrid("endEditCell"),$("#"+c).setColProp(d[f].name,{editable:!1,classes:"datatable-readonly"})}});$(".bpm_self_class").each(function(b){b=$(this).attr("id");a.flowEditor.defaultForm.controlSelfElement(b,!1)});$("#formTab").find("select").not(".bpm_nosec_class").removeAttr("readonly");$("#formTab").find(":checkbox").not(".bpm_nosec_class").not(".bpm_nosec_class :checkbox").removeAttr("readonly");$("#formTab").find(":radio").not(".bpm_nosec_class").removeAttr("readonly");$("#formTab").find(":checkbox").parent("label").not(".bpm_nosec_class").not(".bpm_nosec_class :checkbox").removeAttr("readonly");$("#formTab").find(":radio").parent("label").not(".bpm_nosec_class").removeAttr("readonly");$("#formTab").find(":text").not(".bpm_nosec_class").removeAttr("readonly");$("#formTab").find(".input-group-addon").not(".bpm_nosec_class").removeAttr("readonly");this.flowEditor.defaultForm.setAttachMagic(!1);$("#formTab").find(".eform_mutiattach_auth").each(function(){a.flowEditor.defaultForm.setAttachCanAddOrDel($(this).attr("id"),!1,null);a.flowEditor.defaultForm.setAttachSecretLevelModify($(this).attr("id"),!1,null)});avicAjax.ajax({type:"POST",data:{defineId:this.flowEditor.flowModel.defineId,activityname:this.flowEditor.flowModel.activityname},url:"platform/bpm/business/getFormSecuritys",dataType:"JSON",success:function(c){if(flowUtils.notNull(c.error))flowUtils.error(c.error);else{var d=a.getInitFieldGroupAuths(c);a.flowEditor.bpmSave.isEnable()&&(a.controlAttachmentAuths(c.attachMagic,c.attachmentAuths),a.controlFormOperability(c.result),a.controlFormOperability(d),a.controlFormRequired(c.result,!0),a.controlFormRequired(d,!0),a.bindEventByFieldGroupAuth(c,!0));a.controlFormAccessibility(c.result);a.controlFormAccessibility(d);"2"!=b&&"4"!=b&&"5"!=b&&"0"!=b||$("#formTab").find(".eform_subtable_bpm_button_auth").hide();$(window).resize()}a.flowEditor.defaultForm.afterControlFormInput()}})}};FlowForm.prototype.controlFormOperability=function(a){var b=this,c={};$.each(a,function(a,d){var f="1"==d.operability;if(f)if("bpm_self_class"==d.elementType||"autocode-box"==d.elementType||"waautocode-box"==d.elementType||"bpmopinion-box"==d.elementType||"waidea-box"==d.elementType||"photo-box"==d.elementType)b.flowEditor.defaultForm.controlSelfElement(d.tag,f,d);else if("pt6:h5checkbox"==d.elementType||"pt6:h5radio"==d.elementType||"checkbox"==d.elementType||"radio"==d.elementType){var g=$('input[name\x3d"'+d.tag+'"]');g.removeAttr("disabled")}else if("textarea"==d.elementType)g=$("#"+d.tag),g.removeAttr("readonly");else if("eform_subtable_bpm_auth"==d.elementType){var k=d.tag.split("__"),f=k[1],k=k[0],l=$("#"+k).jqGrid("getGridParam","colModel"),m=!1,q=f+"Name";if(null!=l&&0<l.length)for(var p=0;p<l.length;p++)if(l[p].name==q){m=!0;break}m?($("#"+k).setColProp(f+"Name",{editable:!0,classes:""}),$("[aria-describedby\x3d'"+k+"_"+f+"Name']").removeClass("datatable-readonly")):($("#"+k).setColProp(f,{editable:!0,classes:""}),$("[aria-describedby\x3d'"+k+"_"+f+"']").removeClass("datatable-readonly"));c[k]=!0}else"eform_subtable_bpm_button_auth"!=d.elementType&&("customform_subtable_bpm_auth"==d.elementType?(k=d.tag.split("__"),f=k[1],b.flowEditor.defaultForm.controlCustomSubTableForOperability(f,!0,d)):"fileupload"==d.elementType||"eform_mutiattach_auth"==d.elementType?b.flowEditor.defaultForm.setAttachCanAddOrDel(d.tag,f,d):(g=$("#"+d.tag),g.removeAttr("disabled"),g.parent().find(".input-group-addon").css("cursor","pointer"),g.parent().find(".input-group-addon")&&(g.parent().find(".input-group-addon").unbind("click"),g.parent().find(".input-group-addon").click(function(){g.trigger("focus")}))));else if("bpm_self_class"==d.elementType||"autocode-box"==d.elementType||"waautocode-box"==d.elementType||"bpmopinion-box"==d.elementType||"waidea-box"==d.elementType||"photo-box"==d.elementType)b.flowEditor.defaultForm.controlSelfElement(d.tag,f,d);else if("pt6:h5checkbox"==d.elementType||"pt6:h5radio"==d.elementType||"checkbox"==d.elementType||"radio"==d.elementType)g=$('input[name\x3d"'+d.tag+'"]'),g.attr("disabled","disabled");else if("textarea"==d.elementType)g=$("#"+d.tag),g.attr("readonly","readonly");else if("eform_subtable_bpm_auth"==d.elementType){k=d.tag.split("__");f=k[1];k=k[0];l=$("#"+k).jqGrid("getGridParam","colModel");m=!1;q=f+"Name";if(null!=l&&0<l.length)for(p=0;p<l.length;p++)l[p].name==q&&(m=!0);m?($("#"+k).jqGrid("endEditCell"),$("#"+k).setColProp(f+"Name",{editable:!1,classes:"datatable-readonly"}),$("[aria-describedby\x3d'"+k+"_"+f+"Name']").addClass("datatable-readonly")):($("#"+k).jqGrid("endEditCell"),$("#"+k).setColProp(f,{editable:!1,classes:"datatable-readonly"}),$("[aria-describedby\x3d'"+k+"_"+f+"']").addClass("datatable-readonly"))}else"customform_subtable_bpm_auth"==d.elementType?(k=d.tag.split("__"),f=k[1],b.flowEditor.defaultForm.controlCustomSubTableForOperability(f,!1,d)):"eform_subtable_bpm_button_auth"!=d.elementType&&("fileupload"==d.elementType||"eform_mutiattach_auth"==d.elementType?b.defaultForm.setAttachCanAddOrDel(d.tag,f,d):(g=$("#"+d.tag),g.attr("disabled","disabled"),g.parent().find(".input-group-addon").css("cursor","")))});for(var d in c)c[d]&&($("#"+d).jqGrid("setGridParam",{altRows:!0}).trigger("reloadGrid"),$("#"+d).showCol("cb"))};FlowForm.prototype.controlAttachmentAuths=function(a,b){var c=this;(a=a||"true"==a)&&c.flowEditor.defaultForm.setAttachMagic(a);$.each(b,function(a,b){var d="1"==b.operability,f="1"==b.required,h="1"==b.modifySecretLevel;c.flowEditor.defaultForm.setAttachCanAddOrDel(b.tag,d,b);c.flowEditor.defaultForm.setAttachRequired(b.tag,d&&f?!0:!1,b);c.flowEditor.defaultForm.setAttachSecretLevelModify(b.tag,h,b)})};FlowForm.prototype.controlFormRequired=function(a,b){var c=this;$(".errDom").remove();$.each(a,function(a,f){if("0"==f.required||"1"==f.required&&("0"==f.accessibility||"0"==f.operability))if("bpm_self_class"==f.elementType||"autocode-box"==f.elementType||"waautocode-box"==f.elementType||"bpmopinion-box"==f.elementType||"waidea-box"==f.elementType||"photo-box"==f.elementType){$("#"+f.tag).removeAttr("required");c.flowEditor.defaultForm.controlSelfElementForRequired(f.tag,!1,f);var d=$('label[for\x3d"'+f.tag+'"]'),e=d.children("i[class\x3drequired]");e.remove();d=$("form").validate();d.removeRequiredError()}else if("pt6:h5checkbox"==f.elementType||"pt6:h5radio"==f.elementType||"checkbox"==f.elementType||"radio"==f.elementType)d=$('input[name\x3d"'+f.tag+'"]'),b?d.removeAttr("required","required"):d.rules("remove"),d=$('label[for\x3d"'+f.tag+'"]'),e=d.children("i[class\x3drequired]"),e.remove(),d=$("form").validate(),d.removeRequiredError();else if("textarea"==f.elementType)d=$("#"+f.tag),b?d.removeAttr("required","required"):d.rules("remove"),d=$('label[for\x3d"'+f.tag+'"]'),e=d.children("i[class\x3drequired]"),e.remove(),d=$("form").validate(),d.removeRequiredError();else if("eform_subtable_bpm_auth"==f.elementType){var e=f.tag.split("__"),d=e[1],e=e[0],h=$("#"+e).jqGrid("getGridParam","colModel"),k=!1,l=d+"Name";if(null!=h&&0<h.length)for(var m=0;m<h.length;m++)if(h[m].name==l){k=!0;break}k&&$("#"+e).validateJqGrid("deleteValidate",d+"Name","required");$("#"+e).validateJqGrid("deleteValidate",d,"required")}else"eform_subtable_bpm_button_auth"!=f.elementType&&("customform_subtable_bpm_auth"==f.elementType?(e=f.tag.split("__"),d=e[1],c.flowEditor.defaultForm.controlCustomSubTableForRequired(d,!1,f)):"fileupload"==f.elementType||"eform_mutiattach_auth"==f.elementType?($("#"+f.tag).removeAttr("required"),c.flowEditor.defaultForm.setAttachRequired(f.tag,!1,f)):(d=$("#"+f.tag),b?d.removeAttr("required","required"):d.rules("remove"),d=$('label[for\x3d"'+f.tag+'"]'),e=d.children("i[class\x3drequired]"),e.remove(),d=$("form").validate(),d.removeRequiredError()));else if("1"==f.required&&"1"==f.accessibility&&"1"==f.operability)if("bpm_self_class"==f.elementType||"autocode-box"==f.elementType||"waautocode-box"==f.elementType||"bpmopinion-box"==f.elementType||"waidea-box"==f.elementType||"photo-box"==f.elementType){if($("#"+f.tag).attr("required","required"),c.flowEditor.defaultForm.controlSelfElementForRequired(f.tag,!0,f),d=$('label[for\x3d"'+f.tag+'"]'),e=d.children("i[class\x3drequired]"),!e||1>e.length)e=$("\x3ci class\x3d'required'\x3e*\x3c/i\x3e"),d.prepend(e)}else if("pt6:h5checkbox"==f.elementType||"pt6:h5radio"==f.elementType||"checkbox"==f.elementType||"radio"==f.elementType){if(d=$('input[name\x3d"'+f.tag+'"]'),b?d.attr("required","required"):d.rules("add",{required:!0}),d=$('label[for\x3d"'+f.tag+'"]'),e=d.children("i[class\x3drequired]"),!e||1>e.length)e=$("\x3ci class\x3d'required'\x3e*\x3c/i\x3e"),d.prepend(e)}else if("textarea"==f.elementType){if(d=$("#"+f.tag),b?d.attr("required","required"):d.rules("add",{required:!0}),d=$('label[for\x3d"'+f.tag+'"]'),e=d.children("i[class\x3drequired]"),!e||1>e.length)e=$("\x3ci class\x3d'required'\x3e*\x3c/i\x3e"),d.prepend(e)}else if("eform_subtable_bpm_auth"==f.elementType){e=f.tag.split("__");d=e[1];e=e[0];h=$("#"+e).jqGrid("getGridParam","colModel");k=!1;l=d+"Name";if(null!=h&&0<h.length)for(m=0;m<h.length;m++)if(h[m].name==l){k=!0;break}k?$("#"+e).validateJqGrid("addValidate",d+"Name","required"):$("#"+e).validateJqGrid("addValidate",d,"required")}else if("eform_subtable_bpm_button_auth"!=f.elementType)if("customform_subtable_bpm_auth"==f.elementType)e=f.tag.split("__"),d=e[1],c.flowEditor.defaultForm.controlCustomSubTableForRequired(d,!0,f);else if("fileupload"==f.elementType||"eform_mutiattach_auth"==f.elementType)$("#"+f.tag).attr("required","required"),c.flowEditor.defaultForm.setAttachRequired(f.tag,!0,f);else if(d=$("#"+f.tag),b?d.attr("required","required"):d.rules("add",{required:!0}),d=$('label[for\x3d"'+f.tag+'"]'),e=d.children("i[class\x3drequired]"),!e||1>e.length)e=$("\x3ci class\x3d'required'\x3e*\x3c/i\x3e"),d.prepend(e)})};FlowForm.prototype.controlFormAccessibility=function(a){var b=this;$.each(a,function(a,d){var c="1"==d.accessibility,g=!1;flowUtils.notNull(d.hideRow)&&"1"==d.hideRow&&(g=!0);if(c)if("bpm_self_class"==d.elementType||"autocode-box"==d.elementType||"waautocode-box"==d.elementType||"bpmopinion-box"==d.elementType||"waidea-box"==d.elementType||"photo-box"==d.elementType)b.flowEditor.defaultForm.controlSelfElementForAccess(d.tag,c,d),c=$("#"+d.tag),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.show(),b.showRow(c);else if("pt6:h5checkbox"==d.elementType||"pt6:h5radio"==d.elementType||"checkbox"==d.elementType||"radio"==d.elementType)c=$('input[name\x3d"'+d.tag+'"]'),c.show(),c.parent("label").show(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.show(),b.showRow(c);else if("textarea"==d.elementType)c=$("#"+d.tag),c.show(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.show(),b.showRow(c);else if("eform_subtable_bpm_auth"==d.elementType){e=d.tag.split("__");g=e[1];c=e[0];e=$("#"+c).jqGrid("getGridParam","colModel");h=!1;k=g+"Name";if(null!=e&&0<e.length)for(l=0;l<e.length;l++)if(e[l].name==k){h=!0;break}h?jQuery("#"+c).setGridParam().showCol(g+"Name"):jQuery("#"+c).setGridParam().showCol(g);$(window).trigger("resize")}else"eform_subtable_bpm_button_auth"==d.elementType?b.flowEditor.defaultForm.controlSubTableButtonForAccess(d.tag,c,d):"customform_subtable_bpm_auth"==d.elementType?(e=d.tag.split("__"),g=e[1],b.flowEditor.defaultForm.controlCustomSubTableForAccess(g,c,d)):"datatable"==d.elementType?(c=$("#"+d.tag+"_control"),b.showRowForSubTable(c),$(window).resize(),c.show(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.show()):("photo-box"==d.elementType?(c=$("#"+d.tag+"photo"),c.show(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.show()):"fileupload"==d.elementType||"eform_mutiattach_auth"==d.elementType?(c=$("#"+d.tag),c.show(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.show()):(c=$("#"+d.tag),c.show(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.show(),c.parent().find(".input-group-addon").show()),b.showRow(c));else if("bpm_self_class"==d.elementType||"autocode-box"==d.elementType||"waautocode-box"==d.elementType||"bpmopinion-box"==d.elementType||"waidea-box"==d.elementType||"photo-box"==d.elementType){b.flowEditor.defaultForm.controlSelfElementForAccess(d.tag,c,d);var c=$("#"+d.tag),e=$('label[for\x3d"'+d.tag+'"]');e&&e.length&&e.hide();g&&b.hideRow(c)}else if("pt6:h5checkbox"==d.elementType||"pt6:h5radio"==d.elementType||"checkbox"==d.elementType||"radio"==d.elementType)c=$('input[name\x3d"'+d.tag+'"]'),c.hide(),c.parent("label").hide(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.hide(),g&&b.hideRow(c);else if("textarea"==d.elementType)c=$("#"+d.tag),c.hide(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.hide(),g&&b.hideRow(c);else if("eform_subtable_bpm_auth"==d.elementType){var e=d.tag.split("__"),g=e[1],c=e[0],e=$("#"+c).jqGrid("getGridParam","colModel"),h=!1,k=g+"Name";if(null!=e&&0<e.length)for(var l=0;l<e.length;l++)if(e[l].name==k){h=!0;break}h?jQuery("#"+c).setGridParam().hideCol(g+"Name"):jQuery("#"+c).setGridParam().hideCol(g);$(window).trigger("resize")}else"eform_subtable_bpm_button_auth"==d.elementType?b.flowEditor.defaultForm.controlSubTableButtonForAccess(d.tag,c,d):"customform_subtable_bpm_auth"==d.elementType?(e=d.tag.split("__"),g=e[1],b.flowEditor.defaultForm.controlCustomSubTableForAccess(g,c,d)):"datatable"==d.elementType?(c=$("#"+d.tag+"_control"),c.hide(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.hide(),g&&b.hideRowForSubTable(c)):("photo-box"==d.elementType?(c=$("#"+d.tag+"photo"),c.hide(),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.hide()):"fileupload"==d.elementType||"eform_mutiattach_auth"==d.elementType?(c=$("#"+d.tag),c.attr("style","display:none;"),(e=$('label[for\x3d"'+d.tag+'"]'))&&e.length&&e.hide()):(c=$("#"+d.tag),c.hide(),e=$('label[for\x3d"'+d.tag+'"]'),e.hide(),c.parent().find(".input-group-addon").hide()),g&&b.hideRow(c))})};FlowForm.prototype.hideRow=function(a){flowUtils.notNull(a)&&(a=a.parents("tr"))&&a.hide()};FlowForm.prototype.hideRowForSubTable=function(a){flowUtils.notNull(a)&&(a=a.parents("table").parents("tr"))&&a.hide()};FlowForm.prototype.showRow=function(a){flowUtils.notNull(a)&&(a=a.parents("tr"))&&a.show()};FlowForm.prototype.showRowForSubTable=function(a){flowUtils.notNull(a)&&(a=a.parents("table").parents("tr"))&&a.show()};FlowForm.prototype.bindEventByFieldGroupAuth=function(a,b){var c=a.fieldRelationAuthList;if(flowUtils.notNull(c))for(var d=0;d<c.length;d++)this.bindEventByFieldRelationAuth(c[d],c,a.result,a.attachmentAuths,b)};FlowForm.prototype.bindEventByFieldRelationAuth=function(a,b,c,d,f){var g=this;flowUtils.notNull(a)&&$.each(a.conditonValues,function(e,h){var k=flowUtils.notNull(h.controlDomId)?h.controlDomId:h.controlTag,l=h.controlDomType,m={fieldGroup:a,fieldGroupList:b,defaultAuths:c,defaultAttachmentAuths:d};"radio-box"==l||"radio"==l||"select-box"==l||"select"==l||"check-box"==l||"check"==l||"secret-box"==l||"secret"==l?g.bindFieldEvent(k,l,"change",m,f):g.bindFieldEvent(k,l,"blur",m,f)})};FlowForm.prototype.bindFieldEvent=function(a,b,c,d,f){var g=this;if("user-box"==b||"user"==b||"dept-box"==b||"dept"==b||"position-box"==b||"position"==b||"role-box"==b||"role"==b||"group-box"==b||"group"==b||"org-box"==b||"org"==b||"waorg-box"==b||"custom-select-box"==b)a+="Name";var e=$("#"+a);if("radio-box"==b||"radio"==b||"check-box"==b||"check"==b)e=$("input[name\x3d'"+a+"']");e.on(c,null,d,function(a){var d=a.data.fieldGroup,b=a.data.fieldGroupList,c=d.beControledFields[0];c.domId=flowUtils.notNull(c.domId)?c.domId:c.tag;var e=a.data.defaultAuths;a=a.data.defaultAttachmentAuths;var h=g.calculateFieldGroup(d,b),t=!0;if(!h&&0<d.repeatCount)for(var r=0;r<b.length;r++){var u=b[r];u.order!=d.order&&g.calculateFieldGroup(u)&&(t=!1)}d=c.tag;if("user-box"==c.domType||"user"==c.domType||"dept-box"==c.domType||"dept"==c.domType||"position-box"==c.domType||"position"==c.domType||"role-box"==c.domType||"role"==c.domType||"group-box"==c.domType||"group"==c.domType||"org-box"==c.domType||"org"==c.domType||"waorg-box"==c.domType||"custom-select-box"==c.domType)d+="Name";if(h){var n=[],h={};h.domId=c.domId;h.tag=d;h.tagName=c.tagName;h.elementType=c.elementType;h.accessibility=c.accessibility;h.operability=c.operability;h.required=c.required;h.hideRow=c.hideRow;g.dealSameRowFields(h,e,b);g.dealSameRowFields(h,a,b);g.dealSameRowFieldsForRelation(h,b);n.push(h);g.controlFormAccessibility(n);g.controlFormOperability(n);g.controlFormRequired(n,f)}else if(t){if(e&&e.length){b=[];for(h=0;h<e.length;h++)if(d==e[h].tag){n=e[h];break}if(n){b.push(n);g.controlFormAccessibility(b);g.controlFormOperability(b);g.controlFormRequired(b,f);return}}if(a&&a.length){b=[];for(h=0;h<a.length;h++)if(d==a[h].tag){n=a[h];n.accessibility="1";break}n&&(b.push(n),g.controlFormAccessibility(b),g.controlFormOperability(b),g.controlFormRequired(b,f))}if("datatable"==c.elementType||"bpmopinion-box"==c.elementType)e={},b=[],e.tag=d,e.elementType=c.elementType,e.accessibility="1",e.operability="1",e.required="0",e.hideRow="0",b.push(e),g.controlFormAccessibility(b)}})};FlowForm.prototype.getInitFieldGroupAuths=function(a){var b=a.fieldRelationAuthList,c=a.result;a=a.attachmentAuths;var d=[];if(flowUtils.notNull(b))for(var f=0;f<b.length;f++){var g=b[f];if(this.calculateFieldGroup(g)){var e={};e.domId=g.beControledFields[0].domId;e.tag=g.beControledFields[0].tag;e.elementType=g.beControledFields[0].elementType;e.tagName=g.beControledFields[0].tagName;e.accessibility=g.beControledFields[0].accessibility;e.operability=g.beControledFields[0].operability;e.required=g.beControledFields[0].required;e.hideRow=g.beControledFields[0].hideRow;if("user-box"==g.beControledFields[0].domType||"user"==g.beControledFields[0].domType||"dept-box"==g.beControledFields[0].domType||"dept"==g.beControledFields[0].domType||"position-box"==g.beControledFields[0].domType||"position"==g.beControledFields[0].domType||"role-box"==g.beControledFields[0].domType||"role"==g.beControledFields[0].domType||"group-box"==g.beControledFields[0].domType||"group"==g.beControledFields[0].domType||"org-box"==g.beControledFields[0].domType||"org"==g.beControledFields[0].domType||"waorg-box"==g.beControledFields[0].domType||"custom-select-box"==g.beControledFields[0].domType)e.tag+="Name";this.dealSameRowFields(e,c,b);this.dealSameRowFields(e,a,b);d.push(e)}}return d};FlowForm.prototype.dealSameRowFields=function(a,b,c){if("1"==a.hideRow)for(var d=0;d<b.length;d++)if(b[d].tag!=a.tag&&"1"==b[d].required){var f=$("#"+a.tag).parents("tr").find("#"+b[d].tag);if(f&&f.attr("id")==b[d].tag){for(var f=!1,g=0;g<c.length;g++)if(c[g].beControledFields[0].tag==b[d].tag&&this.calculateFieldGroup(c[g])){f=!0;break}f||(a.hideRow="0")}}};FlowForm.prototype.dealSameRowFieldsForRelation=function(a,b){if("1"==a.hideRow)for(var c=0;c<b.length;c++){var d=b[c].beControledFields[0];if(d.tag!=a.tag&&"1"==d.required){var f;if((f="datatable"==a.elementType?$("#"+a.tag).parents("table").parents("tr").find("#"+d.tag):$("#"+a.tag).parents("tr").find("#"+d.tag))&&f.attr("id")==d.tag&&this.calculateFieldGroup(b[c])){a.hideRow="0";break}}}};FlowForm.prototype.calculateFieldGroup=function(a){a=a.conditonValues;var b=!0;if(!a||1>a.length)b=!1;else for(var c=0;c<a.length;c++){var d=flowUtils.notNull(a[c].controlDomId)?a[c].controlDomId:a[c].controlTag,f=$("#"+d).val(),g=a[c].controlDomType;if("waautocode-box"==g||"autocode-box"==g)f=$("#"+d).attr("initvalue");if("radio-box"==g||"radio"==g)f=$("input[name\x3d'"+d+"']:checked").val();if("check-box"==g||"check"==g){var f="",e=$("input[type\x3dcheckbox][name\x3d"+d+"]:checked");if(e&&e.length){var h=0;e.each(function(){f=h==e.length-1?f+$(this).val():f+($(this).val()+"@@@");h++})}}if(!flowUtils.calculateExpr(g,f,a[c].oper,a[c].compareValue)){b=!1;break}}return b};var mxBasePath="avicit/platform6/bpmreform/bpmdesigner/editors/mxgraph/src";flowUtils.include("avicit/platform6/bpmreform/bpmdesigner/editors/mxgraph/mxClient.js");flowUtils.include("avicit/platform6/bpmreform/bpmdesigner/editors/js/CountUtils.js");flowUtils.include("avicit/platform6/bpmreform/bpmdesigner/editors/js/DesignerEditor.js");flowUtils.include("avicit/platform6/bpmreform/bpmdesigner/picture/MyDesignerEditor.js");var designerEditor=null,_iconType;function initFlowPic(a,b,c){designerEditor=new MyDesignerEditor;mxUtils.alert=function(a){flowUtils.warning(a)};mxGraph.prototype.htmlLabels=!0;mxGraph.prototype.collapseExpandResource="";mxConstants.DEFAULT_HOTSPOT=1;mxGraphHandler.prototype.guidesEnabled=!0;mxGuide.prototype.isEnabledForEvent=function(a){return!mxEvent.isAltDown(a)};mxEdgeHandler.prototype.snapToTerminals=!0;avicAjax.ajax({type:"POST",data:{entryId:a,deploymentId:b},url:"platform/bpm/business/getIconType",dataType:"json",success:function(a){if(flowUtils.notNull(a.error))flowUtils.error(a.error);else{mxObjectCodec.allowEval=!0;var b="";_iconType=a.iconType;"1"==a.iconType?b="avicit/platform6/bpmreform/bpmdesigner/picture/config/new/workfloweditor.xml":(b="avicit/platform6/bpmreform/bpmdesigner/picture/config/workfloweditor.xml",$(".uFlowKeyCss").hide(),$(".uFlowKeyCss").next().hide());a=mxUtils.load(b).getDocumentElement();a=new mxEditor(a);mxObjectCodec.allowEval=!1;designerEditor.setEditor(a);a.graph.addListener(mxEvent.CLICK,function(a,b){var c=b.getProperty("cell");if(flowUtils.notNull(c)){var d=c.id,c=c.pid;flowUtils.notNull(c)&&(d=c);d=designerEditor.myCellMap.get(d);flowUtils.notNull(d)&&"function"==typeof d.actNodeClick&&d.actNodeClick()}});c(designerEditor)}}});flowUtils.notNull(a)&&($.ajax({type:"POST",data:{entryId:a},url:"platform/bpm/business/getParentprocess",dataType:"text",success:function(a){flowUtils.notNull(a)&&($("#bpmParentFlowPic").show(),$("#bpmParentFlowPic").on("click",function(){var b=layer.open({type:2,title:"\u7236\u6d41\u7a0b",area:["800px","450px"],content:"avicit/platform6/bpmreform/bpmdesigner/picture/picAndTracks.jsp?entryId\x3d"+a});layer.full(b)}))}}),"undefined"!=typeof _showBpmOpenFormBut&&($("#bpmOpenForm").show(),$("#bpmOpenForm").on("click",function(){flowUtils.detail(a,"2")})))}function FlowEditor(a){this.simulation=_bpm_simulation;this.flowModel=new FlowModel(_bpm_defineId,_bpm_deploymentId,_bpm_entryId,_bpm_executionId,_bpm_taskId);this.defaultForm=a;this.defaultForm.flowEditor=this;this.flowForm=new FlowForm(this);this.flowIdea="function"==typeof FlowIdeaBySelf?eval("new FlowIdeaBySelf(this)"):new FlowIdea(this);_flow_editor=this;return this}FlowEditor.prototype.setFlowIdea=function(a){this.flowIdea=a};FlowEditor.prototype.init=function(){if(flowUtils.notNull(_bpm_defineId))this.isStartPage=this.isStart=!0,this.flowModel.setActivityname(_bpm_firstTaskName),this.flowModel.setActivitylabel(_bpm_firstTaskAlias),this.flowModel.setUserIdentityKey("6"),this.flowModel.setUserIdentity("\u62df\u7a3f\u4eba"),this.createButtons();else if(flowUtils.notNull(_bpm_entryId,_bpm_executionId,_bpm_taskId,_bpm_formId))if(this.defaultForm.setId(_bpm_formId),this.defaultForm.checkUserSecretLevel()){var a=this;avicAjax.ajax({type:"POST",data:{processInstanceId:_bpm_entryId,secretLevelCode:a.defaultForm.secretLevelCode()},url:"platform/bpm/clientbpmdisplayaction/isUserSecretLevel",dataType:"json",success:function(b){if(b.result)a.defaultForm.initFormData(),a.flowModel.defineId=a.getDefineIdByEntryId(_bpm_entryId),a.createButtons();else return a.hideBody(),flowUtils.error("\u4eba\u5458\u5bc6\u7ea7\u4e0d\u7b26\u5408\u8981\u6c42",function(){flowUtils.closeWindowOnDialog()}),!1}})}else this.defaultForm.initFormData(),this.flowModel.defineId=this.getDefineIdByEntryId(_bpm_entryId),this.createButtons();else return this.hideBody(),flowUtils.error("\u6d41\u7a0b\u53c2\u6570\u9519\u8bef\uff01\u65e0\u6cd5\u521d\u59cb\u5316\u6743\u9650\u6309\u94ae\uff01\u60a8\u53ef\u80fd\u662f\u901a\u8fc7\u975e\u6cd5\u7684\u9014\u5f84\u8fdb\u5165\u4e86\u5f53\u524d\u9875\u9762\uff0c\u4f8b\u5982\u91cd\u590d\u5237\u65b0\u9875\u9762\uff0c\u62f7\u8d1d\u94fe\u63a5\u5230\u6d4f\u89c8\u5668\u5730\u5740\u680f\u7b49\u64cd\u4f5c\u3002\u70b9\u51fb\u786e\u5b9a\u5173\u95ed\u8868\u5355",function(){flowUtils.closeWindowOnDialog()}),!1;var b=flowUtils.getUrlQuery("title");flowUtils.notNull(b)&&(document.title=unescape(b))};FlowEditor.prototype.defaultForm=null;FlowEditor.prototype.flowModel=null;FlowEditor.prototype.isStart=!1;FlowEditor.prototype.isStartPage=!1;FlowEditor.prototype.simulation="0";FlowEditor.prototype.afterInit=!1;FlowEditor.prototype.hideBody=function(){this.hideButtons();$("#main").hide()};FlowEditor.prototype.hideButtons=function(){$(".bpmhide").hide();$(".bpmhide").removeClass("but_lead")};FlowEditor.prototype.showButtons=function(a){-1!=this.leadButCodeList.indexOf(a)&&$("#"+a).addClass("but_lead");$("#"+a).show()};FlowEditor.prototype.leadButCodeList=[];FlowEditor.prototype.createButtons=function(a,b){var c=this;this.leadButCodeList=this.defaultForm.getLeadButCodeList();this.hideButtons();"1"==this.simulation?(this.bpmSubmit=new BpmSubmit(this,this.defaultForm,{}),this.bpmSave=new BpmSave(this,this.defaultForm,{}),this.bpmButHelp=new BpmButHelp(this,this.defaultForm,{}),this.bpmButFile=new BpmButFile(this,this.defaultForm,{}),this.bpmButTrack=new BpmButTrack(this,this.defaultForm,{}),this.bpmSubmit.execute=function(){flowUtils.success("\u6a21\u62df\u63d0\u4ea4")},this.bpmSave.execute=function(){flowUtils.success("\u6a21\u62df\u4fdd\u5b58")},this.setRoles(),this.hoverRemark(),this.flowForm.controlFormInput(),this.refreshPic(),this.refreshIdea(),this.defaultForm.afterCreateButtons(),$(window).resize(),this.afterInit||(this.defaultForm.afterInit(),this.afterInit=!0)):this.isStart?(this.bpmSubmit=new BpmSubmit(this,this.defaultForm,{}),this.bpmSave=new BpmSave(this,this.defaultForm,{}),this.bpmButHelp=new BpmButHelp(this,this.defaultForm,{}),this.bpmButFile=new BpmButFile(this,this.defaultForm,{}),this.bpmButTrack=new BpmButTrack(this,this.defaultForm,{}),this.setRoles(),this.hoverRemark(),this.flowForm.controlFormInput(),this.refreshPic(),this.refreshIdea(),this.defaultForm.afterCreateButtons(),$(window).resize(),this.afterInit||(this.defaultForm.afterInit(),this.afterInit=!0)):(this.refreshPic(),this.refreshIdea(),avicAjax.ajax({type:"POST",data:{processInstanceId:c.flowModel.entryId,executionId:c.flowModel.executionId,taskId:c.flowModel.taskId},url:"platform/bpm/business/getoperateright",dataType:"JSON",success:function(d){flowUtils.notNull(d.error)?flowUtils.error(d.error):(c.drawButtons(d),"undefined"!=typeof word_oa_refresh&&flowUtils.notNull(word_oa_refresh)&&word_oa_refresh(c),a&&c.bpmSubmit.clickBut(b),c.defaultForm.afterCreateButtons(),$(window).resize(),c.afterInit||(c.defaultForm.afterInit(),c.afterInit=!0))}}))};FlowEditor.prototype.drawButtons=function(a){var b=a.bpmContent;flowUtils.notNull(b.messageForEver)&&layer.alert(b.messageForEver);this.flowModel.setActivityname(b.processActivityName);this.flowModel.setActivitylabel(b.processActivityLabel);this.flowModel.setUserIdentityKey(b.userIdentityKey);this.flowModel.setUserIdentity(b.userIdentity);this.flowModel.setIdeasBySelf(b.ideasBySelf);this.setRoles();this.hoverRemark();a=a.operateRight;if(null!=a){var c={};$.each(a,function(a,b){"dosubmit"==b.event?(null==c.dosubmit&&(c.dosubmit=[]),c.dosubmit.push(b)):eval("buttonData."+b.event+"\x3d button")});this.bpmSave=new BpmSave(this,this.defaultForm,c);this.bpmRetreat=new BpmRetreat(this,this.defaultForm,c);this.bpmSubmit=new BpmSubmit(this,this.defaultForm,c);this.bpmWithdraw=new BpmWithdraw(this,this.defaultForm,c);this.bpmSupplement=new BpmSupplement(this,this.defaultForm,c);this.bpmAdduser=new BpmAdduser(this,this.defaultForm,c);this.bpmSupersede=new BpmSupersede(this,this.defaultForm,c);this.bpmTransmit=new BpmTransmit(this,this.defaultForm,c);this.bpmWithdrawassignee=new BpmWithdrawassignee(this,this.defaultForm,c);this.bpmFocus=new BpmFocus(this,this.defaultForm,c);this.bpmGlobalend=new BpmGlobalend(this,this.defaultForm,c);this.bpmGlobalidea=new BpmGlobalidea(this,this.defaultForm,c);this.bpmGlobaljump=new BpmGlobaljump(this,this.defaultForm,c);this.bpmGlobalresume=new BpmGlobalresume(this,this.defaultForm,c);this.bpmGlobalsuspend=new BpmGlobalsuspend(this,this.defaultForm,c);this.bpmStepuserdefined=new BpmStepuserdefined(this,this.defaultForm,c);this.bpmTaskreader=new BpmTaskreader(this,this.defaultForm,c);this.bpmPresstodo=new BpmPresstodo(this,this.defaultForm,c);this.bpmStartsubflow=new BpmStartsubflow(this,this.defaultForm,c);this.bpmRelationparentflow=new BpmRelationparentflow(this,this.defaultForm,c);this.bpmRelationflow=new BpmRelationflow(this,this.defaultForm,c);this.bpmButFile=new BpmButFile(this,this.defaultForm,c);this.bpmButTrack=new BpmButTrack(this,this.defaultForm,c);this.bpmButRelation=new BpmButRelation(this,this.defaultForm,c);this.bpmButHelp=new BpmButHelp(this,this.defaultForm,c);this.bpmAttribute=new BpmAttribute(this,this.defaultForm,c);this.flowForm.controlFormInput()}};FlowEditor.prototype.afterStart=function(a){this.isStart=!1;this.flowModel.setDefineId(a.defineId);this.flowModel.setEntryId(a.entryId);this.flowModel.setExecutionId(a.executionId);this.flowModel.setTaskId(a.taskId);this.defaultForm.setId(a.formId)};FlowEditor.prototype.needRefreshPic=!1;FlowEditor.prototype.refreshPic=function(){this.needRefreshPic=!0;if(!$("#bpm_pic_tab").is(":hidden"))if(this.needRefreshPic=!1,null==this.designerEditor){var a=this;0!=$("#graph").length&&initFlowPic(this.flowModel.entryId,this.flowModel.deploymentId,function(b){a.designerEditor=b;a.designerEditor.init(a.flowModel.entryId,a.flowModel.deploymentId);flowUtils.isIE8()&&$("#graph").children("div").css("position","")})}else this.designerEditor.init(this.flowModel.entryId,this.flowModel.deploymentId),flowUtils.isIE8()&&$("#graph").children("div").css("position","")};FlowEditor.prototype.needRefreshIdea=!1;FlowEditor.prototype.refreshIdea=function(){this.needRefreshIdea=!0;$("#bpm_idea_tab").is(":hidden")||(this.needRefreshIdea=!1,this.flowIdea.refresh())};FlowEditor.prototype.getDefineIdByEntryId=function(a){var b=null;$.ajax({type:"POST",async:!1,data:{entryId:a},url:"platform/bpm/business/getDefineIdByEntryId",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):b=a.defineId}});return b};FlowEditor.prototype.hoverRemark=function(){"true"!=$("#help-panel").attr("isload")&&($("#help-panel").attr("isload","true"),$.ajax({type:"POST",data:{defineId:this.flowModel.defineId,activityname:this.flowModel.activityname},url:"platform/bpm/business/getTaskRemark",dataType:"JSON",success:function(a){flowUtils.notNull(a.error)?flowUtils.error(a.error):(a=flowUtils.notNull(a.result)?"\x3cp\x3e"+a.result+"\x3c/p\x3e":"\x3cp\x3e\u5f53\u524d\u8282\u70b9\u65e0\u63cf\u8ff0\x3c/p\x3e",$("#help-panel").html(a))}}))};FlowEditor.prototype.setRoles=function(){$(".nav-role").find("p").text("\u89d2\u8272\uff1a"+this.flowModel.activitylabel+"\u8282\u70b9"+this.flowModel.userIdentity)};var _flow_editor=null;$(function(){$("#formTabParent").append($("#formTab"));$("#formTab").show();$("#formBut").children().each(function(a,b){var c=$(b).attr("order");if(null==c||""==c)c="99";var d=Number(c);d<$(".top-btns").children("ul").children().length&&0<=d?$(".top-btns").children("ul").children().eq(Number(c)).before($(b)):$(".top-btns").children("ul").append($(b))})});