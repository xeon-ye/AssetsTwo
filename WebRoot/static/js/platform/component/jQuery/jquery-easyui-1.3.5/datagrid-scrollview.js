var s;var Sys={};var isIE67=false;var ua=navigator.userAgent.toLowerCase();(s=ua.match(/msie ([\d.]+)/))?Sys.ie=s[1]:(s=ua.match(/firefox\/([\d.]+)/))?Sys.firefox=s[1]:(s=ua.match(/chrome\/([\d.]+)/))?Sys.chrome=s[1]:(s=ua.match(/opera.([\d.]+)/))?Sys.opera=s[1]:(s=ua.match(/version\/([\d.]+).*safari/))?Sys.safari=s[1]:0;if(Sys.ie&&(ua.indexOf("msie 6.0")>1||ua.indexOf("msie 7.0")>1)){isIE67=true}var scrollview=$.extend({},$.fn.datagrid.defaults.view,{render:function(m,e,a){var d=$.data(m,"datagrid");var b=d.options;var q=this.rows||[];if(!q.length){return}var k=$(m).datagrid("getColumnFields",a);if(a){if(!(b.rownumbers||(b.frozenColumns&&b.frozenColumns.length))){return}}var l=this.index;var o=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'];for(var h=0;h<q.length;h++){var j=b.rowStyler?b.rowStyler.call(m,l,q[h]):"";var f="";var p="";if(typeof j=="string"){p=j}else{if(j){f=j["class"]||"";p=j.style||""}}var n='class="datagrid-row '+(l%2&&b.striped?"datagrid-row-alt ":" ")+f+'"';var c=p?'style="'+p+'"':"";var g=d.rowIdPrefix+"-"+(a?1:2)+"-"+l;o.push('<tr id="'+g+'" datagrid-row-index="'+l+'" '+n+" "+c+">");o.push(this.renderRow.call(this,m,k,a,l,q[h]));o.push("</tr>");if(b.detailFormatter){o.push('<tr style="display:none;">');if(a){o.push("<td colspan="+(k.length+2)+' style="border-right:0">')}else{o.push("<td colspan="+(k.length)+">")}o.push('<div class="datagrid-row-detail">');if(a){o.push("&nbsp;")}else{o.push(b.detailFormatter.call(m,h,q[h]))}o.push("</div>");o.push("</td>");o.push("</tr>")}l++}o.push("</tbody></table>");$(e).html(o.join(""))},renderRow:function(m,l,a,n,h){var b=$.data(m,"datagrid").options;var g=[];if(a&&b.rownumbers){var f=n+1;if(b.pagination){f+=(b.pageNumber-1)*b.pageSize}g.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+f+"</div></td>")}for(var j=0;j<l.length;j++){var o=l[j];var e=$(m).datagrid("getColumnOption",o);if(e){var p=h[o];var k=e.styler?(e.styler(p,h,n)||""):"";var d="";var r="";if(typeof k=="string"){r=k}else{if(g){d=k["class"]||"";r=k.style||""}}var q=d?'class="'+d+'"':"";var c=e.hidden?'style="display:none;'+r+'"':(r?'style="'+r+'"':"");g.push('<td field="'+o+'" '+q+" "+c+">");if(e.checkbox){c=""}else{if(e.expander){c="text-align:center;height:16px;"}else{c=r;if(e.align){c+=";text-align:"+e.align+";"}if(!b.nowrap){c+=";white-space:normal;height:auto;"}else{if(b.autoRowHeight){c+=";height:auto;"}}}}g.push('<div style="'+c+'" ');if(e.checkbox){g.push('class="datagrid-cell-check ')}else{g.push('class="datagrid-cell '+e.cellClass)}g.push('">');if(e.checkbox){g.push('<input type="checkbox" name="'+o+'" value="'+(p!=undefined?p:"")+'">')}else{if(e.expander){g.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:16px;height:16px;cursor:pointer;" />')}else{if(e.formatter){g.push(e.formatter(p,h,n))}else{g.push(p)}}}g.push("</div>");g.push("</td>")}}return g.join("")},bindEvents:function(e){var d=$.data(e,"datagrid");var b=d.dc;var c=d.options;var a=b.body1.add(b.body2);var f=($.data(a[0],"events")||$._data(a[0],"events")).click[0].handler;a.unbind("click").bind("click",function(i){var g=$(i.target);var h=g.closest("tr.datagrid-row");if(!h.length){return}if(g.hasClass("datagrid-row-expander")){var j=parseInt(h.attr("datagrid-row-index"));if(g.hasClass("datagrid-row-expand")){$(e).datagrid("expandRow",j)}else{$(e).datagrid("collapseRow",j)}$(e).datagrid("fixRowHeight")}else{f(i)}i.stopPropagation()})},onBeforeRender:function(g){var e=$.data(g,"datagrid");var d=e.options;var b=e.dc;var a=this;e.data.firstRows=e.data.rows;d.finder.getRow=function(k,l){var j=(typeof l=="object")?l.attr("datagrid-row-index"):l;var m=$.data(k,"datagrid").data.rows[j];if(!m){var i=$(k).datagrid("options").view;m=i.rows[j-i.index]}return m};b.body1.add(b.body2).empty();this.rows=undefined;this.r1=this.r2=[];h();c();function h(){e.onLoadSuccess=d.onLoadSuccess;d.onLoadSuccess=function(){};setTimeout(function(){b.body2.unbind(".datagrid").bind("scroll.datagrid",function(i){if(e.onLoadSuccess){d.onLoadSuccess=e.onLoadSuccess;e.onLoadSuccess=undefined}if(a.scrollTimer){clearTimeout(a.scrollTimer);a.scrollTimer=undefined}a.scrollTimer=setTimeout(function(){f.call(a)},300)});b.body2.triggerHandler("scroll.datagrid")},0)}function f(){if(b.body2.is(":empty")){l.call(this)}else{var k=d.finder.getTr(g,this.index,"body",2);var m=d.finder.getTr(g,0,"last",2);var i=b.view2.children("div.datagrid-header").outerHeight();var o=k.position().top-i;var j=m.position().top+m.outerHeight()-i;if(isIE67){o=k.position().top-i+(this.index)*25;j=m.position().top+m.outerHeight()-i+(this.index)*25}if(o>b.body2.height()||j<0){l.call(this)}else{if(o>0){var n=Math.floor(this.index/d.pageSize);this.getRows.call(this,g,n,function(p){this.r2=this.r1;this.r1=p;this.index=(n-1)*d.pageSize;this.rows=this.r1.concat(this.r2);this.populate.call(this,g)})}else{if(j<b.body2.height()){var n=Math.floor(this.index/d.pageSize)+2;if(this.r2.length){n++}this.getRows.call(this,g,n,function(p){if(!this.r2.length){this.r2=p}else{this.r1=this.r2;this.r2=p;this.index+=d.pageSize}this.rows=this.r1.concat(this.r2);this.populate.call(this,g)})}}}}function l(){var r=$(b.body2).scrollTop();var p=Math.floor(r/25);var q=Math.floor(p/d.pageSize)+1;this.getRows.call(this,g,q,function(t){this.index=(q-1)*d.pageSize;this.rows=t;this.r1=t;this.r2=[];this.populate.call(this,g);b.body2.triggerHandler("scroll.datagrid")})}}function c(){if(!d.detailFormatter){return}var m=$(g);var n=false;var j=m.datagrid("getColumnFields",true).concat(m.datagrid("getColumnFields"));for(var l=0;l<j.length;l++){var k=m.datagrid("getColumnOption",j[l]);if(k.expander){n=true;break}}if(!n){if(d.frozenColumns&&d.frozenColumns.length){d.frozenColumns[0].splice(0,0,{field:"_expander",expander:true,width:24,resizable:false,fixed:true})}else{d.frozenColumns=[[{field:"_expander",expander:true,width:24,resizable:false,fixed:true}]]}var m=b.view1.children("div.datagrid-header").find("table");var o=$('<td rowspan="'+d.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:24px;"></div></td>');if($("tr",m).length==0){o.wrap("<tr></tr>").parent().appendTo($("tbody",m))}else{if(d.rownumbers){o.insertAfter(m.find("td:has(div.datagrid-header-rownumber)"))}else{o.prependTo(m.find("tr:first"))}}}setTimeout(function(){a.bindEvents(g)},0)}},onAfterRender:function(b){$.fn.datagrid.defaults.view.onAfterRender.call(this,b);var a=$.data(b,"datagrid").dc;var c=a.footer1.add(a.footer2);c.find("span.datagrid-row-expander").css("visibility","hidden")},getRows:function(e,f,g){var b=$.data(e,"datagrid");var a=b.options;var d=(f-1)*a.pageSize;var i=b.data.firstRows.slice(d,d+a.pageSize);if(i.length){g.call(this,i)}else{var c=$.extend({},a.queryParams,{page:f,rows:a.pageSize});if(a.sortName){$.extend(c,{sort:a.sortName,order:a.sortOrder})}if(a.onBeforeLoad.call(e,c)==false){return}$(e).datagrid("loading");var h=a.loader.call(e,c,function(j){$(e).datagrid("loaded");var j=a.loadFilter.call(e,j);if(j.rows&&j.rows.length){g.call(a.view,j.rows)}},function(){$(e).datagrid("loaded");a.onLoadError.apply(e,arguments)});if(h==false){$(e).datagrid("loaded")}}},populate:function(g){var f=$.data(g,"datagrid");var e=f.options;var a=f.dc;var d=25;if(this.rows.length){e.view.render.call(e.view,g,a.body2,false);e.view.render.call(e.view,g,a.body1,true);if(isIE67){a.body1.add(a.body2).children("table.datagrid-btable").css({marginTop:this.index*d,marginBottom:f.data.total*d-this.rows.length*d-this.index*d})}else{a.body1.add(a.body2).children("table.datagrid-btable").css({paddingTop:this.index*d,paddingBottom:f.data.total*d-this.rows.length*d-this.index*d})}var c=[];for(var b=0;b<this.index;b++){c.push({})}f.data.rows=c.concat(this.rows);e.onLoadSuccess.call(g,{total:f.data.total,rows:this.rows})}}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(b,a){return b.each(function(){var f=$.data(this,"datagrid").options;var e=$.data(this,"datagrid").dc;var d=f.finder.getTr(this,a,"body",1).next();var g=f.finder.getTr(this,a,"body",2).next();if(g.is(":visible")){d.css("height","");g.css("height","");var c=Math.max(d.height(),g.height());d.css("height",c);g.css("height",c)}e.body2.triggerHandler("scroll")})},getExpander:function(c,a){var b=$.data(c[0],"datagrid").options;return b.finder.getTr(c[0],a).find("span.datagrid-row-expander")},getRowDetail:function(d,a){var b=$.data(d[0],"datagrid").options;var c=b.finder.getTr(d[0],a,"body",2);return c.next().find("div.datagrid-row-detail")},expandRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-expand")){h.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.show();g.show();$(this).datagrid("fixDetailRowHeight",a);if(e.onExpandRow){var f=$(this).datagrid("getRows")[a];e.onExpandRow.call(this,a,f)}}})},collapseRow:function(b,a){return b.each(function(){var e=$(this).datagrid("options");var d=$.data(this,"datagrid").dc;var h=$(this).datagrid("getExpander",a);if(h.hasClass("datagrid-row-collapse")){h.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand");var c=e.finder.getTr(this,a,"body",1).next();var g=e.finder.getTr(this,a,"body",2).next();c.hide();g.hide();d.body2.triggerHandler("scroll");if(e.onCollapseRow){var f=$(this).datagrid("getRows")[a];e.onCollapseRow.call(this,a,f)}}})}});