$(document).bind("contextmenu",function(){return false;});if($.messager){$.messager.defaults.ok="确定";$.messager.defaults.cancel="取消"}var LoadDoc=(function(k){var a,l={},c={},h=false,j=0,b,i=false,g=true,n=1,f=function(o){return o.replace(/^\s*|\s*$/g,"")},e=function(o,p){i=true;k.ajax({url:"platform/span/content/getSpanDocByPage.json",type:"get",data:{page:n,rows:a.rows},dataType:"json",success:function(v){k.messager.progress("close");if(v&&v.errno==0){if(v.total>n*a.rows){k("#navTips").text("已加载"+n*a.rows+"个");g=false}else{k("#navTips").text("已加载全部,共"+v.total+"个");g=true}var t=v.rows;for(var u=0;u<t.length;u++){var y=t[u].id;var w=t[u].fsName;var s=t[u].ownerId;var x="";x+="<li class='ui-state-default' id='"+y+"' title='"+w+"'>";var q=t[u].fsMime;if(q>=100&&q<=199){x+="<img src='static/css/platform/pan/images/document/rar.png' alt='500'>"}else{if(q==1||q==2){x+="<img src='static/css/platform/pan/images/document/doc.png' alt='500'>"}else{if(q==3){x+="<img src='static/css/platform/pan/images/document/txt.png' alt='500'>"}else{if(q==4){x+="<img src='static/css/platform/pan/images/document/xml.png' alt='500'>"}else{if(q==5||q==6){x+="<img src='static/css/platform/pan/images/document/xls.png' alt='500'>"}else{if(q==7||q==8){x+="<img src='static/css/platform/pan/images/document/ppt.png' alt='500'>"}else{if(q==11){x+="<img src='static/css/platform/pan/images/document/csv.png' alt='500'>"}else{if(q==12){x+="<img src='static/css/platform/pan/images/document/pdf.png' alt='500'>"}else{if(q==13){x+="<img src='static/css/platform/pan/images/document/psd.png' alt='500'>"}else{x+="<img src='static/css/platform/pan/images/document/document.png' alt='500'>"}}}}}}}}}x+="<div class='docName'>"+w+"</div>";x+="</li>";l[y]=s;c[y]=w;k("#selectable").append(x)}}else{k.messager.show({title:"加载失败！",msg:v.msg})}i=false}});return this},d=function(v,t,o){var s=k("#hiddenFileIds").val();var r=s.split(",");var q=[],u=[];for(var p=0;p<r.length;p++){q.push(r[p]);u.push(c[r[p]])}k.messager.progress();k.ajax({url:"platform/span/share/share.json",type:"post",data:{ids:JSON.stringify(q),fileNames:JSON.stringify(u),userIds:t.userId,userNames:t.userName},dataType:"json",success:function(w){k.messager.progress("close");if(w&&w.errno==0){k.messager.show({title:"提示",msg:"共享成功！"})}else{k.messager.show({title:"提示",msg:w.msg})}}})};var m=function(p){a=k.extend({},{page:1,rows:50,count:50},p);if(a.showDocDiv){$showDocDiv=k("#"+a.showDocDiv);$showDocDiv.scroll(function(t){t.preventDefault();t.stopPropagation();if(g){return false}var s=k(this),o=k(this).height(),q=k(this).get(0).scrollHeight,r=k(this).scrollTop();if(r/(q-o)>=0.98){if(!i){n++;e()}}})}if(a.toolBar){b=k('<div class="navigation"><p><span id="navTips">已全部加载:共0个</span></p><div id="hisContent">共选择<span id="selectFileNum">0</span>个</div></div>');b.appendTo(k("#"+a.toolBar))}if(a.share){k("#"+a.share).bind("click",function(){var o=k("#hiddenFileIds").val();if(o==""){k.messager.alert("操作提示","请选择文档！","warning")}else{k.messager.confirm("操作提示","确定分享选定的文档？",function(q){if(q){new GridCommonSelector("user","","","",{},d,null,null,null,false,null,null,"n").init()}})}})}if(a.del){k("#"+a.del).bind("click",function(){var o=k("#hiddenFileIds").val();if(o==""){k.messager.alert("操作提示","请选择文档！","warning")}else{k.messager.confirm("操作提示","确定删除选定的文档？",function(q){if(q){var s=[];var t=o.split(",");for(var r=0;r<t.length;r++){s.push(t[r])}k.messager.progress();k.ajax({url:"platform/span/content/delete.json",type:"post",data:{ids:JSON.stringify(s)},dataType:"json",success:function(u){k.messager.progress("close");if(u&&u.errno==0){k.messager.show({title:"提示",msg:"删除成功！"});n=1;k("#selectable").empty();e();k("#hiddenFileIds").val("");k("#selectFileNum").html("0");if(parent&&parent.nav){parent.nav.loadSize().needReycble()}}else{k.messager.show({title:"提示",msg:u.msg})}}})}})}})}if(a.download){k("#"+a.download).bind("click",function(){var o=k("#hiddenFileIds").val();if(o==""){k.messager.alert("操作提示","请选择文档！","warning")}else{if(o.split(",").length>1){k.messager.alert("操作提示","一次只能下载一个文档！","warning")}else{var r=[{key:o,value:l[o]}];var q="platform/span/content/down.json?objs="+JSON.stringify(r);new DownLoad4URL("iframe","form",null,q).downLoad()}}})}};return{init:function(p){m(p);return this},loadData:function(){e();return this}}}(jQuery));