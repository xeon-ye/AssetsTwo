$(document).bind("contextmenu",function(){return false;});var dirTree=dirTree||(function(f){var a,i={},b={},c=false,h=function(j){a=f.extend({},{level:2},j);if(a.tree){i=f("#"+a.tree).tree({url:"platform/span/content/dirtree/2",method:"GET",onClick:function(k){b=k;if(k.state==="closed"){i.tree("expand",k.target)}else{i.tree("collapse",k.target)}},onLoadSuccess:function(k,l){if(!k){b=i.tree("find","-1");i.tree("select",b.target)}}})}if(a.insert){f("#"+a.insert).bind("click",function(){var l=b.target,k;if(b.state==="closed"){i.tree("expand",l)}if(c){k=i.tree("find","-3").target;i.tree("scrollTo",k).tree("select",k);f(".tree-editor").focus().select();return}i.tree("append",{parent:l,data:[{id:"-3",text:"新建文件夹"}]});(function(p){var n=f('<span class="sure"></span>').bind("click",function(){m()}),o=f('<span class="cancel"></span>').bind("click",function(q){q.stopPropagation();i.tree("remove",i.tree("find","-3").target).tree("select",p.target);b=p;c=false}),m=function(){var q=f(".tree-editor").val();if(g(q)){return}q=d(q);f.messager.progress();f.ajax({url:"platform/span/content/create.json",type:"post",data:{text:q,parent:p.id},dataType:"json",success:function(s){f.messager.progress("close");if(s&&s.errno==0){var t=i.tree("find","-3").target;i.tree("cancelEdit",t).tree("update",{target:t,text:s.name,id:s.fid});c=false}else{f.messager.show({title:"创建文件夹失败！",msg:s.msg})}}})};i.tree("beginEdit",i.tree("find","-3").target);c=true;f(".tree-editor").css("position","relative").unbind("blur").unbind("keydown").bind("keydown",function(q){if(q.keyCode==13){m();return false}else{if(q.keyCode==27){q.stopPropagation();i.tree("remove",i.tree("find","-3").target).tree("select",p.target);b=p;c=false;return false}}}).after(o).after(n)})(b)})}if(a.close){f("#"+a.close).bind("click",function(){parent&&parent.dirTree&&parent.dirTree.closeDig("#insert");return false})}if(a.save){f("#"+a.save).bind("click",function(){parent&&parent.dirTree&&parent.dirTree.closeDig("#insert").getOkBack()({id:b.id,name:b.text});return false})}},g=function(j){if(!j){alert("文件夹名称不能为空");return true}if((/[\\/\:\?\"<>\*]+/).test(j)){alert("文件名不能包含以下字符：<,>,|,*,?,,/");return true}return false},d=function(j){return j.replace(/^\s*|\s*$/g,"")},e={};return{show:function(j){new CommonDialog("insert","500","350","avicit/platform6/yun/pan/content/dicTree.jsp",j,false,true,false).show();return this},init:function(j){h(j);return this},setOkBack:function(j){e=j;return this},getOkBack:function(){return e},closeDig:function(j){f(j).dialog("close");return this}}}(jQuery));