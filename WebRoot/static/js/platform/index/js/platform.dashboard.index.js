var winWidth=0;var winHeight=0;var bannerHeight=0;var menuHeigth=0;var tabsHeaderHeight=0;var footerHeight=0;var leftMenuWidth=0;var options={speed:"fast",effect:"fade"};var headLeftWidth=0;var splitWidth=0;$(function(){headLeftWidth=$("#head-left").outerWidth(true);splitWidth=$("#split").outerWidth(true);initHeight();if(messageCount>0){$(".msgbg").css("display","block")}initArrow();initMenu();reSizeWindow();initTabs();initPortletSetting();window.onresize=reSizeWindowAfter});function initHeight(){if($("#divBodyWidth").length==1){if($("#divBodyWidth").css("display")=="block"){bannerHeight=$("#divBodyWidth").outerHeight(true)}else{bannerHeight=0}}if($("div.index-menu").length==1){menuHeigth=$("div.index-menu").outerHeight(true)}else{if($("#headtop").length==1){menuHeigth=$("#headtop").outerHeight(true)}}if($("div.tabs-header").length==1){tabsHeaderHeight=$("div.tabs-header").outerHeight(true)}if($("#copyFooter").length==1){footerHeight=$("#copyFooter").outerHeight(true)}if(window.innerWidth){winWidth=window.innerWidth}else{if((document.body)&&(document.body.clientWidth)){winWidth=document.body.clientWidth}}if(window.innerHeight){winHeight=window.innerHeight}else{if((document.body)&&(document.body.clientHeight)){winHeight=document.body.clientHeight}}if(document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth){winHeight=document.documentElement.clientHeight;winWidth=document.documentElement.clientWidth}if($("#head-left").length==1){if($("#head-left").css("display")=="block"){leftMenuWidth=$("#head-left").outerWidth(true)}else{leftMenuWidth=0}}}function addTab(g,d,h,c,f){if(g.length>20){g=g.substring(0,20)}var e=winHeight-bannerHeight-menuHeigth-tabsHeaderHeight-footerHeight;var j=winWidth-leftMenuWidth;var b=true;if(c=="homePage"||c=="portal"){b=false}var a=parseInt(Math.random()*100000);if($("#tabs").tabs("exists",g)){$("#tabs").tabs("select",g);$("."+g).attr("src",d);closeMegaDrop()}else{if(d.indexOf("target=_blank")!=-1){window.open(d)}else{if(d.indexOf("javascript")==-1&&d!=""){if(h==""||h==null){currentTab=$("#tabs").tabs("add",{title:g,content:"<iframe id=iframeBody class='"+g+"' title='"+c+"' style='overflow-y:auto;overflow-x:hidden;height:"+e+"px;width:"+j+"px;' src="+d+"  frameborder=0 ></iframe>",closable:b,onclick:closeMegaDrop()})}else{currentTab=$("#tabs").tabs("add",{title:g,iconCls:"_"+a+"tabIcon",content:"<iframe id=iframeBody class='"+g+"' title='"+c+"' style='overflow-y:auto;overflow-x:hidden;height:"+e+"px;width:"+j+"px;' src="+d+"  frameborder=0 ></iframe>",closable:b,onclick:closeMegaDrop()});$("._"+a+"tabIcon").css("background","url('"+h+"') no-repeat").css("background-position",f)}}}}}function closeMegaDrop(){$(".sub").hide();$(".sub-container").hide();var a=$(".sub").parent().parent();if(a.hasClass("mega-hover")){a.removeClass("mega-hover")}}function initTabs(){$("#tabs").tabs({onSelect:function(a){if(a==homePage){$(".portlet").css("display","")}else{$(".portlet").css("display","none")}}});$(".tabs li").live("contextmenu",function(c){var a=$(this).text();var b=$("#tabs").tabs("tabs").length;if(b==1){$("#m-closeother").attr({disabled:"disabled"}).css({cursor:"default",opacity:"0.4"});$("#m-closeall").attr({disabled:"disabled"}).css({cursor:"default",opacity:"0.4"});$("#m-close").attr({disabled:"disabled"}).css({cursor:"default",opacity:"0.4"})}else{if(b==2){$("#m-closeall").remove("disabled");$("#m-closeall").removeAttr("style");if(a==homePage){if(typeof($("#m-close").attr("disabled"))=="undefined"){$("#m-close").attr({disabled:"disabled"}).css({cursor:"default",opacity:"0.4"})}$("#m-closeother").remove("disabled");$("#m-closeother").removeAttr("style")}else{$("#m-close").remove("disabled");$("#m-close").removeAttr("style");if(typeof($("#m-closeother").attr("disabled"))=="undefined"){$("#m-closeother").attr({disabled:"disabled"}).css({cursor:"default",opacity:"0.4"})}}}else{$("#m-closeother").remove("disabled");$("#m-closeall").remove("disabled");$("#m-close").remove("disabled");$("#m-closeall").removeAttr("style");$("#m-close").removeAttr("style");$("#m-closeother").removeAttr("style");if(a==homePage){if(typeof($("#m-close").attr("disabled"))=="undefined"){$("#m-close").attr({disabled:"disabled"}).css({cursor:"default",opacity:"0.4"})}}}}$("#tabs").tabs("select",a);$("#context_menu").menu("show",{left:c.pageX,top:c.pageY});return false});$("#m-refresh").click(function(){var a=$("#tabs").tabs("getSelected");var b=$(a.panel("options").content).attr("src");var c=$(a.panel("options").content)[0].className;$("."+c).attr("src",b)});$("#m-closeall").click(function(){$(".tabs li").each(function(a,c){var b=$(c).text();if(b!=homePage){$("#tabs").tabs("close",b)}})});$("#m-closeother").click(function(){var a=$("#tabs").tabs("getSelected");currTitle=a.panel("options").title;$(".tabs li").each(function(b,d){var c=$(d).text();if(currTitle!=c&&c!=homePage){$("#tabs").tabs("close",c)}})});$("#m-close").click(function(){var a=$("#tabs").tabs("getSelected");currTitle=a.panel("options").title;if(currTitle!=homePage){$("#tabs").tabs("close",currTitle)}})}function initArrow(){$("#arrowUpAndDown").click(function(){var a=$("#arrowUpAndDown").hasClass("arrowUp");if(a==false){$("#arrowUpAndDown").removeClass("arrowDown");$("#arrowUpAndDown").addClass("arrowUp");$("#divBodyWidth").show();reSizeTabsHeight()}else{$("#arrowUpAndDown").removeClass("arrowUp");$("#arrowUpAndDown").addClass("arrowDown");$("#divBodyWidth").hide();reSizeTabsHeight()}})}var changeLgg=function(c){var a=$("#language"),b;if(a.length===0){b=$('<div id="language"></div>').dialog({title:c,width:300,height:150,closed:false,cache:true,zIndex:1,modal:true}).html($("<iframe name='languageFrame' id='languageFrame' scrolling='yes' frameborder='0' src='"+baseUrl+"platform/syslanguage/change' style='width:100%;height:91%;'></iframe>"));return}a.dialog("open")};function logout(){if(confirm(logoutTip)){window.location=baseUrl+"platform/user/logout"}}function openSubWindow_pwd(){$("#modify_dialog").dialog().html($("<iframe name='applyPasFrame' id='applyPasFrame' scrolling='yes' frameborder='0' src='"+baseUrl+"platform/syspassword/sysPasswordController/toPassword' style='width:100%;height:91%;'></iframe>"))}function showVersion(){$("#versionDialog").dialog().html($("<iframe name='applyVerFrame' id='applyVerFrame' scrolling='yes' frameborder='0'  src='"+baseUrl+"platform/systemversion/toVesionAlert' style='width:100%;height:100%;'></iframe>"))}function reSizeWindow(){initHeight();$("#tabs").height(winHeight-bannerHeight-menuHeigth-footerHeight);$("#head-left").height(winHeight-bannerHeight-menuHeigth-footerHeight);$("#left-menu-header").height(winHeight-bannerHeight-menuHeigth-footerHeight);$("#split").height(winHeight-bannerHeight-menuHeigth-footerHeight);$(".tabs li").each(function(a,e){var d=$(e).text();var c=$("#tabs").tabs("getTab",d);if(c){var b=c.find('iframe[id="iframeBody"]');b.height(winHeight-bannerHeight-tabsHeaderHeight-menuHeigth-footerHeight);b.width(winWidth-leftMenuWidth)}$(".panel-body-noborder").width(winWidth-leftMenuWidth)});$("#divBodyWidth").width(winWidth);$("#tabs").width(winWidth-leftMenuWidth);$(".tabs-wrap").width(winWidth-leftMenuWidth)}function reSizeWindowAfter(){try{$.fn.dcMegaMenu(options,"1")}catch(a){}reSizeWindow();initMenu()}function reSizeTabsHeight(){initHeight();$("#tabs").height(winHeight-bannerHeight-menuHeigth-footerHeight);$("#head-left").height(winHeight-bannerHeight-menuHeigth-footerHeight);$("#left-menu-header").height(winHeight-bannerHeight-menuHeigth-footerHeight);$("#split").height(winHeight-bannerHeight-menuHeigth-footerHeight);$(".tabs li").each(function(a,e){var d=$(e).text();var c=$("#tabs").tabs("getTab",d);if(c){var b=c.find('iframe[id="iframeBody"]');b.height(winHeight-bannerHeight-tabsHeaderHeight-menuHeigth-footerHeight)}})}function reSizeTabsWidth(){initHeight();$("#tabs").width(winWidth-leftMenuWidth);$(".tabs-wrap").width(winWidth-leftMenuWidth);$(".tabs li").each(function(a,e){var d=$(e).text();var c=$("#tabs").tabs("getTab",d);if(c){var b=c.find('iframe[id="iframeBody"]');b.width(winWidth-leftMenuWidth)}$(".panel-body-noborder").width(winWidth-leftMenuWidth)})}function onFocusEvent(a){if(a.value==onFocusTip){a.value=""}}function onBlurEvent(a){if(a.value==""){a.value=onFocusTip}}function savePortlet(){$("#portletConfigIframe")[0].contentWindow.$saveConfigPersonPortlet()}function restDefault(){if(confirm(resetPorletTip)){$.ajax({url:baseUrl+"platform/portlet/restDefault",method:"GET",async:false,success:function(a){}});refreshPortlet($("#iframeBody")[0].contentWindow.flag)}$("#menu").hide()}function setGlobalPortlet(){$("#iframeBody").attr("src",baseUrl+"platform/portlet/getContent?flag=global");$("#menu").hide();return false}function saveLayout(){var a="";var b=$("#portletConfigIframe")[0].contentWindow.document.getElementsByName("layout");for(i=0;i<b.length;i++){if(b[i].checked){a=b[i].value}}$.ajax({url:baseUrl+"platform/portlet/saveSelectLayout?flag="+$("#portletConfigIframe")[0].contentWindow.flag,method:"GET",dataType:"text",async:false,data:"layoutValue="+a,success:function(c){}});hideDialog();refreshPortlet()}function saveLayout1(){var b=$("#portletConfigIframe")[0].contentWindow;var a=b.saveConfigResultXml();alert("布局设置成功!");hideDialog();refreshPortlet()}function hideDialog(){$.mask("close");$("#overlay").hide();$("#save").unbind("click");$("#dialog").fadeOut(100)}function refreshPortlet(a){if(typeof(a)=="undefined"){a=""}$("#iframeBody").attr("src",baseUrl+"platform/portlet/getContent?flag="+a);return false}function setPortlet(){$("#setPortlet_dialog").dialog("open");return false}function showDialog(modal,title,w,h,iframeSrc,saveClickEvent){$.mask();$("#overlay").show();if(typeof(title)!="undefined"){$(".web_dialog_title span").text(title)}if(typeof(title)!="saveClickEvent"){$("#save").bind("click",function(){eval(saveClickEvent)})}var left=(screen.availWidth-w-30)/2;var top=(screen.availHeight-h-30)/2;$("#dialog").css({width:w,height:h,top:top,left:left});$("#dialog #context").css({height:h-75});if(typeof(iframeSrc)!="undefined"){var flag=$("#iframeBody")[0].contentWindow.flag;$("#dialog #context").html("<iframe id='portletConfigIframe' name='portletConfigIframe' src='"+iframeSrc+"' width='100%' height='"+(h-75)+"px' frameborder='0' marginheight='0' marginwidth='0' scrolling='auto'></iframe>")}else{$("#dialog #context").html("<span></span>")}$("#dialog").fadeIn(300);if(modal){$("#overlay").unbind("click")}else{$("#overlay").click(function(e){hideDialog()})}var obj=document.getElementById("dialog");rDrag.init(obj);$("#menu").hide()}var rDrag={o:null,init:function(a){a.onmousedown=this.start},start:function(a){var b;a=rDrag.fixEvent(a);a.preventDefault&&a.preventDefault();rDrag.o=b=this;b.x=a.clientX-rDrag.o.offsetLeft;b.y=a.clientY-rDrag.o.offsetTop;document.onmousemove=rDrag.move;document.onmouseup=rDrag.end},move:function(c){c=rDrag.fixEvent(c);var a,b;a=c.clientX-rDrag.o.x;b=c.clientY-rDrag.o.y;rDrag.o.style.left=a+"px";rDrag.o.style.top=b+"px"},end:function(a){a=rDrag.fixEvent(a);rDrag.o=document.onmousemove=document.onmouseup=null},fixEvent:function(a){if(!a){a=window.event;a.target=a.srcElement;a.layerX=a.offsetX;a.layerY=a.offsetY}return a}};function initPortletSetting(){setTimeout(function(){$("#tabs .tabs-header .tabs-wrap .tabs").css("float","left");$("#tabs .tabs-header .tabs-wrap").append("<div class='portlet'></div>");$(".portlet").click(function(){$("#menu").show()});$("#portlet").bind("mouseout",function(){setTimeout(function(){$("#menu").hide()},800)});$("#tooltip_menu").bind("mouseenter",function(){$("#portlet").unbind("mouseout")}).bind("mouseleave",function(){$("#menu").hide()})},500);$("#menu #tooltip_menu a").mouseover(function(){$(this).addClass("mouseover")}).mouseout(function(){$(this).removeClass("mouseover")});var a=0;$.mask=function(c){if(typeof c=="undefined"){c="open"}if(c=="open"){if(a==0){var b=$("<div id='window-mask' class='window-mask' style='display:none'></div>").appendTo("body");b.css({width:$(window).width()+"px",height:$(window).height()+"px"}).fadeIn(function(){$(this).css("filter","alpha(opacity=60)")});$(window).bind("resize.mask",function(){b.css({width:$(window).width()+"px",height:$(window).height()+"px"})})}a++}else{if(c=="close"){a--;if(a==0){$("#window-mask").fadeOut(function(){$("#window-mask").remove()});$(window).unbind("resize.mask")}}}};$("#btnClose").click(function(b){$.mask("close");hideDialog();b.preventDefault()})}function initMenu(){var g=$("div.menu-scroller-left");var j=$("div.menu-scroller-right");var b=0;var k;if($("div.index-menu").length>0){$("ul.mega-menu > li").each(function(){b+=$(this).outerWidth(true)});k=$("ul.mega-menu")}else{if($("#headtop").length>0){$("#navigation > li").each(function(){b+=$(this).outerWidth(true)});k=$("#navigation")}else{return}}if(b>winWidth){g.add(j).show();if(false){var a=g.outerWidth(true)-b;var d=g.outerWidth(true);var f=g.outerWidth(true)-b*2;var c=$("ul.mega-menu > li").clone(true);$("ul.mega-menu").append(c);$("ul.mega-menu").append(c.clone(true));$("ul.mega-menu").css("width",(b*3+50)+"px");$("div.menu-header").css("margin-left",a+"px");if($.browser.msie&&$.browser.version=="6.0"){j.css("left",(winWidth-j.outerWidth(true))+"px");$("div.menu-arrow").css("left",(winWidth-j.outerWidth(true)-$("div.menu-arrow").outerWidth())+"px")}else{j.css("left","");$("div.menu-arrow").css("left","");$("div.menu-arrow").css("right",j.outerWidth(true)+"px")}var e;$("div.menu-scroller-left").unbind().bind("mouseover",function(l){e=setInterval(function(){var m=parseInt($("div.menu-header").css("marginLeft"));m++;if(m>=d){m=a}$("div.menu-header").css({marginLeft:m})},5)}).bind("mouseout",function(l){clearInterval(e)});$("div.menu-scroller-right").unbind().bind("mouseover",function(l){e=setInterval(function(){var m=parseInt($("div.menu-header").css("marginLeft"));m--;if(m<=f){m=a}$("div.menu-header").css({marginLeft:m})},5)}).bind("mouseout",function(l){clearInterval(e)})}else{k.css("width",(b+50)+"px");$("div.menu-header").css({marginLeft:g.outerWidth(true)});if($.browser.msie&&$.browser.version=="6.0"){j.css("left",(winWidth-j.outerWidth(true))+"px");$("div.menu-arrow").css("left",(winWidth-j.outerWidth(true)-$("div.menu-arrow").outerWidth())+"px")}else{j.css("left","");$("div.menu-arrow").css("left","");$("div.menu-arrow").css("right",j.outerWidth(true)+"px")}var h=b-1-winWidth+j.outerWidth(true)+$("div.menu-arrow").outerWidth(true);$("div.menu-scroller-left").unbind().bind("click",function(m){var l=parseInt($("div.menu-header").css("marginLeft"));var n=Math.min(l+200,g.outerWidth(true));$("div.menu-header").animate({marginLeft:n},50)});$("div.menu-scroller-right").unbind().bind("click",function(m){var l=parseInt($("div.menu-header").css("marginLeft"));var n=Math.max(l-200,-h);$("div.menu-header").animate({marginLeft:n},50)})}$("div.menu-scroller-left").hover(function(){$(this).addClass("menu-scroller-left-hover")},function(){$(this).removeClass("menu-scroller-left-hover")});$("div.menu-scroller-right").hover(function(){$(this).addClass("menu-scroller-right-hover")},function(){$(this).removeClass("menu-scroller-right-hover")});if($("#mega-menu").length>0){$("#mega-menu").dcMegaMenu(options,"1")}}else{g.add(j).hide();k.css("width","100%");$("div.menu-header").css("margin-left","0px");j.css("left","");$("div.menu-arrow").css("left","");$("div.menu-arrow").css("right","0px");if($("#mega-menu").length>0){$("#mega-menu").dcMegaMenu(options,"0")}}}function switchSkin(a){if(skinSwitch!=null&&skinSwitch=="false"){return}doChangeSkin(a,window);saveUserSkin(a);if(typeof(initMenu)!="undefined"){setTimeout(function(){initMenu()},1000)}}function doChangeSkin(g,f){var c="static/css/platform/themes/";switchHref(g,c,f);c="static/css/custom/themes/";switchHref(g,c,f);var c="static/js/platform/component/jQuery/jquery-easyui-1.3.5/themes/";switchHref(g,c,f);var h=f.document.getElementsByTagName("iframe");for(var b=0;b<h.length;b++){var a=h[b].contentWindow;if(a){try{doChangeSkin(g,a)}catch(d){}}}}function switchHref(j,b,f){var h=f.$('link[rel="stylesheet"]');for(var c=0;c<h.length;c++){var a=$(h[c]).attr("href");if(a&&a.indexOf(b)!=-1){var e=a.indexOf(b)+b.length;var d=a.indexOf("/",e);if(d!=-1){var g=a.substring(0,e)+j+a.substring(d);$(h[c]).attr("href",g)}}}}function saveUserSkin(a){$.ajax({url:"platform/syscustomed/sysCustomedController/saveCustomesSkin.json",data:{skin:a},type:"post",dataType:"json",success:function(b){}})}function showSubMenu(c){var b=$(c).parent().parent().find("> li");b.each(function(){if(this!=$(c).parent()[0]){var d=$(this).find("> ul");if(d.css("display")!="none"){d.hide();$(this).find("a:first").removeClass("expand")}}});var a=$(c).parent().find("> ul");if(a.css("display")=="none"){a.show();$(c).find("> a").addClass("expand")}else{a.hide();$(c).find("> a").removeClass("expand")}}function selectMenu(a){$(a).addClass("select")}function unSelectMenu(a){$(a).removeClass("select")}function doSplit(a){if($(a).hasClass("open")){$("#head-left").animate({width:headLeftWidth},{speed:500,complete:function(){$("#left-menu-header").show();$(a).removeClass("open");reSizeTabsWidth();$("#divBody").css("left",(headLeftWidth+1)+"px")}})}else{$("#head-left").animate({width:splitWidth},{speed:500,complete:function(){$("#left-menu-header").hide();$(a).addClass("open");reSizeTabsWidth();$("#divBody").css("left",(splitWidth+1)+"px")},step:function(){}})}}function initSearch(){var a="platform/search/search.html";$("#subjectSearch").bind("keyup",function(b){if(b.keyCode=="13"){doSearchAddTab()}});$("#searchIcon").bind("click",function(b){doSearchAddTab()})}function doSearchAddTab(){var a=$.trim($("#subjectSearch").val());if(a!=""){a=encodeURIComponent(a);a=encodeURIComponent(a);addTab("搜索首页","platform/search/search.html?keywords="+a+"&isFromAgile=1","","sysSearchResult","")}}function openDeptWin(){$("#change_dept_dialog").dialog().html($("<iframe name='deptFrame' id='deptFrame' scrolling='yes' frameborder='0' src='"+baseUrl+"platform/sysuser/toChangeDept' style='width:100%;height:91%;'></iframe>"))}function openMyWorkbench(){window.open(getPath2()+"/platform/myWorkbenchController/getIndex")};